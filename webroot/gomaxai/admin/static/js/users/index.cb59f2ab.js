
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,u as l,r as a,G as t,x as o,j as r,o as s,c as d,b as i,f as u,g as n,V as p,W as c,e as m,h as f,t as v,J as g,S as y,P as b,y as h,p as x,k as w,_,q as V}from"../main-5b9099dc.js";import{u as k}from"../index/index.7e2cb35b.js";import{u as z}from"../utcformatTime/utcformatTime.f6db2c52.js";const F=e=>(x("data-v-1ecebd4e"),e=e(),w(),e),U={class:"user_list_box"},C={class:"search_add_card"},j={style:{display:"flex","align-items":"center"}},A=F((()=>i("div",{class:"condition_name"},"搜索关键字",-1))),D={style:{"margin-left":"10px"}},M=F((()=>i("div",{class:"condition_name"},"是否开通会员",-1))),I={style:{"margin-left":"10px"}},E=F((()=>i("div",{class:"condition_name"},"用户状态",-1))),P={style:{"margin-left":"10px"}},Y={class:"table_card"},q={style:{display:"flex","align-items":"center"}},B=["src"],S={style:{color:"#20295A","font-weight":"400","font-size":"13px","margin-left":"5px"}},R={key:1},$={style:{"font-size":"13px"}},T={style:{display:"flex"}},G={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},J=F((()=>i("div",null," 赠送会员 ",-1))),N={style:{padding:"0 20px"}},W={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},H=F((()=>i("div",null," 修改用户状态 ",-1))),K={style:{padding:"0 20px"}},L={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},O=F((()=>i("div",null," 赠送积分 ",-1))),Q={style:{padding:"0 20px"}},X={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},Z=F((()=>i("div",null," 创建账号12 ",-1))),ee={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},le={key:0},ae={key:1},te={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},oe=e({__name:"index",setup(e){const x=l();a();const w=a(0),_=a(!1),V=a(!1),F=a(!1),oe=a(0);a();const re=a(!1),se=a(!1),de=a(0),ie=t({userId:"",days:""}),ue=t({userId:"",score:""}),ne=t({keyword:"",vip:"",status:"",page:1,size:15}),pe=a([]),ce=a(),me=a({username:"",nickname:"",phone:"",email:"",password:""}),fe=a({num:1,score:1,vipDays:1}),ve=t({status:"",id:0}),ge=t({username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:6,message:"用户名不能少于6位",trigger:"blur"}],nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],phone:[{required:!0,message:"手机号不能为空",trigger:"blur"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:6,message:"密码不能少于6位",trigger:"blur"}]}),ye=a([{value:0,label:"未开通"},{value:1,label:"已开通"}]);async function be(){try{V.value=!0;const e=await y.queryAllUser(ne),{rows:l,count:a}=e.data;V.value=!1,w.value=a,pe.value=l}catch(e){V.value=!1}}async function he(){if(0==x.isUserModifyPermissions())return b.error("非超级管理员无权限操作！");(await y.updateUserStatus(ve)).success&&b({type:"success",message:"变更用户状态成功！"}),_.value=!1,be()}function xe(){ne.keyword="",ne.vip="",ne.status="",ne.page=1,ne.size=15,be()}function we(){ce.value.validate((async e=>{if(!e)return;if(0==x.isUserModifyPermissions())return b.error("非超级管理员无权限操作！");let l="";if(0==de.value)l=await y.createUser({username:me.value.username,nickname:me.value.nickname,phone:me.value.phone,email:me.value.email,password:me.value.password});else{if(""==fe.value.num||fe.value.num<=0||null==fe.value.num)return b.error("创建的用户数量不能为空或者不能少于1");if(""==fe.value.score||fe.value.score<=0||null==fe.value.score)return b.error("积分数量不能为空或者不能少于1");if(""==fe.value.vipDays||fe.value.vipDays<=0||null==fe.value.vipDays)return b.error("会员天数不能为空或者不能少于1");l=await y.batchCreateUser(fe.value)}200==l.code?(b.success("创建用户成功！"),se.value=!1,be()):b.error(l.data)}))}async function _e(){if(0==x.isUserModifyPermissions())return b.error("非超级管理员无权限操作！");if(""==ie.days||null==ie.days)return void b({type:"error",message:"赠送的会员天数不能为空"});const e=await y.giftUserVip(ie);200==e.code?(b({type:"success",message:"会员赠送成功"}),re.value=!1,be()):b({type:"error",message:e.data})}async function Ve(){if(0==x.isUserModifyPermissions())return b.error("非超级管理员无权限操作！");if(""==ue.score||null==ue.score)return void b({type:"error",message:"赠送的积分数量不能为空"});const e=await y.giftUserIntegral(ue);200==e.code?(b({type:"success",message:"积分赠送成功"}),F.value=!1,be()):b({type:"error",message:e.data})}return o((()=>be())),(e,l)=>{const a=r("el-input"),t=r("el-option"),o=r("el-select"),V=r("el-button"),ke=r("RefreshRight"),ze=r("el-icon"),Fe=r("el-table-column"),Ue=r("el-tag"),Ce=r("el-popconfirm"),je=h,Ae=r("el-popover"),De=r("el-table"),Me=r("el-pagination"),Ie=r("el-row"),Ee=r("el-form-item"),Pe=r("el-form"),Ye=r("el-dialog");return s(),d("div",U,[i("div",C,[i("div",j,[i("div",null,[A,u(a,{modelValue:ne.keyword,"onUpdate:modelValue":l[0]||(l[0]=e=>ne.keyword=e),placeholder:"用户名/呢称/手机号/邮箱",style:{width:"200px"}},null,8,["modelValue"])]),i("div",D,[M,u(o,{clearable:"",modelValue:ne.vip,"onUpdate:modelValue":l[1]||(l[1]=e=>ne.vip=e),placeholder:"请选择会员状态",style:{width:"150px"}},{default:n((()=>[(s(!0),d(p,null,c(ye.value,(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),i("div",I,[E,u(o,{clearable:"",modelValue:ne.status,"onUpdate:modelValue":l[2]||(l[2]=e=>ne.status=e),placeholder:"请选择用户状态",style:{width:"150px"}},{default:n((()=>[(s(!0),d(p,null,c(m(k),(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),i("div",P,[u(V,{bg:"",text:"",type:"primary",size:"large",style:{"font-size":"15px",height:"32px",background:"#EFF6FF",color:"#60A5FA","border-radius":"8px","margin-top":"25px"},onClick:be},{default:n((()=>[f(" 查询 ")])),_:1})]),i("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:xe},[u(ze,{color:"#3B82F6",size:"20"},{default:n((()=>[u(ke)])),_:1})])]),i("div",null,[u(V,{style:{"border-radius":"8px",border:"1px solid #3B82F6",color:"#3B82F6","font-size":"15px",height:"32px","margin-top":"25px"},onClick:l[3]||(l[3]=e=>se.value=!0)},{default:n((()=>[f(" 创建账号 ")])),_:1})])]),i("div",Y,[u(De,{border:"","highlight-current-row":"",data:pe.value,style:{width:"100%"},"max-height":"70vh"},{default:n((()=>[u(Fe,{label:"用户昵称",width:"180"},{default:n((e=>[i("div",q,[i("div",null,[i("img",{style:{width:"24px",height:"24px","border-radius":"50%","margin-top":"5px"},src:e.row.avatar},null,8,B)]),i("div",S,v(e.row.nickname),1)])])),_:1}),u(Fe,{label:"用户名",width:"180"},{default:n((e=>[f(v(null==e.row.username?"--":e.row.username),1)])),_:1}),u(Fe,{prop:"phone",label:"手机号",width:"160",style:{"font-size":"13px"}},{default:n((e=>[f(v(null==e.row.phone?"--":e.row.phone),1)])),_:1}),u(Fe,{prop:"email",label:"邮箱",width:"200",style:{"font-size":"13px"}},{default:n((e=>[f(v(null==e.row.email?"--":e.row.email),1)])),_:1}),u(Fe,{prop:"score",label:"当前积分",width:"120",style:{"font-size":"13px"}}),u(Fe,{prop:"vipExpire",label:"会员到期时间",style:{"font-size":"13px"}},{default:n((e=>[null==e.row.vipExpire?(s(),g(Ue,{key:0,type:"info"},{default:n((()=>[f("非会员")])),_:1})):(s(),d("div",R,v(m(z)(e.row.vipExpire,"YYYY-MM-DD hh:mm:ss")),1))])),_:1}),u(Fe,{prop:"status",label:"账号状态",width:"90"},{default:n((e=>[u(Ue,{type:1==e.row.status?"success":"danger"},{default:n((()=>[f(v(m(k)[e.row.status].label),1)])),_:2},1032,["type"])])),_:1}),u(Fe,{prop:"createdAt",label:"注册时间"},{default:n((e=>[i("div",$,v(m(z)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),u(Fe,{fixed:"right",label:"操作",width:"200"},{default:n((e=>[i("div",T,[i("div",null,[u(V,{size:"small",link:"",style:{color:"#3B82F6","font-size":"13px","font-weight":"400"},onClick:l=>{return a=e.row,_.value=!0,ve.status=a.status,void(ve.id=a.id);var a}},{default:n((()=>[f("修改状态 ")])),_:2},1032,["onClick"]),u(Ce,{title:"确认重置此用户密码为【123456】?","confirm-button-text":"确认重置",onConfirm:l=>async function(e){if(0==x.isUserModifyPermissions())return b.error("非超级管理员无权限操作！");const{id:l,email:a}=e;(await y.resetUserPassword({id:l})).success&&b({type:"success",message:`重置用户[${a}密码为初始密码为[123456]完成！`})}(e.row)},{reference:n((()=>[u(V,{size:"small",link:"",style:{color:"#3B82F6","font-size":"13px","font-weight":"400"}},{default:n((()=>[f("重置密码 ")])),_:1})])),_:2},1032,["onConfirm"])]),u(Ae,{placement:"bottom",trigger:"click",content:"this is content, this is content, this is content","popper-class":"el-popover-self"},{reference:n((()=>[i("div",null,[u(ze,{size:24,style:{"margin-left":"10px"}},{default:n((()=>[u(je,{name:"more"})])),_:1})])])),default:n((()=>[i("div",null,[u(V,{style:{width:"100%",border:"none"},onClick:l=>async function(e){re.value=!0,ie.userId=e.id,oe.value=e.id}(e.row)},{default:n((()=>[f(" 赠送会员 ")])),_:2},1032,["onClick"]),u(V,{style:{width:"100%","margin-left":"0",border:"none"},onClick:l=>{return a=e.row,F.value=!0,ue.userId=a.id,void(oe.value=a.id);var a}},{default:n((()=>[f(" 赠送积分 ")])),_:2},1032,["onClick"])])])),_:2},1024)])])),_:1})])),_:1},8,["data"]),u(Ie,{class:"flex justify-end mt-3"},{default:n((()=>[u(Me,{"current-page":ne.page,"onUpdate:currentPage":l[4]||(l[4]=e=>ne.page=e),"page-size":ne.size,"onUpdate:pageSize":l[5]||(l[5]=e=>ne.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:w.value,onSizeChange:be,onCurrentChange:be},null,8,["current-page","page-size","total"])])),_:1})]),u(Ye,{modelValue:re.value,"onUpdate:modelValue":l[8]||(l[8]=e=>re.value=e),width:"500","show-close":!1,"destroy-on-close":""},{header:n((({close:e,titleId:a,titleClass:t})=>[i("div",G,[J,i("div",{onClick:l[6]||(l[6]=e=>re.value=!1),style:{cursor:"pointer"}},[u(ze,null,{default:n((()=>[u(je,{name:"close"})])),_:1})])])])),default:n((()=>[i("div",N,[u(Pe,{model:ie,inline:!0,ro:""},{default:n((()=>[u(Ee,{label:"会员天数"},{default:n((()=>[u(a,{style:{width:"240px"},modelValue:ie.days,"onUpdate:modelValue":l[7]||(l[7]=e=>ie.days=e),modelModifiers:{number:!0},size:"large",placeholder:"请输入赠送会员天数(-1为永久)"},null,8,["modelValue"])])),_:1}),u(Ee,null,{default:n((()=>[u(V,{type:"primary",onClick:_e},{default:n((()=>[f(" 确认赠送 ")])),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),u(Ye,{modelValue:_.value,"onUpdate:modelValue":l[11]||(l[11]=e=>_.value=e),width:"400","show-close":!1,"destroy-on-close":""},{header:n((({close:e,titleId:a,titleClass:t})=>[i("div",W,[H,i("div",{onClick:l[9]||(l[9]=e=>_.value=!1),style:{cursor:"pointer"}},[u(ze,null,{default:n((()=>[u(je,{name:"close"})])),_:1})])])])),default:n((()=>[i("div",K,[u(Pe,{model:ve,inline:!0},{default:n((()=>[u(Ee,{label:"用户状态","label-width":"90px"},{default:n((()=>[u(o,{style:{width:"100px"},modelValue:ve.status,"onUpdate:modelValue":l[10]||(l[10]=e=>ve.status=e),placeholder:"请选择用户状态",clearable:""},{default:n((()=>[(s(!0),d(p,null,c(m(k),(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(Ee,null,{default:n((()=>[u(V,{type:"primary",onClick:he},{default:n((()=>[f(" 确认变更 ")])),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),u(Ye,{modelValue:F.value,"onUpdate:modelValue":l[14]||(l[14]=e=>F.value=e),width:"500","show-close":!1,"destroy-on-close":""},{header:n((({close:e,titleId:a,titleClass:t})=>[i("div",L,[O,i("div",{onClick:l[12]||(l[12]=e=>F.value=!1),style:{cursor:"pointer"}},[u(ze,null,{default:n((()=>[u(je,{name:"close"})])),_:1})])])])),default:n((()=>[i("div",Q,[u(Pe,{model:ue,inline:!0},{default:n((()=>[u(Ee,{label:"积分数量"},{default:n((()=>[u(a,{style:{width:"240px"},modelValue:ue.score,"onUpdate:modelValue":l[13]||(l[13]=e=>ue.score=e),modelModifiers:{number:!0},size:"large",placeholder:"请输入赠送的积分数量"},null,8,["modelValue"])])),_:1}),u(Ee,null,{default:n((()=>[u(V,{type:"primary",onClick:Ve},{default:n((()=>[f(" 确认赠送 ")])),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),u(Ye,{modelValue:se.value,"onUpdate:modelValue":l[26]||(l[26]=e=>se.value=e),width:"400","show-close":!1,"destroy-on-close":""},{header:n((({close:e,titleId:a,titleClass:t})=>[i("div",X,[Z,i("div",{onClick:l[15]||(l[15]=e=>se.value=!1),style:{cursor:"pointer"}},[u(ze,null,{default:n((()=>[u(je,{name:"close"})])),_:1})])])])),default:n((()=>[i("div",ee,[u(Pe,{ref_key:"addUserFormRef",ref:ce,rules:ge,model:me.value,"label-width":"auto",style:{"max-width":"400px"}},{default:n((()=>[u(Ee,{label:"创建方式",size:"large"},{default:n((()=>[u(o,{modelValue:de.value,"onUpdate:modelValue":l[16]||(l[16]=e=>de.value=e)},{default:n((()=>[u(t,{label:"单个用户",value:0}),u(t,{label:"多个用户",value:1})])),_:1},8,["modelValue"])])),_:1}),0==de.value?(s(),d("div",le,[u(Ee,{label:"用户名",prop:"username",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入用户名(字母+数字)",modelValue:me.value.username,"onUpdate:modelValue":l[17]||(l[17]=e=>me.value.username=e)},null,8,["modelValue"])])),_:1}),u(Ee,{label:"用户昵称",prop:"nickname",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入用户昵称",modelValue:me.value.nickname,"onUpdate:modelValue":l[18]||(l[18]=e=>me.value.nickname=e)},null,8,["modelValue"])])),_:1}),u(Ee,{label:"手机号",prop:"phone",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入手机号",modelValue:me.value.phone,"onUpdate:modelValue":l[19]||(l[19]=e=>me.value.phone=e)},null,8,["modelValue"])])),_:1}),u(Ee,{label:"邮箱",prop:"email",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入邮箱",modelValue:me.value.email,"onUpdate:modelValue":l[20]||(l[20]=e=>me.value.email=e)},null,8,["modelValue"])])),_:1}),u(Ee,{label:"密码",prop:"password",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入密码",modelValue:me.value.password,"onUpdate:modelValue":l[21]||(l[21]=e=>me.value.password=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])):(s(),d("div",ae,[u(Ee,{label:"数量",prop:"createNumber",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入批量创建的用户数量",modelValue:fe.value.num,"onUpdate:modelValue":l[22]||(l[22]=e=>fe.value.num=e),type:"number"},null,8,["modelValue"])])),_:1}),u(Ee,{label:"score",prop:"score",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入赠送的积分数量",modelValue:fe.value.score,"onUpdate:modelValue":l[23]||(l[23]=e=>fe.value.score=e),type:"number"},null,8,["modelValue"])])),_:1}),u(Ee,{label:"会员有效期",prop:"vipDays",size:"large"},{default:n((()=>[u(a,{size:"large",placeholder:"请输入赠送会员天数",modelValue:fe.value.vipDays,"onUpdate:modelValue":l[24]||(l[24]=e=>fe.value.vipDays=e),type:"number"},null,8,["modelValue"])])),_:1})]))])),_:1},8,["rules","model"])]),i("div",te,[u(V,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[25]||(l[25]=e=>se.value=!1)},{default:n((()=>[f("取消 ")])),_:1}),u(V,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:we},{default:n((()=>[f(" 确定 ")])),_:1})])])),_:1},8,["modelValue"])])}}});"function"==typeof V&&V(oe);const re=_(oe,[["__scopeId","data-v-1ecebd4e"]]);export{re as default};
