
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,u as a,r as l,E as t,A as o,q as r,j as s,V as d,o as i,c as n,b as u,f as p,g as c,Y as m,X as g,e as f,h as b,w as y,I as v,t as h,N as x,J as w,U as _,O as k,s as F,_ as V,n as z}from"../main-31e47da4.js";import{A as C}from"./package.2b923685.js";import{u as U}from"../utcformatTime/utcformatTime.f6db2c52.js";import{C as I}from"../index/index.6a62fca0.js";const A={class:"search_add_card"},j={style:{display:"flex","align-items":"center"}},q={style:{"margin-left":"10px"}},M={style:{"margin-left":"10px"}},Y={style:{"margin-top":"22px"}},B={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},E={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},N={key:1},P={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},R=e({__name:"crami",setup(e){const V=a();l();const z=l(0),R=l(!1);l(!1);const S=l(),D=l(0),T=l([]),J=l([]),O=l(!1),X=l([]);l([]);const $=t({packageId:null,count:1,score:1}),G=t({useId:"",status:"",page:1,size:15}),H=t({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],score:[{required:!0,message:"卡密携带积分数量",trigger:"blur"}]}),K=l([]);async function L(){try{O.value=!0;const e=await C.queryAllCrami(G),{rows:a,count:l}=e.data;O.value=!1,z.value=l,K.value=a}catch(e){O.value=!1}}async function Q(e){const a=await _.queryAllUser({size:30,username:e});J.value=a.data.rows}function W(){$.packageId=null,$.count=1,$.score=1,async function(){const e=await C.queryAllPackage({size:100});T.value=e.data.rows}(),R.value=!0}function Z(e){null==e||e.resetFields(),L()}async function ee(e){X.value=e}return o((()=>K.value.some((e=>e.email)))),r((()=>{L()})),(e,a)=>{const l=s("el-option"),t=s("el-select"),o=s("el-button"),r=s("RefreshRight"),_=s("el-icon"),X=s("el-table-column"),ae=s("el-tag"),le=s("el-popconfirm"),te=s("el-table"),oe=s("el-pagination"),re=s("el-row"),se=F,de=s("el-switch"),ie=s("el-form-item"),ne=s("el-input"),ue=s("el-form"),pe=s("el-dialog"),ce=d("loading");return i(),n("div",null,[u("div",A,[u("div",j,[u("div",null,[a[12]||(a[12]=u("div",{class:"condition_name"},"用户信息",-1)),p(t,{modelValue:G.useId,"onUpdate:modelValue":a[0]||(a[0]=e=>G.useId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":Q,style:{width:"192px"}},{default:c((()=>[(i(!0),n(m,null,g(f(J),(e=>(i(),v(l,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",q,[a[13]||(a[13]=u("div",{class:"condition_name"},"卡密状态",-1)),p(t,{modelValue:G.status,"onUpdate:modelValue":a[1]||(a[1]=e=>G.status=e),placeholder:"请选择卡密状态",clearable:"",style:{width:"192px"}},{default:c((()=>[(i(!0),n(m,null,g(f(I),(e=>(i(),v(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",M,[p(o,{bg:"",text:"",type:"primary",size:"large",style:{"font-size":"15px",height:"32px",background:"#EFF6FF",color:"#60A5FA","border-radius":"8px","margin-top":"25px"},onClick:L},{default:c((()=>a[14]||(a[14]=[b(" 查询 ")]))),_:1})]),u("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:Z},[p(_,{color:"#3B82F6",size:"20"},{default:c((()=>[p(r)])),_:1})])]),u("div",Y,[p(o,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:W},{default:c((()=>a[15]||(a[15]=[b("批量生成 ")]))),_:1})])]),u("div",null,[y((i(),v(te,{border:"",data:f(K),height:"calc(100vh - 310px)",style:{width:"100%"},size:"large",onSelectionChange:ee},{default:c((()=>[p(X,{type:"selection",width:"55"}),p(X,{prop:"code",label:"卡密账号"}),p(X,{prop:"packageName",label:"套餐类型"},{default:c((e=>[p(ae,{type:e.row.packageName?"primary":"danger"},{default:c((()=>[b(h(e.row.packageName||"自定义卡密"),1)])),_:2},1032,["type"])])),_:1}),p(X,{prop:"code",label:"卡密状态"},{default:c((e=>[p(ae,{type:e.row.status?"danger":"primary"},{default:c((()=>[b(h(e.row.status?"已使用":"未使用"),1)])),_:2},1032,["type"])])),_:1}),p(X,{prop:"username",label:"用户名"},{default:c((e=>[b(h(null==e.row.username?"--":e.row.username),1)])),_:1}),p(X,{prop:"phone",label:"手机号"},{default:c((e=>[b(h(""==e.row.phone?"--":e.row.phone),1)])),_:1}),p(X,{prop:"email",label:"邮箱"},{default:c((e=>[b(h(""==e.row.email?"--":e.row.email),1)])),_:1}),p(X,{prop:"createdAt",label:"生成时间"},{default:c((e=>[b(h(f(U)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),p(X,{label:"操作"},{default:c((e=>[p(le,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:a=>async function(e){if(0==V.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");await C.delCrami({id:e.id}),k({type:"success",message:"删除卡密成功！"}),L()}(e.row)},{reference:c((()=>[p(o,{link:"",type:"danger",size:"small"},{default:c((()=>a[16]||(a[16]=[b(" 删除卡密 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[ce,f(O)]]),p(re,{class:"flex justify-end mt-5"},{default:c((()=>[p(oe,{"current-page":G.page,"onUpdate:currentPage":a[2]||(a[2]=e=>G.page=e),"page-size":G.size,"onUpdate:pageSize":a[3]||(a[3]=e=>G.size=e),class:"mr-5","page-sizes":[15,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:f(z),onSizeChange:L,onCurrentChange:L},null,8,["current-page","page-size","total"])])),_:1})]),p(pe,{modelValue:f(R),"onUpdate:modelValue":a[11]||(a[11]=e=>x(R)?R.value=e:null),width:"500","show-close":!1,"destroy-on-close":""},{header:c((({close:e,titleId:l,titleClass:t})=>[u("div",B,[a[17]||(a[17]=u("div",null," 生成卡密 ",-1)),u("div",{onClick:a[4]||(a[4]=e=>R.value=!1),style:{cursor:"pointer"}},[p(_,null,{default:c((()=>[p(se,{name:"close"})])),_:1})])])])),default:c((()=>[u("div",E,[p(ue,{ref_key:"formCramiRef",ref:S,"label-position":"right","label-width":"100px",model:$,rules:H},{default:c((()=>[p(re,null,{default:c((()=>[p(ie,{label:"是否生成自定义卡密","label-width":"170px"},{default:c((()=>[p(de,{modelValue:f(D),"onUpdate:modelValue":a[5]||(a[5]=e=>x(D)?D.value=e:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1}),f(D)?w("",!0):(i(),v(ie,{key:0,label:"套餐类型",prop:"packageId"},{default:c((()=>[p(t,{size:"large",modelValue:$.packageId,"onUpdate:modelValue":a[6]||(a[6]=e=>$.packageId=e),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:c((()=>[(i(!0),n(m,null,g(f(T),(e=>(i(),v(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})),f(D)?(i(),n("div",N,[p(ie,{label:"积分额度",prop:"score"},{default:c((()=>[p(ne,{size:"large",modelValue:$.score,"onUpdate:modelValue":a[7]||(a[7]=e=>$.score=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带积分额度额度"},null,8,["modelValue"])])),_:1})])):w("",!0),p(ie,{label:"生成数量",prop:"count"},{default:c((()=>[p(ne,{size:"large",modelValue:$.count,"onUpdate:modelValue":a[8]||(a[8]=e=>$.count=e),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])]),u("div",P,[p(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:a[9]||(a[9]=e=>R.value=!1)},{default:c((()=>a[18]||(a[18]=[b("取消 ")]))),_:1}),p(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:a[10]||(a[10]=e=>async function(e){null==e||e.validate((async e=>{if(e){if(0==V.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");await C.createCrami($),k({type:"success",message:"生成卡密成功！"}),R.value=!1,L()}}))}(f(S)))},{default:c((()=>a[19]||(a[19]=[b(" 确认 ")]))),_:1})])])),_:1},8,["modelValue"])])}}});"function"==typeof z&&z(R);const S=V(R,[["__scopeId","data-v-793d4208"]]);export{S as default};
