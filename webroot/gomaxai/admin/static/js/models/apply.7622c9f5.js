
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,u as l,r as a,A as t,E as o,q as r,j as d,V as i,o as s,c as u,b as p,f as n,g as m,Y as y,X as c,e as g,h as f,w as b,I as v,t as x,J as h,N as k,O as w,P as F,a9 as _,s as V,_ as U}from"../main-31e47da4.js";import{h as z,Q as N}from"../index/index.6a62fca0.js";import{A as T}from"./models.3d2c178e.js";import{u as C}from"../utcformatTime/utcformatTime.f6db2c52.js";const j={class:"dialogue_model_box"},A={style:{"margin-bottom":"32px"}},W={class:"search_condition"},S={style:{display:"flex","align-items":"center"}},q={style:{"margin-top":"22px","margin-left":"12px"}},B={style:{"margin-top":"22px"}},M={style:{"margin-top":"12px"}},P={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},Y={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},E={style:{display:"flex","align-items":"center","justify-content":"space-between"}},D={style:{display:"flex","align-items":"center","justify-content":"space-between"}},I={style:{"margin-left":"61px",width:"100%",display:"flex","align-items":"center"}},K={style:{display:"flex","align-items":"center"}},R={style:{display:"flex","align-items":"center","margin-left":"20px"}},O={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},G=U(e({__name:"apply",setup(e){const U=l(),G=a(),J=a([]),Q=a(0),X=a(!1),Z=a(!1),H=a(!1),L=a(0),$=t((()=>L.value?"更新秘钥":"新增秘钥")),ee=t((()=>L.value?"确认更新":"确认新增")),le=o({status:null,modelType:z[1].value,page:1,size:10}),ae=o({modelName:(new Date).getTime(),model:"model",keyType:1,deduct:1,displaySort:0,keyWeight:0,vipFreeNum:0,proxyUrl:"",key:"",status:!1,modelType:"app"}),te=o({keyType:[{required:!0,message:"请选择您的调用模型类型",trigger:"blur"}],vipFreeNum:[{required:!0,message:"请填写会员每日可用的最大次数",trigger:"blur"}],model:[{required:!0,message:"请选择您需要使用的模型",trigger:"blur"}],modelName:[{required:!0,message:"为您的模型取一个名字吧",trigger:"blur"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],keyWeight:[{required:!0,message:"请填写key的权重值",trigger:"blur"}],key:[{required:!0,message:"请填写您的调用模型key",trigger:"blur"}]});async function oe(){try{X.value=!0;const e=await T.queryModels(le);X.value=!1;const{rows:l,count:a}=e.data;Q.value=a,J.value=l}catch(e){X.value=!1}}function re(){le.page=1,le.size=10,le.keyType="",le.model="",le.status=null,oe()}function de(){L.value=0,ae.modelName=(new Date).getTime(),ae.model="model",ae.keyType=1,ae.deduct=1,ae.keyWeight=0,ae.vipFreeNum=0,ae.displaySort=0,ae.proxyUrl="",ae.key="",ae.status=!1,ae.modelType="app",H.value=!0}function ie(e){ae.vipFreeNum=1==e?-1:0}function se(){G.value.validate((async e=>{if(!e)return;if(0==U.isUserModifyPermissions())return w.error("非超级管理员无权限操作！");if(0==Z.value&&ae.vipFreeNum<0)return void w({type:"error",message:"会员每日可用次数不能小于零"});const l=_(ae);if(delete l.id,L.value&&(l.id=L.value),1===Number(ae.keyType)){const e=_(ae.key);l.key=e.split("\n")}const a=await T.setModels(l);200==a.code?(w({type:"success",message:"操作成功"}),H.value=!1,oe()):w({type:"error",message:a.data})}))}return r((()=>{oe()})),(e,l)=>{const a=d("el-alert"),t=d("el-option"),o=d("el-select"),r=d("el-button"),_=d("RefreshRight"),z=d("el-icon"),ue=d("el-table-column"),pe=d("el-tag"),ne=d("el-popconfirm"),me=d("el-table"),ye=d("el-pagination"),ce=d("el-row"),ge=V,fe=d("el-input"),be=d("el-form-item"),ve=d("el-switch"),xe=d("el-form"),he=d("el-dialog"),ke=i("loading");return s(),u("div",j,[p("div",A,[n(a,{closable:!1,"show-icon":"",title:"说明",description:"应用分为普通应用和GPTS应用，均调用当前界面配置的KEY",type:"warning"})]),p("div",W,[p("div",S,[p("div",null,[l[15]||(l[15]=p("div",{class:"search_title"},"启用状态",-1)),p("div",null,[n(o,{modelValue:le.status,"onUpdate:modelValue":l[0]||(l[0]=e=>le.status=e),placeholder:"请选择启用状态",style:{width:"120px"}},{default:m((()=>[(s(!0),u(y,null,c(g(N),(e=>(s(),v(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",q,[n(r,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:oe},{default:m((()=>l[16]||(l[16]=[f("查询 ")]))),_:1})]),p("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:re},[n(z,{color:"#3B82F6",size:"20"},{default:m((()=>[n(_)])),_:1})])]),p("div",B,[n(r,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:de},{default:m((()=>l[17]||(l[17]=[f("添加key ")]))),_:1})])]),p("div",M,[b((s(),v(me,{border:"",data:g(J),style:{"font-size":"13px",width:"100%"},"max-height":"65vh"},{default:m((()=>[n(ue,{prop:"displaySort",label:"排序id",width:"100"}),n(ue,{prop:"status",label:"是否启用",width:"100"},{default:m((e=>[1==e.row.status?(s(),v(pe,{key:0,type:"primary"},{default:m((()=>l[18]||(l[18]=[f("启用")]))),_:1})):(s(),v(pe,{key:1,type:"info"},{default:m((()=>l[19]||(l[19]=[f("禁用")]))),_:1}))])),_:1}),n(ue,{prop:"key",label:"模型key",width:"300"}),n(ue,{prop:"proxyUrl",label:"代理地址",width:"200"},{default:m((e=>[f(x(""==e.row.proxyUrl?"——":e.row.proxyUrl),1)])),_:1}),n(ue,{prop:"keyWeight",label:"模型权重",width:"100"}),n(ue,{prop:"deduct",label:"单次扣除",width:"100"}),n(ue,{prop:"useCount",label:"调用次数"}),n(ue,{prop:"useToken",label:"已使用token"}),n(ue,{prop:"createdAt",label:"添加时间",width:"200"},{default:m((e=>[f(x(g(C)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),n(ue,{label:"操作",fixed:"right",width:"160"},{default:m((e=>[n(r,{style:{border:"none",color:"#3B82F6","font-size":"13px","background-color":"transparent"},onClick:l=>{return a=e.row,L.value=a.id,a.vipFreeNum,Z.value,F((()=>{const{modelName:e,model:l,keyType:t,deduct:o,keyWeight:r,vipFreeNum:d,displaySort:i,proxyUrl:s,key:u,status:p,modelType:n}=a;Object.assign(ae,{modelName:e,model:l,keyType:t,deduct:o,keyWeight:r,vipFreeNum:d,displaySort:i,proxyUrl:s,key:u,status:p,modelType:n})})),void(H.value=!0);var a}},{default:m((()=>l[20]||(l[20]=[f("编辑")]))),_:2},1032,["onClick"]),n(ne,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:l=>async function(e){if(0==U.isUserModifyPermissions())return w.error("非超级管理员无权限操作！");const{id:l}=e;await T.delModels({id:l}),w({type:"success",message:"操作完成！"}),oe()}(e.row)},{reference:m((()=>[n(r,{style:{border:"none",color:"#FF3B30","font-size":"13px","background-color":"transparent"}},{default:m((()=>l[21]||(l[21]=[f("删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[ke,g(X)]]),n(ce,{class:"flex justify-end mt-5"},{default:m((()=>[n(ye,{"current-page":le.page,"onUpdate:currentPage":l[1]||(l[1]=e=>le.page=e),"page-size":le.size,"onUpdate:pageSize":l[2]||(l[2]=e=>le.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:g(Q),onSizeChange:oe,onCurrentChange:oe},null,8,["current-page","page-size","total"])])),_:1})]),n(he,{modelValue:g(H),"onUpdate:modelValue":l[14]||(l[14]=e=>k(H)?H.value=e:null),width:"750","show-close":!1,"destroy-on-close":""},{header:m((({close:e,titleId:a,titleClass:t})=>[p("div",P,[p("div",null,x($.value),1),p("div",{onClick:l[3]||(l[3]=e=>H.value=!1),style:{cursor:"pointer"}},[n(z,null,{default:m((()=>[n(ge,{name:"close"})])),_:1})])])])),default:m((()=>[p("div",Y,[n(xe,{ref_key:"addModelKeyFormRef",ref:G,rules:te,model:ae,"label-width":"auto",style:{"max-width":"750px"}},{default:m((()=>[p("div",E,[n(be,{label:"单次消耗积分",prop:"deduct"},{default:m((()=>[n(fe,{modelValue:ae.deduct,"onUpdate:modelValue":l[4]||(l[4]=e=>ae.deduct=e),size:"large",style:{width:"200px"},placeholder:"请填写单次消耗的积分量",type:"number"},null,8,["modelValue"])])),_:1}),n(be,{label:"指定代理地址"},{default:m((()=>[n(fe,{modelValue:ae.proxyUrl,"onUpdate:modelValue":l[5]||(l[5]=e=>ae.proxyUrl=e),size:"large",style:{width:"200px"},placeholder:"请填写模型代理地址"},null,8,["modelValue"])])),_:1})]),p("div",D,[1==g(Z)?(s(),v(be,{key:0,label:"调用轮询权重",prop:"keyWeight"},{default:m((()=>[n(fe,{modelValue:ae.keyWeight,"onUpdate:modelValue":l[6]||(l[6]=e=>ae.keyWeight=e),size:"large",style:{width:"200px"},placeholder:"请填写轮询权重",type:"number"},null,8,["modelValue"])])),_:1})):h("",!0),1!=g(Z)?(s(),v(be,{key:1,label:"会员每日可用次数",prop:"vipFreeNum"},{default:m((()=>[n(fe,{modelValue:ae.vipFreeNum,"onUpdate:modelValue":l[7]||(l[7]=e=>ae.vipFreeNum=e),size:"large",style:{width:"200px"},placeholder:"请填写会员单日可用的次数",type:"number"},null,8,["modelValue"])])),_:1})):h("",!0),n(be,{label:"模型显示排序"},{default:m((()=>[n(fe,{modelValue:ae.displaySort,"onUpdate:modelValue":l[8]||(l[8]=e=>ae.displaySort=e),size:"large",style:{width:"200px"},type:"number",placeholder:"请填写模型的排序"},null,8,["modelValue"])])),_:1})]),1!=g(Z)?(s(),v(be,{key:0,label:"调用轮询权重",prop:"keyWeight"},{default:m((()=>[n(fe,{modelValue:ae.keyWeight,"onUpdate:modelValue":l[9]||(l[9]=e=>ae.keyWeight=e),size:"large",style:{width:"200px"},placeholder:"请填写轮询权重",type:"number"},null,8,["modelValue"])])),_:1})):h("",!0),n(be,{label:"API Key",prop:"key"},{default:m((()=>[n(fe,{modelValue:ae.key,"onUpdate:modelValue":l[10]||(l[10]=e=>ae.key=e),size:"large",placeholder:"请填写模型Key l clientld l Appld"},null,8,["modelValue"])])),_:1}),n(be,null,{default:m((()=>[p("div",I,[p("div",K,[l[22]||(l[22]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"启用状态",-1)),p("div",null,[n(ve,{modelValue:ae.status,"onUpdate:modelValue":l[11]||(l[11]=e=>ae.status=e)},null,8,["modelValue"])])]),p("div",R,[l[23]||(l[23]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"会员免费",-1)),p("div",null,[n(ve,{modelValue:g(Z),"onUpdate:modelValue":l[12]||(l[12]=e=>k(Z)?Z.value=e:null),onChange:ie},null,8,["modelValue"])])])])])),_:1})])),_:1},8,["rules","model"])]),p("div",O,[n(r,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[13]||(l[13]=e=>H.value=!1)},{default:m((()=>l[24]||(l[24]=[f("取消 ")]))),_:1}),n(r,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:se},{default:m((()=>[f(x(ee.value),1)])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0a8dd89b"]]);export{G as default};
