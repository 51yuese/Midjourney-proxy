'use strict';const _0x50a66e=_0x5b11;(function(_0x1bcbf1,_0x5a97f8){const _0x1984eb=_0x5b11,_0x5ee9e8=_0x1bcbf1();while(!![]){try{const _0x334c59=-parseInt(_0x1984eb(0x208))/0x1*(-parseInt(_0x1984eb(0x1ee))/0x2)+-parseInt(_0x1984eb(0x1f0))/0x3*(parseInt(_0x1984eb(0x226))/0x4)+parseInt(_0x1984eb(0x21e))/0x5+parseInt(_0x1984eb(0x224))/0x6*(parseInt(_0x1984eb(0x210))/0x7)+-parseInt(_0x1984eb(0x1ed))/0x8*(-parseInt(_0x1984eb(0x221))/0x9)+parseInt(_0x1984eb(0x1f8))/0xa*(-parseInt(_0x1984eb(0x216))/0xb)+parseInt(_0x1984eb(0x217))/0xc*(parseInt(_0x1984eb(0x1f2))/0xd);if(_0x334c59===_0x5a97f8)break;else _0x5ee9e8['push'](_0x5ee9e8['shift']());}catch(_0x127813){_0x5ee9e8['push'](_0x5ee9e8['shift']());}}}(_0x2510,0xe398d));var __decorate=this&&this[_0x50a66e(0x201)]||function(_0x194488,_0x3cad0f,_0x20410e,_0x7d380b){const _0x33634c=_0x50a66e;var _0x450725=arguments[_0x33634c(0x1f5)],_0xa9b160=_0x450725<0x3?_0x3cad0f:_0x7d380b===null?_0x7d380b=Object[_0x33634c(0x211)](_0x3cad0f,_0x20410e):_0x7d380b,_0x21d1ed;if(typeof Reflect==='object'&&typeof Reflect[_0x33634c(0x21c)]==='function')_0xa9b160=Reflect['decorate'](_0x194488,_0x3cad0f,_0x20410e,_0x7d380b);else{for(var _0x333abc=_0x194488[_0x33634c(0x1f5)]-0x1;_0x333abc>=0x0;_0x333abc--)if(_0x21d1ed=_0x194488[_0x333abc])_0xa9b160=(_0x450725<0x3?_0x21d1ed(_0xa9b160):_0x450725>0x3?_0x21d1ed(_0x3cad0f,_0x20410e,_0xa9b160):_0x21d1ed(_0x3cad0f,_0x20410e))||_0xa9b160;}return _0x450725>0x3&&_0xa9b160&&Object[_0x33634c(0x1fb)](_0x3cad0f,_0x20410e,_0xa9b160),_0xa9b160;},__metadata=this&&this[_0x50a66e(0x1f7)]||function(_0x1211d9,_0x536f94){const _0x3ed864=_0x50a66e;if(typeof Reflect===_0x3ed864(0x21b)&&typeof Reflect['metadata']===_0x3ed864(0x20b))return Reflect['metadata'](_0x1211d9,_0x536f94);};function _0x5b11(_0x5efdc9,_0x36befb){const _0x2510bd=_0x2510();return _0x5b11=function(_0x5b113d,_0x488c0b){_0x5b113d=_0x5b113d-0x1eb;let _0x4f1ee4=_0x2510bd[_0x5b113d];return _0x4f1ee4;},_0x5b11(_0x5efdc9,_0x36befb);}Object[_0x50a66e(0x1fb)](exports,'__esModule',{'value':!![]}),exports[_0x50a66e(0x203)]=void 0x0;const redisCache_service_1=require(_0x50a66e(0x1f3)),common_1=require('@nestjs/common'),passport_1=require('@nestjs/passport'),jwt=require(_0x50a66e(0x1f6)),core_1=require(_0x50a66e(0x209)),auth_service_1=require(_0x50a66e(0x1fe)),nestjs_cls_1=require(_0x50a66e(0x1f9)),utils_1=require(_0x50a66e(0x20e));function _0x2510(){const _0x11d015=['log','6741AhIUhi','getOwnPropertyDescriptor','createTokenFromFingerprint','toString','id:\x20','AuthGuard','11GMpqLx','2268FbqIdQ','RedisCacheService','fingerprint','ClsService','object','decorate','visitor','4092740orpFZn','HttpStatus','headers','1818xkjKqp','jwt','slice','4086bmJleX','UnauthorizedException','4hNWNeC','moduleRef','verify','17240dCmdte','35268JamaZL','extractToken','5225223lSXfbV','authService','107783AdNmkT','../../modules/redisCache/redisCache.service','getReqSaasId','length','jsonwebtoken','__metadata','15256760afiNOV','nestjs-cls','亲爱的用户,请登录后继续操作,我们正在等您的到来！','defineProperty','redisCacheService','checkTokenAuth','../../modules/auth/auth.service','JWT_SECRET','clsService','__decorate','get','JwtAuthGuard','split','env','switchToHttp','HttpException','41NWDjVD','@nestjs/core','validateToken','function','UNAUTHORIZED','authorization','../utils'];_0x2510=function(){return _0x11d015;};return _0x2510();}let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x50a66e(0x215)])(_0x50a66e(0x222)){constructor(_0xcff2bd,_0x1a530d,_0x3b4709,_0x1f997c){const _0xdddc7a=_0x50a66e;super(),this[_0xdddc7a(0x1fc)]=_0xcff2bd,this[_0xdddc7a(0x1eb)]=_0x1a530d,this[_0xdddc7a(0x200)]=_0x3b4709,this[_0xdddc7a(0x1f1)]=_0x1f997c;}async['canActivate'](_0x1b0dbc){const _0x19ff72=_0x50a66e;!this[_0x19ff72(0x1fc)]&&(this[_0x19ff72(0x1fc)]=this[_0x19ff72(0x1eb)][_0x19ff72(0x202)](redisCache_service_1[_0x19ff72(0x218)],{'strict':![]}));const _0x1ebcfa=_0x1b0dbc[_0x19ff72(0x206)]()['getRequest'](),_0x2eab36=this[_0x19ff72(0x1ef)](_0x1ebcfa);_0x1ebcfa['user']=this[_0x19ff72(0x20a)](_0x2eab36);if(_0x1ebcfa['user']['role']===_0x19ff72(0x21d))throw new common_1[(_0x19ff72(0x207))](_0x19ff72(0x1fa),common_1[_0x19ff72(0x21f)]['UNAUTHORIZED']);return await this[_0x19ff72(0x1fc)][_0x19ff72(0x1fd)](_0x2eab36,_0x1ebcfa),!![];}[_0x50a66e(0x1ef)](_0x3dc72f){const _0x263a35=_0x50a66e;if(!_0x3dc72f[_0x263a35(0x220)][_0x263a35(0x20d)]){if(_0x3dc72f[_0x263a35(0x220)][_0x263a35(0x219)]){let _0x20553e=_0x3dc72f[_0x263a35(0x220)]['fingerprint'];return _0x20553e>0x7fffffff&&(_0x20553e=_0x20553e[_0x263a35(0x213)]()[_0x263a35(0x223)](-0x9),_0x20553e=Number(String(Number(_0x20553e))),console[_0x263a35(0x20f)](_0x263a35(0x214),_0x20553e)),this[_0x263a35(0x1f1)][_0x263a35(0x212)](_0x20553e);}return null;}const _0x3ef5a7=_0x3dc72f['headers'][_0x263a35(0x20d)][_0x263a35(0x204)]('\x20');if(_0x3ef5a7[_0x263a35(0x1f5)]!==0x2||_0x3ef5a7[0x0]!=='Bearer')return null;return _0x3ef5a7[0x1];}['validateToken'](_0x557773){const _0x1111fd=_0x50a66e;try{const _0x2156f1=(0x0,utils_1[_0x1111fd(0x1f4)])(this['clsService']),_0x27b303=jwt[_0x1111fd(0x1ec)](_0x557773,process[_0x1111fd(0x205)][_0x1111fd(0x1ff)]);if(_0x27b303?.['saasId']!==_0x2156f1)throw new common_1[(_0x1111fd(0x207))](_0x1111fd(0x1fa),common_1[_0x1111fd(0x21f)]['UNAUTHORIZED']);return _0x27b303;}catch(_0x5d0d5d){throw new common_1['HttpException'](_0x1111fd(0x1fa),common_1[_0x1111fd(0x21f)][_0x1111fd(0x20c)]);}}['handleRequest'](_0x4dc451,_0x50293a,_0x347504){const _0x2e75a6=_0x50a66e;if(_0x4dc451||!_0x50293a){console[_0x2e75a6(0x20f)]('err:\x20',_0x4dc451);throw _0x4dc451||new common_1[(_0x2e75a6(0x225))]();}return _0x50293a;}};JwtAuthGuard=__decorate([(0x0,common_1['Injectable'])(),__metadata('design:paramtypes',[redisCache_service_1[_0x50a66e(0x218)],core_1['ModuleRef'],nestjs_cls_1[_0x50a66e(0x21a)],auth_service_1['AuthService']])],JwtAuthGuard),exports[_0x50a66e(0x203)]=JwtAuthGuard;