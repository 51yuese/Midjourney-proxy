'use strict';const _0x24de9c=_0x5ada;function _0x5a76(){const _0x40e707=['IsNull','CHAT_TYPE','nestjs-cls','count','select','diff','@nestjs/common','../../common/constants/midjourney.constant','&end_date=','6028268ocHAus','value','overview/getTimeTrendRpt','countMjDrawsByTimeRange','length','countTodayCollection','%Y-%m-%d\x20%H:00','../midjourney/midjourney.entity','startTime','push','midjourney.status\x20=\x20:status','%Y-%m-%d','clsService','MUSIC','请先配置百度统计accessToken','chatlog','6WDpYhm','result','setDate','ClsService','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','get','connection','YYYYMMDD','chatlog.saasId\x20=\x20:saasId','StatisticService','countChatsByTimeRange','countDrawsByTimeRange','ChatLogEntity','MidjourneyStatusEnum','groupBy','DRAWED','../order/order.entity','12296494nypmFc','getReqSaasId','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','countTotalMusic','createQueryBuilder','&method=','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','typeorm','countChats','saasId','1707039VEFleP','DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','../globalConfig/globalConfig.service','countTodayMusic','endTime','Connection','object','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','13865592XKvXID','Injectable','1987014perlqe','query','baiduSiteId','date','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','getBaseStatistic','__param','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','getOwnPropertyDescriptor','EModelType','15Rfytjn','default','132381oGUVKR','map','InjectRepository','countUsers','18134990gIaMtg','globalConfigService','DeductionKey','orderEntity','chatlog.createdAt\x20>=\x20:startDate','Not','data','axios','__esModule','decorate','metadata','HttpException','find','countNewOrdersToday','Between','sum','&site_id=','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','countOrders','getDate','__decorate','baiduToken','getChatStatistic','Repository','9XwDXzw','&start_date=','M.DD','PAINT_TYPE','../chatLog/chatLog.entity','startOf','endOf','countNewMidhourneysToday','countNewChatsToday','andWhere','GlobalConfigService','countNewDrawsToday','formatDate','midjourneyEntity','subtract','HttpStatus','@nestjs/typeorm','where','getRawMany','toDate','now','../../common/constants/model.constant','../../common/utils/date','design:paramtypes','getConfigByKeys','function','UserEntity','../../common/constants/balance.constant','../../common/utils','userEntity','orderBy','price','获取百度统计数据失败','countNewUsersToday','chatLogEntity','BAD_REQUEST','countTotalCollection','defineProperty'];_0x5a76=function(){return _0x40e707;};return _0x5a76();}function _0x5ada(_0x430c45,_0x995b5a){const _0x5a7617=_0x5a76();return _0x5ada=function(_0x5adada,_0x5df399){_0x5adada=_0x5adada-0x14c;let _0x380af0=_0x5a7617[_0x5adada];return _0x380af0;},_0x5ada(_0x430c45,_0x995b5a);}(function(_0x4c2fad,_0x4a6373){const _0x51fe0f=_0x5ada,_0x45e69d=_0x4c2fad();while(!![]){try{const _0x5e565b=-parseInt(_0x51fe0f(0x1b9))/0x1+-parseInt(_0x51fe0f(0x187))/0x2*(-parseInt(_0x51fe0f(0x1a2))/0x3)+-parseInt(_0x51fe0f(0x177))/0x4+-parseInt(_0x51fe0f(0x1b7))/0x5*(parseInt(_0x51fe0f(0x1ad))/0x6)+parseInt(_0x51fe0f(0x198))/0x7+-parseInt(_0x51fe0f(0x1ab))/0x8*(parseInt(_0x51fe0f(0x1d5))/0x9)+parseInt(_0x51fe0f(0x1bd))/0xa;if(_0x5e565b===_0x4a6373)break;else _0x45e69d['push'](_0x45e69d['shift']());}catch(_0x3e2c76){_0x45e69d['push'](_0x45e69d['shift']());}}}(_0x5a76,0xde6b2));var __decorate=this&&this[_0x24de9c(0x1d1)]||function(_0x22a7cc,_0x278640,_0x11793e,_0x298303){const _0x2807b0=_0x24de9c;var _0x1c6dfd=arguments[_0x2807b0(0x17b)],_0x2ca4f2=_0x1c6dfd<0x3?_0x278640:_0x298303===null?_0x298303=Object[_0x2807b0(0x1b5)](_0x278640,_0x11793e):_0x298303,_0x244752;if(typeof Reflect===_0x2807b0(0x1a8)&&typeof Reflect['decorate']===_0x2807b0(0x161))_0x2ca4f2=Reflect[_0x2807b0(0x1c6)](_0x22a7cc,_0x278640,_0x11793e,_0x298303);else{for(var _0x2399db=_0x22a7cc[_0x2807b0(0x17b)]-0x1;_0x2399db>=0x0;_0x2399db--)if(_0x244752=_0x22a7cc[_0x2399db])_0x2ca4f2=(_0x1c6dfd<0x3?_0x244752(_0x2ca4f2):_0x1c6dfd>0x3?_0x244752(_0x278640,_0x11793e,_0x2ca4f2):_0x244752(_0x278640,_0x11793e))||_0x2ca4f2;}return _0x1c6dfd>0x3&&_0x2ca4f2&&Object[_0x2807b0(0x16d)](_0x278640,_0x11793e,_0x2ca4f2),_0x2ca4f2;},__metadata=this&&this['__metadata']||function(_0x3cede0,_0x5bb668){const _0x888176=_0x24de9c;if(typeof Reflect===_0x888176(0x1a8)&&typeof Reflect[_0x888176(0x1c7)]===_0x888176(0x161))return Reflect[_0x888176(0x1c7)](_0x3cede0,_0x5bb668);},__param=this&&this[_0x24de9c(0x1b3)]||function(_0x5db202,_0x390efc){return function(_0x105d1f,_0x3c37af){_0x390efc(_0x105d1f,_0x3c37af,_0x5db202);};};Object[_0x24de9c(0x16d)](exports,_0x24de9c(0x1c5),{'value':!![]}),exports[_0x24de9c(0x190)]=void 0x0;const common_1=require(_0x24de9c(0x174)),typeorm_1=require(_0x24de9c(0x158)),user_entity_1=require('../user/user.entity'),typeorm_2=require(_0x24de9c(0x19f)),chatLog_entity_1=require(_0x24de9c(0x14c)),balance_constant_1=require(_0x24de9c(0x163)),date_1=require(_0x24de9c(0x15e)),axios_1=require(_0x24de9c(0x1c4)),order_entity_1=require(_0x24de9c(0x197)),midjourney_entity_1=require(_0x24de9c(0x17e)),midjourney_constant_1=require(_0x24de9c(0x175)),model_constant_1=require(_0x24de9c(0x15d)),globalConfig_service_1=require(_0x24de9c(0x1a4)),nestjs_cls_1=require(_0x24de9c(0x170)),utils_1=require(_0x24de9c(0x164));let StatisticService=class StatisticService{constructor(_0x1f86f5,_0x31481e,_0xfb86c3,_0x20ac06,_0x118ee4,_0x98c31f,_0x1a91d4){const _0x2e130b=_0x24de9c;this[_0x2e130b(0x165)]=_0x1f86f5,this[_0x2e130b(0x16a)]=_0x31481e,this[_0x2e130b(0x1c0)]=_0xfb86c3,this[_0x2e130b(0x155)]=_0x20ac06,this['globalConfigService']=_0x118ee4,this['clsService']=_0x98c31f,this[_0x2e130b(0x18d)]=_0x1a91d4;}async[_0x24de9c(0x1b2)](_0xfb0215){const _0xc9a709=_0x24de9c,_0x93c6a1=(0x0,utils_1['getReqSaasId'])(this[_0xc9a709(0x183)]);_0x93c6a1!==0x0&&(_0xfb0215=_0x93c6a1);const _0x47a393=await this[_0xc9a709(0x1bc)](_0xfb0215),_0xf37391=await this['countNewUsersToday'](_0xfb0215),_0x3da2c6=await this[_0xc9a709(0x1a0)](_0xfb0215),_0x1650ca=await this[_0xc9a709(0x150)](_0xfb0215),_0x50add4=await this['countDraws'](_0xfb0215),_0x4aeb38=await this[_0xc9a709(0x153)](_0xfb0215),_0x8514af=await this[_0xc9a709(0x14f)](_0xfb0215),_0x3f620c=await this[_0xc9a709(0x1cf)](_0xfb0215),_0x4b434f=await this['countNewOrdersToday'](_0xfb0215),_0x576896=await this[_0xc9a709(0x17c)](_0xfb0215),_0x1beeeb=await this[_0xc9a709(0x16c)](_0xfb0215),_0x2005fb=await this[_0xc9a709(0x1a5)](_0xfb0215),_0x2af624=await this[_0xc9a709(0x19b)](_0xfb0215);return{'userCount':_0x47a393,'newUserCount':_0xf37391,'chatCount':_0x3da2c6,'newChatCount':_0x1650ca,'drawCount':_0x50add4,'newDrawCount':_0x8514af+_0x4aeb38,'orderCount':_0x3f620c,'newOrderCount':_0x4b434f,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x576896,'totalCollection':_0x1beeeb,'todayMusic':_0x2005fb,'totalMusic':_0x2af624,'todayVideo':0x0,'totalVideo':0x0};}async[_0x24de9c(0x1bc)](_0x5bf823){const _0x4ab8d3=_0x24de9c,_0x161b9a={};_0x5bf823!==undefined&&(_0x161b9a[_0x4ab8d3(0x1a1)]=_0x5bf823);const _0xa338cf=await this[_0x4ab8d3(0x165)][_0x4ab8d3(0x171)]({'where':_0x161b9a});return _0xa338cf;}async[_0x24de9c(0x169)](_0xd112d7){const _0xa7b86c=_0x24de9c,_0xdb3509=(0x0,date_1['default'])()[_0xa7b86c(0x14d)]('d')['toDate'](),_0x2d52e1=(0x0,date_1[_0xa7b86c(0x1b8)])()[_0xa7b86c(0x14e)]('d')['toDate'](),_0x13da1b={'createdAt':(0x0,typeorm_2[_0xa7b86c(0x1cb)])(_0xdb3509,_0x2d52e1)};_0xd112d7!==undefined&&(_0x13da1b['saasId']=_0xd112d7);const _0x4095ba=await this[_0xa7b86c(0x165)][_0xa7b86c(0x171)]({'where':_0x13da1b});return _0x4095ba;}async[_0x24de9c(0x1a0)](_0x31145b){const _0x2b1f3d=_0x24de9c,_0x37295f={'type':balance_constant_1[_0x2b1f3d(0x1bf)][_0x2b1f3d(0x16f)]};_0x31145b!==undefined&&(_0x37295f[_0x2b1f3d(0x1a1)]=_0x31145b);const _0x2604fe=await this[_0x2b1f3d(0x16a)][_0x2b1f3d(0x171)]({'where':_0x37295f});return _0x2604fe;}async[_0x24de9c(0x150)](_0x3d78c8){const _0x5ea7d1=_0x24de9c,_0x1ffddc=(0x0,date_1['default'])()[_0x5ea7d1(0x14d)]('d')[_0x5ea7d1(0x15b)](),_0x4856cc=(0x0,date_1['default'])()['endOf']('d')[_0x5ea7d1(0x15b)](),_0x2ebb21={'type':balance_constant_1[_0x5ea7d1(0x1bf)][_0x5ea7d1(0x16f)],'createdAt':(0x0,typeorm_2[_0x5ea7d1(0x1cb)])(_0x1ffddc,_0x4856cc)};_0x3d78c8!==undefined&&(_0x2ebb21[_0x5ea7d1(0x1a1)]=_0x3d78c8);const _0x2fb752=await this[_0x5ea7d1(0x16a)][_0x5ea7d1(0x171)]({'where':_0x2ebb21});return _0x2fb752;}async['countDraws'](_0x562a54){const _0xaf2709=_0x24de9c,_0x22b9e2={'type':balance_constant_1['DeductionKey'][_0xaf2709(0x1d8)]};_0x562a54!==undefined&&(_0x22b9e2[_0xaf2709(0x1a1)]=_0x562a54);const _0x12e9ee=await this['chatLogEntity'][_0xaf2709(0x171)]({'where':_0x22b9e2});return _0x12e9ee;}async['countNewDrawsToday'](_0x30e943){const _0x34baef=_0x24de9c,_0x21603b=(0x0,date_1['default'])()[_0x34baef(0x14d)]('d')[_0x34baef(0x15b)](),_0x10e158=(0x0,date_1[_0x34baef(0x1b8)])()[_0x34baef(0x14e)]('d')[_0x34baef(0x15b)](),_0x2ff40c={'type':balance_constant_1[_0x34baef(0x1bf)][_0x34baef(0x1d8)],'createdAt':(0x0,typeorm_2[_0x34baef(0x1cb)])(_0x21603b,_0x10e158)};_0x30e943!==undefined&&(_0x2ff40c[_0x34baef(0x1a1)]=_0x30e943);const _0x1ae568=await this[_0x34baef(0x16a)][_0x34baef(0x171)]({'where':_0x2ff40c});return _0x1ae568;}async[_0x24de9c(0x14f)](_0xd5e0c0){const _0x4f3046=_0x24de9c,_0x2f0808=(0x0,date_1[_0x4f3046(0x1b8)])()['startOf']('d')[_0x4f3046(0x15b)](),_0x402928=(0x0,date_1[_0x4f3046(0x1b8)])()[_0x4f3046(0x14e)]('d')[_0x4f3046(0x15b)](),_0x2fe6b9={'createdAt':(0x0,typeorm_2[_0x4f3046(0x1cb)])(_0x2f0808,_0x402928)};_0xd5e0c0!==undefined&&(_0x2fe6b9['saasId']=_0xd5e0c0);const _0x1cc688=await this[_0x4f3046(0x155)]['count']({'where':_0x2fe6b9});return _0x1cc688;}async['countOrders'](_0x21ded9){const _0x400342=_0x24de9c,_0x403044={};_0x21ded9!==undefined&&(_0x403044['saasId']=_0x21ded9);const _0x2c119d=await this[_0x400342(0x1c0)][_0x400342(0x171)]({'where':_0x403044});return _0x2c119d;}async[_0x24de9c(0x1ca)](_0x45b49c){const _0x23b0c1=_0x24de9c,_0x58e0cf=(0x0,date_1[_0x23b0c1(0x1b8)])()[_0x23b0c1(0x14d)]('d')[_0x23b0c1(0x15b)](),_0x3723df=(0x0,date_1['default'])()[_0x23b0c1(0x14e)]('d')[_0x23b0c1(0x15b)](),_0x4f9b79={'createdAt':(0x0,typeorm_2[_0x23b0c1(0x1cb)])(_0x58e0cf,_0x3723df)};_0x45b49c!==undefined&&(_0x4f9b79[_0x23b0c1(0x1a1)]=_0x45b49c);const _0x24aac2=await this[_0x23b0c1(0x1c0)]['count']({'where':_0x4f9b79});return _0x24aac2;}async[_0x24de9c(0x1a5)](_0x4bf599){const _0x1b2264=_0x24de9c,_0x1b932b=(0x0,date_1[_0x1b2264(0x1b8)])()[_0x1b2264(0x14d)]('d')[_0x1b2264(0x15b)](),_0x1a2fb8=(0x0,date_1[_0x1b2264(0x1b8)])()[_0x1b2264(0x14e)]('d')[_0x1b2264(0x15b)](),_0x29bc05={'answer':(0x0,typeorm_2[_0x1b2264(0x1c2)])((0x0,typeorm_2[_0x1b2264(0x16e)])()),'modelType':model_constant_1[_0x1b2264(0x1b6)][_0x1b2264(0x184)],'createdAt':(0x0,typeorm_2[_0x1b2264(0x1cb)])(_0x1b932b,_0x1a2fb8)};_0x4bf599!==undefined&&(_0x29bc05[_0x1b2264(0x1a1)]=_0x4bf599);const _0x3053d5=await this[_0x1b2264(0x16a)]['count']({'where':_0x29bc05});return _0x3053d5;}async['countTotalMusic'](_0x150368){const _0x47f376=_0x24de9c,_0x308eb2={'answer':(0x0,typeorm_2[_0x47f376(0x1c2)])((0x0,typeorm_2['IsNull'])()),'modelType':model_constant_1['EModelType'][_0x47f376(0x184)]};_0x150368!==undefined&&(_0x308eb2['saasId']=_0x150368);const _0x447321=await this['chatLogEntity']['count']({'where':_0x308eb2});return _0x447321;}async[_0x24de9c(0x17c)](_0x3a8cc8){const _0x3b393d=_0x24de9c,_0x21e73d=(0x0,date_1[_0x3b393d(0x1b8)])()[_0x3b393d(0x14d)]('d')['toDate'](),_0x227877=(0x0,date_1[_0x3b393d(0x1b8)])()[_0x3b393d(0x14e)]('d')['toDate'](),_0x3a5ffe={'status':0x1,'updatedAt':(0x0,typeorm_2[_0x3b393d(0x1cb)])(_0x21e73d,_0x227877)};_0x3a8cc8!==undefined&&(_0x3a5ffe[_0x3b393d(0x1a1)]=_0x3a8cc8);const _0x54c103=await this[_0x3b393d(0x1c0)][_0x3b393d(0x1cc)](_0x3b393d(0x167),_0x3a5ffe)||0x0;return _0x54c103['toFixed'](0x2);}async[_0x24de9c(0x16c)](_0xda9c9b){const _0x56f46e=_0x24de9c,_0x3d7030={'status':0x1};_0xda9c9b!==undefined&&(_0x3d7030[_0x56f46e(0x1a1)]=_0xda9c9b);const _0x8e2daf=await this['orderEntity']['sum']('price',_0x3d7030)||0x0;return _0x8e2daf['toFixed'](0x2);}async[_0x24de9c(0x1d3)]({days:days=0x7,saasId:_0x2192f4}){const _0x54953b=_0x24de9c,_0x36f15a=(0x0,utils_1[_0x54953b(0x199)])(this[_0x54953b(0x183)]);_0x36f15a!==0x0&&(_0x2192f4=_0x36f15a);const _0x3ffea9=await this[_0x54953b(0x191)](days,_0x2192f4),_0x1ad313=await this[_0x54953b(0x192)](days,_0x2192f4),_0x715ca5=await this['countMjDrawsByTimeRange'](days,_0x2192f4);return{'date':_0x3ffea9['map'](_0x1e4a4a=>_0x1e4a4a['date']),'chat':_0x3ffea9['map'](_0x107f66=>_0x107f66[_0x54953b(0x178)]),'draw':_0x1ad313[_0x54953b(0x1ba)]((_0x4d2a67,_0x368124)=>{const _0x127312=_0x54953b;return _0x4d2a67['value']+_0x715ca5[_0x368124][_0x127312(0x178)];})};}async['countChatsByTimeRange'](_0x2a5e7c,_0x472e1d){const _0x5ea979=_0x24de9c,_0xa4bfd2=(0x0,date_1[_0x5ea979(0x1b8)])()[_0x5ea979(0x156)](_0x2a5e7c,'d')[_0x5ea979(0x14d)]('d')[_0x5ea979(0x15b)](),_0x253487=this['chatLogEntity'][_0x5ea979(0x19c)](_0x5ea979(0x186))[_0x5ea979(0x172)]('DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')[_0x5ea979(0x159)]('chatlog.type\x20=\x20:type',{'type':balance_constant_1[_0x5ea979(0x1bf)][_0x5ea979(0x16f)]})[_0x5ea979(0x151)]('chatlog.createdAt\x20>=\x20:startDate',{'startDate':_0xa4bfd2});_0x472e1d!==undefined&&_0x253487['andWhere'](_0x5ea979(0x18f),{'saasId':_0x472e1d});_0x253487['groupBy']('date')[_0x5ea979(0x166)]('date');const _0x5d041a=await _0x253487[_0x5ea979(0x15a)](),_0xf6afeb=[],_0x18fecf=_0xa4bfd2;for(let _0x30093e=0x0;_0x30093e<_0x2a5e7c;_0x30093e++){const _0x444e26=(0x0,date_1['formatDate'])(new Date(_0x18fecf),'M.DD'),_0x278397=_0x5d041a[_0x5ea979(0x1c9)](_0x449e0e=>(0x0,date_1[_0x5ea979(0x154)])(new Date(_0x449e0e['date']),_0x5ea979(0x1d7))===_0x444e26)?.[_0x5ea979(0x171)]??0x0;_0x278397>0x0?_0xf6afeb[_0x5ea979(0x180)]({'date':_0x444e26,'value':Number(_0x278397)}):_0xf6afeb[_0x5ea979(0x180)]({'date':_0x444e26,'value':0x0}),_0x18fecf[_0x5ea979(0x189)](_0x18fecf['getDate']()+0x1);}return _0xf6afeb;}async['countDrawsByTimeRange'](_0x3a8b4e,_0x5d3a36){const _0x412e00=_0x24de9c,_0x414039=(0x0,date_1[_0x412e00(0x1b8)])()[_0x412e00(0x156)](_0x3a8b4e,'d')[_0x412e00(0x14d)]('d')[_0x412e00(0x15b)](),_0x3b011d=this[_0x412e00(0x16a)][_0x412e00(0x19c)](_0x412e00(0x186))[_0x412e00(0x172)](_0x412e00(0x1b1))[_0x412e00(0x159)]('chatlog.type\x20=\x20:type',{'type':balance_constant_1[_0x412e00(0x1bf)][_0x412e00(0x1d8)]})[_0x412e00(0x151)](_0x412e00(0x1c1),{'startDate':_0x414039});_0x5d3a36!==undefined&&_0x3b011d['andWhere'](_0x412e00(0x18f),{'saasId':_0x5d3a36});_0x3b011d[_0x412e00(0x195)](_0x412e00(0x1b0))[_0x412e00(0x166)](_0x412e00(0x1b0));const _0x5f154a=await _0x3b011d[_0x412e00(0x15a)](),_0x41d103=[],_0x36d21f=_0x414039;for(let _0x318e42=0x0;_0x318e42<_0x3a8b4e;_0x318e42++){const _0x3847f1=(0x0,date_1[_0x412e00(0x154)])(new Date(_0x36d21f),_0x412e00(0x1d7)),_0x4e0053=_0x5f154a[_0x412e00(0x1c9)](_0x5b5468=>(0x0,date_1[_0x412e00(0x154)])(new Date(_0x5b5468[_0x412e00(0x1b0)]),_0x412e00(0x1d7))===_0x3847f1)?.[_0x412e00(0x171)]??0x0;_0x4e0053>0x0?_0x41d103[_0x412e00(0x180)]({'date':_0x3847f1,'value':Number(_0x4e0053)}):_0x41d103[_0x412e00(0x180)]({'date':_0x3847f1,'value':0x0}),_0x36d21f[_0x412e00(0x189)](_0x36d21f[_0x412e00(0x1d0)]()+0x1);}return _0x41d103;}async[_0x24de9c(0x17a)](_0x1c5ca1,_0x1f8e94){const _0x375acd=_0x24de9c,_0x1900d0=(0x0,date_1[_0x375acd(0x1b8)])()[_0x375acd(0x156)](_0x1c5ca1,'d')[_0x375acd(0x14d)]('d')[_0x375acd(0x15b)](),_0x396253=this[_0x375acd(0x155)][_0x375acd(0x19c)]('midjourney')['select'](_0x375acd(0x1a3))[_0x375acd(0x159)](_0x375acd(0x181),{'status':midjourney_constant_1[_0x375acd(0x194)][_0x375acd(0x196)]})[_0x375acd(0x151)]('midjourney.createdAt\x20>=\x20:startDate',{'startDate':_0x1900d0});_0x1f8e94!==undefined&&_0x396253['andWhere']('midjourney.saasId\x20=\x20:saasId',{'saasId':_0x1f8e94});_0x396253[_0x375acd(0x195)](_0x375acd(0x1b0))[_0x375acd(0x166)]('date');const _0x2fe144=await _0x396253['getRawMany'](),_0x593dcb=[],_0x48f609=_0x1900d0;for(let _0x301c0b=0x0;_0x301c0b<_0x1c5ca1;_0x301c0b++){const _0x109c71=(0x0,date_1[_0x375acd(0x154)])(new Date(_0x48f609),'M.DD'),_0x5971a2=_0x2fe144[_0x375acd(0x1c9)](_0x24cbed=>(0x0,date_1['formatDate'])(new Date(_0x24cbed[_0x375acd(0x1b0)]),_0x375acd(0x1d7))===_0x109c71)?.['count']??0x0;_0x5971a2>0x0?_0x593dcb[_0x375acd(0x180)]({'date':_0x109c71,'value':Number(_0x5971a2)}):_0x593dcb[_0x375acd(0x180)]({'date':_0x109c71,'value':0x0}),_0x48f609['setDate'](_0x48f609['getDate']()+0x1);}return _0x593dcb;}async['getBaiduStatistics'](_0x4c61bc){const _0x501af0=_0x24de9c,_0xdac91c=(0x0,date_1[_0x501af0(0x154)])(new Date(),_0x501af0(0x18e)),_0xfc6bc=(0x0,date_1[_0x501af0(0x154)])(new Date(Date[_0x501af0(0x15c)]()-Number(_0x4c61bc-0x1)*0x18*0x3c*0x3c*0x3e8),'YYYYMMDD'),_0x226367=_0x501af0(0x1ce),_0x444a3e=_0x501af0(0x179),_0xae5e8=await this[_0x501af0(0x1be)][_0x501af0(0x160)]([_0x501af0(0x1d2),'baiduSiteId']),_0x59c8dd=_0xae5e8[_0x501af0(0x1af)],_0x53e130=_0xae5e8[_0x501af0(0x1d2)];if(!_0x59c8dd||!_0x53e130)return[];if(!_0x59c8dd)throw new common_1[(_0x501af0(0x1c8))]('请先配置百度统计siteId',common_1[_0x501af0(0x157)][_0x501af0(0x16b)]);if(!_0x53e130)throw new common_1[(_0x501af0(0x1c8))](_0x501af0(0x185),common_1[_0x501af0(0x157)]['BAD_REQUEST']);const _0x171cfa=_0x501af0(0x19e)+_0x53e130+_0x501af0(0x1cd)+_0x59c8dd+_0x501af0(0x19d)+_0x444a3e+_0x501af0(0x1d6)+_0xfc6bc+_0x501af0(0x176)+_0xdac91c+'&metrics='+_0x226367,_0x24b5c3=await axios_1[_0x501af0(0x1b8)][_0x501af0(0x18c)](_0x171cfa),{error_code:_0x4adff5,message:_0x5acb1c}=_0x24b5c3[_0x501af0(0x1c3)];if(_0x4adff5===0x6f)throw new common_1[(_0x501af0(0x1c8))](_0x5acb1c||'百度授权码过期',common_1[_0x501af0(0x157)][_0x501af0(0x16b)]);if(_0x4adff5&&_0x4adff5!==0xc8)throw new common_1[(_0x501af0(0x1c8))](_0x5acb1c||_0x501af0(0x168),common_1[_0x501af0(0x157)][_0x501af0(0x16b)]);return _0x24b5c3[_0x501af0(0x1c3)][_0x501af0(0x188)];}async['modelUse'](_0x4fbe5f){const _0x4ce850=_0x24de9c,_0x4ea8cb=await this['connection'][_0x4ce850(0x1ae)](_0x4ce850(0x18b)+_0x4fbe5f[_0x4ce850(0x17f)]+_0x4ce850(0x1b4)+_0x4fbe5f[_0x4ce850(0x1a6)]+_0x4ce850(0x1a9)),_0x2dcf87=(0x0,date_1['default'])(_0x4fbe5f[_0x4ce850(0x17f)])[_0x4ce850(0x173)]((0x0,date_1[_0x4ce850(0x1b8)])(_0x4fbe5f['endTime']),'day'),_0x3f8bd8=_0x2dcf87===0x0?_0x4ce850(0x17d):_0x4ce850(0x182),_0x1591c5=await this['connection'][_0x4ce850(0x1ae)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27'+_0x3f8bd8+_0x4ce850(0x1aa)+_0x4fbe5f[_0x4ce850(0x17f)]+_0x4ce850(0x1b4)+_0x4fbe5f[_0x4ce850(0x1a6)]+_0x4ce850(0x19a));return{'pie':_0x4ea8cb,'line':_0x1591c5};}};StatisticService=__decorate([(0x0,common_1[_0x24de9c(0x1ac)])(),__param(0x0,(0x0,typeorm_1[_0x24de9c(0x1bb)])(user_entity_1[_0x24de9c(0x162)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(chatLog_entity_1[_0x24de9c(0x193)])),__param(0x2,(0x0,typeorm_1[_0x24de9c(0x1bb)])(order_entity_1['OrderEntity'])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1['MidjourneyEntity'])),__metadata(_0x24de9c(0x15f),[typeorm_2[_0x24de9c(0x1d4)],typeorm_2[_0x24de9c(0x1d4)],typeorm_2[_0x24de9c(0x1d4)],typeorm_2[_0x24de9c(0x1d4)],globalConfig_service_1[_0x24de9c(0x152)],nestjs_cls_1[_0x24de9c(0x18a)],typeorm_2[_0x24de9c(0x1a7)]])],StatisticService),exports[_0x24de9c(0x190)]=StatisticService;