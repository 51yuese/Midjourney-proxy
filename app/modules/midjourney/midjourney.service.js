'use strict';const _0x471d3e=_0x31f2;function _0x31f2(_0x364db1,_0x1949be){const _0x2f420b=_0x2f42();return _0x31f2=function(_0x31f256,_0x4de9cd){_0x31f256=_0x31f256-0x136;let _0x2456cf=_0x2f420b[_0x31f256];return _0x2456cf;},_0x31f2(_0x364db1,_0x1949be);}(function(_0x425f71,_0xe4be31){const _0x36e266=_0x31f2,_0x33d880=_0x425f71();while(!![]){try{const _0x3cf2d0=parseInt(_0x36e266(0x1ea))/0x1+-parseInt(_0x36e266(0x19e))/0x2+parseInt(_0x36e266(0x15e))/0x3+-parseInt(_0x36e266(0x1e4))/0x4*(-parseInt(_0x36e266(0x179))/0x5)+parseInt(_0x36e266(0x257))/0x6+parseInt(_0x36e266(0x30e))/0x7*(parseInt(_0x36e266(0x24f))/0x8)+-parseInt(_0x36e266(0x1bb))/0x9;if(_0x3cf2d0===_0xe4be31)break;else _0x33d880['push'](_0x33d880['shift']());}catch(_0x44373e){_0x33d880['push'](_0x33d880['shift']());}}}(_0x2f42,0xae9f3));function _0x2f42(){const _0x35342a=['aiLogService','subscribePlan','saveSuggestWords','username','effectMainBody','ENV','get','6008682xdQqMk','DictService','商拍摄影','convertMode4Transfer','stringify','绘画制作','创建图混图任务失败','delLog','当前图片不存在！','图混图任务至少需要两张图片','getDetailByIds','动漫漫画','workflowSave','workflowTaskDetail','mjNotSaveImg','weight','denoisingStrength','setting','squareType','transferImg','updateReconnect','aiTaskDetail','../user/user.service','midjourneyEntity','addMjAccount','FaceSwap','Imagine\x20all','Mj\x20Modal\x20通知','mjParamEntity','@nestjs/common','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','function','./mjIncantationClassify.entity','nickname','删除成功！','vipFreeNum','queryModels','transaction','modifyMjIncantationClassify','sdTaskUpdateJob:\x20','名称不能重复','艺术设计','number','deduct','ASC','redisCacheService','workflowDel','query','swap','syncWfTask','listByCondition','all','HttpException','fast','imagine','创建图生文任务失败','IMAGE_MIX_IMAGE','imageSeed','syncTaskInfo','getUserId','MjIncantationEntity','deductBalance4SD','relax','string','BAD_REQUEST','style','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','env','removeMjIncantationClassify','MjPromptsEntity','getAgreeByRelateId','IMAGE_TO_TEXT','./mjInspireClassify.entity','applicationFields','authorization','timeoutMinutes','\x20--iw\x20','properties','workflowModelDetail','../dict/dict.service','deleteDraw','addMjIncantationClassify','__metadata','addMjIncantation','drawTaskList','MODAL','keyword','queryAllPrompt','addMjInspireClassify','CZTaskService','Blend','./mjPrompts.entity','toString','checkUserStatus','notifySD','触站::模型信息同步完成','message','save','getMjAccount','save4workflow','useCount','__esModule','CzStateMap','aiInpaint','set','VIP_FREE','exist','mjIncantationClassifyEntity','Like','badwordsService','progress','分页参数错误','error:\x20','PRO','modifyMjIncantation','czTaskService','syncSdTask','MidjourneyStatusEnum','任务已达最大并发数，请等待其他任务完成后再提交新任务！','key','result','不需要灵感广场分类','mjpTaskId','mjTaskUpdateJob:\x20','has','HttpStatus','Injectable','非法操作！','guildId','delPrompt','workflowTaskSubmit','status','Imagine','delete','removeMjIncantation','fileInfo','findBy','mjSuggestWordEntity','values','fileService','任务类型错误','Not','setMjAccountEnable','createRandomUid','Connection','find','remix','DESC','timeout','log','styleName','push','visitNum','Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','removeMjAccount','账号不存在','size','catch','queryMjInspireClassify','RELAX','./mjSuggestWord.entity','blend','assign','入库图片地址：','mjpAccountService','concat','./dto/addDrawQueue.dto','mask','小工具已禁用！','clsService','length','\x20OFFSET\x20','checkBadWords','MjpAccountService','originPrompt','getReqSaasId','describe','distributeAccount','map','FALSE','label','actionTask','MJP_ACCOUNT','3262aSpCak','name','action','queryMjAccountList','syncMjpAccount','原始任务不存在！','concurrentLimit','cancel','查询咒语分类失败','添加绘图任务失败','prompt包含敏感词','account','increaseVisit','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.used\x20AS\x20used\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','handleAddDrawTask','state','DrawSpeed','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20','addDrawQueue','workflowModelPage','info','defineProperty','convertToEnglish','推荐关键词不存在','dictType','modalTask','syncMjpAccountManual','incantationCn','prompt','triggerWords','parseMjStatus','mjpTaskService','../redisCache/redisCache.service','MjConfig','mjInspireClassifyEntity','推荐关键词已存在，不可重复添加','modelsService','DESCRIBE','applicationFieldsName','MID_JOURNEY','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.createdAt\x20DESC\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','mjProxyImgUrl','getUserListByIds','object','addRefer','wfTaskUpdateJob:\x20','error','../globalConfig/globalConfig.service','development','imageUrl','disabled','freeUsed','查询推荐关键词失败','queryMjIncantationClassify','createdAt','MEGA','dictValue','删除记录失败！','EFavorite','base64','modelPage','checkIsActionDone','GlobalConfigService','AddDrawQueueDto','querySuggestWords','workflowForm','relateId','connection','effect_category','绘制中的图片任务、禁止删除！','getMjIncantation','coverImageUrl','finally','globalConfigService','2563410rZMEDC','../../common/constants/model.constant','IsNull','isSuper','removeSuggestWords','syncMjpAccountAutomatic','触站工作流任务通知异常:\x20','tutorial','EBotType','__decorate','displaySort','instanceId','美女形象','design:paramtypes','count','isChinese','Logger','startTime','MidJourneyDrawEnum','查询咒语失败','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mjpId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20midjourney\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20action\x20IN\x20(\x201,\x202,\x203,\x2022\x20)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20DATE\x20(\x20createdAt\x20)\x20=\x20CURDATE()\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mjpId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20t\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.mjpId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count\x20ASC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20','WORKFLOW','decorate','当前图片已经执行过相同指令！','MJ\x20通知内容：','nestjs-cls','model','6096190dHoHLF','notify','use','Repository','effectCategoryName','FanyiService','推送图片地址：','split','add','findOne','MjIncantationClassifyEntity','classifyName','notifyWF','dictService','fastTimeRemaining','工作流（小工具）不存在','MidjourneyService','datas','orderPlan','userService','../models/models.service','type','dictName','删除失败！','getConfigByKeys','drawSquarePage','MoreThan','保存推荐关键词','jobIds','精选分享','pageCount','SD任务通知内容：','replace','Mj任务通知异常:\x20','list4workflow','from','finishTime','371460cSFeHn','IMAGE_ACTION','../../common/utils','squire-images','syncInfo','初始化灵感广场分类成功','initHasAccount','value','形象设计','deductBalance4MJ','workflowId','@nestjs/typeorm','forEach','customId','channelId','Describe','findAndCount','ids','durationSpent','lifetimeVip','mjModel','modelSave','removeMjInspireClassify','data:image/png;base64,','application_fields','触站::运用领域、风格画风、作用主体、作用类别字典同步失败','触站::模型信息同步失败','SUCCESS','hideString','33512841zLlvvQ','mjModelEntity','url','NIJI_JOURNEY','vipExpire','mode','syncTask','get4workflow','rec','MjpStateIndexMap','effectCategory','./mjIncantation.entity','page','AiLogService','getUserById','BASIC','id不能为空！','壁纸绘画','lifetimeUsage','mjPromptsEntity','favoriteListByTypeAndIds','versionSelector','syncMjTask','description','fanyiService','versionId','mjpId','rows','getModelById','version','DRAW','../../common/constants/redisKey.constant','affected','handleImagesUploadTask','email','taskId','effect_main_body','syncModelsByTag','queryMjIncantationClassifyAllByLevel','deductBalance4WorkFlow','RedisCacheService','4XHxBjg','phone','workflowDetail','MJ_TASK_UPDATE','Modal已处理，无需更新','aiDraw','589515YHGiKY','saasId','join','initInspireData','relaxedUsage','update','emoji','botType','modifyMjAccount','modal','mjVersion','queryMjIncantationByClassify','MjpStateMap','TEXT_TO_IMAGE','MidjourneyEntity','删除推荐关键词失败','pid','sdTaskInpaint','paintingSign','turbo','isPlatform','ModelsService','queryMjIncantationAll','setImageFavorite','modelName','operated','insightFace','getOneDraw','触站::运用领域、风格画风、作用主体、作用类别字典同步完成','fullPrompt','workflowDicts','code','workflowRun','list4dictTypes','mjProxy','../../common/constants/midjourney.constant','../fanyi/fanyi.service','modelVersion','avatar','代理图片地址：','promptsPage','copyAccountInfo','Custom\x20Zoom','未查询到咒语一级分类','files','EModelType','cover','workflowUsedPage','getMjIncantationClassify','remark','InjectRepository','enable','STANDARD','failReason','trubo','syncModels','vipFreeUsed','TURBO','finalPrompt','查询灵感分类失败','buttons','buffer','mjIncantationEntity','validateBalance4MJ','没有满足条件的MJ账号，请联系管理员！','modifyMjInspireClassify','changeVersion','__param','mjLimitCount','../../common/store','queryTopMjIncantationClassify','level','filter','FAST','then','Modal\x20状态\x20手动同步任务信息','totalTime','getOwnPropertyDescriptor','inputs','renewDate','updatedAt','\x20--sw\x20','fastRemainTime','user','userId','lock','findOneBy','extraParam','userInfo','初始化灵感广场分类失败','MjParamEntity','操作失败！','绘制的任务不存在！','del','../../common/constants/user.constant','队列已满，请稍后尝试','fetch','getByRelateId','FileService','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27','isDefined','16480wQRZNa'];_0x2f42=function(){return _0x35342a;};return _0x2f42();}var __decorate=this&&this[_0x471d3e(0x167)]||function(_0x4f61aa,_0x5dfb56,_0x5747c8,_0x14c1a9){const _0x5720cf=_0x471d3e;var _0x5421d3=arguments['length'],_0x566670=_0x5421d3<0x3?_0x5dfb56:_0x14c1a9===null?_0x14c1a9=Object[_0x5720cf(0x237)](_0x5dfb56,_0x5747c8):_0x14c1a9,_0x22fe9f;if(typeof Reflect===_0x5720cf(0x13f)&&typeof Reflect[_0x5720cf(0x174)]===_0x5720cf(0x276))_0x566670=Reflect[_0x5720cf(0x174)](_0x4f61aa,_0x5dfb56,_0x5747c8,_0x14c1a9);else{for(var _0x4c51d2=_0x4f61aa[_0x5720cf(0x301)]-0x1;_0x4c51d2>=0x0;_0x4c51d2--)if(_0x22fe9f=_0x4f61aa[_0x4c51d2])_0x566670=(_0x5421d3<0x3?_0x22fe9f(_0x566670):_0x5421d3>0x3?_0x22fe9f(_0x5dfb56,_0x5747c8,_0x566670):_0x22fe9f(_0x5dfb56,_0x5747c8))||_0x566670;}return _0x5421d3>0x3&&_0x566670&&Object[_0x5720cf(0x324)](_0x5dfb56,_0x5747c8,_0x566670),_0x566670;},__metadata=this&&this[_0x471d3e(0x2a9)]||function(_0x40ce88,_0x40916e){const _0x58ea8e=_0x471d3e;if(typeof Reflect===_0x58ea8e(0x13f)&&typeof Reflect['metadata']===_0x58ea8e(0x276))return Reflect['metadata'](_0x40ce88,_0x40916e);},__param=this&&this[_0x471d3e(0x22d)]||function(_0x2badb2,_0x455d65){return function(_0x15ca6a,_0x301acb){_0x455d65(_0x15ca6a,_0x301acb,_0x2badb2);};};Object[_0x471d3e(0x324)](exports,_0x471d3e(0x2bc),{'value':!![]}),exports[_0x471d3e(0x189)]=void 0x0;const common_1=require(_0x471d3e(0x274)),typeorm_1=require(_0x471d3e(0x1a9)),midjourney_entity_1=require('./midjourney.entity'),typeorm_2=require('typeorm'),globalConfig_service_1=require(_0x471d3e(0x143)),midjourney_constant_1=require(_0x471d3e(0x20d)),file_service_1=require('../file/file.service'),badwords_service_1=require('../badwords/badwords.service'),utils_1=require(_0x471d3e(0x1a0)),mjPrompts_entity_1=require(_0x471d3e(0x2b2)),mjParam_entity_1=require('./mjParam.entity'),mjIncantationClassify_entity_1=require(_0x471d3e(0x277)),mjInspireClassify_entity_1=require(_0x471d3e(0x29f)),mjIncantation_entity_1=require(_0x471d3e(0x1c6)),fanyi_service_1=require(_0x471d3e(0x20e)),mjSuggestWord_entity_1=require(_0x471d3e(0x2f7)),user_service_1=require(_0x471d3e(0x26d)),redisCache_service_1=require(_0x471d3e(0x32f)),mjpAccount_service_1=require('../api/mjpAccount.service'),mjpTask_service_1=require('../api/mjpTask.service'),addDrawQueue_dto_1=require(_0x471d3e(0x2fd)),store_1=require(_0x471d3e(0x22f)),redisKey_constant_1=require(_0x471d3e(0x1da)),aiLog_service_1=require('../aiLog/aiLog.service'),model_constant_1=require(_0x471d3e(0x15f)),nestjs_cls_1=require(_0x471d3e(0x177)),czTask_service_1=require('../api/czTask.service'),models_service_1=require(_0x471d3e(0x18d)),DrawTaskPage_dto_1=require('./dto/DrawTaskPage.dto'),user_constant_1=require(_0x471d3e(0x248)),dict_service_1=require(_0x471d3e(0x2a6)),mjModel_entity_1=require('./mjModel.entity');let MidjourneyService=class MidjourneyService{constructor(_0x298d25,_0x4253f5,_0x252ad9,_0x1ee9a3,_0x1924cf,_0x40fb44,_0x96f445,_0x209c22,_0x451d86,_0x52c813,_0x3bc676,_0x195449,_0x30de03,_0x415ed3,_0x2ac095,_0x1ebdf5,_0x3867e4,_0x1eedf7,_0x2b8733,_0x3df2b5,_0x316940,_0x7193dd){const _0x5677f7=_0x471d3e;this[_0x5677f7(0x1bc)]=_0x298d25,this['mjParamEntity']=_0x4253f5,this[_0x5677f7(0x1ce)]=_0x252ad9,this[_0x5677f7(0x26e)]=_0x1ee9a3,this[_0x5677f7(0x2e0)]=_0x1924cf,this['mjIncantationEntity']=_0x40fb44,this[_0x5677f7(0x136)]=_0x96f445,this[_0x5677f7(0x2c2)]=_0x209c22,this[_0x5677f7(0x300)]=_0x451d86,this[_0x5677f7(0x186)]=_0x52c813,this['userService']=_0x3bc676,this[_0x5677f7(0x2e2)]=_0x195449,this[_0x5677f7(0x1d3)]=_0x30de03,this[_0x5677f7(0x250)]=_0x415ed3,this[_0x5677f7(0x138)]=_0x2ac095,this[_0x5677f7(0x2ca)]=_0x1ebdf5,this['mjpTaskService']=_0x3867e4,this[_0x5677f7(0x2c4)]=_0x1eedf7,this[_0x5677f7(0x284)]=_0x2b8733,this[_0x5677f7(0x2fb)]=_0x3df2b5,this[_0x5677f7(0x15d)]=_0x316940,this['connection']=_0x7193dd;}async['onModuleInit'](){const _0x40a7ad=_0x471d3e;await this[_0x40a7ad(0x1ed)](),await this['initHasAccount']();}async[_0x471d3e(0x1a4)](){const _0x541c22=_0x471d3e,_0x4d39cf=await this['mjParamEntity']['count']({'where':{'enable':0x1},'order':{'weight':_0x541c22(0x2ea)}});_0x4d39cf===0x0&&common_1[_0x541c22(0x16e)][_0x541c22(0x142)]('要使用MJ绘画功能，至少需要配置一个MJ账号,并且启用该账号');}async['initInspireData'](){const _0x376cb1=_0x471d3e,_0x96f01a=await this[_0x376cb1(0x136)]['count']();if(_0x96f01a===0x0){const _0x323766=[{'name':_0x376cb1(0x25c),'value':0x1},{'name':'摄影拍照','value':0x2},{'name':'头像制作','value':0x3},{'name':_0x376cb1(0x16a),'value':0x4},{'name':_0x376cb1(0x262),'value':0x5},{'name':_0x376cb1(0x1cc),'value':0x6},{'name':_0x376cb1(0x280),'value':0x7},{'name':_0x376cb1(0x259),'value':0x8},{'name':_0x376cb1(0x1a6),'value':0x9},{'name':_0x376cb1(0x196),'value':0xa}]['map'](_0x574a39=>{const _0x3e305f=_0x376cb1;return{'name':_0x574a39[_0x3e305f(0x30f)],'value':_0x574a39[_0x3e305f(0x1a5)]+'','inner':0x1};});await this['mjInspireClassifyEntity'][_0x376cb1(0x2b8)](_0x323766)['catch'](()=>{const _0x5e7eb1=_0x376cb1;common_1[_0x5e7eb1(0x16e)][_0x5e7eb1(0x142)](_0x5e7eb1(0x243));}),common_1[_0x376cb1(0x16e)][_0x376cb1(0x2ec)](_0x376cb1(0x1a3));}common_1[_0x376cb1(0x16e)][_0x376cb1(0x2ec)](_0x376cb1(0x2d0));}async[_0x471d3e(0x26f)](_0x2071ae){const _0x3b07c2=_0x471d3e;try{const {guildId:_0x295184,account:_0x55f522,authorization:_0x1cca88,mode:_0x102e90,timeout:_0x590767,channelId:_0xee57b4,remark:_0x9526f6,mjBotChannelId:_0x3900ca,nijiBotChannelId:_0x5d26d8}=_0x2071ae;var _0x1e5645=await this['mjpAccountService']['create']({'data':{'channelId':_0xee57b4,'coreSize':0x3,'guildId':_0x295184,'mjBotChannelId':_0x3900ca||'','nijiBotChannelId':_0x5d26d8||'','queueSize':0xa,'remark':_0x9526f6,'remixAutoSubmit':![],'timeoutMinutes':_0x590767,'userAgent':_0x3b07c2(0x2f0),'userToken':_0x1cca88}});if(_0x1e5645[_0x3b07c2(0x209)]!==0x1)throw new Error(_0x1e5645[_0x3b07c2(0x1d2)]);const _0x25e7bd=await this[_0x3b07c2(0x273)][_0x3b07c2(0x2b8)]({'account':_0x55f522,'authorization':_0x1cca88,'mode':_0x102e90,'timeout':_0x590767,'channelId':_0xee57b4,'guildId':_0x295184,'remark':_0x9526f6,'mjpId':_0x1e5645['result'],'mjBotChannelId':_0x3900ca||'','nijiBotChannelId':_0x5d26d8||''});return await this['syncMjpAccount'](_0x1e5645[_0x3b07c2(0x2cf)]),!!_0x25e7bd;}catch(_0x33f38){common_1[_0x3b07c2(0x16e)][_0x3b07c2(0x142)](_0x33f38);throw new common_1[(_0x3b07c2(0x28b))](_0x33f38[_0x3b07c2(0x2b7)],common_1[_0x3b07c2(0x2d4)][_0x3b07c2(0x297)]);}}async[_0x471d3e(0x1f2)](_0x76550e){const _0x57b7e0=_0x471d3e,{id:_0x49d519,account:_0x283ab1,authorization:_0x3da961,mode:_0x3e2f53,guildId:_0x541c73,remark:_0x30d68a,channelId:_0x506c3e,timeout:_0x594960,enable:_0x1f6d23,mjBotChannelId:_0x4cb501,nijiBotChannelId:_0x149940}=_0x76550e;try{const _0x8a3cf7=await this[_0x57b7e0(0x273)][_0x57b7e0(0x240)]({'id':Number(_0x49d519)});var _0x6b86b7=await this[_0x57b7e0(0x2fb)][_0x57b7e0(0x26b)]({'data':{'channelId':_0x506c3e,'coreSize':0x3,'guildId':_0x541c73,'mjBotChannelId':_0x4cb501||'','nijiBotChannelId':_0x149940||'','queueSize':0xa,'remark':_0x30d68a,'remixAutoSubmit':![],'timeoutMinutes':_0x594960,'userAgent':'Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','userToken':_0x3da961,'enable':Boolean(_0x1f6d23)}},_0x8a3cf7['mjpId']);if(_0x6b86b7['code']!==0x1)throw new Error(_0x6b86b7[_0x57b7e0(0x1d2)]);return await this[_0x57b7e0(0x273)][_0x57b7e0(0x1ef)](_0x49d519,{'account':_0x283ab1,'authorization':_0x3da961,'mode':_0x3e2f53,'guildId':_0x541c73,'remark':_0x30d68a,'channelId':_0x506c3e,'timeout':_0x594960,'mjBotChannelId':_0x4cb501||'','nijiBotChannelId':_0x149940||''});}catch(_0x25c8ba){common_1[_0x57b7e0(0x16e)]['error'](_0x25c8ba);throw new common_1[(_0x57b7e0(0x28b))](_0x25c8ba[_0x57b7e0(0x2b7)],common_1[_0x57b7e0(0x2d4)][_0x57b7e0(0x297)]);}}async['copyAccountInfo'](_0x3290f7,_0x1bc307){const _0x1ec51d=_0x471d3e;_0x3290f7[_0x1ec51d(0x1f4)]=_0x1bc307[_0x1ec51d(0x1d8)];if(_0x1bc307['mode']==='FAST')_0x3290f7[_0x1ec51d(0x1c0)]=midjourney_constant_1[_0x1ec51d(0x31f)][_0x1ec51d(0x28c)];else{if(_0x1bc307[_0x1ec51d(0x1c0)]===_0x1ec51d(0x2f6))_0x3290f7['mode']=midjourney_constant_1[_0x1ec51d(0x31f)][_0x1ec51d(0x295)];else _0x1bc307[_0x1ec51d(0x1c0)]===_0x1ec51d(0x223)&&(_0x3290f7[_0x1ec51d(0x1c0)]=midjourney_constant_1[_0x1ec51d(0x31f)][_0x1ec51d(0x1fd)]);}_0x3290f7[_0x1ec51d(0x23c)]=_0x1bc307[_0x1ec51d(0x187)],_0x3290f7[_0x1ec51d(0x236)]=_0x1bc307[_0x1ec51d(0x187)],_0x3290f7[_0x1ec51d(0x1cd)]=_0x1bc307[_0x1ec51d(0x1cd)],_0x3290f7[_0x1ec51d(0x1ee)]=_0x1bc307[_0x1ec51d(0x1ee)],_0x3290f7['remix']=Number(_0x1bc307[_0x1ec51d(0x2e9)]);if(_0x1bc307[_0x1ec51d(0x251)]===_0x1ec51d(0x1ca))_0x3290f7[_0x1ec51d(0x18b)]=0x1;else{if(_0x1bc307[_0x1ec51d(0x251)]===_0x1ec51d(0x21e))_0x3290f7[_0x1ec51d(0x18b)]=0x2;else{if(_0x1bc307[_0x1ec51d(0x251)]===_0x1ec51d(0x2c8))_0x3290f7[_0x1ec51d(0x18b)]=0x3;else _0x1bc307[_0x1ec51d(0x251)]===_0x1ec51d(0x14b)&&(_0x3290f7[_0x1ec51d(0x18b)]=0x4);}}_0x3290f7[_0x1ec51d(0x239)]=_0x1bc307[_0x1ec51d(0x239)],_0x3290f7[_0x1ec51d(0x2eb)]=_0x1bc307[_0x1ec51d(0x2a2)],_0x3290f7[_0x1ec51d(0x268)]=JSON[_0x1ec51d(0x25b)](_0x1bc307[_0x1ec51d(0x226)]),_0x3290f7[_0x1ec51d(0x323)]=JSON[_0x1ec51d(0x25b)](_0x1bc307[_0x1ec51d(0x1d0)]),await this[_0x1ec51d(0x273)]['save'](_0x3290f7);}async[_0x471d3e(0x312)](_0xb78ee3){const _0x3af665=_0x471d3e;try{if(store_1['MjConfig'][_0x3af665(0x1b2)]!==_0x3af665(0x20c))return;const _0x1cd295=await this[_0x3af665(0x2fb)][_0x3af665(0x24a)]({},_0xb78ee3);if(!_0x1cd295)return;const _0xc88256=await this[_0x3af665(0x273)][_0x3af665(0x182)]({'where':{'mjpId':_0xb78ee3}});await this[_0x3af665(0x213)](_0xc88256,_0x1cd295);}catch(_0x51a04b){common_1[_0x3af665(0x16e)]['error']('自动同步账号信息失败：',_0x51a04b);}}async[_0x471d3e(0x163)](){const _0xc50f59=_0x471d3e,_0x31a3dd=await this['mjParamEntity']['find']();if(!_0x31a3dd[_0xc50f59(0x301)])return;for(let _0x558418=0x0;_0x558418<_0x31a3dd[_0xc50f59(0x301)];_0x558418++){this[_0xc50f59(0x312)](_0x31a3dd[_0x558418][_0xc50f59(0x1d5)]);}}async[_0x471d3e(0x329)]({id:_0x3a990d}){const _0x30bf50=_0x471d3e;try{const _0x25f64f=await this['mjParamEntity'][_0x30bf50(0x240)]({'id':Number(_0x3a990d)}),_0x445f62=await this[_0x30bf50(0x2fb)][_0x30bf50(0x1a2)]({},_0x25f64f[_0x30bf50(0x1d5)]);if(_0x445f62[_0x30bf50(0x209)]!==0x1)throw new Error(_0x445f62[_0x30bf50(0x1d2)]);await this[_0x30bf50(0x213)](_0x25f64f,_0x445f62[_0x30bf50(0x2cf)]);}catch(_0x221968){throw new common_1['HttpException'](_0x221968[_0x30bf50(0x2b7)],common_1[_0x30bf50(0x2d4)][_0x30bf50(0x297)]);}}async[_0x471d3e(0x22c)](_0x36ccd2){const _0x274561=_0x471d3e;try{const _0x1a17b8=await this['mjParamEntity'][_0x274561(0x240)]({'id':Number(_0x36ccd2['id'])}),_0x16c699=await this[_0x274561(0x2fb)][_0x274561(0x22c)]({'data':_0x36ccd2},_0x1a17b8[_0x274561(0x1d5)]);if(_0x16c699['code']!==0x1)throw new Error(_0x16c699[_0x274561(0x1d2)]);return _0x1a17b8[_0x274561(0x1f4)]=_0x36ccd2[_0x274561(0x1d8)],await this[_0x274561(0x273)][_0x274561(0x2b8)](_0x1a17b8),!![];}catch(_0xe589b0){throw new common_1[(_0x274561(0x28b))](_0xe589b0[_0x274561(0x2b7)],common_1['HttpStatus'][_0x274561(0x297)]);}}async[_0x471d3e(0x310)](_0xaae5d9){const _0x849914=_0x471d3e;try{const _0x375c37=await this[_0x849914(0x273)][_0x849914(0x240)]({'id':Number(_0xaae5d9['id'])}),_0x1e062a=await this[_0x849914(0x2fb)][_0x849914(0x310)]({'data':_0xaae5d9},_0x375c37[_0x849914(0x1d5)]);if(_0x1e062a[_0x849914(0x209)]!==0x1)throw new Error(_0x1e062a[_0x849914(0x1d2)]);return!![];}catch(_0x458243){throw new common_1['HttpException'](_0x458243[_0x849914(0x2b7)],common_1['HttpStatus'][_0x849914(0x297)]);}}async[_0x471d3e(0x2f1)](_0x4fc0eb){const _0x53444c=_0x471d3e,{id:_0x1d6284}=_0x4fc0eb;try{const _0x41a93f=await this['mjParamEntity']['findOne']({'where':{'id':Number(_0x1d6284)}});if(!_0x41a93f)throw new Error(_0x53444c(0x2f2));common_1[_0x53444c(0x16e)][_0x53444c(0x142)]('mjpId:\x20',_0x41a93f[_0x53444c(0x1d5)]);const _0x291598=await this[_0x53444c(0x2fb)][_0x53444c(0x2dc)]({},_0x41a93f[_0x53444c(0x1d5)]);if(_0x291598[_0x53444c(0x209)]!==0x1)throw new Error(_0x291598[_0x53444c(0x1d2)]);const _0x6808dc=await this['mjParamEntity'][_0x53444c(0x2dc)]({'id':_0x1d6284});return _0x6808dc[_0x53444c(0x1db)];}catch(_0x482286){throw new common_1[(_0x53444c(0x28b))](_0x482286[_0x53444c(0x2b7)],common_1[_0x53444c(0x2d4)][_0x53444c(0x297)]);}}async[_0x471d3e(0x2e5)](_0x37fe72){const _0x56589c=_0x471d3e,{id:_0xe4b035,enable:_0x2cd200}=_0x37fe72;return await this['mjParamEntity'][_0x56589c(0x1ef)](_0xe4b035,{'enable':_0x2cd200})['then'](_0x32d004=>_0x32d004['affected']>0x0);}async[_0x471d3e(0x2b9)](_0x41cda4,_0x329dca){const _0xcc3cd6=_0x471d3e,_0x247757=(0x0,utils_1[_0xcc3cd6(0x161)])(this[_0xcc3cd6(0x300)]),{id:_0x273e64}=_0x41cda4;let _0x5c2b1d=null;try{const _0xe4cd2b=await this[_0xcc3cd6(0x273)]['findOne']({'where':{'id':_0x273e64}});return _0x247757&&(_0x5c2b1d=await this['mjpAccountService'][_0xcc3cd6(0x24a)]({},_0xe4cd2b[_0xcc3cd6(0x1d5)])),{..._0xe4cd2b,'mjpAccountInfo':_0x5c2b1d,'authorization':_0x247757?_0xe4cd2b[_0xcc3cd6(0x2a1)]:(0x0,utils_1['hideString'])(_0xe4cd2b[_0xcc3cd6(0x2a1)]),'guildId':_0x247757?_0xe4cd2b[_0xcc3cd6(0x2d7)]:(0x0,utils_1[_0xcc3cd6(0x1ba)])(_0xe4cd2b['guildId']),'channelId':_0x247757?_0xe4cd2b[_0xcc3cd6(0x1ac)]:(0x0,utils_1[_0xcc3cd6(0x1ba)])(_0xe4cd2b[_0xcc3cd6(0x1ac)])};}catch(_0x2c3446){throw new common_1['HttpException'](_0x2c3446,common_1[_0xcc3cd6(0x2d4)][_0xcc3cd6(0x297)]);}}async[_0x471d3e(0x311)](_0x364738,_0x292b09){const _0x5a0f7e=_0x471d3e,{page:page=0x1,size:size=0x14,account:_0x441ace,channelId:_0xcc8491,enable:_0x1fc313}=_0x364738;if(!page||!size)throw new common_1[(_0x5a0f7e(0x28b))](_0x5a0f7e(0x2c6),common_1['HttpStatus'][_0x5a0f7e(0x297)]);const _0x607734={};_0x441ace&&Object[_0x5a0f7e(0x2f9)](_0x607734,{'account':(0x0,typeorm_2[_0x5a0f7e(0x2c3)])('%'+_0x441ace+'%')}),_0xcc8491&&Object[_0x5a0f7e(0x2f9)](_0x607734,{'channelId':(0x0,typeorm_2[_0x5a0f7e(0x2c3)])('%'+_0xcc8491+'%')}),_0x1fc313>0x0&&Object[_0x5a0f7e(0x2f9)](_0x607734,{'enable':_0x1fc313});const [_0x256c0f,_0x1268b3]=await this[_0x5a0f7e(0x273)][_0x5a0f7e(0x1ae)]({'skip':(page-0x1)*size,'where':_0x607734,'take':size,'order':{'createdAt':_0x5a0f7e(0x2ea)},'cache':!![],'select':['id',_0x5a0f7e(0x2d7),'channelId',_0x5a0f7e(0x2a1),_0x5a0f7e(0x319),_0x5a0f7e(0x266),_0x5a0f7e(0x21d),_0x5a0f7e(0x23c),_0x5a0f7e(0x18b),_0x5a0f7e(0x239),_0x5a0f7e(0x14a),_0x5a0f7e(0x1c0)]});return(0x0,utils_1[_0x5a0f7e(0x161)])(this[_0x5a0f7e(0x300)])?{'rows':_0x256c0f||[],'count':_0x1268b3||0x0}:{'rows':_0x256c0f['map'](_0x4ed5a7=>({..._0x4ed5a7,'authorization':(0x0,utils_1[_0x5a0f7e(0x1ba)])(_0x4ed5a7['authorization']),'guildId':(0x0,utils_1[_0x5a0f7e(0x1ba)])(_0x4ed5a7['guildId']),'channelId':(0x0,utils_1[_0x5a0f7e(0x1ba)])(_0x4ed5a7[_0x5a0f7e(0x1ac)])}))||[],'count':_0x1268b3||0x0};}async[_0x471d3e(0x2ab)](_0x2085bc,_0x3e67bc){const _0x4278cb=_0x471d3e;try{const _0x2da1ff=(0x0,utils_1[_0x4278cb(0x306)])(this[_0x4278cb(0x300)]),{page:page=0x1,size:size=0x14,botType:_0x257d0c,action:_0x26c19e,keyword:_0x2232ff,userId:_0x5c7c4e,rec:_0x5d8d97,status:_0x4202b5,squareType:_0x48d3f8,workflowId:_0x22a37b,saasId:_0xaa5037}=_0x2085bc,_0x41ac00={};_0x257d0c&&_0x257d0c[_0x4278cb(0x301)]&&(_0x41ac00[_0x4278cb(0x1f1)]=(0x0,typeorm_2['In'])(_0x257d0c));_0x26c19e&&(_0x41ac00[_0x4278cb(0x310)]=_0x26c19e);_0x2232ff&&(_0x41ac00[_0x4278cb(0x305)]=(0x0,typeorm_2[_0x4278cb(0x2c3)])('%'+_0x2232ff+'%'));_0x5c7c4e&&(_0x41ac00[_0x4278cb(0x23e)]=_0x5c7c4e);_0x48d3f8&&(_0x41ac00[_0x4278cb(0x269)]=_0x48d3f8);_0x22a37b&&(_0x41ac00[_0x4278cb(0x1a8)]=_0x22a37b);_0x5d8d97!==null&&_0x5d8d97!==undefined&&(_0x41ac00[_0x4278cb(0x1c3)]=_0x5d8d97);_0x5d8d97!==null&&_0x4202b5!==undefined&&(_0x41ac00[_0x4278cb(0x2da)]=_0x4202b5);(0x0,utils_1['isPlatform'])(this[_0x4278cb(0x300)])?(0x0,utils_1[_0x4278cb(0x24e)])(_0xaa5037)&&(_0x41ac00[_0x4278cb(0x1eb)]=_0xaa5037):_0x41ac00['saasId']=_0x2da1ff;const [_0x1cb8e8,_0x361107]=await this['midjourneyEntity']['findAndCount']({'where':_0x41ac00,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x4278cb(0x2ea)}}),_0x37abf1=new Map(),_0x39e526=_0x1cb8e8[_0x4278cb(0x309)](_0x35eef5=>_0x35eef5[_0x4278cb(0x1a8)])[_0x4278cb(0x232)](_0x1791c6=>Boolean(_0x1791c6));if(_0x39e526[_0x4278cb(0x301)]){const _0x11d7d1=await this[_0x4278cb(0x138)]['getModelByIds'](_0x39e526);_0x11d7d1[_0x4278cb(0x1aa)](_0x5e4871=>_0x37abf1['set'](_0x5e4871['id'],_0x5e4871));}const _0x373470=_0x1cb8e8[_0x4278cb(0x309)](_0xabf37a=>{const _0x53536a=_0x4278cb;return{..._0xabf37a,'workflowName':_0x37abf1['get'](_0xabf37a[_0x53536a(0x1a8)])?.[_0x53536a(0x202)]||''};});if(_0x3e67bc){const _0xa0be5c=_0x373470[_0x4278cb(0x309)](_0x23d226=>_0x23d226[_0x4278cb(0x23e)]),_0x53764f=await this[_0x4278cb(0x18c)][_0x4278cb(0x13e)](_0xa0be5c);_0x373470[_0x4278cb(0x1aa)](_0x316be1=>{const _0x5a2525=_0x4278cb,_0x1ea168=_0x53764f['find'](_0x4ffb84=>_0x4ffb84['id']===_0x316be1[_0x5a2525(0x23e)]);!(0x0,utils_1[_0x5a2525(0x161)])(this['clsService'])&&(_0x1ea168[_0x5a2525(0x1dd)]=(0x0,utils_1[_0x5a2525(0x1ba)])(_0x1ea168['email']),_0x1ea168[_0x5a2525(0x1e5)]=(0x0,utils_1[_0x5a2525(0x1ba)])(_0x1ea168['phone'])),_0x316be1[_0x5a2525(0x242)]=_0x1ea168;});}return{'rows':_0x373470,'count':_0x361107};}catch(_0x597cd1){throw new common_1[(_0x4278cb(0x28b))](_0x597cd1[_0x4278cb(0x2b7)],common_1[_0x4278cb(0x2d4)][_0x4278cb(0x297)]);}}async[_0x471d3e(0x314)](_0x4f62bd){const _0xd91b7a=_0x471d3e,_0x27dbbd=await this[_0xd91b7a(0x15d)][_0xd91b7a(0x191)]([_0xd91b7a(0x22e)]),_0xe438e2=Number(_0x27dbbd||0x0);if(_0xe438e2===0x0)return!![];const _0x3ec0f1=await this[_0xd91b7a(0x26e)][_0xd91b7a(0x16c)]({'where':{'userId':_0x4f62bd,'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6])}});if(_0x3ec0f1<_0xe438e2)return!![];else throw new Error(_0xd91b7a(0x2cd));}async[_0x471d3e(0x308)](_0x3e751b){const _0x5f018f=_0x471d3e;if(store_1[_0x5f018f(0x330)]['mjModel']!==_0x5f018f(0x20c))return null;if(process[_0x5f018f(0x29a)][_0x5f018f(0x30d)]===_0x5f018f(0x30a)){if(_0x3e751b===0x0)return{'modes':['RELAX']};if(_0x3e751b===0x1)return{'modes':[_0x5f018f(0x233)]};if(_0x3e751b===0x2)return{'modes':[_0x5f018f(0x2f6)]};if(_0x3e751b===0x3)return{'modes':[_0x5f018f(0x223)]};}const _0x62579e=await this[_0x5f018f(0x273)][_0x5f018f(0x2e8)]({'where':{'enable':0x1,'mode':_0x3e751b,'fastRemainTime':(0x0,typeorm_2['Not'])((0x0,typeorm_2[_0x5f018f(0x160)])())},'order':{'weight':'DESC'}});if(!_0x62579e[_0x5f018f(0x301)])throw new Error(_0x5f018f(0x22a));const [_0x265493]=await this[_0x5f018f(0x157)][_0x5f018f(0x286)](_0x5f018f(0x172));if(!_0x265493)return{'instanceId':_0x62579e[0x0]['mjpId']};else{const _0x15fdab=_0x62579e[_0x5f018f(0x2e8)](_0x32c7a3=>_0x32c7a3[_0x5f018f(0x1d5)]===_0x265493[_0x5f018f(0x1d5)]);if(!_0x15fdab)throw new Error('没有满足条件的MJ账号，请联系管理员！');return{'instanceId':_0x15fdab[_0x5f018f(0x1d5)]};}}async[_0x471d3e(0x151)](_0x428964,_0x1f876e){const _0x54a645=_0x471d3e,_0x23a430=await this[_0x54a645(0x26e)][_0x54a645(0x16c)]({'where':{'originTaskId':String(_0x428964),'customId':_0x1f876e}});if(_0x23a430>0x0)throw new common_1[(_0x54a645(0x28b))](_0x54a645(0x175),common_1['HttpStatus'][_0x54a645(0x297)]);return![];}async[_0x471d3e(0x321)](_0x3d190a){const _0x3689a2=_0x471d3e,_0x1b4b8b=new addDrawQueue_dto_1[(_0x3689a2(0x153))](_0x3d190a);await this[_0x3689a2(0x2c4)][_0x3689a2(0x303)](_0x1b4b8b['fullPrompt'],_0x1b4b8b[_0x3689a2(0x23e)]);const _0x349f74=(0x0,utils_1[_0x3689a2(0x306)])(this[_0x3689a2(0x300)]);_0x1b4b8b['saasId']=_0x349f74;const _0x4ed106=await this[_0x3689a2(0x26e)][_0x3689a2(0x2b8)](_0x1b4b8b);return _0x4ed106;}async['imagine'](_0x3039a8,_0x2d172c){const _0x234e23=_0x471d3e;let _0x505b87,{botType:_0x3a843e,prompt:_0x56c6e9,extend:_0x2ed71a,action:_0x28d054,mode:_0xf68ec1,translate:_0x558956,base64Array:_0x172739,mats:mats=[],iw:_0x1fd909,roles:roles=[],cw:_0x30aa13,styles:styles=[],sw:_0x985478}=_0x2d172c;_0xf68ec1=await this[_0x234e23(0x18c)]['validateBalance4MJ'](_0x3039a8['user']['id'],_0xf68ec1,_0x234e23(0x2db));const _0x50b31e=_0x56c6e9,_0x352e3c=await this[_0x234e23(0x308)](_0xf68ec1);_0x56c6e9&&await this[_0x234e23(0x2c4)][_0x234e23(0x303)](_0x56c6e9,_0x3039a8['user']['id']),_0x56c6e9=_0x558956===0x1&&(0x0,utils_1['isChinese'])(_0x56c6e9)?await this['fanyiService']['convertToEnglish'](_0x56c6e9):_0x56c6e9;let _0xffdcf9=_0x56c6e9;mats[_0x234e23(0x301)]&&(_0xffdcf9=mats[_0x234e23(0x1ec)]('\x20')+'\x20'+_0xffdcf9);_0x1fd909&&(_0xffdcf9=_0xffdcf9+_0x234e23(0x2a3)+_0x1fd909);styles[_0x234e23(0x301)]&&(_0xffdcf9=_0xffdcf9+'\x20--sref\x20'+styles[_0x234e23(0x1ec)]('\x20'));roles['length']&&(_0xffdcf9=_0xffdcf9+'\x20--cref\x20'+roles['join']('\x20'));_0x30aa13&&(_0xffdcf9=_0xffdcf9+'\x20--cw\x20'+_0x30aa13);_0x985478&&(_0xffdcf9=_0xffdcf9+_0x234e23(0x23b)+_0x985478);_0x2ed71a&&(_0xffdcf9=_0xffdcf9+'\x20'+_0x2ed71a);const _0x35f004=await this[_0x234e23(0x32e)][_0x234e23(0x28d)]({'data':{'mode':this[_0x234e23(0x25a)](_0xf68ec1),'prompt':_0xffdcf9,'botType':_0x3a843e||_0x234e23(0x13b),'base64Array':_0x172739,'accountFilter':_0x352e3c}});if(_0x35f004[_0x234e23(0x209)]===0x17)throw new Error('队列已满，请稍后尝试');if(_0x35f004[_0x234e23(0x209)]===0x18)throw new Error(_0x234e23(0x318));if(_0x35f004[_0x234e23(0x209)]!==0x1&&_0x35f004['code']!==0x16)throw new Error(_0x35f004[_0x234e23(0x1d2)]);return _0x505b87=await this['connection']['transaction'](async()=>{const _0x56069a=_0x234e23,_0x427e68={'mode':_0xf68ec1,'prompt':_0x56c6e9,'action':_0x28d054,'translate':_0x558956,'fullPrompt':_0xffdcf9,'originPrompt':_0x50b31e,'extraParam':_0x2ed71a,'userId':_0x3039a8[_0x56069a(0x23d)]['id'],'mjpId':_0x352e3c?.[_0x56069a(0x169)],'mjpTaskId':_0x35f004[_0x56069a(0x2cf)],'botType':_0x3a843e||_0x56069a(0x13b)},_0x4729d7=await this[_0x56069a(0x321)](_0x427e68);if(!_0x4729d7)throw new Error(_0x56069a(0x317));return await this[_0x56069a(0x18c)][_0x56069a(0x1a7)](_0x3039a8[_0x56069a(0x23d)]['id'],_0xf68ec1,_0x56069a(0x2db),_0x4729d7['id']),_0x4729d7;}),_0x505b87;}async[_0x471d3e(0x30c)](_0x28757c,_0x3b9d15){const _0x28fbce=_0x471d3e;let _0x429915;const {action:_0x5ccf64,taskId:_0x19103c,customId:_0x387736,prompt:_0x155a8c,mask:_0xdf1710}=_0x3b9d15;await this[_0x28fbce(0x151)](_0x19103c,_0x387736);const _0xdef58a=await this[_0x28fbce(0x26e)][_0x28fbce(0x182)]({'where':{'id':_0x19103c}});if(!_0xdef58a)throw new Error('无绘图记录');let _0x556a42=await this[_0x28fbce(0x18c)][_0x28fbce(0x229)](_0x28757c[_0x28fbce(0x23d)]['id'],_0xdef58a[_0x28fbce(0x1c0)],_0x387736);const _0x351400=await this[_0x28fbce(0x32e)][_0x28fbce(0x310)]({'data':{'customId':_0x387736,'taskId':_0xdef58a['mjpTaskId'],'accountFilter':{'instanceId':_0xdef58a[_0x28fbce(0x1d5)]},'mode':this[_0x28fbce(0x25a)](_0x556a42)}});if(_0x351400[_0x28fbce(0x209)]===0x17)throw new Error(_0x28fbce(0x249));else{if(_0x351400[_0x28fbce(0x209)]===0x18)throw new Error(_0x28fbce(0x318));else{if(_0x351400[_0x28fbce(0x209)]===0x15)setTimeout(()=>this[_0x28fbce(0x291)](_0x351400[_0x28fbce(0x2cf)]));else{if(_0x351400[_0x28fbce(0x209)]!==0x1&&_0x351400[_0x28fbce(0x209)]!==0x16)throw new Error(_0x351400['description']);}}}return _0x429915=await this[_0x28fbce(0x157)][_0x28fbce(0x27c)](async()=>{const _0x460313=_0x28fbce,_0x318d1d={'action':_0x5ccf64,'customId':_0x387736,'userId':_0x28757c[_0x460313(0x23d)]['id'],'mjpTaskId':_0x351400[_0x460313(0x2cf)],'originTaskId':String(_0x19103c),'mode':_0x556a42,'mjpId':_0xdef58a[_0x460313(0x1d5)],'prompt':_0xdef58a[_0x460313(0x32b)],'botType':_0xdef58a['botType'],'extraParam':_0xdef58a[_0x460313(0x241)],'fullPrompt':_0xdef58a[_0x460313(0x207)],'originPrompt':_0xdef58a[_0x460313(0x305)]},_0x2c2227=await this[_0x460313(0x321)](_0x318d1d);if(!_0x2c2227)throw new Error('提交动作失败');const _0x1d92e6=_0xdef58a[_0x460313(0x226)];return _0xdef58a[_0x460313(0x226)][_0x460313(0x1aa)](_0x5514e7=>{const _0x2e9ca3=_0x460313;_0x5514e7['customId']===_0x3b9d15[_0x2e9ca3(0x1ab)]&&(_0x5514e7[_0x2e9ca3(0x203)]=!![]);}),await this[_0x460313(0x26e)][_0x460313(0x2b8)](_0xdef58a),await this[_0x460313(0x18c)]['deductBalance4MJ'](_0x28757c[_0x460313(0x23d)]['id'],_0x556a42,_0x387736,_0x2c2227['id']),_0x2c2227;}),_0x429915;}async[_0x471d3e(0x328)](_0x8e9a9,_0x2a7848){const _0x3214d2=_0x471d3e;let _0x35dbcd,{action:_0x2eedd2,taskId:_0x73569f,customId:_0x4fa238,prompt:_0x1563e1,mask:_0x5c598a}=_0x2a7848;const _0x10ac91=await this[_0x3214d2(0x26e)]['findOne']({'where':{'id':_0x73569f}});if(!_0x10ac91)throw new Error('无绘图记录');const _0x21ef32=_0x1563e1;_0x1563e1&&await this[_0x3214d2(0x2c4)]['checkBadWords'](_0x1563e1,_0x8e9a9[_0x3214d2(0x23d)]['id']),_0x1563e1=(0x0,utils_1[_0x3214d2(0x16d)])(_0x1563e1)?await this['fanyiService'][_0x3214d2(0x325)](_0x1563e1):_0x1563e1;const _0x5b1cc2=await this[_0x3214d2(0x32e)][_0x3214d2(0x1f3)]({'data':{'prompt':_0x1563e1,'maskBase64':_0x5c598a,'taskId':_0x10ac91[_0x3214d2(0x2d1)]}});if(_0x5b1cc2[_0x3214d2(0x209)]!==0x1&&_0x5b1cc2['code']!==0x16)throw new Error(_0x5b1cc2[_0x3214d2(0x1d2)]);_0x35dbcd=await this[_0x3214d2(0x26e)][_0x3214d2(0x2b8)]({'id':_0x73569f,'prompt':_0x1563e1,'status':0x1,'originPrompt':_0x21ef32,'messageFlags':0x1});for(let _0x55979a in _0x35dbcd){_0x35dbcd[_0x55979a]&&(_0x10ac91[_0x55979a]=_0x35dbcd[_0x55979a]);}return _0x10ac91;}async[_0x471d3e(0x31d)](_0x14711a,_0x3e1335){const _0x530ec1=_0x471d3e;let _0x3f0a84,_0x56d09e;try{let {type:_0x33432e,params:_0x596f30}=_0x14711a;await this[_0x530ec1(0x18c)][_0x530ec1(0x2b4)](_0x3e1335[_0x530ec1(0x23d)]),await this[_0x530ec1(0x314)](_0x3e1335[_0x530ec1(0x23d)]['id']);if(_0x33432e===midjourney_constant_1['MidJourneyDrawEnum'][_0x530ec1(0x1f7)])_0x56d09e=await this['imagine'](_0x3e1335,_0x596f30),_0x3f0a84=_0x56d09e[_0x530ec1(0x2d1)];else{if(_0x33432e===midjourney_constant_1[_0x530ec1(0x170)][_0x530ec1(0x19f)])_0x596f30=_0x596f30,_0x596f30[_0x530ec1(0x1ab)]?(_0x56d09e=await this[_0x530ec1(0x30c)](_0x3e1335,_0x596f30),_0x596f30[_0x530ec1(0x32b)]&&(_0x596f30[_0x530ec1(0x1de)]=_0x56d09e['id'],_0x56d09e=await this[_0x530ec1(0x328)](_0x3e1335,_0x596f30))):_0x56d09e=await this[_0x530ec1(0x328)](_0x3e1335,_0x596f30),_0x3f0a84=_0x56d09e[_0x530ec1(0x2d1)];else return new common_1[(_0x530ec1(0x28b))]('任务类型错误',common_1[_0x530ec1(0x2d4)][_0x530ec1(0x297)]);}return _0x56d09e;}catch(_0x5ef0a1){if(_0x5ef0a1 instanceof common_1['HttpException'])throw _0x5ef0a1;else{_0x3f0a84&&await this[_0x530ec1(0x32e)][_0x530ec1(0x315)]({},_0x3f0a84);throw new common_1[(_0x530ec1(0x28b))](_0x5ef0a1[_0x530ec1(0x2b7)],common_1[_0x530ec1(0x2d4)]['BAD_REQUEST']);}}}async[_0x471d3e(0x1dc)](_0x4422a7,_0x108956){const _0x4a28c8=_0x471d3e;let _0x5ee909,_0x195957;try{let {type:_0x211f52,botType:_0x21ae1a,files:_0x1d14b5,mode:_0x53e251,action:_0x1a649c,size:_0x111e3e,base64Array:base64Array=[]}=_0x4422a7;await this[_0x4a28c8(0x18c)]['checkUserStatus'](_0x108956[_0x4a28c8(0x23d)]),await this[_0x4a28c8(0x314)](_0x108956[_0x4a28c8(0x23d)]['id']);let _0x34a619='';if(Number(_0x211f52)===midjourney_constant_1[_0x4a28c8(0x170)][_0x4a28c8(0x28f)])_0x34a619=_0x4a28c8(0x2b1);else Number(_0x211f52)===midjourney_constant_1['MidJourneyDrawEnum'][_0x4a28c8(0x29e)]&&(_0x34a619=_0x4a28c8(0x1ad));_0x53e251=await this['userService'][_0x4a28c8(0x229)](_0x108956['user']['id'],_0x53e251,_0x34a619);const _0x1b2ef8=await this['distributeAccount'](_0x53e251);if(!base64Array[_0x4a28c8(0x301)])for(let _0x164fa0=0x0;_0x164fa0<_0x1d14b5[_0x4a28c8(0x301)];_0x164fa0++){base64Array['push'](_0x4a28c8(0x1b5)+_0x1d14b5[_0x164fa0][_0x4a28c8(0x227)][_0x4a28c8(0x2b3)](_0x4a28c8(0x14f)));}if(Number(_0x211f52)===midjourney_constant_1[_0x4a28c8(0x170)][_0x4a28c8(0x28f)]){if(base64Array[_0x4a28c8(0x301)]<0x2)throw new Error(_0x4a28c8(0x260));const _0x150369=await this['mjpTaskService'][_0x4a28c8(0x2f8)]({'data':{'mode':this[_0x4a28c8(0x25a)](_0x53e251),'dimensions':_0x111e3e,'botType':_0x4a28c8(0x13b),'base64Array':base64Array,'accountFilter':_0x1b2ef8}});if(_0x150369[_0x4a28c8(0x209)]===0x17)throw new Error(_0x4a28c8(0x249));if(_0x150369[_0x4a28c8(0x209)]!==0x1&&_0x150369[_0x4a28c8(0x209)]!==0x16)throw new Error(_0x150369[_0x4a28c8(0x1d2)]);_0x5ee909=_0x150369[_0x4a28c8(0x2cf)],_0x195957=await this[_0x4a28c8(0x157)][_0x4a28c8(0x27c)](async()=>{const _0x4969d0=_0x4a28c8,_0x5666cd={'mode':_0x53e251,'action':_0x1a649c,'userId':_0x108956['user']['id'],'jobId':(0x0,utils_1['createRandomUid'])(),'botType':_0x21ae1a||'MID_JOURNEY','extraParam':JSON[_0x4969d0(0x25b)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x150369[_0x4969d0(0x2cf)]},_0x490190=await this[_0x4969d0(0x321)](_0x5666cd);if(!_0x490190)throw new Error(_0x4969d0(0x25d));return await this[_0x4969d0(0x18c)][_0x4969d0(0x1a7)](_0x108956[_0x4969d0(0x23d)]['id'],_0x53e251,_0x34a619,_0x490190['id']),_0x490190;});}else{if(Number(_0x211f52)===midjourney_constant_1['MidJourneyDrawEnum']['IMAGE_TO_TEXT']){const _0x494876=await this[_0x4a28c8(0x32e)][_0x4a28c8(0x307)]({'data':{'mode':this[_0x4a28c8(0x25a)](_0x53e251),'botType':_0x4a28c8(0x13b),'base64':base64Array[0x0],'accountFilter':_0x1b2ef8}});if(_0x494876[_0x4a28c8(0x209)]===0x17)throw new Error(_0x4a28c8(0x249));if(_0x494876[_0x4a28c8(0x209)]!==0x1&&_0x494876[_0x4a28c8(0x209)]!==0x16)throw new Error(_0x494876['description']);_0x5ee909=_0x494876['result'],_0x195957=await this[_0x4a28c8(0x157)]['transaction'](async()=>{const _0x4d8277=_0x4a28c8,_0x5bfe94={'mode':_0x53e251,'action':_0x1a649c,'userId':_0x108956[_0x4d8277(0x23d)]['id'],'jobId':(0x0,utils_1[_0x4d8277(0x2e6)])(),'botType':_0x21ae1a||_0x4d8277(0x13b),'extraParam':JSON[_0x4d8277(0x25b)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x494876[_0x4d8277(0x2cf)]},_0x584c96=await this[_0x4d8277(0x321)](_0x5bfe94);if(!_0x584c96)throw new Error(_0x4d8277(0x28e));return await this[_0x4d8277(0x18c)][_0x4d8277(0x1a7)](_0x108956['user']['id'],_0x53e251,_0x34a619,_0x584c96['id']),_0x584c96;})[_0x4a28c8(0x2f4)](async _0x54a3d9=>{const _0x1f7d99=_0x4a28c8;await this['mjpTaskService'][_0x1f7d99(0x315)]({},_0x494876['result']);throw _0x54a3d9;});}else return new common_1[(_0x4a28c8(0x28b))](_0x4a28c8(0x2e3),common_1['HttpStatus'][_0x4a28c8(0x297)]);}return _0x195957;}catch(_0x4724d8){if(_0x4724d8 instanceof common_1['HttpException'])throw _0x4724d8;else{_0x5ee909&&await this[_0x4a28c8(0x32e)][_0x4a28c8(0x315)]({},_0x5ee909);throw new common_1[(_0x4a28c8(0x28b))](_0x4724d8[_0x4a28c8(0x2b7)],common_1[_0x4a28c8(0x2d4)][_0x4a28c8(0x297)]);}}}async[_0x471d3e(0x204)](_0x306709,_0x5285af){const _0x23993a=_0x471d3e;let _0x1a442e;try{const {params:_0x3ea1c2}=_0x306709;let {mode:_0x2091cd,botType:_0x144dfe,action:_0x3103c7,extend:_0x45a61a,sourceBase64:_0x552178,targetBase64:_0x32de66}=_0x3ea1c2;await this[_0x23993a(0x18c)][_0x23993a(0x2b4)](_0x5285af[_0x23993a(0x23d)]),await this[_0x23993a(0x314)](_0x5285af[_0x23993a(0x23d)]['id']),_0x2091cd=await this[_0x23993a(0x18c)][_0x23993a(0x229)](_0x5285af[_0x23993a(0x23d)]['id'],_0x2091cd,_0x23993a(0x270));const _0xb433b2=await this[_0x23993a(0x308)](_0x2091cd),_0x406eab=await this[_0x23993a(0x32e)][_0x23993a(0x287)]({'data':{'sourceBase64':_0x552178,'targetBase64':_0x32de66,'state':_0x45a61a,'mode':this[_0x23993a(0x25a)](_0x2091cd),'accountFilter':_0xb433b2}});if(_0x406eab['code']===0x17)throw new Error('队列已满，请稍后尝试');if(_0x406eab['code']===0x18)throw new Error(_0x23993a(0x318));if(_0x406eab[_0x23993a(0x209)]!==0x1&&_0x406eab[_0x23993a(0x209)]!==0x16)throw new Error(_0x406eab[_0x23993a(0x1d2)]);return _0x1a442e=await this[_0x23993a(0x157)][_0x23993a(0x27c)](async()=>{const _0x6e40bc=_0x23993a,_0x3b1d52={'mode':_0x2091cd,'action':_0x3103c7,'prompt':null,'extraParam':_0x45a61a,'originPrompt':null,'userId':_0x5285af[_0x6e40bc(0x23d)]['id'],'mjpId':_0xb433b2?.[_0x6e40bc(0x169)],'mjpTaskId':_0x406eab['result'],'botType':_0x144dfe||_0x6e40bc(0x13b)},_0x116e7c=new addDrawQueue_dto_1[(_0x6e40bc(0x153))](_0x3b1d52),_0x3d1572=(0x0,utils_1[_0x6e40bc(0x306)])(this[_0x6e40bc(0x300)]);_0x116e7c[_0x6e40bc(0x1eb)]=_0x3d1572;const _0x5b06e4=await this[_0x6e40bc(0x26e)][_0x6e40bc(0x2b8)](_0x116e7c);if(!_0x5b06e4)throw new Error(_0x6e40bc(0x317));return await this[_0x6e40bc(0x18c)][_0x6e40bc(0x1a7)](_0x5285af[_0x6e40bc(0x23d)]['id'],_0x2091cd,_0x6e40bc(0x270),_0x5b06e4['id']),_0x5b06e4;}),_0x1a442e;}catch(_0x309426){if(_0x309426 instanceof common_1[_0x23993a(0x28b)])throw _0x309426;else throw new common_1[(_0x23993a(0x28b))](_0x309426[_0x23993a(0x2b7)],common_1[_0x23993a(0x2d4)][_0x23993a(0x297)]);}}async[_0x471d3e(0x140)](_0x132952,_0x21868d){const _0x13b68a=_0x471d3e,_0x39a06e=(0x0,utils_1[_0x13b68a(0x306)])(this['clsService']),_0x1a09b9={'userId':_0x21868d[_0x13b68a(0x23d)]['id'],'jobId':(0x0,utils_1['createRandomUid'])(),'mode':0x1,'translate':0x0,'prompt':'','progress':0x64,'durationSpent':0x0,'status':0x3,'fullPrompt':_0x132952[_0x13b68a(0x32b)],'originPrompt':_0x132952[_0x13b68a(0x32b)],'fileInfo':_0x132952[_0x13b68a(0x2de)],'botType':_0x132952[_0x13b68a(0x1f1)],'imageUrl':_0x132952[_0x13b68a(0x145)],'buttons':[],'saasId':_0x39a06e},_0x3fc94a=await this[_0x13b68a(0x26e)]['save'](_0x1a09b9);return _0x3fc94a;}async[_0x471d3e(0x290)](_0x345ac5){const _0x46bdb5=_0x471d3e;try{const _0x30b461=await this[_0x46bdb5(0x26e)][_0x46bdb5(0x182)]({'where':{'jobId':_0x345ac5}});if(!_0x30b461)throw new Error('任务不存在！');const _0xba8232=await this[_0x46bdb5(0x32e)][_0x46bdb5(0x290)]({},_0x30b461[_0x46bdb5(0x2d1)]);if(_0xba8232[_0x46bdb5(0x209)]!==0x1)throw new Error(_0xba8232[_0x46bdb5(0x1d2)]);return _0xba8232[_0x46bdb5(0x2cf)];}catch(_0x24567a){throw new common_1[(_0x46bdb5(0x28b))](_0x24567a[_0x46bdb5(0x2b7)],common_1[_0x46bdb5(0x2d4)][_0x46bdb5(0x297)]);}}async[_0x471d3e(0x205)](_0x3f4cff,_0x584a78){const _0x252fb0=_0x471d3e;try{let _0x3e8223,_0x119e5c,_0x126964,_0x1a8b5b;const {jobId:_0x24ab22,detail:_0xb5a3d0}=_0x584a78,_0x299120=(0x0,utils_1[_0x252fb0(0x292)])(this['clsService']),_0x19364c=await this[_0x252fb0(0x26e)][_0x252fb0(0x182)]({'where':{'jobId':_0x24ab22}});if(_0x19364c[_0x252fb0(0x1a8)]){const _0x41d4d3=await this[_0x252fb0(0x138)][_0x252fb0(0x1d7)](_0x19364c[_0x252fb0(0x1a8)]);_0x1a8b5b=_0x41d4d3[_0x252fb0(0x202)];}return _0xb5a3d0&&(this['aiLogService'][_0x252fb0(0x31a)](model_constant_1[_0x252fb0(0x217)][_0x252fb0(0x1d9)],_0x19364c['id']),_0x3e8223=await this['userService'][_0x252fb0(0x1c9)](_0x19364c['userId']),_0x119e5c=await this[_0x252fb0(0x250)][_0x252fb0(0x24b)](model_constant_1[_0x252fb0(0x217)][_0x252fb0(0x1d9)],_0x19364c['id']),_0x299120&&(_0x126964=await this['aiLogService'][_0x252fb0(0x29d)](model_constant_1[_0x252fb0(0x217)][_0x252fb0(0x1d9)],_0x19364c['id']))),{..._0x19364c,'workflowName':_0x1a8b5b,'avatar':_0x3e8223?_0x3e8223[_0x252fb0(0x210)]:null,'username':_0x3e8223?_0x3e8223[_0x252fb0(0x253)]:null,'nickname':_0x3e8223?_0x3e8223[_0x252fb0(0x278)]:null,'visitNum':_0x119e5c?_0x119e5c[_0x252fb0(0x2ef)]:0x0,'agreeNum':_0x119e5c?_0x119e5c['agreeNum']:0x0,'agree':_0x126964?_0x126964['action']:null};}catch(_0xe4c231){throw new common_1[(_0x252fb0(0x28b))](_0xe4c231[_0x252fb0(0x2b7)],common_1[_0x252fb0(0x2d4)][_0x252fb0(0x297)]);}}async[_0x471d3e(0x261)](_0x48861a,_0xe5b8fe){const _0x127ac3=_0x471d3e;try{if(!_0xe5b8fe[_0x127ac3(0x195)]||!_0xe5b8fe[_0x127ac3(0x195)]['length'])return[];const _0x217605=_0xe5b8fe['jobIds'][_0x127ac3(0x180)](','),_0x437c77=await this['midjourneyEntity']['find']({'where':{'jobId':(0x0,typeorm_2['In'])(_0x217605)}}),_0x34b32a=new Map(),_0x4f6363=_0x437c77[_0x127ac3(0x309)](_0x283099=>_0x283099[_0x127ac3(0x1a8)])[_0x127ac3(0x232)](_0x1a497d=>Boolean(_0x1a497d));if(_0x4f6363[_0x127ac3(0x301)]){const _0x5203d9=await this[_0x127ac3(0x138)]['getModelByIds'](_0x4f6363);_0x5203d9[_0x127ac3(0x1aa)](_0x35fa86=>_0x34b32a[_0x127ac3(0x2bf)](_0x35fa86['id'],_0x35fa86));}return _0x437c77[_0x127ac3(0x309)](_0x3581ed=>{const _0x2f943f=_0x127ac3;return{..._0x3581ed,'workflowName':_0x34b32a[_0x2f943f(0x256)](_0x3581ed[_0x2f943f(0x1a8)])?.[_0x2f943f(0x202)]||''};});}catch(_0x2a60bc){throw new common_1[(_0x127ac3(0x28b))](_0x2a60bc['message'],common_1[_0x127ac3(0x2d4)][_0x127ac3(0x297)]);}}async['recDraw'](_0x1b56fa){const _0xb16a5e=_0x471d3e,{id:_0x2979bd,squareType:_0x4f3ca1}=_0x1b56fa,_0x50d917=await this[_0xb16a5e(0x26e)]['findOne']({'where':{'id':_0x2979bd,'status':midjourney_constant_1['MidjourneyStatusEnum']['DRAWED']}});if(!_0x50d917)throw new common_1[(_0xb16a5e(0x28b))](_0xb16a5e(0x25f),common_1[_0xb16a5e(0x2d4)]['BAD_REQUEST']);const _0x459bcf=await this['midjourneyEntity'][_0xb16a5e(0x1ef)]({'id':_0x2979bd},{'rec':0x1,'squareType':_0x4f3ca1})[_0xb16a5e(0x2f4)](_0x4bf9e0=>{const _0xb5df32=_0xb16a5e;throw new common_1[(_0xb5df32(0x28b))](_0x4bf9e0,common_1[_0xb5df32(0x2d4)][_0xb5df32(0x297)]);});if(_0x459bcf[_0xb16a5e(0x1db)]<=0x0)throw new common_1['HttpException']('操作失败！',common_1[_0xb16a5e(0x2d4)][_0xb16a5e(0x297)]);return await this['redisCacheService'][_0xb16a5e(0x247)]({'key':_0xb16a5e(0x1a1)}),!![];}async[_0x471d3e(0x155)](_0x346485,_0x371792){const _0x54a862=_0x471d3e;return this[_0x54a862(0x2ca)][_0x54a862(0x1e6)]({'data':{'workflowId':_0x346485,'versionId':_0x371792}});}async['workflowPage'](_0x418bfa,_0x55a251){const _0x336c25=_0x471d3e;try{const _0x262068={'page':_0x55a251[_0x336c25(0x1c7)],'size':_0x55a251[_0x336c25(0x2f3)],'modelName':_0x55a251[_0x336c25(0x2ad)],'modelType':model_constant_1['EModelType'][_0x336c25(0x173)]};(0x0,utils_1['isManage'])(this[_0x336c25(0x300)])?_0x55a251[_0x336c25(0x2da)]!==undefined&&(_0x262068[_0x336c25(0x2da)]=Boolean(_0x55a251[_0x336c25(0x2da)])):_0x262068[_0x336c25(0x2da)]=!![];const _0x1ef134=await this[_0x336c25(0x138)][_0x336c25(0x27b)](_0x418bfa,_0x262068);let _0x3bc7eb=[];if(_0x1ef134[_0x336c25(0x1d6)][_0x336c25(0x301)]){const _0x48fab7=new Set(),_0x23f1a5=(0x0,utils_1[_0x336c25(0x292)])(this[_0x336c25(0x300)]),_0x141b93=_0x1ef134['rows'][_0x336c25(0x309)](_0x58f0f4=>_0x58f0f4['id']);if(_0x141b93[_0x336c25(0x301)]&&_0x23f1a5){const _0x26bfe4=await this[_0x336c25(0x18c)][_0x336c25(0x1cf)](_0x23f1a5,user_constant_1[_0x336c25(0x14e)][_0x336c25(0x173)],_0x141b93);_0x26bfe4['forEach'](_0x250e4b=>_0x48fab7[_0x336c25(0x181)](Number(_0x250e4b[_0x336c25(0x156)])));}_0x3bc7eb=_0x1ef134['rows'][_0x336c25(0x309)](_0x5f41d4=>{const _0x431e10=_0x336c25,_0x235a64={'id':_0x5f41d4['id'],'cover':_0x5f41d4[_0x431e10(0x218)],'name':_0x5f41d4[_0x431e10(0x202)],'workflowId':_0x5f41d4[_0x431e10(0x178)],'versionId':Number(_0x5f41d4[_0x431e10(0x2ce)]),'deduct':_0x5f41d4['deduct'],'vipFreeNum':_0x5f41d4[_0x431e10(0x27a)],'displaySort':_0x5f41d4[_0x431e10(0x168)],'description':_0x5f41d4[_0x431e10(0x1d2)],'status':_0x5f41d4[_0x431e10(0x2da)],'createdAt':_0x5f41d4[_0x431e10(0x14a)],'updatedAt':_0x5f41d4[_0x431e10(0x23a)],'useCount':_0x5f41d4[_0x431e10(0x2bb)],'tutorial':_0x5f41d4['remark'],'freeUsed':_0x5f41d4[_0x431e10(0x17b)],'favorite':_0x48fab7[_0x431e10(0x2d3)](_0x5f41d4['id'])};return _0x235a64;});}return{'count':_0x1ef134['count'],'rows':_0x3bc7eb};}catch(_0x312573){throw new common_1[(_0x336c25(0x28b))](_0x312573[_0x336c25(0x2b7)],common_1[_0x336c25(0x2d4)]['BAD_REQUEST']);}}async[_0x471d3e(0x1e6)](_0x2b9411,_0x5a9b6d){const _0x90ebcc=_0x471d3e;try{let _0x2d7006;const _0x2e2722=(0x0,utils_1[_0x90ebcc(0x292)])(this[_0x90ebcc(0x300)]),_0x550ccb=new Set(),_0x55f9bc=await this[_0x90ebcc(0x138)]['getModelById'](_0x5a9b6d);if(!_0x55f9bc)throw new common_1[(_0x90ebcc(0x28b))](_0x90ebcc(0x188),common_1[_0x90ebcc(0x2d4)][_0x90ebcc(0x297)]);if(_0x2e2722){const _0x2658f0=await this[_0x90ebcc(0x18c)]['getUserById'](_0x2e2722);if(_0x2658f0['vipExpire']||_0x2658f0[_0x90ebcc(0x1b1)]){const _0x410368=redisKey_constant_1[_0x90ebcc(0x2c0)]+'-'+_0x2e2722+'-'+_0x55f9bc['id'];_0x2d7006=await await this[_0x90ebcc(0x284)][_0x90ebcc(0x256)]({'key':_0x410368});}const _0x36a069=await this[_0x90ebcc(0x18c)][_0x90ebcc(0x1cf)](_0x2e2722,user_constant_1['EFavorite'][_0x90ebcc(0x173)],[_0x55f9bc['id']]);_0x36a069[_0x90ebcc(0x1aa)](_0x2d0b05=>_0x550ccb[_0x90ebcc(0x181)](Number(_0x2d0b05[_0x90ebcc(0x156)])));}const _0x16d720={'id':_0x55f9bc['id'],'cover':_0x55f9bc[_0x90ebcc(0x218)],'name':_0x55f9bc[_0x90ebcc(0x202)],'workflowId':_0x55f9bc[_0x90ebcc(0x178)],'versionId':Number(_0x55f9bc[_0x90ebcc(0x2ce)]),'deduct':_0x55f9bc[_0x90ebcc(0x282)],'vipFreeNum':_0x55f9bc[_0x90ebcc(0x27a)],'displaySort':_0x55f9bc[_0x90ebcc(0x168)],'description':_0x55f9bc[_0x90ebcc(0x1d2)],'status':_0x55f9bc['status'],'createdAt':_0x55f9bc[_0x90ebcc(0x14a)],'updatedAt':_0x55f9bc[_0x90ebcc(0x23a)],'useCount':_0x55f9bc[_0x90ebcc(0x2bb)],'tutorial':_0x55f9bc[_0x90ebcc(0x21b)],'freeUsed':Number(_0x2d7006),'favorite':_0x550ccb[_0x90ebcc(0x2d3)](_0x55f9bc['id'])};return _0x16d720;}catch(_0x577b6f){throw new common_1[(_0x90ebcc(0x28b))](_0x577b6f[_0x90ebcc(0x2b7)],common_1[_0x90ebcc(0x2d4)]['BAD_REQUEST']);}}async[_0x471d3e(0x263)](_0x1c2c32){const _0x36bdf9=_0x471d3e;try{const _0xecf6fe={'id':_0x1c2c32['id'],'keyType':0x5,'modelType':model_constant_1[_0x36bdf9(0x217)][_0x36bdf9(0x173)],'cover':_0x1c2c32[_0x36bdf9(0x218)],'modelName':_0x1c2c32[_0x36bdf9(0x30f)],'model':_0x1c2c32['workflowId'],'key':'','deduct':_0x1c2c32['deduct'],'vipFreeNum':_0x1c2c32[_0x36bdf9(0x27a)],'displaySort':_0x1c2c32[_0x36bdf9(0x168)],'description':_0x1c2c32[_0x36bdf9(0x1d2)],'status':_0x1c2c32[_0x36bdf9(0x2da)],'remark':_0x1c2c32[_0x36bdf9(0x165)]};return _0x1c2c32[_0x36bdf9(0x1d4)]&&(_0xecf6fe[_0x36bdf9(0x2ce)]=String(_0x1c2c32[_0x36bdf9(0x1d4)])),await this[_0x36bdf9(0x138)][_0x36bdf9(0x1b3)](_0xecf6fe),!![];}catch(_0x10391b){throw new common_1['HttpException'](_0x10391b['message'],common_1[_0x36bdf9(0x2d4)]['BAD_REQUEST']);}}async[_0x471d3e(0x285)](_0x5318a8){const _0x3ad71e=_0x471d3e;return this[_0x3ad71e(0x138)]['modelDel'](_0x5318a8[_0x3ad71e(0x1af)]);}async[_0x471d3e(0x208)](){const _0x27b94e=_0x471d3e,_0x3eddc9=await this[_0x27b94e(0x186)][_0x27b94e(0x19b)]('style'),_0x2f9c68=await this[_0x27b94e(0x186)][_0x27b94e(0x19b)]('effect_category'),_0x3cd866=await this[_0x27b94e(0x186)][_0x27b94e(0x19b)](_0x27b94e(0x1df)),_0x2e3bb0=await this[_0x27b94e(0x186)][_0x27b94e(0x19b)](_0x27b94e(0x1b6));return{'style':_0x3eddc9,'effect_category':_0x2f9c68,'effect_main_body':_0x3cd866,'application_fields':_0x2e3bb0};}async[_0x471d3e(0x322)](_0x196603){const _0x58669a=_0x471d3e;try{const {page:page=0x1,size:size=0x14,keyword:_0x4c65ad,type:_0x5238e9,version:_0x43382f,style:_0x298163,effectCategory:_0x413233,effectMainBody:_0x22ed99,applicationFields:_0xf641d6,disabled:_0x402f00}=_0x196603,_0x5fa68d={};_0x4c65ad&&(_0x5fa68d[_0x58669a(0x30f)]=(0x0,typeorm_2[_0x58669a(0x2c3)])('%'+_0x4c65ad+'%'));_0x5238e9&&(_0x5fa68d['type']=_0x5238e9);_0x43382f&&(_0x5fa68d[_0x58669a(0x1d8)]=_0x43382f);_0x298163&&(_0x5fa68d[_0x58669a(0x298)]=_0x298163);_0x413233&&(_0x5fa68d[_0x58669a(0x1c5)]=_0x413233);_0x22ed99&&(_0x5fa68d[_0x58669a(0x254)]=_0x22ed99);_0xf641d6&&(_0x5fa68d['applicationFields']=_0xf641d6);(0x0,utils_1['isManage'])(this[_0x58669a(0x300)])?(0x0,utils_1[_0x58669a(0x24e)])(_0x402f00)&&(_0x5fa68d['disabled']=_0x402f00):_0x5fa68d[_0x58669a(0x146)]=0x0;const [_0x124d77,_0x52f9e7]=await this[_0x58669a(0x1bc)][_0x58669a(0x1ae)]({'where':_0x5fa68d,'take':size,'skip':(page-0x1)*size,'order':{'id':_0x58669a(0x283)}});return{'rows':_0x124d77,'count':_0x52f9e7};}catch(_0x2addbd){throw new common_1[(_0x58669a(0x28b))](_0x2addbd[_0x58669a(0x2b7)],common_1['HttpStatus']['BAD_REQUEST']);}}async['workflowModelUpdate'](_0x47114f){const _0x207b63=_0x471d3e;try{const {id:_0x526ccb,name:_0x3cba51,cover:_0x246d75,description:_0x87790f,disabled:_0x435a8d}=_0x47114f,_0x28aab9={};return _0x3cba51&&(_0x28aab9[_0x207b63(0x30f)]=_0x3cba51),_0x246d75&&(_0x28aab9[_0x207b63(0x218)]=_0x246d75),_0x87790f&&(_0x28aab9[_0x207b63(0x1d2)]=_0x87790f),_0x435a8d&&(_0x28aab9['disabled']=_0x435a8d),await this['mjModelEntity']['update']({'id':_0x526ccb},_0x28aab9),!![];}catch(_0x584be6){throw new common_1['HttpException'](_0x584be6['message'],common_1[_0x207b63(0x2d4)][_0x207b63(0x297)]);}}async[_0x471d3e(0x2a5)](_0x55e1c9){const _0x233362=_0x471d3e,_0x2e2aa7=_0x55e1c9['split'](',');if(!_0x55e1c9['length'])throw new common_1[(_0x233362(0x28b))](_0x233362(0x1cb),common_1[_0x233362(0x2d4)][_0x233362(0x297)]);return this['mjModelEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x2e2aa7),'disabled':0x0}});}async[_0x471d3e(0x2d9)](_0xe34162,_0x440581){const _0x453635=_0x471d3e;try{const _0x4f4e30=await this[_0x453635(0x138)]['getModelById'](_0x440581['workflowId']);if(!_0x4f4e30[_0x453635(0x2da)])throw new Error(_0x453635(0x2ff));let _0x939729;const _0x290765=(0x0,utils_1[_0x453635(0x306)])(this[_0x453635(0x300)]);return await this[_0x453635(0x157)][_0x453635(0x27c)](async()=>{const _0x3a4439=_0x453635;_0x939729=await this[_0x3a4439(0x321)]({'originPrompt':'','saasId':_0x290765,'userId':_0xe34162[_0x3a4439(0x23d)]['id'],'mode':midjourney_constant_1[_0x3a4439(0x31f)][_0x3a4439(0x28c)],'botType':DrawTaskPage_dto_1[_0x3a4439(0x166)][_0x3a4439(0x173)],'workflowId':_0x440581[_0x3a4439(0x1a8)],'fullPrompt':JSON['stringify'](_0x440581['inputs'])}),await this['userService'][_0x3a4439(0x1e2)](_0xe34162[_0x3a4439(0x23d)]['id'],_0x4f4e30,_0x939729['id']);const _0x5b68a7=await this[_0x3a4439(0x2ca)][_0x3a4439(0x20a)]({'data':{'workflowId':Number(_0x4f4e30['model']),'versionId':Number(_0x4f4e30['key']),'inputs':_0x440581[_0x3a4439(0x238)]}});_0x939729['mjpTaskId']=_0x5b68a7[_0x3a4439(0x1de)],await this['midjourneyEntity'][_0x3a4439(0x1ef)]({'id':_0x939729['id']},{'mjpTaskId':_0x5b68a7[_0x3a4439(0x1de)]});}),_0x939729;}catch(_0x3eb014){throw new common_1[(_0x453635(0x28b))](_0x3eb014[_0x453635(0x2b7)],common_1[_0x453635(0x2d4)][_0x453635(0x297)]);}}async[_0x471d3e(0x219)](_0x3f7f55,_0x3bd0a4){const _0x5539a5=_0x471d3e,{page:page=0x1,size:size=0x14}=_0x3bd0a4,[_0x31c70b]=await this[_0x5539a5(0x157)][_0x5539a5(0x286)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20'+_0x3f7f55[_0x5539a5(0x23d)]['id']+'\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x1a4928=await this[_0x5539a5(0x157)][_0x5539a5(0x286)](_0x5539a5(0x31b)+_0x3f7f55[_0x5539a5(0x23d)]['id']+'\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.createdAt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+size+_0x5539a5(0x302)+(page-0x1)*size+_0x5539a5(0x31c));return{'rows':_0x1a4928,'count':Number(_0x31c70b?.['count']||0x0)};}async['workflowFavorite'](_0x5a7d1d,_0x3a8298){const _0x2d9493=_0x471d3e,_0x1db379=_0x5a7d1d[_0x2d9493(0x23d)]['id'],{page:page=0x1,size:size=0x14}=_0x3a8298,[_0xbf3c9]=await this['connection'][_0x2d9493(0x286)](_0x2d9493(0x275)+_0x5a7d1d[_0x2d9493(0x23d)]['id']+_0x2d9493(0x24d)+user_constant_1[_0x2d9493(0x14e)][_0x2d9493(0x173)]+_0x2d9493(0x320)),_0x50b736=await this[_0x2d9493(0x157)][_0x2d9493(0x286)](_0x2d9493(0x299)+_0x5a7d1d[_0x2d9493(0x23d)]['id']+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27'+user_constant_1['EFavorite'][_0x2d9493(0x173)]+_0x2d9493(0x13c)+size+_0x2d9493(0x302)+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20');if(_0x5a7d1d[_0x2d9493(0x23d)]['id']){const _0xad5f8d=await this['userService']['getUserById'](_0x1db379);if(_0xad5f8d[_0x2d9493(0x1bf)]||_0xad5f8d[_0x2d9493(0x1b1)])for(let _0x303bea=0x0;_0x303bea<_0x50b736[_0x2d9493(0x301)];_0x303bea++){const _0x45545a=_0x50b736[_0x303bea],_0x475f04=redisKey_constant_1[_0x2d9493(0x2c0)]+'-'+_0x1db379+'-'+_0x45545a['id'],_0x1ce4f0=await await this[_0x2d9493(0x284)]['get']({'key':_0x475f04});_0x45545a[_0x2d9493(0x147)]=Number(_0x1ce4f0||0x0);}}return{'rows':_0x50b736,'count':_0xbf3c9?.['count']||0x0};}async['sdTaskSubmit'](_0x15325d,_0x100760){const _0xe9a4a6=_0x471d3e;try{let _0x5e0f9f;const _0x3fc20a=(0x0,utils_1['getReqSaasId'])(this['clsService']);return await this['connection']['transaction'](async()=>{const _0x355ca9=_0x31f2;_0x5e0f9f=await this[_0x355ca9(0x321)]({'saasId':_0x3fc20a,'userId':_0x15325d[_0x355ca9(0x23d)]['id'],'mode':midjourney_constant_1['DrawSpeed'][_0x355ca9(0x28c)],'botType':DrawTaskPage_dto_1['EBotType']['SD'],'originPrompt':_0x100760[_0x355ca9(0x32b)],'fullPrompt':JSON[_0x355ca9(0x25b)](_0x100760)}),await this[_0x355ca9(0x18c)][_0x355ca9(0x294)](_0x15325d[_0x355ca9(0x23d)]['id'],_0x5e0f9f['id']);const _0x35e7d8=await this[_0x355ca9(0x2ca)][_0x355ca9(0x1e9)]({'data':_0x100760});_0x5e0f9f['mjpTaskId']=_0x35e7d8[_0x355ca9(0x1fc)],await this[_0x355ca9(0x26e)][_0x355ca9(0x1ef)]({'id':_0x5e0f9f['id']},{'mjpTaskId':_0x35e7d8[_0x355ca9(0x1fc)]});}),_0x5e0f9f;}catch(_0x3ee993){throw new common_1[(_0xe9a4a6(0x28b))](_0x3ee993[_0xe9a4a6(0x2b7)],common_1[_0xe9a4a6(0x2d4)]['BAD_REQUEST']);}}async[_0x471d3e(0x1fb)](_0x5af9fb,_0x2db315){const _0x176ebb=_0x471d3e;try{const _0x2e6b90=await this['midjourneyEntity']['findOne']({'where':{'id':Number(_0x2db315[_0x176ebb(0x1de)])}});if(!_0x2e6b90)throw new Error(_0x176ebb(0x313));let _0x1bb18a;const _0x2efe3d=(0x0,utils_1[_0x176ebb(0x306)])(this[_0x176ebb(0x300)]);return await this['connection'][_0x176ebb(0x27c)](async()=>{const _0x53c800=_0x176ebb;_0x1bb18a=await this[_0x53c800(0x321)]({'saasId':_0x2efe3d,'userId':_0x5af9fb[_0x53c800(0x23d)]['id'],'mode':midjourney_constant_1[_0x53c800(0x31f)]['fast'],'botType':DrawTaskPage_dto_1[_0x53c800(0x166)]['SD'],'originPrompt':_0x2db315[_0x53c800(0x32b)],'originTaskId':_0x2db315[_0x53c800(0x1de)],'fullPrompt':JSON[_0x53c800(0x25b)](_0x2db315)}),await this[_0x53c800(0x18c)][_0x53c800(0x294)](_0x5af9fb[_0x53c800(0x23d)]['id'],_0x1bb18a['id']);const _0x2f744c=await this[_0x53c800(0x2ca)][_0x53c800(0x2be)]({'data':{'mask':_0x2db315[_0x53c800(0x2fe)],'prompt':_0x2db315[_0x53c800(0x32b)],'taskId':_0x2e6b90['mjpTaskId'],'denoisingStrength':_0x2db315[_0x53c800(0x267)]}});_0x1bb18a[_0x53c800(0x2d1)]=_0x2f744c[_0x53c800(0x1fc)],await this[_0x53c800(0x26e)][_0x53c800(0x1ef)]({'id':_0x1bb18a['id']},{'mjpTaskId':_0x2f744c[_0x53c800(0x1fc)]});}),_0x1bb18a;}catch(_0x4d4654){throw new common_1[(_0x176ebb(0x28b))](_0x4d4654[_0x176ebb(0x2b7)],common_1[_0x176ebb(0x2d4)][_0x176ebb(0x297)]);}}async[_0x471d3e(0x201)](_0x41dee7){const _0x57b860=_0x471d3e,{id:_0x4f89ea,favorite:_0x489a78}=_0x41dee7,_0x17c81c=await this[_0x57b860(0x26e)]['findOne']({'where':{'id':_0x4f89ea}})['catch'](_0x4edc53=>{const _0x5537d8=_0x57b860;common_1[_0x5537d8(0x16e)][_0x5537d8(0x142)](_0x4edc53);});if(!_0x17c81c)throw new common_1[(_0x57b860(0x28b))](_0x57b860(0x25f),common_1[_0x57b860(0x2d4)]['BAD_REQUEST']);const _0x5e4ba2=await this[_0x57b860(0x26e)][_0x57b860(0x1ef)]({'id':_0x4f89ea},{'favorite':_0x489a78});if(_0x5e4ba2[_0x57b860(0x1db)]<=0x0)throw new common_1[(_0x57b860(0x28b))](_0x57b860(0x245),common_1[_0x57b860(0x2d4)][_0x57b860(0x297)]);return!![];}async[_0x471d3e(0x2a7)](_0x305990,_0x26bd70){const _0x426747=_0x471d3e;try{const _0x471120=await this['midjourneyEntity'][_0x426747(0x182)]({'where':{'id':_0x305990,'userId':_0x26bd70[_0x426747(0x23d)]['id']}});if(!_0x471120)throw new Error(_0x426747(0x246));if(_0x471120[_0x426747(0x2da)]===midjourney_constant_1[_0x426747(0x2cc)]['DRAWING'])throw new Error(_0x426747(0x159));await this[_0x426747(0x32e)][_0x426747(0x315)](null,_0x471120[_0x426747(0x2d1)]);const _0x4709f6=await this[_0x426747(0x26e)]['delete']({'id':_0x305990});if(_0x4709f6[_0x426747(0x1db)]>0x0)return _0x426747(0x279);else throw new Error(_0x426747(0x190));}catch(_0x29e337){throw new common_1[(_0x426747(0x28b))](_0x29e337[_0x426747(0x2b7)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x471d3e(0x25e)](_0x1b0e1e,_0x4e1410){const _0x177189=_0x471d3e,{id:_0xbf770c}=_0x4e1410;if(!_0xbf770c)throw new common_1[(_0x177189(0x28b))](_0x177189(0x2d6),common_1[_0x177189(0x2d4)][_0x177189(0x297)]);const _0x2ff8fb=await this['midjourneyEntity'][_0x177189(0x2dc)]({'id':_0xbf770c});if(_0x2ff8fb[_0x177189(0x1db)]<=0x0)throw new common_1['HttpException'](_0x177189(0x14d),common_1[_0x177189(0x2d4)]['BAD_REQUEST']);return!![];}async['setPrompt'](_0x1e442b,_0x562a98){const _0x15a131=_0x471d3e;try{const {prompt:_0x1ec749,status:_0x14b075,isCarryParams:_0x53187c,imageUrl:_0x57595d,title:_0x4ef883,order:_0x1fba85,id:_0x233ee6,aspect:_0x289857}=_0x562a98;if(_0x233ee6)return await this[_0x15a131(0x1ce)]['update']({'id':_0x233ee6},{'title':_0x4ef883,'prompt':_0x1ec749,'imageUrl':_0x57595d,'status':_0x14b075,'isCarryParams':_0x53187c,'order':_0x1fba85,'aspect':_0x289857})[_0x15a131(0x234)](_0x2b41ed=>!!_0x2b41ed);else{const _0x18e064=(0x0,utils_1['getReqSaasId'])(this[_0x15a131(0x300)]);return await this[_0x15a131(0x1ce)][_0x15a131(0x2b8)]({'prompt':_0x1ec749,'status':_0x14b075,'imageUrl':_0x57595d,'isCarryParams':_0x53187c,'title':_0x4ef883,'order':_0x1fba85,'aspect':_0x289857,'saasId':_0x18e064})['then'](_0x47914d=>!!_0x47914d);}}catch(_0x421001){console[_0x15a131(0x2ec)](_0x15a131(0x2c7),_0x421001);}}async[_0x471d3e(0x2d8)](_0x3b5475,_0x3ed394){const _0x5f10f0=_0x471d3e,{id:_0x358e98}=_0x3ed394;if(!_0x358e98)throw new common_1[(_0x5f10f0(0x28b))]('非法操作！',common_1[_0x5f10f0(0x2d4)][_0x5f10f0(0x297)]);return await this[_0x5f10f0(0x1ce)][_0x5f10f0(0x2dc)]({'id':_0x358e98});}async[_0x471d3e(0x2ae)](){const _0x2d9374=_0x471d3e,_0x34ef0b=(0x0,utils_1[_0x2d9374(0x306)])(this[_0x2d9374(0x300)]);return await this[_0x2d9374(0x1ce)][_0x2d9374(0x2e8)]({'where':{'saasId':_0x34ef0b},'order':{'order':_0x2d9374(0x2ea)}})[_0x2d9374(0x234)](_0xb3984d=>_0xb3984d||[])[_0x2d9374(0x2f4)](_0x40f498=>{const _0x2ed885=_0x2d9374;common_1[_0x2ed885(0x16e)]['error'](_0x40f498);});}async[_0x471d3e(0x212)](_0x10fab3){const _0x4e0bee=_0x471d3e;try{const {page:_0x46c2aa,size:_0x5d58f5,keyword:_0x2c5e4b,saasId:_0x37e4c2}=_0x10fab3,_0x89153a=(0x0,utils_1[_0x4e0bee(0x306)])(this['clsService']),_0x9c4871={'status':!![]};(0x0,utils_1[_0x4e0bee(0x1fe)])(this[_0x4e0bee(0x300)])?(0x0,utils_1['isDefined'])(_0x37e4c2)&&(_0x9c4871[_0x4e0bee(0x1eb)]=_0x37e4c2):_0x9c4871['saasId']=_0x89153a;const [_0x49a39c,_0x58f30c]=await this[_0x4e0bee(0x1ce)][_0x4e0bee(0x1ae)]({'where':[{..._0x9c4871,'title':(0x0,typeorm_2['Like'])('%'+_0x2c5e4b+'%')},{..._0x9c4871,'prompt':(0x0,typeorm_2[_0x4e0bee(0x2c3)])('%'+_0x2c5e4b+'%')}],'take':_0x5d58f5,'skip':(_0x46c2aa-0x1)*_0x5d58f5,'order':{'order':_0x4e0bee(0x2ea)}});return{'rows':_0x49a39c,'count':_0x58f30c};}catch(_0x2ae933){throw new common_1[(_0x4e0bee(0x28b))](_0x2ae933['message'],common_1[_0x4e0bee(0x2d4)]['BAD_REQUEST']);}}async[_0x471d3e(0x2af)](_0x1d8ee0){const _0x16ad83=_0x471d3e;try{const {name:_0x5d7bfa,value:_0x585885}=_0x1d8ee0,_0x45901c=(0x0,utils_1['getReqSaasId'])(this[_0x16ad83(0x300)]),_0x2f46e7=await this['mjInspireClassifyEntity'][_0x16ad83(0x240)]({'name':_0x5d7bfa,'saasId':_0x45901c});if(_0x2f46e7)throw new common_1['HttpException'](_0x16ad83(0x27f),common_1[_0x16ad83(0x2d4)]['BAD_REQUEST']);return await this[_0x16ad83(0x136)][_0x16ad83(0x2b8)]({'name':_0x5d7bfa,'value':_0x585885,'saasId':_0x45901c})['then'](_0x1755e1=>!!_0x1755e1)[_0x16ad83(0x2f4)](_0xc9a396=>{const _0x10f6b1=_0x16ad83;console['log'](_0xc9a396);throw new common_1[(_0x10f6b1(0x28b))](_0xc9a396,common_1[_0x10f6b1(0x2d4)][_0x10f6b1(0x297)]);});}catch(_0x6cf759){return![];}}async[_0x471d3e(0x22b)](_0x22ce67){const _0x50c181=_0x471d3e,{id:_0x58c3b8,name:_0x59b3c7,value:_0x194a7e}=_0x22ce67;return await this[_0x50c181(0x136)]['update'](_0x58c3b8,{'name':_0x59b3c7,'value':_0x194a7e})[_0x50c181(0x234)](_0x296908=>!!_0x296908);}async[_0x471d3e(0x1b4)](_0x5d37fd){const _0x55e267=_0x471d3e,{id:_0x16e398}=_0x5d37fd;return await this['mjInspireClassifyEntity']['delete']({'id':_0x16e398})[_0x55e267(0x2f4)](_0x4810f6=>{const _0x58996d=_0x55e267;throw new common_1[(_0x58996d(0x28b))](_0x4810f6,common_1['HttpStatus'][_0x58996d(0x297)]);});}async[_0x471d3e(0x2f5)](_0x59fd11){const _0x2ab7a8=_0x471d3e,{size:_0x1638a3,page:_0x22d1eb,saasId:_0x33571a}=_0x59fd11,_0x4440d2=(0x0,utils_1[_0x2ab7a8(0x306)])(this[_0x2ab7a8(0x300)]),_0x390028={};(0x0,utils_1[_0x2ab7a8(0x1fe)])(this[_0x2ab7a8(0x300)])?(0x0,utils_1[_0x2ab7a8(0x24e)])(_0x33571a)&&(_0x390028['saasId']=_0x33571a):_0x390028[_0x2ab7a8(0x1eb)]=_0x4440d2;const _0x66ef45=await this[_0x2ab7a8(0x136)]['findAndCount']({'where':_0x390028,'order':{'createdAt':'DESC'},'take':_0x1638a3,'skip':(_0x22d1eb-0x1)*_0x1638a3})['catch'](_0x3cf927=>{const _0x48ae1c=_0x2ab7a8;throw new common_1[(_0x48ae1c(0x28b))](_0x3cf927,common_1[_0x48ae1c(0x2d4)][_0x48ae1c(0x297)]);});if(!_0x66ef45)throw new common_1[(_0x2ab7a8(0x28b))](_0x2ab7a8(0x225),common_1[_0x2ab7a8(0x2d4)][_0x2ab7a8(0x297)]);const [_0x2127fa,_0x291c35]=_0x66ef45;return{'rows':_0x2127fa,'count':_0x291c35};}async['getMjInspireClassify'](_0x259f0c){const {id:_0x29dc13}=_0x259f0c;return await this['mjInspireClassifyEntity']['findOne']({'where':{'id':_0x29dc13}});}async[_0x471d3e(0x2a8)](_0x19958a){const _0x2996cb=_0x471d3e;try{const _0x5bb39e=(0x0,utils_1['getReqSaasId'])(this[_0x2996cb(0x300)]),{classifyName:_0x4287e7,level:_0x1139a5,type:_0x3a72a3,pid:pid=0x0}=_0x19958a;return await this[_0x2996cb(0x2c2)][_0x2996cb(0x2b8)]({'classifyName':_0x4287e7,'level':_0x1139a5,'type':_0x3a72a3,'pid':pid,'saasId':_0x5bb39e})[_0x2996cb(0x234)](_0x18f17f=>!!_0x18f17f)['catch'](_0x52c8ca=>{const _0xca9938=_0x2996cb;console[_0xca9938(0x2ec)](_0x52c8ca);throw new common_1[(_0xca9938(0x28b))](_0x52c8ca,common_1[_0xca9938(0x2d4)][_0xca9938(0x297)]);});}catch(_0x5361ab){return![];}}async[_0x471d3e(0x27d)](_0x69149f){const _0x305be2=_0x471d3e,{id:_0x390969,classifyName:_0x45ca31,level:_0x1cb7d5,type:_0x1ad7df,pid:_0x3fdecd}=_0x69149f;return this[_0x305be2(0x157)][_0x305be2(0x27c)](async()=>{const _0x454620=_0x305be2,_0x80cbe2=await this[_0x454620(0x2c2)][_0x454620(0x182)]({'where':{'id':_0x390969}});_0x80cbe2[_0x454620(0x18e)]!==_0x1ad7df&&await this['mjIncantationClassifyEntity'][_0x454620(0x1ef)]({'pid':_0x390969},{'type':_0x1ad7df}),await this[_0x454620(0x2c2)]['update'](_0x390969,{'classifyName':_0x45ca31,'level':_0x1cb7d5,'type':_0x1ad7df,'pid':_0x3fdecd});}),!![];}async[_0x471d3e(0x29b)](_0x37a69c){const _0x242755=_0x471d3e,{id:_0x522360}=_0x37a69c;return await this[_0x242755(0x2c2)]['delete']({'id':_0x522360})['then'](_0x5c0236=>_0x5c0236[_0x242755(0x1db)]>0x0);}async[_0x471d3e(0x21a)](_0x43d16a){const _0x5cb4b0=_0x471d3e,{id:_0x140cf6}=_0x43d16a;return await this['mjIncantationClassifyEntity'][_0x5cb4b0(0x182)]({'where':{'id':_0x140cf6}});}async[_0x471d3e(0x230)](){const _0x203e92=_0x471d3e,_0x49a6e1=(0x0,utils_1['getReqSaasId'])(this[_0x203e92(0x300)]);return this[_0x203e92(0x2c2)][_0x203e92(0x2e8)]({'where':{'level':0x1,'saasId':_0x49a6e1}});}async[_0x471d3e(0x149)](_0xb14321){const _0xc62fff=_0x471d3e,{size:_0x1b6e79,page:_0x5cfb04,type:_0x51c77f,keyword:_0x176086,level:_0x196785,saasId:_0x344728}=_0xb14321,_0xd1ae9b=(0x0,utils_1['getReqSaasId'])(this[_0xc62fff(0x300)]);let _0x3f916f={};_0x196785>0x0&&(_0x3f916f[_0xc62fff(0x231)]=_0x196785);_0x51c77f&&(_0x3f916f[_0xc62fff(0x18e)]=_0x51c77f);_0x176086&&(_0x3f916f[_0xc62fff(0x184)]=(0x0,typeorm_2[_0xc62fff(0x2c3)])('%'+_0x176086+'%'));(0x0,utils_1[_0xc62fff(0x1fe)])(this[_0xc62fff(0x300)])?(0x0,utils_1['isDefined'])(_0x344728)&&(_0x3f916f[_0xc62fff(0x1eb)]=_0x344728):_0x3f916f[_0xc62fff(0x1eb)]=_0xd1ae9b;const _0x1c6c03=await this[_0xc62fff(0x2c2)][_0xc62fff(0x1ae)]({'order':{'createdAt':_0xc62fff(0x2ea)},'where':_0x3f916f,'take':_0x1b6e79,'skip':(_0x5cfb04-0x1)*_0x1b6e79})[_0xc62fff(0x2f4)](_0x2da186=>{const _0x370114=_0xc62fff;console[_0x370114(0x2ec)](_0x2da186);});if(!_0x1c6c03)throw new common_1[(_0xc62fff(0x28b))]('查询咒语分类失败',common_1[_0xc62fff(0x2d4)]['BAD_REQUEST']);const [_0x448e5e,_0xe1c8e5]=_0x1c6c03;return{'rows':_0x448e5e,'count':_0xe1c8e5};}async[_0x471d3e(0x1e1)](_0x31242c){const _0x3c054e=_0x471d3e,{level:_0x509ba9,type:_0x27b1e9,saasId:_0x55a2f4}=_0x31242c,_0xbd723d=(0x0,utils_1[_0x3c054e(0x306)])(this[_0x3c054e(0x300)]),_0xb49cd1={};_0x509ba9===0x0?_0xb49cd1[_0x3c054e(0x231)]=(0x0,typeorm_2[_0x3c054e(0x193)])(_0x509ba9):_0xb49cd1[_0x3c054e(0x231)]=_0x509ba9;_0x27b1e9&&(_0xb49cd1[_0x3c054e(0x18e)]=_0x27b1e9);(0x0,utils_1[_0x3c054e(0x1fe)])(this['clsService'])?(0x0,utils_1[_0x3c054e(0x24e)])(_0x55a2f4)&&(_0xb49cd1[_0x3c054e(0x1eb)]=_0x55a2f4):_0xb49cd1[_0x3c054e(0x1eb)]=_0xbd723d;const _0x521860=await this[_0x3c054e(0x2c2)][_0x3c054e(0x2df)](_0xb49cd1)[_0x3c054e(0x2f4)](_0x41021e=>{const _0x44f6d5=_0x3c054e;console[_0x44f6d5(0x2ec)](_0x41021e);});if(!_0x521860)throw new common_1[(_0x3c054e(0x28b))](_0x3c054e(0x316),common_1['HttpStatus'][_0x3c054e(0x297)]);if(_0x509ba9===0x0)return{'level1':_0x521860[_0x3c054e(0x232)](_0x14feeb=>_0x14feeb[_0x3c054e(0x231)]===0x1),'level2':_0x521860[_0x3c054e(0x232)](_0x4017de=>_0x4017de[_0x3c054e(0x231)]===0x2)};return _0x521860;}async[_0x471d3e(0x2aa)](_0x288767){const _0x418494=_0x471d3e;try{const _0x54171e=(0x0,utils_1['getReqSaasId'])(this['clsService']),{incantationEn:_0xe173da,incantationCn:_0xd5bfb0,img:_0x4d7e47,pid:_0x34d07d}=_0x288767;return await this[_0x418494(0x228)][_0x418494(0x2b8)]({'incantationEn':_0xe173da,'incantationCn':_0xd5bfb0,'img':_0x4d7e47,'pid':_0x34d07d,'saasId':_0x54171e})['then'](_0x6af8fd=>!!_0x6af8fd)[_0x418494(0x2f4)](_0xc9f40=>{throw _0xc9f40;});}catch(_0x47a8a1){return console[_0x418494(0x2ec)](_0x47a8a1),![];}}async[_0x471d3e(0x2c9)](_0x288eda){const _0x42a018=_0x471d3e,{id:_0x2c6df7,incantationEn:_0x5ae13d,incantationCn:_0x5d9246,img:_0xf7a6a4,pid:_0x101d8d}=_0x288eda;return await this[_0x42a018(0x228)][_0x42a018(0x1ef)](_0x2c6df7,{'incantationCn':_0x5d9246,'incantationEn':_0x5ae13d,'img':_0xf7a6a4,'pid':_0x101d8d});}async[_0x471d3e(0x2dd)](_0x2cf43e){const _0x17b13a=_0x471d3e,{id:_0x5df0fb}=_0x2cf43e;return await this['mjIncantationEntity']['delete']({'id':_0x5df0fb})[_0x17b13a(0x234)](_0x282b65=>_0x282b65[_0x17b13a(0x1db)]>0x0);}async[_0x471d3e(0x15a)](_0x432fde){const _0x11ebb0=_0x471d3e,{id:_0x18f512}=_0x432fde;return await this[_0x11ebb0(0x228)]['findOne']({'where':{'id':_0x18f512}});}async['queryMjIncantation'](_0x5109bb){const _0x406d8a=_0x471d3e,_0x2fe2a5=(0x0,utils_1[_0x406d8a(0x306)])(this[_0x406d8a(0x300)]),{size:_0x540abd,page:_0xf1dd22,keyword:_0x3c8235,pid:_0x13686c,saasId:_0x555338}=_0x5109bb;let _0xa019d5={};_0x13686c>0x0&&(_0xa019d5['pid']=_0x13686c);_0x3c8235&&(_0xa019d5[_0x406d8a(0x32a)]=(0x0,typeorm_2[_0x406d8a(0x2c3)])('%'+_0x3c8235+'%'));(0x0,utils_1[_0x406d8a(0x1fe)])(this[_0x406d8a(0x300)])?(0x0,utils_1['isDefined'])(_0x555338)&&(_0xa019d5['saasId']=_0x555338):_0xa019d5[_0x406d8a(0x1eb)]=_0x2fe2a5;const _0x414cb1=await this[_0x406d8a(0x228)][_0x406d8a(0x1ae)]({'order':{'createdAt':_0x406d8a(0x2ea)},'where':_0xa019d5,'take':_0x540abd,'skip':(_0xf1dd22-0x1)*_0x540abd})['catch'](_0x118de5=>{const _0x2e2c40=_0x406d8a;console[_0x2e2c40(0x2ec)](_0x118de5);});if(!_0x414cb1)throw new common_1[(_0x406d8a(0x28b))]('查询咒语失败',common_1[_0x406d8a(0x2d4)][_0x406d8a(0x297)]);const [_0x4c08fd,_0xfbf9f5]=_0x414cb1;return{'rows':_0x4c08fd,'count':_0xfbf9f5};}async[_0x471d3e(0x1f5)](_0x2441cd){const _0x5cd716=_0x471d3e,{id:_0x5c658f}=_0x2441cd,_0x57befb=await this[_0x5cd716(0x2c2)]['findOne']({'where':{'level':0x1,'id':_0x5c658f}})[_0x5cd716(0x2f4)](_0x1babd2=>{const _0x2cf994=_0x5cd716;common_1['Logger'][_0x2cf994(0x142)](_0x1babd2);});if(!_0x57befb)throw new common_1['HttpException'](_0x5cd716(0x215),common_1[_0x5cd716(0x2d4)][_0x5cd716(0x297)]);const _0x415aae=await this['mjIncantationClassifyEntity']['find']({'where':{'level':0x2,'pid':_0x57befb['id']}})[_0x5cd716(0x2f4)](_0x4342f2=>{const _0x5db5e6=_0x5cd716;common_1[_0x5db5e6(0x16e)]['error'](_0x4342f2);});if(!_0x415aae||_0x415aae[_0x5cd716(0x301)]===0x0)return{'rows':[]};const _0x509268=_0x415aae['map'](_0x223ed8=>_0x223ed8['id']),_0x45641f=await this[_0x5cd716(0x228)][_0x5cd716(0x2e8)]({'where':{'pid':(0x0,typeorm_2['In'])(_0x509268)}})[_0x5cd716(0x2f4)](_0x2327c5=>{const _0x478203=_0x5cd716;common_1[_0x478203(0x16e)][_0x478203(0x142)](_0x2327c5);});if(!_0x45641f)throw new common_1[(_0x5cd716(0x28b))](_0x5cd716(0x171),common_1[_0x5cd716(0x2d4)]['BAD_REQUEST']);const _0x40acc6=_0x415aae[_0x5cd716(0x309)](_0x31630a=>{const _0x5019ee=_0x5cd716;return{'children':_0x45641f['filter'](_0x1139b9=>_0x1139b9[_0x5019ee(0x1fa)]===_0x31630a['id'])||[],..._0x31630a};});return{'rows':_0x40acc6};}async[_0x471d3e(0x200)](){const _0x739371=_0x471d3e,_0x1f6dc0=(0x0,utils_1[_0x739371(0x306)])(this['clsService']),_0x3ec027=await this['mjIncantationEntity'][_0x739371(0x2e8)]({'where':{'saasId':_0x1f6dc0},'order':{'createdAt':_0x739371(0x2ea)}})[_0x739371(0x2f4)](_0x62eb48=>{const _0x252b96=_0x739371;console[_0x252b96(0x2ec)](_0x62eb48);});if(!_0x3ec027)throw new common_1['HttpException'](_0x739371(0x171),common_1[_0x739371(0x2d4)][_0x739371(0x297)]);return _0x3ec027;}async[_0x471d3e(0x252)](_0x10956d){const _0x3634e6=_0x471d3e,_0x4fec53=(0x0,utils_1[_0x3634e6(0x306)])(this[_0x3634e6(0x300)]),{id:_0x8b23d,suggestCn:_0x5d57cd,suggestEn:_0xb68ada,order:_0x47aa81,image:_0x4a5fee}=_0x10956d,_0x1b8069=await this[_0x3634e6(0x2e0)][_0x3634e6(0x182)]({'where':{'suggestCn':_0x5d57cd,'saasId':_0x4fec53}});if(_0x8b23d){if(_0x1b8069&&_0x1b8069['id']!==_0x8b23d)throw new common_1['HttpException'](_0x3634e6(0x137),common_1['HttpStatus']['BAD_REQUEST']);}else{if(_0x1b8069)throw new common_1[(_0x3634e6(0x28b))](_0x3634e6(0x137),common_1['HttpStatus'][_0x3634e6(0x297)]);}const _0x5a1145=await this[_0x3634e6(0x2e0)][_0x3634e6(0x2b8)]({'id':_0x8b23d,'suggestCn':_0x5d57cd,'suggestEn':_0xb68ada,'order':_0x47aa81||0x64,'image':_0x4a5fee||'','saasId':_0x4fec53})[_0x3634e6(0x234)](_0x5dd09e=>!!_0x5dd09e['id'])[_0x3634e6(0x2f4)](_0x3aaa68=>{console['log'](_0x3aaa68);});if(!_0x5a1145)throw new common_1[(_0x3634e6(0x28b))](_0x3634e6(0x194),common_1[_0x3634e6(0x2d4)][_0x3634e6(0x297)]);return _0x5a1145;}async[_0x471d3e(0x162)](_0x2c4356){const _0x3ab772=_0x471d3e,{id:_0x462a97}=_0x2c4356,_0x24f390=await this['mjSuggestWordEntity'][_0x3ab772(0x2c1)]({'where':{'id':_0x462a97}});if(!_0x24f390)throw new common_1[(_0x3ab772(0x28b))](_0x3ab772(0x326),common_1[_0x3ab772(0x2d4)][_0x3ab772(0x297)]);const _0x1d55f4=await this['mjSuggestWordEntity'][_0x3ab772(0x2dc)](_0x462a97)[_0x3ab772(0x234)](_0x1fbb40=>_0x1fbb40[_0x3ab772(0x1db)]>0x0)[_0x3ab772(0x2f4)](_0x554353=>{const _0xced151=_0x3ab772;console[_0xced151(0x2ec)](_0x554353);});if(!_0x1d55f4)throw new common_1[(_0x3ab772(0x28b))](_0x3ab772(0x1f9),common_1['HttpStatus']['BAD_REQUEST']);return _0x1d55f4;}async[_0x471d3e(0x154)](_0x533b7f){const _0x599488=_0x471d3e;let _0x13c6e0={};const {page:_0x54bc07,size:_0x524659,saasId:_0x45097c}=_0x533b7f,_0x46b782=(0x0,utils_1[_0x599488(0x306)])(this['clsService']);(0x0,utils_1[_0x599488(0x1fe)])(this[_0x599488(0x300)])?(0x0,utils_1[_0x599488(0x24e)])(_0x45097c)&&(_0x13c6e0['saasId']=_0x45097c):_0x13c6e0[_0x599488(0x1eb)]=_0x46b782;const _0x4dade7=await this[_0x599488(0x2e0)][_0x599488(0x1ae)]({'where':_0x13c6e0,'take':_0x524659,'skip':(_0x54bc07-0x1)*_0x524659,'order':{'order':'DESC'}})[_0x599488(0x234)](([_0x1842e9,_0x2154ec])=>({'rows':_0x1842e9,'count':_0x2154ec}))['catch'](_0x4174bb=>{const _0x364b84=_0x599488;console[_0x364b84(0x2ec)](_0x4174bb);});if(!_0x4dade7)throw new common_1['HttpException'](_0x599488(0x148),common_1[_0x599488(0x2d4)][_0x599488(0x297)]);return _0x4dade7;}async[_0x471d3e(0x192)](_0xf614b1){const _0x16d348=_0x471d3e,_0x969b79=await this[_0x16d348(0x2ab)]({'rec':_0xf614b1[_0x16d348(0x1c3)],'page':_0xf614b1[_0x16d348(0x1c7)],'size':_0xf614b1[_0x16d348(0x2f3)],'status':_0xf614b1[_0x16d348(0x2da)],'keyword':_0xf614b1[_0x16d348(0x2ad)],'squareType':_0xf614b1[_0x16d348(0x269)]});return _0x969b79['rows'][_0x16d348(0x1aa)](_0x224b2a=>{const _0x37ebd0=_0x16d348;_0x224b2a[_0x37ebd0(0x2de)]=_0x224b2a['fileInfo']?JSON['parse'](_0x224b2a['fileInfo']):{};}),_0x969b79;}[_0x471d3e(0x25a)](_0x2aff98){const _0x49ed6f=_0x471d3e;if(!_0x2aff98)return'fast';if(_0x2aff98===midjourney_constant_1[_0x49ed6f(0x31f)][_0x49ed6f(0x28c)])return'fast';if(_0x2aff98===midjourney_constant_1[_0x49ed6f(0x31f)]['relax'])return _0x49ed6f(0x295);if(_0x2aff98===midjourney_constant_1[_0x49ed6f(0x31f)][_0x49ed6f(0x1fd)])return _0x49ed6f(0x1fd);return _0x49ed6f(0x28c);}async['syncWorkFlowDict'](){const _0x545e42=_0x471d3e;if(process[_0x545e42(0x29a)]['ENV']===_0x545e42(0x144))return;try{const _0xe83052=await this[_0x545e42(0x2ca)][_0x545e42(0x208)]({});for(let _0x165d45 in _0xe83052){let _0x139839=_0x165d45;for(let _0x5a6a75=0x0;_0x5a6a75<_0xe83052[_0x165d45]['length'];_0x5a6a75++){const _0x14fded=_0xe83052[_0x165d45][_0x5a6a75];let _0x4fde49=await this[_0x545e42(0x186)][_0x545e42(0x1c2)](_0x139839,String(_0x14fded['id']));_0x4fde49?(_0x4fde49[_0x545e42(0x327)]=_0x139839,_0x4fde49[_0x545e42(0x18f)]=_0x14fded['name'],_0x4fde49[_0x545e42(0x14c)]=String(_0x14fded['id'])):_0x4fde49={'dictType':_0x139839,'dictName':_0x14fded[_0x545e42(0x30f)],'dictValue':String(_0x14fded['id'])},await this[_0x545e42(0x186)][_0x545e42(0x2ba)](_0x4fde49);}}common_1['Logger'][_0x545e42(0x2ec)](_0x545e42(0x206));}catch(_0x227014){common_1[_0x545e42(0x16e)]['error'](_0x227014,_0x545e42(0x1b7));}}async[_0x471d3e(0x1e0)](_0x322306){const _0x54fa91=_0x471d3e;let _0x116956=[];try{const _0x58653e=await this[_0x54fa91(0x2ca)]['modelPage']({'data':{'size':0x32,'index':0x1,'tagIds':[_0x322306]}});_0x116956=_0x116956[_0x54fa91(0x2fc)](_0x58653e['datas']);for(let _0x52b941=0x2;_0x52b941<=_0x58653e[_0x54fa91(0x197)];_0x52b941++){const _0x4b27e3=await this['czTaskService'][_0x54fa91(0x150)]({'data':{'index':_0x52b941,'size':0x32,'tagIds':[_0x322306]}});_0x116956=_0x116956['concat'](_0x4b27e3[_0x54fa91(0x18a)]);}return _0x116956;}catch(_0x57af34){return common_1[_0x54fa91(0x16e)]['error'](_0x57af34,_0x54fa91(0x1b8)),[];}}async[_0x471d3e(0x221)](){const _0x392731=_0x471d3e;if(process[_0x392731(0x29a)][_0x392731(0x255)]===_0x392731(0x144))return;try{const _0x15fa44=await this[_0x392731(0x186)][_0x392731(0x20b)](['style',_0x392731(0x158),_0x392731(0x1df),_0x392731(0x1b6)]),_0x5dc73b=new Map(),_0x4643b4=await this['mjModelEntity'][_0x392731(0x2e8)]();_0x4643b4[_0x392731(0x1aa)](_0x1baf55=>_0x5dc73b[_0x392731(0x2bf)](_0x1baf55['id'],_0x1baf55));for(let _0x4e9549=0x0;_0x4e9549<_0x15fa44[_0x392731(0x301)];_0x4e9549++){const _0x1aebe7=_0x15fa44[_0x4e9549][_0x392731(0x18f)],_0x1ef8fb=Number(_0x15fa44[_0x4e9549]['dictValue']),_0x4e8e1f=await this[_0x392731(0x1e0)](_0x1ef8fb);_0x4e8e1f['forEach'](_0x379aff=>{const _0x417c34=_0x392731,_0x5a3699=String(_0x379aff['id']);!_0x5dc73b[_0x417c34(0x2d3)](_0x5a3699)&&_0x5dc73b[_0x417c34(0x2bf)](_0x5a3699,{'id':_0x5a3699,'type':_0x379aff['modelType'],'name':_0x379aff[_0x417c34(0x30f)],'cover':'https://img2.huashi6.com/'+_0x379aff[_0x417c34(0x15b)],'version':_0x379aff[_0x417c34(0x20f)],'description':'','triggerWords':_0x379aff[_0x417c34(0x32c)]});const _0x1ecef8=_0x5dc73b[_0x417c34(0x256)](_0x5a3699);_0x15fa44[_0x4e9549][_0x417c34(0x327)]===_0x417c34(0x298)&&(_0x1ecef8[_0x417c34(0x298)]=_0x1ef8fb,_0x1ecef8[_0x417c34(0x2ed)]=_0x1aebe7),_0x15fa44[_0x4e9549][_0x417c34(0x327)]===_0x417c34(0x158)&&(_0x1ecef8['effectCategory']=_0x1ef8fb,_0x1ecef8[_0x417c34(0x17d)]=_0x1aebe7),_0x15fa44[_0x4e9549][_0x417c34(0x327)]===_0x417c34(0x1df)&&(_0x1ecef8['effectMainBody']=_0x1ef8fb,_0x1ecef8['effectMainBodyName']=_0x1aebe7),_0x15fa44[_0x4e9549]['dictType']===_0x417c34(0x1b6)&&(_0x1ecef8[_0x417c34(0x2a0)]=_0x1ef8fb,_0x1ecef8[_0x417c34(0x13a)]=_0x1aebe7);});}await this[_0x392731(0x1bc)]['save'](Array[_0x392731(0x19c)](_0x5dc73b[_0x392731(0x2e1)]())),common_1['Logger'][_0x392731(0x2ec)](_0x392731(0x2b6));}catch(_0xa50a16){common_1[_0x392731(0x16e)][_0x392731(0x142)](_0xa50a16,_0x392731(0x1b8));}}async['syncTaskInfo'](_0x5beb83){const _0x2fe143=_0x471d3e,_0x61f54f=await this['mjpTaskService'][_0x2fe143(0x289)]({'data':{'ids':[_0x5beb83]}});common_1['Logger'][_0x2fe143(0x2ec)](_0x2fe143(0x235)),this['notify'](_0x61f54f[0x0]);}async[_0x471d3e(0x222)](_0x4516a2){const _0x26b397=_0x471d3e,_0x461a5f=await this[_0x26b397(0x18c)][_0x26b397(0x1c9)](_0x4516a2[_0x26b397(0x23d)]['id']),_0x672c67={'fast':0x0,'relax':0x0,'trubo':0x0};let _0x4915ee=redisKey_constant_1['VIP_FREE']+'-'+_0x461a5f['id']+'-';if(_0x461a5f[_0x26b397(0x1bf)]||_0x461a5f['lifetimeVip']){const [_0x362c11,_0x33d17c,_0x5f04d8]=await Promise[_0x26b397(0x28a)]([this[_0x26b397(0x284)][_0x26b397(0x256)]({'key':_0x4915ee+'fast_vip_free'}),this[_0x26b397(0x284)][_0x26b397(0x256)]({'key':_0x4915ee+'relax_vip_free'}),this[_0x26b397(0x284)]['get']({'key':_0x4915ee+'turbo_vip_free'})]);_0x672c67[_0x26b397(0x28c)]=Number(_0x362c11||0x0),_0x672c67[_0x26b397(0x295)]=Number(_0x33d17c||0x0),_0x672c67[_0x26b397(0x220)]=Number(_0x5f04d8||0x0);}return _0x672c67;}[_0x471d3e(0x32d)](_0x3f5cca){const _0x238f0c=_0x471d3e;if(typeof _0x3f5cca===_0x238f0c(0x296))return midjourney_constant_1[_0x238f0c(0x1f6)][_0x238f0c(0x256)](_0x3f5cca);if(typeof _0x3f5cca===_0x238f0c(0x281))return midjourney_constant_1[_0x238f0c(0x1c4)][_0x238f0c(0x256)](_0x3f5cca);}async[_0x471d3e(0x17a)](_0x4f4b90){const _0x247d7f=_0x471d3e;common_1[_0x247d7f(0x16e)][_0x247d7f(0x2ec)](_0x4f4b90,_0x247d7f(0x176));try{let _0x174a68=[];const _0x19d411=this[_0x247d7f(0x32d)](_0x4f4b90[_0x247d7f(0x2da)]),_0x46f9ee=_0x4f4b90[_0x247d7f(0x2c5)]?parseFloat(_0x4f4b90[_0x247d7f(0x2c5)]):null;let _0x3f2606=await this['midjourneyEntity'][_0x247d7f(0x182)]({'where':{'mjpTaskId':_0x4f4b90['id']}});if(_0x4f4b90[_0x247d7f(0x2da)]===_0x247d7f(0x2ac)&&_0x3f2606['messageFlags']){common_1[_0x247d7f(0x16e)][_0x247d7f(0x2ec)](_0x247d7f(0x1e8),_0x247d7f(0x272));return;}_0x4f4b90[_0x247d7f(0x226)]&&(_0x174a68=_0x4f4b90['buttons'][_0x247d7f(0x232)](_0x2f40f5=>_0x2f40f5[_0x247d7f(0x30b)]!=='Custom\x20Zoom'&&_0x2f40f5[_0x247d7f(0x30b)]!==_0x247d7f(0x271)&&_0x2f40f5[_0x247d7f(0x1f0)]!=='❤️'));common_1[_0x247d7f(0x16e)]['log'](_0x4f4b90[_0x247d7f(0x145)],_0x247d7f(0x17f)),common_1[_0x247d7f(0x16e)][_0x247d7f(0x2ec)](store_1[_0x247d7f(0x330)][_0x247d7f(0x13d)],_0x247d7f(0x211));store_1[_0x247d7f(0x330)][_0x247d7f(0x13d)]&&_0x4f4b90[_0x247d7f(0x145)]&&(_0x4f4b90['imageUrl']=_0x4f4b90['imageUrl'][_0x247d7f(0x199)]('https://cdn.discordapp.com',store_1[_0x247d7f(0x330)][_0x247d7f(0x13d)]));common_1[_0x247d7f(0x16e)][_0x247d7f(0x2ec)](_0x4f4b90[_0x247d7f(0x145)],_0x247d7f(0x2fa));const _0x36bf65={'id':_0x3f2606['id'],'status':_0x19d411,'progress':_0x46f9ee,'buttons':_0x174a68,'durationSpent':null,'imageUrl':_0x4f4b90['imageUrl'],'failReason':_0x4f4b90[_0x247d7f(0x21f)]};return(_0x4f4b90['action']==='DESCRIBE'||_0x4f4b90[_0x247d7f(0x310)]===0x4)&&(_0x36bf65['prompt']=_0x4f4b90[_0x247d7f(0x224)]||_0x4f4b90[_0x247d7f(0x2a4)]?.[_0x247d7f(0x224)],_0x36bf65[_0x247d7f(0x207)]=_0x4f4b90[_0x247d7f(0x224)]||_0x4f4b90['properties']?.[_0x247d7f(0x224)]),_0x4f4b90[_0x247d7f(0x19d)]&&_0x4f4b90['startTime']&&(_0x36bf65[_0x247d7f(0x1b0)]=(_0x4f4b90[_0x247d7f(0x19d)]-_0x4f4b90[_0x247d7f(0x16f)])/0x3e8),_0x3f2606=await this[_0x247d7f(0x26e)][_0x247d7f(0x2b8)](_0x36bf65),_0x4f4b90[_0x247d7f(0x2da)]===_0x247d7f(0x1b9)&&_0x3f2606['imageUrl']&&this[_0x247d7f(0x2e2)][_0x247d7f(0x26a)](_0x3f2606['id'],_0x3f2606[_0x247d7f(0x145)]),null;}catch(_0x5a1a6d){common_1[_0x247d7f(0x16e)]['error'](_0x247d7f(0x19a),_0x5a1a6d);}}async[_0x471d3e(0x185)](_0x36740c){const _0x1ae442=_0x471d3e;common_1[_0x1ae442(0x16e)][_0x1ae442(0x2ec)](_0x36740c,'触站工作流任务通知内容：');try{const _0x3c5db4=midjourney_constant_1[_0x1ae442(0x2bd)][_0x1ae442(0x256)](_0x36740c[_0x1ae442(0x31e)]),_0x124f8c=Number(_0x36740c[_0x1ae442(0x2c5)])*0x64;let _0x2c0723=await this['midjourneyEntity'][_0x1ae442(0x182)]({'where':{'mjpTaskId':_0x36740c['taskId']}});const _0x1b7639={'id':_0x2c0723['id'],'status':_0x3c5db4,'progress':_0x124f8c,'imageUrl':_0x36740c[_0x1ae442(0x216)]?.[_0x1ae442(0x309)](_0x37ce62=>_0x37ce62[_0x1ae442(0x1bd)])['join']('↢↣')};return _0x2c0723=await this[_0x1ae442(0x26e)]['save'](_0x1b7639),_0x2c0723[_0x1ae442(0x2da)]===0x3&&_0x2c0723[_0x1ae442(0x145)]&&this[_0x1ae442(0x2e2)][_0x1ae442(0x26a)](_0x2c0723['id'],_0x2c0723[_0x1ae442(0x145)]),null;}catch(_0x2e5c03){common_1['Logger'][_0x1ae442(0x142)](_0x1ae442(0x164),_0x2e5c03);}}async['notifySD'](_0x3442d3){const _0x113020=_0x471d3e;common_1['Logger'][_0x113020(0x2ec)](_0x3442d3,_0x113020(0x198));try{const _0x2a1105=midjourney_constant_1['CzStateMap'][_0x113020(0x256)](_0x3442d3[_0x113020(0x31e)]),_0x23c280=Number(_0x3442d3[_0x113020(0x2c5)])*0x64;let _0x4992c5=await this['midjourneyEntity'][_0x113020(0x182)]({'where':{'mjpTaskId':_0x3442d3[_0x113020(0x1de)]}});const _0x3ba53c={'id':_0x4992c5['id'],'status':_0x2a1105,'progress':_0x23c280,'imageUrl':_0x3442d3['images']?.[_0x113020(0x309)](_0x4b5f7b=>_0x4b5f7b['imageUrl'])[_0x113020(0x1ec)]('↢↣')};return _0x4992c5=await this['midjourneyEntity'][_0x113020(0x2b8)](_0x3ba53c),_0x4992c5[_0x113020(0x2da)]===0x3&&_0x4992c5[_0x113020(0x145)]&&this['fileService']['transferImg'](_0x4992c5['id'],_0x4992c5['imageUrl']),null;}catch(_0x328978){common_1[_0x113020(0x16e)][_0x113020(0x142)](_0x113020(0x164),_0x328978);}}async[_0x471d3e(0x1c1)](){const _0x5bb60a=_0x471d3e;this[_0x5bb60a(0x1d1)](),this[_0x5bb60a(0x288)](),this[_0x5bb60a(0x2cb)]();}async['syncMjTask'](){const _0x21410a=_0x471d3e;try{const _0x2eb1d3=await this[_0x21410a(0x26e)][_0x21410a(0x2e8)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6]),'botType':(0x0,typeorm_2['In'])([DrawTaskPage_dto_1[_0x21410a(0x166)][_0x21410a(0x13b)],DrawTaskPage_dto_1[_0x21410a(0x166)][_0x21410a(0x1be)]])}});if(_0x2eb1d3[_0x21410a(0x301)])for(let _0x425b04=0x0;_0x425b04<_0x2eb1d3[_0x21410a(0x301)];_0x425b04++){const _0x4a9874=redisKey_constant_1['MJ_TASK_UPDATE']+_0x2eb1d3[_0x425b04][_0x21410a(0x2d1)],_0x3c3290=await this['redisCacheService'][_0x21410a(0x256)]({'key':_0x4a9874});if(_0x3c3290)continue;else this[_0x21410a(0x284)][_0x21410a(0x2bf)]({'key':_0x4a9874,'val':_0x21410a(0x23f)}),this[_0x21410a(0x32e)][_0x21410a(0x289)]({'data':{'ids':[_0x2eb1d3[_0x425b04]['mjpTaskId']]}})[_0x21410a(0x234)](async _0x1935b3=>{const _0x5c4331=_0x21410a,_0x46d6e9=_0x1935b3[0x0],_0x42d16b=_0x2eb1d3[_0x425b04],_0x10d2e3=this[_0x5c4331(0x32d)](_0x46d6e9[_0x5c4331(0x2da)]),_0x1f089f=_0x46d6e9['progress']?parseFloat(_0x46d6e9[_0x5c4331(0x2c5)]):null;if(_0x42d16b[_0x5c4331(0x2c5)]===_0x1f089f&&_0x42d16b[_0x5c4331(0x2da)]===_0x10d2e3){}else{const _0xd385c7=_0x46d6e9['buttons'][_0x5c4331(0x232)](_0x2fcc78=>_0x2fcc78[_0x5c4331(0x30b)]!==_0x5c4331(0x214)&&_0x2fcc78[_0x5c4331(0x30b)]!==_0x5c4331(0x271)&&_0x2fcc78['emoji']!=='❤️'),_0xf4fa03={'id':_0x42d16b['id'],'mjpTaskId':_0x46d6e9['id'],'status':_0x10d2e3,'progress':_0x1f089f,'buttons':_0xd385c7,'durationSpent':null,'imageUrl':_0x46d6e9[_0x5c4331(0x145)],'failReason':_0x46d6e9[_0x5c4331(0x21f)]};store_1['MjConfig'][_0x5c4331(0x13d)]&&_0xf4fa03[_0x5c4331(0x145)]&&(_0xf4fa03[_0x5c4331(0x145)]=_0xf4fa03[_0x5c4331(0x145)][_0x5c4331(0x199)]('https://cdn.discordapp.com',store_1['MjConfig']['mjProxyImgUrl'])),(_0x46d6e9['action']===_0x5c4331(0x139)||_0x46d6e9[_0x5c4331(0x310)]===0x4)&&(_0xf4fa03[_0x5c4331(0x32b)]=_0x46d6e9['finalPrompt']||_0x46d6e9['properties']?.[_0x5c4331(0x224)],_0xf4fa03[_0x5c4331(0x207)]=_0x46d6e9['finalPrompt']||_0x46d6e9['properties']?.[_0x5c4331(0x224)]),_0x46d6e9['finishTime']&&_0x46d6e9[_0x5c4331(0x16f)]&&(_0xf4fa03[_0x5c4331(0x1b0)]=(_0x46d6e9[_0x5c4331(0x19d)]-_0x46d6e9[_0x5c4331(0x16f)])/0x3e8),await this[_0x5c4331(0x26e)][_0x5c4331(0x2b8)](_0xf4fa03);}})[_0x21410a(0x2f4)](_0x25ca52=>{const _0x3bc68e=_0x21410a;common_1[_0x3bc68e(0x16e)][_0x3bc68e(0x142)](_0x3bc68e(0x2d2),_0x25ca52);})[_0x21410a(0x15c)](()=>{const _0x5da69e=_0x21410a;this[_0x5da69e(0x284)][_0x5da69e(0x247)]({'key':_0x4a9874});});}}catch(_0x274fce){}}async[_0x471d3e(0x288)](){const _0x5a3c5b=_0x471d3e;try{const _0x5915f4=await this[_0x5a3c5b(0x26e)][_0x5a3c5b(0x2e8)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'mjpTaskId':(0x0,typeorm_2[_0x5a3c5b(0x2e4)])((0x0,typeorm_2[_0x5a3c5b(0x160)])()),'botType':DrawTaskPage_dto_1[_0x5a3c5b(0x166)][_0x5a3c5b(0x173)]}});if(_0x5915f4['length'])for(let _0x16a348=0x0;_0x16a348<_0x5915f4[_0x5a3c5b(0x301)];_0x16a348++){const _0x525252=redisKey_constant_1['MJ_TASK_UPDATE']+_0x5915f4[_0x16a348]['mjpTaskId'],_0x23c3fc=await this[_0x5a3c5b(0x284)][_0x5a3c5b(0x256)]({'key':_0x525252});if(_0x23c3fc)continue;else{this[_0x5a3c5b(0x284)]['set']({'key':_0x525252,'val':_0x5a3c5b(0x23f)});try{const _0x3b9c6e=await this['czTaskService'][_0x5a3c5b(0x264)]({'data':{'taskId':_0x5915f4[_0x16a348][_0x5a3c5b(0x2d1)]}});this[_0x5a3c5b(0x185)](_0x3b9c6e);}catch(_0x1f96ae){common_1[_0x5a3c5b(0x16e)][_0x5a3c5b(0x142)](_0x5a3c5b(0x141),_0x1f96ae);}finally{this[_0x5a3c5b(0x284)][_0x5a3c5b(0x247)]({'key':_0x525252});}}}}catch(_0x35153a){}}async['syncSdTask'](){const _0x10e86b=_0x471d3e;try{const _0x20d94d=await this[_0x10e86b(0x26e)][_0x10e86b(0x2e8)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'botType':DrawTaskPage_dto_1[_0x10e86b(0x166)]['SD']}});if(_0x20d94d[_0x10e86b(0x301)])for(let _0x28956d=0x0;_0x28956d<_0x20d94d[_0x10e86b(0x301)];_0x28956d++){const _0x10f9f8=redisKey_constant_1[_0x10e86b(0x1e7)]+_0x20d94d[_0x28956d][_0x10e86b(0x2d1)],_0x4931bc=await this[_0x10e86b(0x284)]['get']({'key':_0x10f9f8});if(_0x4931bc)continue;else{this[_0x10e86b(0x284)][_0x10e86b(0x2bf)]({'key':_0x10f9f8,'val':_0x10e86b(0x23f)});try{const _0x3dbe96=await this[_0x10e86b(0x2ca)][_0x10e86b(0x26c)]({'data':{'taskId':_0x20d94d[_0x28956d][_0x10e86b(0x2d1)]}});this[_0x10e86b(0x2b5)](_0x3dbe96);}catch(_0x39f58a){common_1[_0x10e86b(0x16e)]['error'](_0x10e86b(0x27e),_0x39f58a);}finally{this[_0x10e86b(0x284)][_0x10e86b(0x247)]({'key':_0x10f9f8});}}}}catch(_0x2f8252){}}async['syncMjImg'](){const _0x39f505=_0x471d3e;if(store_1[_0x39f505(0x330)][_0x39f505(0x265)])return;try{const _0xc90e0d=[{'status':0x3,'imageUrl':(0x0,typeorm_2[_0x39f505(0x2c3)])('https://cdn.discordapp.com%')}];store_1[_0x39f505(0x330)][_0x39f505(0x13d)]&&_0xc90e0d[_0x39f505(0x2ee)]({'status':0x3,'imageUrl':(0x0,typeorm_2[_0x39f505(0x2c3)])(store_1[_0x39f505(0x330)][_0x39f505(0x13d)]+'%')});const _0x326c05=await this['midjourneyEntity'][_0x39f505(0x2e8)]({'where':_0xc90e0d});if(_0x326c05[_0x39f505(0x301)])for(let _0x46dce3=0x0;_0x46dce3<_0x326c05[_0x39f505(0x301)];_0x46dce3++){let {id:_0x3a9148,imageUrl:_0x1687e6}=_0x326c05[_0x46dce3];this[_0x39f505(0x2e2)][_0x39f505(0x26a)](_0x3a9148,_0x1687e6);}}catch(_0x17c299){common_1[_0x39f505(0x16e)][_0x39f505(0x142)](_0x17c299);}}};MidjourneyService=__decorate([(0x0,common_1[_0x471d3e(0x2d5)])(),__param(0x0,(0x0,typeorm_1[_0x471d3e(0x21c)])(mjModel_entity_1['MjModelEntity'])),__param(0x1,(0x0,typeorm_1[_0x471d3e(0x21c)])(mjParam_entity_1[_0x471d3e(0x244)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(mjPrompts_entity_1[_0x471d3e(0x29c)])),__param(0x3,(0x0,typeorm_1[_0x471d3e(0x21c)])(midjourney_entity_1[_0x471d3e(0x1f8)])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(mjSuggestWord_entity_1['MjSuggestWordEntity'])),__param(0x5,(0x0,typeorm_1[_0x471d3e(0x21c)])(mjIncantation_entity_1[_0x471d3e(0x293)])),__param(0x6,(0x0,typeorm_1[_0x471d3e(0x21c)])(mjInspireClassify_entity_1['MjInspireClassifyEntity'])),__param(0x7,(0x0,typeorm_1[_0x471d3e(0x21c)])(mjIncantationClassify_entity_1[_0x471d3e(0x183)])),__metadata(_0x471d3e(0x16b),[typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x471d3e(0x17c)],typeorm_2[_0x471d3e(0x17c)],typeorm_2[_0x471d3e(0x17c)],typeorm_2[_0x471d3e(0x17c)],typeorm_2[_0x471d3e(0x17c)],typeorm_2[_0x471d3e(0x17c)],nestjs_cls_1['ClsService'],dict_service_1[_0x471d3e(0x258)],user_service_1['UserService'],file_service_1[_0x471d3e(0x24c)],fanyi_service_1[_0x471d3e(0x17e)],aiLog_service_1[_0x471d3e(0x1c8)],models_service_1[_0x471d3e(0x1ff)],czTask_service_1[_0x471d3e(0x2b0)],mjpTask_service_1['MjpTaskService'],badwords_service_1['BadwordsService'],redisCache_service_1[_0x471d3e(0x1e3)],mjpAccount_service_1[_0x471d3e(0x304)],globalConfig_service_1[_0x471d3e(0x152)],typeorm_2[_0x471d3e(0x2e7)]])],MidjourneyService),exports['MidjourneyService']=MidjourneyService;