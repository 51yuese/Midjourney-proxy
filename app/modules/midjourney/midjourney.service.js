'use strict';function _0x3145(_0x50b534,_0x527123){const _0x31a13e=_0x31a1();return _0x3145=function(_0x31454b,_0x299acc){_0x31454b=_0x31454b-0x9e;let _0x3e358e=_0x31a13e[_0x31454b];return _0x3e358e;},_0x3145(_0x50b534,_0x527123);}function _0x31a1(){const _0x139dc6=['mjpId','操作失败！','__metadata','HttpException','193635lmGbGD','hideString','mask','blend','WORKFLOW','number','effect_category','44rglFmc','queryAllPrompt','getReqSaasId','../../common/utils','remark','env','lifetimeUsage','emoji','添加绘图任务失败','workflowRun','saasId','任务不存在！','squareType','Connection','imageSeed','customId','sdTaskUpdateJob:\x20','mjProxy','workflowDel','checkBadWords','userInfo','queryMjIncantationClassifyAllByLevel','versionId','syncMjTask','workflowForm','failReason','删除失败！','buffer','getModelByIds','swap','version','pid','addMjIncantationClassify','messageFlags','length','syncTaskInfo','MidjourneyStatusEnum','无绘图记录','原始任务不存在！','size','convertMode4Transfer','mjProxyImgUrl','fast_vip_free','mjpTaskId','保存推荐关键词','Mj任务通知异常:\x20','isPlatform','development','base64','当前图片已经执行过相同指令！','save','getAgreeByRelateId','AddDrawQueueDto','modal','mjModelEntity','metadata','description','coverImageUrl','getUserListByIds','UserService','modelName','has','modifyMjInspireClassify','incantationCn','DRAWING','files','分页参数错误','ASC','removeMjInspireClassify','findOneBy','assign','taskId','isDefined','label','fullPrompt','FAST','addMjAccount','AiLogService','properties','effectCategory','promptsPage','removeMjAccount','get4workflow','DESC','defineProperty','split','查询推荐关键词失败','application_fields','syncMjImg','isManage','connection','查询咒语失败','MEGA','自动同步账号信息失败：','IsNull','形象设计','imagine','BASIC','message','vipFreeNum','../../common/constants/user.constant','validateBalance4MJ','mjParamEntity','modelsService','result','userId','notifyWF','绘制的任务不存在！','then','rows','BAD_REQUEST','InjectRepository','初始化灵感广场分类失败','deductBalance4MJ','displaySort','notifySD','./mjIncantationClassify.entity','图混图任务至少需要两张图片','page','workflowPage','mjpTaskService','authorization','cover','join','effectMainBodyName','\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20','notify','phone','\x20OFFSET\x20','decorate','totalTime','精选分享','Like','fetch','__param','forEach','dictName','findAndCount','mjNotSaveImg','deductBalance4SD','推荐关键词不存在','saveSuggestWords','effect_main_body','enable','clsService','\x20--sw\x20','modelType','MjpAccountService','MjSuggestWordEntity','buttons','czTaskService','未查询到咒语一级分类','\x20--sref\x20','MID_JOURNEY','BadwordsService','当前图片不存在！','initInspireData','mjpId:\x20','DESCRIBE','applicationFieldsName','effectCategoryName','Modal已处理，无需更新','getModelById','remix','ModelsService','level','object','RELAX','queryTopMjIncantationClassify','convertToEnglish','mjpAccountService','datas','Mj\x20Modal\x20通知','美女形象','setting','fastRemainTime','update','channelId','mjTaskUpdateJob:\x20','state','../api/czTask.service','dictService','add','../models/models.service','guildId','modelPage','checkUserStatus','CzStateMap','DrawSpeed','nickname','../dict/dict.service','jobIds','value','handleImagesUploadTask','./mjIncantation.entity','botType','workflowModelDetail','squire-images','\x20--cw\x20','syncModelsByTag','vipExpire','VIP_FREE','mjModel','商拍摄影','Custom\x20Zoom','function','copyAccountInfo','syncTask','email','map','动漫漫画','fanyiService','use','prompt','findOne','count','./dto/DrawTaskPage.dto','../../common/constants/redisKey.constant','../../common/constants/model.constant','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','HttpStatus','查询咒语分类失败','concurrentLimit','syncSdTask','https://cdn.discordapp.com%','syncModels','listByCondition','aiLogService','action','ClsService','\x20--cref\x20','syncWfTask','IMAGE_TO_TEXT','checkIsActionDone','status','relax','删除推荐关键词失败','modalTask','getMjInspireClassify','要使用MJ绘画功能，至少需要配置一个MJ账号,并且启用该账号','updatedAt','removeSuggestWords','aiInpaint','MJP_ACCOUNT','progress','isSuper','TURBO','parse','绘制中的图片任务、禁止删除！','deduct','../globalConfig/globalConfig.service','mjInspireClassifyEntity','MjParamEntity','turbo','dictValue','570JGLqlT','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','addRefer','globalConfigService','DRAWED','Injectable','parseMjStatus','inputs','MjPromptsEntity','FileService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.used\x20AS\x20used\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','dictType','replace','CZTaskService','relaxedUsage','sdTaskInpaint','初始化灵感广场分类成功','workflowUsedPage','style','workflowSave','代理图片地址：','mjVersion','modelDel','lock','onModuleInit','./mjParam.entity','changeVersion','finalPrompt','MJ_TASK_UPDATE','mjIncantationEntity','useCount','syncMjpAccountManual','mjSuggestWordEntity','model','actionTask','renewDate','catch','928444txEydE','aiTaskDetail','drawSquarePage','fastTimeRemaining','setPrompt','fileService','getUserId','weight','@nestjs/common','DictService','triggerWords','getMjAccount','mjPromptsEntity','del','query','workflowModelPage','lifetimeVip','string','getUserById','绘画制作','exist','./mjSuggestWord.entity','../user/user.service','addDrawQueue','prompt包含敏感词','recDraw','querySuggestWords','error','小工具已禁用！','favoriteListByTypeAndIds','find','subscribePlan','MjConfig','不需要灵感广场分类','getDetailByIds','finally','log','startTime','mjIncantationClassifyEntity','id不能为空！','finishTime','toString','freeUsed','创建图混图任务失败','timeoutMinutes','set','nestjs-cls','queryModels','18091503tDfuUP','./dto/addDrawQueue.dto','keyword','../file/file.service','查询灵感分类失败','code','推送图片地址：','user','__decorate','../api/mjpAccount.service','MjIncantationEntity','workflowDicts','badwordsService','error:\x20','imageUrl','modelSave','FALSE','describe','触站::模型信息同步失败','denoisingStrength','摄影拍照','get','durationSpent','../fanyi/fanyi.service','orderPlan','values','addMjInspireClassify','Repository','2898165GBDWvI','deductBalance4WorkFlow','mode','modifyMjIncantationClassify','触站工作流任务通知内容：','getOwnPropertyDescriptor','stringify','7jlPfoi','getConfigByKeys','Modal\x20状态\x20手动同步任务信息','工作流（小工具）不存在','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.createdAt\x20DESC\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','MjIncantationClassifyEntity','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','../api/mjpTask.service','queryMjAccountList','getMjIncantationClassify','transaction','filter','队列已满，请稍后尝试','MidJourneyDrawEnum','createRandomUid','queryMjInspireClassify','username','EFavorite','MjpStateMap','rec','fast','setImageFavorite','applicationFields','classifyName','EModelType','distributeAccount','transferImg','IMAGE_MIX_IMAGE','ids','Not','推荐关键词已存在，不可重复添加','turbo_vip_free','list4workflow','4901502JVkcXt','drawTaskList','redisCacheService','任务类型错误','styleName','getByRelateId','handleAddDrawTask','触站::运用领域、风格画风、作用主体、作用类别字典同步失败','触站工作流任务通知异常:\x20','Imagine','create','MODAL','disabled','concat','workflowDetail','4851712KIfXtE','头像制作','increaseVisit','Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','info','DRAW','delLog','createdAt','Blend','FaceSwap','from','trubo','versionSelector','url','ENV','MidjourneyService','Imagine\x20all','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27','没有满足条件的MJ账号，请联系管理员！','../aiLog/aiLog.service','MjModelEntity','MJ\x20通知内容：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mjpId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20midjourney\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20action\x20IN\x20(\x201,\x202,\x203,\x2022\x20)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20DATE\x20(\x20createdAt\x20)\x20=\x20CURDATE()\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mjpId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20t\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.mjpId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count\x20ASC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20','syncMjpAccount','非法操作！','save4workflow','MjpStateIndexMap','name','isChinese','SD任务通知内容：','midjourneyEntity','workflowId','MjpTaskService','MjInspireClassifyEntity','fileInfo','https://cdn.discordapp.com','https://img2.huashi6.com/','userService','findBy','tutorial','account','updateReconnect','list4dictTypes','timeout','cancel','paintingSign','GlobalConfigService','EBotType','pageCount','MoreThan','affected','提交动作失败','删除成功！','delete','aiDraw','instanceId','type','Logger','../../common/constants/midjourney.constant'];_0x31a1=function(){return _0x139dc6;};return _0x31a1();}const _0x32b9f0=_0x3145;(function(_0x21796c,_0x1545b5){const _0x3d5038=_0x3145,_0x42b9ba=_0x21796c();while(!![]){try{const _0x276538=parseInt(_0x3d5038(0x175))/0x1+-parseInt(_0x3d5038(0x17c))/0x2*(parseInt(_0x3d5038(0x27b))/0x3)+parseInt(_0x3d5038(0xb3))/0x4+-parseInt(_0x3d5038(0xff))/0x5+-parseInt(_0x3d5038(0x127))/0x6*(parseInt(_0x3d5038(0x106))/0x7)+-parseInt(_0x3d5038(0x136))/0x8+parseInt(_0x3d5038(0xe3))/0x9;if(_0x276538===_0x1545b5)break;else _0x42b9ba['push'](_0x42b9ba['shift']());}catch(_0x5eaf88){_0x42b9ba['push'](_0x42b9ba['shift']());}}}(_0x31a1,0x68aaf));var __decorate=this&&this[_0x32b9f0(0xeb)]||function(_0x4689d9,_0x555dcc,_0x15a65e,_0x37824a){const _0x59d648=_0x32b9f0;var _0x509bd1=arguments[_0x59d648(0x19e)],_0x3061b8=_0x509bd1<0x3?_0x555dcc:_0x37824a===null?_0x37824a=Object[_0x59d648(0x104)](_0x555dcc,_0x15a65e):_0x37824a,_0x2f21a6;if(typeof Reflect===_0x59d648(0x222)&&typeof Reflect[_0x59d648(0x1fd)]===_0x59d648(0x249))_0x3061b8=Reflect['decorate'](_0x4689d9,_0x555dcc,_0x15a65e,_0x37824a);else{for(var _0x5de0e3=_0x4689d9[_0x59d648(0x19e)]-0x1;_0x5de0e3>=0x0;_0x5de0e3--)if(_0x2f21a6=_0x4689d9[_0x5de0e3])_0x3061b8=(_0x509bd1<0x3?_0x2f21a6(_0x3061b8):_0x509bd1>0x3?_0x2f21a6(_0x555dcc,_0x15a65e,_0x3061b8):_0x2f21a6(_0x555dcc,_0x15a65e))||_0x3061b8;}return _0x509bd1>0x3&&_0x3061b8&&Object[_0x59d648(0x1d0)](_0x555dcc,_0x15a65e,_0x3061b8),_0x3061b8;},__metadata=this&&this[_0x32b9f0(0x173)]||function(_0x3263db,_0xf85374){const _0x25af21=_0x32b9f0;if(typeof Reflect===_0x25af21(0x222)&&typeof Reflect['metadata']===_0x25af21(0x249))return Reflect[_0x25af21(0x1b3)](_0x3263db,_0xf85374);},__param=this&&this[_0x32b9f0(0x202)]||function(_0xf61ba6,_0x28756e){return function(_0x44a1d8,_0xf5fed9){_0x28756e(_0x44a1d8,_0xf5fed9,_0xf61ba6);};};Object[_0x32b9f0(0x1d0)](exports,'__esModule',{'value':!![]}),exports[_0x32b9f0(0x145)]=void 0x0;const common_1=require(_0x32b9f0(0xbb)),typeorm_1=require('@nestjs/typeorm'),midjourney_entity_1=require('./midjourney.entity'),typeorm_2=require('typeorm'),globalConfig_service_1=require(_0x32b9f0(0x276)),midjourney_constant_1=require(_0x32b9f0(0x170)),file_service_1=require(_0x32b9f0(0xe6)),badwords_service_1=require('../badwords/badwords.service'),utils_1=require(_0x32b9f0(0x17f)),mjPrompts_entity_1=require('./mjPrompts.entity'),mjParam_entity_1=require(_0x32b9f0(0xa7)),mjIncantationClassify_entity_1=require(_0x32b9f0(0x1f0)),mjInspireClassify_entity_1=require('./mjInspireClassify.entity'),mjIncantation_entity_1=require(_0x32b9f0(0x23e)),fanyi_service_1=require(_0x32b9f0(0xfa)),mjSuggestWord_entity_1=require(_0x32b9f0(0xc8)),user_service_1=require(_0x32b9f0(0xc9)),redisCache_service_1=require('../redisCache/redisCache.service'),mjpAccount_service_1=require(_0x32b9f0(0xec)),mjpTask_service_1=require(_0x32b9f0(0x10d)),addDrawQueue_dto_1=require(_0x32b9f0(0xe4)),store_1=require('../../common/store'),redisKey_constant_1=require(_0x32b9f0(0x255)),aiLog_service_1=require(_0x32b9f0(0x149)),model_constant_1=require(_0x32b9f0(0x256)),nestjs_cls_1=require(_0x32b9f0(0xe1)),czTask_service_1=require(_0x32b9f0(0x230)),models_service_1=require(_0x32b9f0(0x233)),DrawTaskPage_dto_1=require(_0x32b9f0(0x254)),user_constant_1=require(_0x32b9f0(0x1e0)),dict_service_1=require(_0x32b9f0(0x23a)),mjModel_entity_1=require('./mjModel.entity');let MidjourneyService=class MidjourneyService{constructor(_0x2b48ff,_0x89e017,_0x1d8db4,_0x363ed2,_0x16e158,_0x7f37f2,_0x56c39e,_0x3167d7,_0x20e0fd,_0x1f7443,_0x35091a,_0xe4cb73,_0x8294f8,_0x2b161a,_0x481351,_0x2ad2f4,_0x49ce15,_0x5df149,_0x712345,_0x2b7d1b,_0xabc820,_0x42ca70){const _0x498ff1=_0x32b9f0;this[_0x498ff1(0x1b2)]=_0x2b48ff,this[_0x498ff1(0x1e2)]=_0x89e017,this[_0x498ff1(0xbf)]=_0x1d8db4,this[_0x498ff1(0x154)]=_0x363ed2,this[_0x498ff1(0xae)]=_0x16e158,this[_0x498ff1(0xab)]=_0x7f37f2,this['mjInspireClassifyEntity']=_0x56c39e,this[_0x498ff1(0xd9)]=_0x3167d7,this['clsService']=_0x20e0fd,this[_0x498ff1(0x231)]=_0x1f7443,this[_0x498ff1(0x15b)]=_0x35091a,this[_0x498ff1(0xb8)]=_0xe4cb73,this[_0x498ff1(0x24f)]=_0x8294f8,this[_0x498ff1(0x25f)]=_0x2b161a,this[_0x498ff1(0x1e3)]=_0x481351,this['czTaskService']=_0x2ad2f4,this[_0x498ff1(0x1f4)]=_0x49ce15,this['badwordsService']=_0x5df149,this[_0x498ff1(0x129)]=_0x712345,this[_0x498ff1(0x226)]=_0x2b7d1b,this[_0x498ff1(0x27e)]=_0xabc820,this[_0x498ff1(0x1d6)]=_0x42ca70;}async[_0x32b9f0(0xa6)](){const _0x54a23d=_0x32b9f0;await this[_0x54a23d(0x218)](),await this['initHasAccount']();}async['initHasAccount'](){const _0x9b912a=_0x32b9f0,_0x4b4c84=await this['mjParamEntity'][_0x9b912a(0x253)]({'where':{'enable':0x1},'order':{'weight':'DESC'}});_0x4b4c84===0x0&&common_1['Logger'][_0x9b912a(0xce)](_0x9b912a(0x26b));}async[_0x32b9f0(0x218)](){const _0x1cfc3e=_0x32b9f0,_0x13aa1b=await this[_0x1cfc3e(0x277)]['count']();if(_0x13aa1b===0x0){const _0x3a2a63=[{'name':_0x1cfc3e(0xc6),'value':0x1},{'name':_0x1cfc3e(0xf7),'value':0x2},{'name':_0x1cfc3e(0x137),'value':0x3},{'name':_0x1cfc3e(0x229),'value':0x4},{'name':_0x1cfc3e(0x24e),'value':0x5},{'name':'壁纸绘画','value':0x6},{'name':'艺术设计','value':0x7},{'name':_0x1cfc3e(0x247),'value':0x8},{'name':_0x1cfc3e(0x1db),'value':0x9},{'name':_0x1cfc3e(0x1ff),'value':0xa}]['map'](_0x1800e5=>{const _0x57f05b=_0x1cfc3e;return{'name':_0x1800e5['name'],'value':_0x1800e5[_0x57f05b(0x23c)]+'','inner':0x1};});await this[_0x1cfc3e(0x277)][_0x1cfc3e(0x1ae)](_0x3a2a63)['catch'](()=>{const _0x334d1d=_0x1cfc3e;common_1['Logger'][_0x334d1d(0xce)](_0x334d1d(0x1ec));}),common_1[_0x1cfc3e(0x16f)][_0x1cfc3e(0xd7)](_0x1cfc3e(0x9e));}common_1[_0x1cfc3e(0x16f)][_0x1cfc3e(0xd7)](_0x1cfc3e(0xd4));}async[_0x32b9f0(0x1c8)](_0x1a556a){const _0x208b88=_0x32b9f0;try{const {guildId:_0x1b7440,account:_0x4bc15d,authorization:_0x3b6c83,mode:_0xeebd93,timeout:_0x990074,channelId:_0x1a8f9e,remark:_0x52948e,mjBotChannelId:_0x598c85,nijiBotChannelId:_0x234cbc}=_0x1a556a;var _0x4aaa1f=await this['mjpAccountService'][_0x208b88(0x131)]({'data':{'channelId':_0x1a8f9e,'coreSize':0x3,'guildId':_0x1b7440,'mjBotChannelId':_0x598c85||'','nijiBotChannelId':_0x234cbc||'','queueSize':0xa,'remark':_0x52948e,'remixAutoSubmit':![],'timeoutMinutes':_0x990074,'userAgent':'Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','userToken':_0x3b6c83}});if(_0x4aaa1f['code']!==0x1)throw new Error(_0x4aaa1f[_0x208b88(0x1b4)]);const _0x91904f=await this[_0x208b88(0x1e2)]['save']({'account':_0x4bc15d,'authorization':_0x3b6c83,'mode':_0xeebd93,'timeout':_0x990074,'channelId':_0x1a8f9e,'guildId':_0x1b7440,'remark':_0x52948e,'mjpId':_0x4aaa1f[_0x208b88(0x1e4)],'mjBotChannelId':_0x598c85||'','nijiBotChannelId':_0x234cbc||''});return await this[_0x208b88(0x14d)](_0x4aaa1f['result']),!!_0x91904f;}catch(_0x42dcae){common_1[_0x208b88(0x16f)][_0x208b88(0xce)](_0x42dcae);throw new common_1['HttpException'](_0x42dcae['message'],common_1[_0x208b88(0x258)][_0x208b88(0x1ea)]);}}async['modifyMjAccount'](_0x52443f){const _0x5b7dc5=_0x32b9f0,{id:_0x1a734a,account:_0x43c9b1,authorization:_0x17a6f7,mode:_0x4207b,guildId:_0x340e76,remark:_0x343d45,channelId:_0x101500,timeout:_0x2bbc28,enable:_0x45912b,mjBotChannelId:_0x160863,nijiBotChannelId:_0x1c30dc}=_0x52443f;try{const _0x34baea=await this[_0x5b7dc5(0x1e2)]['findOneBy']({'id':Number(_0x1a734a)});var _0x34813b=await this[_0x5b7dc5(0x226)][_0x5b7dc5(0x15f)]({'data':{'channelId':_0x101500,'coreSize':0x3,'guildId':_0x340e76,'mjBotChannelId':_0x160863||'','nijiBotChannelId':_0x1c30dc||'','queueSize':0xa,'remark':_0x343d45,'remixAutoSubmit':![],'timeoutMinutes':_0x2bbc28,'userAgent':_0x5b7dc5(0x139),'userToken':_0x17a6f7,'enable':Boolean(_0x45912b)}},_0x34baea['mjpId']);if(_0x34813b[_0x5b7dc5(0xe8)]!==0x1)throw new Error(_0x34813b[_0x5b7dc5(0x1b4)]);return await this[_0x5b7dc5(0x1e2)]['update'](_0x1a734a,{'account':_0x43c9b1,'authorization':_0x17a6f7,'mode':_0x4207b,'guildId':_0x340e76,'remark':_0x343d45,'channelId':_0x101500,'timeout':_0x2bbc28,'mjBotChannelId':_0x160863||'','nijiBotChannelId':_0x1c30dc||''});}catch(_0x4d18f0){common_1['Logger'][_0x5b7dc5(0xce)](_0x4d18f0);throw new common_1[(_0x5b7dc5(0x174))](_0x4d18f0[_0x5b7dc5(0x1de)],common_1[_0x5b7dc5(0x258)][_0x5b7dc5(0x1ea)]);}}async['copyAccountInfo'](_0x573424,_0x422d0b){const _0x4a7ab0=_0x32b9f0;_0x573424[_0x4a7ab0(0xa3)]=_0x422d0b[_0x4a7ab0(0x19a)];if(_0x422d0b[_0x4a7ab0(0x101)]===_0x4a7ab0(0x1c7))_0x573424[_0x4a7ab0(0x101)]=midjourney_constant_1['DrawSpeed'][_0x4a7ab0(0x11a)];else{if(_0x422d0b['mode']===_0x4a7ab0(0x223))_0x573424['mode']=midjourney_constant_1['DrawSpeed'][_0x4a7ab0(0x267)];else _0x422d0b[_0x4a7ab0(0x101)]===_0x4a7ab0(0x272)&&(_0x573424[_0x4a7ab0(0x101)]=midjourney_constant_1[_0x4a7ab0(0x238)]['turbo']);}_0x573424[_0x4a7ab0(0x22b)]=_0x422d0b[_0x4a7ab0(0xb6)],_0x573424[_0x4a7ab0(0x1fe)]=_0x422d0b[_0x4a7ab0(0xb6)],_0x573424['lifetimeUsage']=_0x422d0b[_0x4a7ab0(0x182)],_0x573424[_0x4a7ab0(0x289)]=_0x422d0b['relaxedUsage'],_0x573424[_0x4a7ab0(0x21f)]=Number(_0x422d0b['remix']);if(_0x422d0b[_0x4a7ab0(0xd2)]===_0x4a7ab0(0x1dd))_0x573424[_0x4a7ab0(0xfb)]=0x1;else{if(_0x422d0b[_0x4a7ab0(0xd2)]==='STANDARD')_0x573424[_0x4a7ab0(0xfb)]=0x2;else{if(_0x422d0b[_0x4a7ab0(0xd2)]==='PRO')_0x573424['orderPlan']=0x3;else _0x422d0b[_0x4a7ab0(0xd2)]===_0x4a7ab0(0x1d8)&&(_0x573424[_0x4a7ab0(0xfb)]=0x4);}}_0x573424[_0x4a7ab0(0xb1)]=_0x422d0b[_0x4a7ab0(0xb1)],_0x573424[_0x4a7ab0(0x161)]=_0x422d0b[_0x4a7ab0(0xdf)],_0x573424[_0x4a7ab0(0x22a)]=JSON[_0x4a7ab0(0x105)](_0x422d0b[_0x4a7ab0(0x211)]),_0x573424[_0x4a7ab0(0x13a)]=JSON[_0x4a7ab0(0x105)](_0x422d0b[_0x4a7ab0(0x142)]),await this[_0x4a7ab0(0x1e2)]['save'](_0x573424);}async[_0x32b9f0(0x14d)](_0x14b32c){const _0x1790ce=_0x32b9f0;try{if(store_1[_0x1790ce(0xd3)][_0x1790ce(0x246)]!==_0x1790ce(0x18d))return;const _0x32ee78=await this[_0x1790ce(0x226)][_0x1790ce(0x201)]({},_0x14b32c);if(!_0x32ee78)return;const _0x288a65=await this[_0x1790ce(0x1e2)][_0x1790ce(0x252)]({'where':{'mjpId':_0x14b32c}});await this[_0x1790ce(0x24a)](_0x288a65,_0x32ee78);}catch(_0x5ce7ee){common_1[_0x1790ce(0x16f)][_0x1790ce(0xce)](_0x1790ce(0x1d9),_0x5ce7ee);}}async['syncMjpAccountAutomatic'](){const _0x3fb5ba=_0x32b9f0,_0x247011=await this[_0x3fb5ba(0x1e2)][_0x3fb5ba(0xd1)]();if(!_0x247011[_0x3fb5ba(0x19e)])return;for(let _0x4d7afd=0x0;_0x4d7afd<_0x247011[_0x3fb5ba(0x19e)];_0x4d7afd++){this[_0x3fb5ba(0x14d)](_0x247011[_0x4d7afd]['mjpId']);}}async[_0x32b9f0(0xad)]({id:_0x4646b6}){const _0x1b18fd=_0x32b9f0;try{const _0x454736=await this[_0x1b18fd(0x1e2)][_0x1b18fd(0x1c1)]({'id':Number(_0x4646b6)}),_0x550ce0=await this[_0x1b18fd(0x226)]['syncInfo']({},_0x454736[_0x1b18fd(0x171)]);if(_0x550ce0[_0x1b18fd(0xe8)]!==0x1)throw new Error(_0x550ce0[_0x1b18fd(0x1b4)]);await this[_0x1b18fd(0x24a)](_0x454736,_0x550ce0['result']);}catch(_0xd0e5fc){throw new common_1[(_0x1b18fd(0x174))](_0xd0e5fc[_0x1b18fd(0x1de)],common_1[_0x1b18fd(0x258)][_0x1b18fd(0x1ea)]);}}async['changeVersion'](_0xc98686){const _0x4daa1e=_0x32b9f0;try{const _0x26700b=await this[_0x4daa1e(0x1e2)]['findOneBy']({'id':Number(_0xc98686['id'])}),_0x56935b=await this[_0x4daa1e(0x226)][_0x4daa1e(0xa8)]({'data':_0xc98686},_0x26700b[_0x4daa1e(0x171)]);if(_0x56935b[_0x4daa1e(0xe8)]!==0x1)throw new Error(_0x56935b[_0x4daa1e(0x1b4)]);return _0x26700b['mjVersion']=_0xc98686[_0x4daa1e(0x19a)],await this[_0x4daa1e(0x1e2)][_0x4daa1e(0x1ae)](_0x26700b),!![];}catch(_0x5b0285){throw new common_1[(_0x4daa1e(0x174))](_0x5b0285[_0x4daa1e(0x1de)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x32b9f0(0x260)](_0x4b135e){const _0x467e2d=_0x32b9f0;try{const _0x2076fb=await this[_0x467e2d(0x1e2)][_0x467e2d(0x1c1)]({'id':Number(_0x4b135e['id'])}),_0x1ffbe9=await this['mjpAccountService'][_0x467e2d(0x260)]({'data':_0x4b135e},_0x2076fb[_0x467e2d(0x171)]);if(_0x1ffbe9[_0x467e2d(0xe8)]!==0x1)throw new Error(_0x1ffbe9[_0x467e2d(0x1b4)]);return!![];}catch(_0x231d6f){throw new common_1[(_0x467e2d(0x174))](_0x231d6f[_0x467e2d(0x1de)],common_1[_0x467e2d(0x258)][_0x467e2d(0x1ea)]);}}async[_0x32b9f0(0x1cd)](_0x5536ee){const _0x531119=_0x32b9f0,{id:_0x1cfe64}=_0x5536ee;try{const _0x3076b4=await this[_0x531119(0x1e2)]['findOne']({'where':{'id':Number(_0x1cfe64)}});if(!_0x3076b4)throw new Error('账号不存在');common_1[_0x531119(0x16f)][_0x531119(0xce)](_0x531119(0x219),_0x3076b4[_0x531119(0x171)]);const _0x3d633b=await this['mjpAccountService']['delete']({},_0x3076b4[_0x531119(0x171)]);if(_0x3d633b['code']!==0x1)throw new Error(_0x3d633b[_0x531119(0x1b4)]);const _0x28095a=await this[_0x531119(0x1e2)]['delete']({'id':_0x1cfe64});return _0x28095a[_0x531119(0x168)];}catch(_0xb4cee2){throw new common_1[(_0x531119(0x174))](_0xb4cee2[_0x531119(0x1de)],common_1[_0x531119(0x258)][_0x531119(0x1ea)]);}}async['setMjAccountEnable'](_0x5b1ca6){const _0x4fef05=_0x32b9f0,{id:_0x837ec5,enable:_0x33029a}=_0x5b1ca6;return await this[_0x4fef05(0x1e2)]['update'](_0x837ec5,{'enable':_0x33029a})[_0x4fef05(0x1e8)](_0x4213e8=>_0x4213e8[_0x4fef05(0x168)]>0x0);}async[_0x32b9f0(0xbe)](_0x52bc4d,_0x40b0a9){const _0x39d87e=_0x32b9f0,_0x4ef171=(0x0,utils_1[_0x39d87e(0x271)])(this['clsService']),{id:_0x5a2a31}=_0x52bc4d;let _0x26ba50=null;try{const _0x6788d6=await this[_0x39d87e(0x1e2)][_0x39d87e(0x252)]({'where':{'id':_0x5a2a31}});return _0x4ef171&&(_0x26ba50=await this['mjpAccountService'][_0x39d87e(0x201)]({},_0x6788d6[_0x39d87e(0x171)])),{..._0x6788d6,'mjpAccountInfo':_0x26ba50,'authorization':_0x4ef171?_0x6788d6[_0x39d87e(0x1f5)]:(0x0,utils_1[_0x39d87e(0x176)])(_0x6788d6[_0x39d87e(0x1f5)]),'guildId':_0x4ef171?_0x6788d6[_0x39d87e(0x234)]:(0x0,utils_1['hideString'])(_0x6788d6[_0x39d87e(0x234)]),'channelId':_0x4ef171?_0x6788d6[_0x39d87e(0x22d)]:(0x0,utils_1[_0x39d87e(0x176)])(_0x6788d6[_0x39d87e(0x22d)])};}catch(_0x44c162){throw new common_1['HttpException'](_0x44c162,common_1[_0x39d87e(0x258)][_0x39d87e(0x1ea)]);}}async[_0x32b9f0(0x10e)](_0x52cead,_0xf7803e){const _0x11b75a=_0x32b9f0,{page:page=0x1,size:size=0x14,account:_0xc5c8c7,channelId:_0x5aafff,enable:_0x15962d}=_0x52cead;if(!page||!size)throw new common_1[(_0x11b75a(0x174))](_0x11b75a(0x1be),common_1[_0x11b75a(0x258)][_0x11b75a(0x1ea)]);const _0x55f6b8={};_0xc5c8c7&&Object[_0x11b75a(0x1c2)](_0x55f6b8,{'account':(0x0,typeorm_2[_0x11b75a(0x200)])('%'+_0xc5c8c7+'%')}),_0x5aafff&&Object[_0x11b75a(0x1c2)](_0x55f6b8,{'channelId':(0x0,typeorm_2['Like'])('%'+_0x5aafff+'%')}),_0x15962d>0x0&&Object[_0x11b75a(0x1c2)](_0x55f6b8,{'enable':_0x15962d});const [_0x2507c2,_0x138eb5]=await this[_0x11b75a(0x1e2)]['findAndCount']({'skip':(page-0x1)*size,'where':_0x55f6b8,'take':size,'order':{'createdAt':'DESC'},'cache':!![],'select':['id',_0x11b75a(0x234),_0x11b75a(0x22d),'authorization',_0x11b75a(0x15e),_0x11b75a(0xba),_0x11b75a(0x20b),'fastRemainTime',_0x11b75a(0xfb),_0x11b75a(0xb1),_0x11b75a(0x13d),_0x11b75a(0x101)]});return(0x0,utils_1['isSuper'])(this[_0x11b75a(0x20c)])?{'rows':_0x2507c2||[],'count':_0x138eb5||0x0}:{'rows':_0x2507c2[_0x11b75a(0x24d)](_0x4cf586=>({..._0x4cf586,'authorization':(0x0,utils_1[_0x11b75a(0x176)])(_0x4cf586[_0x11b75a(0x1f5)]),'guildId':(0x0,utils_1[_0x11b75a(0x176)])(_0x4cf586[_0x11b75a(0x234)]),'channelId':(0x0,utils_1['hideString'])(_0x4cf586[_0x11b75a(0x22d)])}))||[],'count':_0x138eb5||0x0};}async[_0x32b9f0(0x128)](_0x58936,_0x1f39fe){const _0x222008=_0x32b9f0;try{const _0x43cc2f=(0x0,utils_1[_0x222008(0x17e)])(this[_0x222008(0x20c)]),{page:page=0x1,size:size=0x14,botType:_0xfdadbd,action:_0x43be62,keyword:_0xa36379,userId:_0x19fdd2,rec:_0x540f73,status:_0xa1cf0e,squareType:_0x3fcfff,workflowId:_0x4c3b56,saasId:_0x82715f}=_0x58936,_0x2ddf93={};_0xfdadbd&&_0xfdadbd[_0x222008(0x19e)]&&(_0x2ddf93[_0x222008(0x23f)]=(0x0,typeorm_2['In'])(_0xfdadbd));_0x43be62&&(_0x2ddf93[_0x222008(0x260)]=_0x43be62);_0xa36379&&(_0x2ddf93['originPrompt']=(0x0,typeorm_2[_0x222008(0x200)])('%'+_0xa36379+'%'));_0x19fdd2&&(_0x2ddf93[_0x222008(0x1e5)]=_0x19fdd2);_0x3fcfff&&(_0x2ddf93['squareType']=_0x3fcfff);_0x4c3b56&&(_0x2ddf93[_0x222008(0x155)]=_0x4c3b56);_0x540f73!==null&&_0x540f73!==undefined&&(_0x2ddf93['rec']=_0x540f73);_0x540f73!==null&&_0xa1cf0e!==undefined&&(_0x2ddf93[_0x222008(0x266)]=_0xa1cf0e);(0x0,utils_1[_0x222008(0x1aa)])(this['clsService'])?(0x0,utils_1['isDefined'])(_0x82715f)&&(_0x2ddf93['saasId']=_0x82715f):_0x2ddf93[_0x222008(0x186)]=_0x43cc2f;const [_0x4723d0,_0x3efa19]=await this[_0x222008(0x154)][_0x222008(0x205)]({'where':_0x2ddf93,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':'DESC'}}),_0x3fff44=new Map(),_0x23720a=_0x4723d0['map'](_0x1a8370=>_0x1a8370[_0x222008(0x155)])['filter'](_0x3fd973=>Boolean(_0x3fd973));if(_0x23720a[_0x222008(0x19e)]){const _0x202743=await this[_0x222008(0x1e3)][_0x222008(0x198)](_0x23720a);_0x202743[_0x222008(0x203)](_0x358ec7=>_0x3fff44[_0x222008(0xe0)](_0x358ec7['id'],_0x358ec7));}const _0x1e9695=_0x4723d0[_0x222008(0x24d)](_0x1cce20=>{const _0x50ab9d=_0x222008;return{..._0x1cce20,'workflowName':_0x3fff44[_0x50ab9d(0xf8)](_0x1cce20[_0x50ab9d(0x155)])?.[_0x50ab9d(0x1b8)]||''};});if(_0x1f39fe){const _0x12172f=_0x1e9695[_0x222008(0x24d)](_0x377b9b=>_0x377b9b[_0x222008(0x1e5)]),_0x122b28=await this['userService'][_0x222008(0x1b6)](_0x12172f);_0x1e9695[_0x222008(0x203)](_0x56246e=>{const _0x81c93d=_0x222008,_0x28f056=_0x122b28[_0x81c93d(0xd1)](_0x429f7f=>_0x429f7f['id']===_0x56246e[_0x81c93d(0x1e5)]);!(0x0,utils_1[_0x81c93d(0x271)])(this['clsService'])&&(_0x28f056[_0x81c93d(0x24c)]=(0x0,utils_1[_0x81c93d(0x176)])(_0x28f056[_0x81c93d(0x24c)]),_0x28f056[_0x81c93d(0x1fb)]=(0x0,utils_1[_0x81c93d(0x176)])(_0x28f056[_0x81c93d(0x1fb)])),_0x56246e[_0x81c93d(0x190)]=_0x28f056;});}return{'rows':_0x1e9695,'count':_0x3efa19};}catch(_0x57c03f){throw new common_1[(_0x222008(0x174))](_0x57c03f['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x32b9f0(0x25a)](_0x483cef){const _0x2e089c=_0x32b9f0,_0x3cd289=await this[_0x2e089c(0x27e)][_0x2e089c(0x107)](['mjLimitCount']),_0x523209=Number(_0x3cd289||0x0);if(_0x523209===0x0)return!![];const _0x311bb0=await this[_0x2e089c(0x154)][_0x2e089c(0x253)]({'where':{'userId':_0x483cef,'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6])}});if(_0x311bb0<_0x523209)return!![];else throw new Error('任务已达最大并发数，请等待其他任务完成后再提交新任务！');}async[_0x32b9f0(0x11f)](_0x1527d4){const _0x1731d8=_0x32b9f0;if(store_1['MjConfig'][_0x1731d8(0x246)]!==_0x1731d8(0x18d))return null;if(process[_0x1731d8(0x181)][_0x1731d8(0x26f)]===_0x1731d8(0xf3)){if(_0x1527d4===0x0)return{'modes':[_0x1731d8(0x223)]};if(_0x1527d4===0x1)return{'modes':[_0x1731d8(0x1c7)]};if(_0x1527d4===0x2)return{'modes':['RELAX']};if(_0x1527d4===0x3)return{'modes':[_0x1731d8(0x272)]};}const _0x22a6ea=await this[_0x1731d8(0x1e2)][_0x1731d8(0xd1)]({'where':{'enable':0x1,'mode':_0x1527d4,'fastRemainTime':(0x0,typeorm_2[_0x1731d8(0x123)])((0x0,typeorm_2[_0x1731d8(0x1da)])())},'order':{'weight':'DESC'}});if(!_0x22a6ea[_0x1731d8(0x19e)])throw new Error('没有满足条件的MJ账号，请联系管理员！');const [_0x4817df]=await this[_0x1731d8(0x1d6)][_0x1731d8(0xc1)](_0x1731d8(0x14c));if(!_0x4817df)return{'instanceId':_0x22a6ea[0x0][_0x1731d8(0x171)]};else{const _0xd41e47=_0x22a6ea[_0x1731d8(0xd1)](_0xcda39d=>_0xcda39d[_0x1731d8(0x171)]===_0x4817df[_0x1731d8(0x171)]);if(!_0xd41e47)throw new Error(_0x1731d8(0x148));return{'instanceId':_0xd41e47['mjpId']};}}async[_0x32b9f0(0x265)](_0x1faa69,_0x36b132){const _0x2d04a7=_0x32b9f0,_0x5a8e08=await this[_0x2d04a7(0x154)][_0x2d04a7(0x253)]({'where':{'originTaskId':String(_0x1faa69),'customId':_0x36b132}});if(_0x5a8e08>0x0)throw new common_1['HttpException'](_0x2d04a7(0x1ad),common_1['HttpStatus'][_0x2d04a7(0x1ea)]);return![];}async[_0x32b9f0(0xca)](_0x30fe0f){const _0x3bc62e=_0x32b9f0,_0x263eb3=new addDrawQueue_dto_1['AddDrawQueueDto'](_0x30fe0f);await this['badwordsService'][_0x3bc62e(0x18f)](_0x263eb3['fullPrompt'],_0x263eb3[_0x3bc62e(0x1e5)]);const _0x4f46e2=(0x0,utils_1[_0x3bc62e(0x17e)])(this[_0x3bc62e(0x20c)]);_0x263eb3[_0x3bc62e(0x186)]=_0x4f46e2;const _0x12f03d=await this[_0x3bc62e(0x154)]['save'](_0x263eb3);return _0x12f03d;}async[_0x32b9f0(0x1dc)](_0x53a9d9,_0x24ea74){const _0x4aed70=_0x32b9f0;let _0x401cc1,{botType:_0x1a72e7,prompt:_0x5ac93a,extend:_0x564eb1,action:_0x5ccf3d,mode:_0x62221,translate:_0x5ce3c4,base64Array:_0x26d1e9,mats:mats=[],iw:_0x3ba92d,roles:roles=[],cw:_0x263fb4,styles:styles=[],sw:_0x145308}=_0x24ea74;await this[_0x4aed70(0x15b)][_0x4aed70(0x1e1)](_0x53a9d9[_0x4aed70(0xea)]['id'],_0x62221,_0x4aed70(0x130));const _0x485e1c=_0x5ac93a,_0x2f4be1=await this[_0x4aed70(0x11f)](_0x62221);_0x5ac93a&&await this[_0x4aed70(0xef)][_0x4aed70(0x18f)](_0x5ac93a,_0x53a9d9[_0x4aed70(0xea)]['id']),_0x5ac93a=_0x5ce3c4===0x1&&(0x0,utils_1['isChinese'])(_0x5ac93a)?await this['fanyiService'][_0x4aed70(0x225)](_0x5ac93a):_0x5ac93a;let _0x4a527f=_0x5ac93a;mats[_0x4aed70(0x19e)]&&(_0x4a527f=mats[_0x4aed70(0x1f7)]('\x20')+'\x20'+_0x4a527f);_0x3ba92d&&(_0x4a527f=_0x4a527f+'\x20--iw\x20'+_0x3ba92d);styles[_0x4aed70(0x19e)]&&(_0x4a527f=_0x4a527f+_0x4aed70(0x214)+styles[_0x4aed70(0x1f7)]('\x20'));roles[_0x4aed70(0x19e)]&&(_0x4a527f=_0x4a527f+_0x4aed70(0x262)+roles[_0x4aed70(0x1f7)]('\x20'));_0x263fb4&&(_0x4a527f=_0x4a527f+_0x4aed70(0x242)+_0x263fb4);_0x145308&&(_0x4a527f=_0x4a527f+_0x4aed70(0x20d)+_0x145308);_0x564eb1&&(_0x4a527f=_0x4a527f+'\x20'+_0x564eb1);const _0x347de0=await this[_0x4aed70(0x1f4)]['imagine']({'data':{'mode':this[_0x4aed70(0x1a4)](_0x62221),'prompt':_0x4a527f,'botType':_0x1a72e7||_0x4aed70(0x215),'base64Array':_0x26d1e9,'accountFilter':_0x2f4be1}});if(_0x347de0['code']===0x17)throw new Error(_0x4aed70(0x112));if(_0x347de0[_0x4aed70(0xe8)]===0x18)throw new Error(_0x4aed70(0xcb));if(_0x347de0[_0x4aed70(0xe8)]!==0x1&&_0x347de0[_0x4aed70(0xe8)]!==0x16)throw new Error(_0x347de0[_0x4aed70(0x1b4)]);return _0x401cc1=await this[_0x4aed70(0x1d6)][_0x4aed70(0x110)](async()=>{const _0x2245e7=_0x4aed70,_0x21bfa8={'mode':_0x62221,'prompt':_0x5ac93a,'action':_0x5ccf3d,'translate':_0x5ce3c4,'fullPrompt':_0x4a527f,'originPrompt':_0x485e1c,'extraParam':_0x564eb1,'userId':_0x53a9d9['user']['id'],'mjpId':_0x2f4be1[_0x2245e7(0x16d)],'mjpTaskId':_0x347de0[_0x2245e7(0x1e4)],'botType':_0x1a72e7||'MID_JOURNEY'},_0x192e7d=await this['addDrawQueue'](_0x21bfa8);if(!_0x192e7d)throw new Error(_0x2245e7(0x184));return await this[_0x2245e7(0x15b)][_0x2245e7(0x1ed)](_0x53a9d9[_0x2245e7(0xea)]['id'],_0x62221,_0x2245e7(0x130),_0x192e7d['id']),_0x192e7d;}),_0x401cc1;}async[_0x32b9f0(0xb0)](_0xa3cb96,_0x24987f){const _0x1c6cc2=_0x32b9f0;let _0x3efba1;const {action:_0x1c1f85,taskId:_0x246356,customId:_0x197388,prompt:_0x16086,mask:_0x19ca97}=_0x24987f;await this[_0x1c6cc2(0x265)](_0x246356,_0x197388);const _0x6d0388=await this[_0x1c6cc2(0x154)][_0x1c6cc2(0x252)]({'where':{'id':_0x246356}});if(!_0x6d0388)throw new Error(_0x1c6cc2(0x1a1));await this['userService'][_0x1c6cc2(0x1e1)](_0xa3cb96[_0x1c6cc2(0xea)]['id'],_0x6d0388[_0x1c6cc2(0x101)],_0x197388);const _0x2e515f=await this[_0x1c6cc2(0x1f4)][_0x1c6cc2(0x260)]({'data':{'customId':_0x197388,'taskId':_0x6d0388[_0x1c6cc2(0x1a7)],'accountFilter':{'instanceId':_0x6d0388['mjpId']},'mode':this[_0x1c6cc2(0x1a4)](_0x6d0388[_0x1c6cc2(0x101)])}});if(_0x2e515f['code']===0x17)throw new Error(_0x1c6cc2(0x112));else{if(_0x2e515f[_0x1c6cc2(0xe8)]===0x18)throw new Error(_0x1c6cc2(0xcb));else{if(_0x2e515f[_0x1c6cc2(0xe8)]===0x15)setTimeout(()=>this[_0x1c6cc2(0x19f)](_0x2e515f['result']));else{if(_0x2e515f[_0x1c6cc2(0xe8)]!==0x1&&_0x2e515f['code']!==0x16)throw new Error(_0x2e515f['description']);}}}return _0x3efba1=await this[_0x1c6cc2(0x1d6)][_0x1c6cc2(0x110)](async()=>{const _0x52a299=_0x1c6cc2,_0x2f50f5={'action':_0x1c1f85,'customId':_0x197388,'userId':_0xa3cb96[_0x52a299(0xea)]['id'],'mjpTaskId':_0x2e515f[_0x52a299(0x1e4)],'originTaskId':String(_0x246356),'mode':_0x6d0388[_0x52a299(0x101)],'mjpId':_0x6d0388[_0x52a299(0x171)],'prompt':_0x6d0388[_0x52a299(0x251)],'botType':_0x6d0388[_0x52a299(0x23f)],'extraParam':_0x6d0388['extraParam'],'fullPrompt':_0x6d0388[_0x52a299(0x1c6)],'originPrompt':_0x6d0388['originPrompt']},_0x44c063=await this['addDrawQueue'](_0x2f50f5);if(!_0x44c063)throw new Error(_0x52a299(0x169));const _0x11795a=_0x6d0388[_0x52a299(0x211)];return _0x6d0388[_0x52a299(0x211)][_0x52a299(0x203)](_0x595729=>{const _0x5de790=_0x52a299;_0x595729['customId']===_0x24987f[_0x5de790(0x18b)]&&(_0x595729['operated']=!![]);}),await this[_0x52a299(0x154)][_0x52a299(0x1ae)](_0x6d0388),await this[_0x52a299(0x15b)][_0x52a299(0x1ed)](_0xa3cb96[_0x52a299(0xea)]['id'],_0x6d0388[_0x52a299(0x101)],_0x197388,_0x44c063['id']),_0x44c063;}),_0x3efba1;}async[_0x32b9f0(0x269)](_0x50348a,_0x1f1224){const _0x2bf1ab=_0x32b9f0;let _0x38be22,{action:_0x15c176,taskId:_0x3985bd,customId:_0x57a89a,prompt:_0x49b4bc,mask:_0x3cb1e0}=_0x1f1224;const _0x231a5c=await this[_0x2bf1ab(0x154)]['findOne']({'where':{'id':_0x3985bd}});if(!_0x231a5c)throw new Error(_0x2bf1ab(0x1a1));const _0x375d19=_0x49b4bc;_0x49b4bc&&await this[_0x2bf1ab(0xef)]['checkBadWords'](_0x49b4bc,_0x50348a[_0x2bf1ab(0xea)]['id']),_0x49b4bc=(0x0,utils_1[_0x2bf1ab(0x152)])(_0x49b4bc)?await this['fanyiService']['convertToEnglish'](_0x49b4bc):_0x49b4bc;const _0x5ab165=await this[_0x2bf1ab(0x1f4)][_0x2bf1ab(0x1b1)]({'data':{'prompt':_0x49b4bc,'maskBase64':_0x3cb1e0,'taskId':_0x231a5c[_0x2bf1ab(0x1a7)]}});if(_0x5ab165[_0x2bf1ab(0xe8)]!==0x1&&_0x5ab165[_0x2bf1ab(0xe8)]!==0x16)throw new Error(_0x5ab165[_0x2bf1ab(0x1b4)]);_0x38be22=await this['midjourneyEntity']['save']({'id':_0x3985bd,'prompt':_0x49b4bc,'status':0x1,'originPrompt':_0x375d19,'messageFlags':0x1});for(let _0x4ab3da in _0x38be22){_0x38be22[_0x4ab3da]&&(_0x231a5c[_0x4ab3da]=_0x38be22[_0x4ab3da]);}return _0x231a5c;}async[_0x32b9f0(0x12d)](_0x2c0a27,_0x296915){const _0x4bb2d1=_0x32b9f0;let _0x31aaa8,_0x1bb57f;try{let {type:_0x1a93ed,params:_0x18d1f4}=_0x2c0a27;await this[_0x4bb2d1(0x15b)][_0x4bb2d1(0x236)](_0x296915[_0x4bb2d1(0xea)]),await this['concurrentLimit'](_0x296915[_0x4bb2d1(0xea)]['id']);if(_0x1a93ed===midjourney_constant_1['MidJourneyDrawEnum']['TEXT_TO_IMAGE'])_0x1bb57f=await this[_0x4bb2d1(0x1dc)](_0x296915,_0x18d1f4),_0x31aaa8=_0x1bb57f[_0x4bb2d1(0x1a7)];else{if(_0x1a93ed===midjourney_constant_1[_0x4bb2d1(0x113)]['IMAGE_ACTION'])_0x18d1f4=_0x18d1f4,_0x18d1f4[_0x4bb2d1(0x18b)]?(_0x1bb57f=await this[_0x4bb2d1(0xb0)](_0x296915,_0x18d1f4),_0x18d1f4[_0x4bb2d1(0x251)]&&(_0x18d1f4['taskId']=_0x1bb57f['id'],_0x1bb57f=await this[_0x4bb2d1(0x269)](_0x296915,_0x18d1f4))):_0x1bb57f=await this[_0x4bb2d1(0x269)](_0x296915,_0x18d1f4),_0x31aaa8=_0x1bb57f['mjpTaskId'];else return new common_1[(_0x4bb2d1(0x174))](_0x4bb2d1(0x12a),common_1[_0x4bb2d1(0x258)][_0x4bb2d1(0x1ea)]);}return _0x1bb57f;}catch(_0x31a886){if(_0x31a886 instanceof common_1[_0x4bb2d1(0x174)])throw _0x31a886;else{_0x31aaa8&&await this[_0x4bb2d1(0x1f4)][_0x4bb2d1(0x162)]({},_0x31aaa8);throw new common_1[(_0x4bb2d1(0x174))](_0x31a886['message'],common_1[_0x4bb2d1(0x258)]['BAD_REQUEST']);}}}async[_0x32b9f0(0x23d)](_0x4dce9d,_0xec545e){const _0x61f146=_0x32b9f0;let _0x488cbf,_0x6d5143;try{const {type:_0x43eef5,botType:_0x3ecd27,files:_0x333ed7,mode:_0xbd7fb9,action:_0x10f698,size:_0x34effd,base64Array:base64Array=[]}=_0x4dce9d;await this[_0x61f146(0x15b)][_0x61f146(0x236)](_0xec545e[_0x61f146(0xea)]),await this[_0x61f146(0x25a)](_0xec545e[_0x61f146(0xea)]['id']);let _0x4ec434='';if(Number(_0x43eef5)===midjourney_constant_1[_0x61f146(0x113)][_0x61f146(0x121)])_0x4ec434=_0x61f146(0x13e);else Number(_0x43eef5)===midjourney_constant_1[_0x61f146(0x113)][_0x61f146(0x264)]&&(_0x4ec434='Describe');await this['userService'][_0x61f146(0x1e1)](_0xec545e[_0x61f146(0xea)]['id'],_0xbd7fb9,_0x4ec434);const _0x2c6f14=await this[_0x61f146(0x11f)](_0xbd7fb9);if(!base64Array[_0x61f146(0x19e)])for(let _0xcf6102=0x0;_0xcf6102<_0x333ed7[_0x61f146(0x19e)];_0xcf6102++){base64Array['push']('data:image/png;base64,'+_0x333ed7[_0xcf6102][_0x61f146(0x197)][_0x61f146(0xdc)](_0x61f146(0x1ac)));}if(Number(_0x43eef5)===midjourney_constant_1[_0x61f146(0x113)]['IMAGE_MIX_IMAGE']){if(base64Array[_0x61f146(0x19e)]<0x2)throw new Error(_0x61f146(0x1f1));const _0x50b5d7=await this[_0x61f146(0x1f4)][_0x61f146(0x178)]({'data':{'mode':this['convertMode4Transfer'](_0xbd7fb9),'dimensions':_0x34effd,'botType':_0x61f146(0x215),'base64Array':base64Array,'accountFilter':_0x2c6f14}});if(_0x50b5d7[_0x61f146(0xe8)]===0x17)throw new Error(_0x61f146(0x112));if(_0x50b5d7[_0x61f146(0xe8)]!==0x1&&_0x50b5d7[_0x61f146(0xe8)]!==0x16)throw new Error(_0x50b5d7[_0x61f146(0x1b4)]);_0x488cbf=_0x50b5d7[_0x61f146(0x1e4)],_0x6d5143=await this[_0x61f146(0x1d6)][_0x61f146(0x110)](async()=>{const _0x5f2e7c=_0x61f146,_0x10a01d={'mode':_0xbd7fb9,'action':_0x10f698,'userId':_0xec545e[_0x5f2e7c(0xea)]['id'],'jobId':(0x0,utils_1[_0x5f2e7c(0x114)])(),'botType':_0x3ecd27||_0x5f2e7c(0x215),'extraParam':JSON[_0x5f2e7c(0x105)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x50b5d7[_0x5f2e7c(0x1e4)]},_0x44fa4d=await this[_0x5f2e7c(0xca)](_0x10a01d);if(!_0x44fa4d)throw new Error(_0x5f2e7c(0xde));return await this[_0x5f2e7c(0x15b)]['deductBalance4MJ'](_0xec545e[_0x5f2e7c(0xea)]['id'],_0xbd7fb9,_0x4ec434,_0x44fa4d['id']),_0x44fa4d;});}else{if(Number(_0x43eef5)===midjourney_constant_1[_0x61f146(0x113)]['IMAGE_TO_TEXT']){const _0x32ce8b=await this['mjpTaskService'][_0x61f146(0xf4)]({'data':{'mode':this[_0x61f146(0x1a4)](_0xbd7fb9),'botType':'MID_JOURNEY','base64':base64Array[0x0],'accountFilter':_0x2c6f14}});if(_0x32ce8b[_0x61f146(0xe8)]===0x17)throw new Error('队列已满，请稍后尝试');if(_0x32ce8b[_0x61f146(0xe8)]!==0x1&&_0x32ce8b[_0x61f146(0xe8)]!==0x16)throw new Error(_0x32ce8b[_0x61f146(0x1b4)]);_0x488cbf=_0x32ce8b[_0x61f146(0x1e4)],_0x6d5143=await this['connection'][_0x61f146(0x110)](async()=>{const _0x5b8019=_0x61f146,_0x444247={'mode':_0xbd7fb9,'action':_0x10f698,'userId':_0xec545e[_0x5b8019(0xea)]['id'],'jobId':(0x0,utils_1['createRandomUid'])(),'botType':_0x3ecd27||_0x5b8019(0x215),'extraParam':JSON['stringify']({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x32ce8b[_0x5b8019(0x1e4)]},_0x1763e9=await this[_0x5b8019(0xca)](_0x444247);if(!_0x1763e9)throw new Error('创建图生文任务失败');return await this[_0x5b8019(0x15b)][_0x5b8019(0x1ed)](_0xec545e[_0x5b8019(0xea)]['id'],_0xbd7fb9,_0x4ec434,_0x1763e9['id']),_0x1763e9;})[_0x61f146(0xb2)](async _0x43b59=>{const _0x2c5e95=_0x61f146;await this[_0x2c5e95(0x1f4)]['cancel']({},_0x32ce8b[_0x2c5e95(0x1e4)]);throw _0x43b59;});}else return new common_1['HttpException'](_0x61f146(0x12a),common_1[_0x61f146(0x258)][_0x61f146(0x1ea)]);}return _0x6d5143;}catch(_0x2a3f3d){if(_0x2a3f3d instanceof common_1['HttpException'])throw _0x2a3f3d;else{_0x488cbf&&await this[_0x61f146(0x1f4)]['cancel']({},_0x488cbf);throw new common_1[(_0x61f146(0x174))](_0x2a3f3d[_0x61f146(0x1de)],common_1['HttpStatus'][_0x61f146(0x1ea)]);}}}async['insightFace'](_0x241374,_0x3637fb){const _0x7d0746=_0x32b9f0;let _0x3c4040;try{const {params:_0x2b3247}=_0x241374,{mode:_0x4bd893,botType:_0x1e471b,action:_0x15fbd3,extend:_0x57b7f2,sourceBase64:_0x2e3e00,targetBase64:_0x4c7c02}=_0x2b3247;await this[_0x7d0746(0x15b)][_0x7d0746(0x236)](_0x3637fb[_0x7d0746(0xea)]),await this[_0x7d0746(0x25a)](_0x3637fb[_0x7d0746(0xea)]['id']),await this['userService'][_0x7d0746(0x1e1)](_0x3637fb['user']['id'],_0x4bd893,'FaceSwap');const _0x1a416b=await this[_0x7d0746(0x11f)](_0x4bd893),_0x26172e=await this[_0x7d0746(0x1f4)][_0x7d0746(0x199)]({'data':{'sourceBase64':_0x2e3e00,'targetBase64':_0x4c7c02,'state':_0x57b7f2,'mode':this[_0x7d0746(0x1a4)](_0x4bd893),'accountFilter':_0x1a416b}});if(_0x26172e[_0x7d0746(0xe8)]===0x17)throw new Error(_0x7d0746(0x112));if(_0x26172e[_0x7d0746(0xe8)]===0x18)throw new Error('prompt包含敏感词');if(_0x26172e[_0x7d0746(0xe8)]!==0x1&&_0x26172e[_0x7d0746(0xe8)]!==0x16)throw new Error(_0x26172e[_0x7d0746(0x1b4)]);return _0x3c4040=await this[_0x7d0746(0x1d6)][_0x7d0746(0x110)](async()=>{const _0x31e5ea=_0x7d0746,_0x1af9b5={'mode':_0x4bd893,'action':_0x15fbd3,'prompt':null,'extraParam':_0x57b7f2,'originPrompt':null,'userId':_0x3637fb[_0x31e5ea(0xea)]['id'],'mjpId':_0x1a416b['instanceId'],'mjpTaskId':_0x26172e[_0x31e5ea(0x1e4)],'botType':_0x1e471b||_0x31e5ea(0x215)},_0x1f13de=new addDrawQueue_dto_1[(_0x31e5ea(0x1b0))](_0x1af9b5),_0x472669=(0x0,utils_1[_0x31e5ea(0x17e)])(this['clsService']);_0x1f13de[_0x31e5ea(0x186)]=_0x472669;const _0x130f58=await this[_0x31e5ea(0x154)]['save'](_0x1f13de);if(!_0x130f58)throw new Error(_0x31e5ea(0x184));return await this[_0x31e5ea(0x15b)][_0x31e5ea(0x1ed)](_0x3637fb[_0x31e5ea(0xea)]['id'],_0x4bd893,_0x31e5ea(0x13f),_0x130f58['id']),_0x130f58;}),_0x3c4040;}catch(_0x40d587){if(_0x40d587 instanceof common_1[_0x7d0746(0x174)])throw _0x40d587;else throw new common_1[(_0x7d0746(0x174))](_0x40d587[_0x7d0746(0x1de)],common_1[_0x7d0746(0x258)][_0x7d0746(0x1ea)]);}}async[_0x32b9f0(0x27d)](_0x10224a,_0x4ff848){const _0x2d9117=_0x32b9f0,_0x5b0a23=(0x0,utils_1[_0x2d9117(0x17e)])(this['clsService']),_0x33ee40={'userId':_0x4ff848[_0x2d9117(0xea)]['id'],'jobId':(0x0,utils_1['createRandomUid'])(),'mode':0x1,'translate':0x0,'prompt':'','progress':0x64,'durationSpent':0x0,'status':0x3,'fullPrompt':_0x10224a['prompt'],'originPrompt':_0x10224a['prompt'],'fileInfo':_0x10224a[_0x2d9117(0x158)],'botType':_0x10224a[_0x2d9117(0x23f)],'imageUrl':_0x10224a[_0x2d9117(0xf1)],'buttons':[],'saasId':_0x5b0a23},_0x5bb277=await this['midjourneyEntity'][_0x2d9117(0x1ae)](_0x33ee40);return _0x5bb277;}async['imageSeed'](_0x1ccd90){const _0x57e85c=_0x32b9f0;try{const _0x3a7124=await this[_0x57e85c(0x154)][_0x57e85c(0x252)]({'where':{'jobId':_0x1ccd90}});if(!_0x3a7124)throw new Error(_0x57e85c(0x187));const _0x2c8b92=await this[_0x57e85c(0x1f4)][_0x57e85c(0x18a)]({},_0x3a7124[_0x57e85c(0x1a7)]);if(_0x2c8b92[_0x57e85c(0xe8)]!==0x1)throw new Error(_0x2c8b92[_0x57e85c(0x1b4)]);return _0x2c8b92[_0x57e85c(0x1e4)];}catch(_0x2f4e33){throw new common_1[(_0x57e85c(0x174))](_0x2f4e33[_0x57e85c(0x1de)],common_1[_0x57e85c(0x258)][_0x57e85c(0x1ea)]);}}async['getOneDraw'](_0x4e0c89,_0x21d9d0){const _0x2de0dd=_0x32b9f0;try{let _0xc9209a,_0x28b545,_0x29e8b2,_0x2cfc5b;const {jobId:_0x594142,detail:_0x588fa4}=_0x21d9d0,_0x370282=(0x0,utils_1[_0x2de0dd(0xb9)])(this[_0x2de0dd(0x20c)]),_0x394285=await this[_0x2de0dd(0x154)]['findOne']({'where':{'jobId':_0x594142}});if(_0x394285[_0x2de0dd(0x155)]){const _0x20f65f=await this[_0x2de0dd(0x1e3)][_0x2de0dd(0x21e)](_0x394285['workflowId']);_0x2cfc5b=_0x20f65f['modelName'];}return _0x588fa4&&(this[_0x2de0dd(0x25f)][_0x2de0dd(0x138)](model_constant_1[_0x2de0dd(0x11e)]['DRAW'],_0x394285['id']),_0xc9209a=await this[_0x2de0dd(0x15b)]['getUserById'](_0x394285[_0x2de0dd(0x1e5)]),_0x28b545=await this[_0x2de0dd(0x25f)][_0x2de0dd(0x12c)](model_constant_1[_0x2de0dd(0x11e)]['DRAW'],_0x394285['id']),_0x370282&&(_0x29e8b2=await this[_0x2de0dd(0x25f)][_0x2de0dd(0x1af)](model_constant_1[_0x2de0dd(0x11e)][_0x2de0dd(0x13b)],_0x394285['id']))),{..._0x394285,'workflowName':_0x2cfc5b,'avatar':_0xc9209a?_0xc9209a['avatar']:null,'username':_0xc9209a?_0xc9209a[_0x2de0dd(0x116)]:null,'nickname':_0xc9209a?_0xc9209a[_0x2de0dd(0x239)]:null,'visitNum':_0x28b545?_0x28b545['visitNum']:0x0,'agreeNum':_0x28b545?_0x28b545['agreeNum']:0x0,'agree':_0x29e8b2?_0x29e8b2[_0x2de0dd(0x260)]:null};}catch(_0x4ddf3f){throw new common_1[(_0x2de0dd(0x174))](_0x4ddf3f[_0x2de0dd(0x1de)],common_1['HttpStatus'][_0x2de0dd(0x1ea)]);}}async[_0x32b9f0(0xd5)](_0x26c62e,_0x26eb64){const _0x4ffb6b=_0x32b9f0;try{if(!_0x26eb64[_0x4ffb6b(0x23b)]||!_0x26eb64[_0x4ffb6b(0x23b)]['length'])return[];const _0x59f2a7=_0x26eb64[_0x4ffb6b(0x23b)][_0x4ffb6b(0x1d1)](','),_0x1f7076=await this[_0x4ffb6b(0x154)][_0x4ffb6b(0xd1)]({'where':{'jobId':(0x0,typeorm_2['In'])(_0x59f2a7)}}),_0x33fbe2=new Map(),_0x275ca9=_0x1f7076[_0x4ffb6b(0x24d)](_0x30c60b=>_0x30c60b[_0x4ffb6b(0x155)])['filter'](_0x4dd1f3=>Boolean(_0x4dd1f3));if(_0x275ca9['length']){const _0x3a0cfd=await this[_0x4ffb6b(0x1e3)][_0x4ffb6b(0x198)](_0x275ca9);_0x3a0cfd[_0x4ffb6b(0x203)](_0x3c6cbe=>_0x33fbe2['set'](_0x3c6cbe['id'],_0x3c6cbe));}return _0x1f7076[_0x4ffb6b(0x24d)](_0x26650f=>{const _0xd44611=_0x4ffb6b;return{..._0x26650f,'workflowName':_0x33fbe2[_0xd44611(0xf8)](_0x26650f['workflowId'])?.['modelName']||''};});}catch(_0x315a25){throw new common_1[(_0x4ffb6b(0x174))](_0x315a25[_0x4ffb6b(0x1de)],common_1[_0x4ffb6b(0x258)][_0x4ffb6b(0x1ea)]);}}async[_0x32b9f0(0xcc)](_0x53f58b){const _0x4cffb2=_0x32b9f0,{id:_0x3b40a8,squareType:_0x4ba714}=_0x53f58b,_0x51c82a=await this[_0x4cffb2(0x154)][_0x4cffb2(0x252)]({'where':{'id':_0x3b40a8,'status':midjourney_constant_1['MidjourneyStatusEnum'][_0x4cffb2(0x27f)]}});if(!_0x51c82a)throw new common_1[(_0x4cffb2(0x174))](_0x4cffb2(0x217),common_1[_0x4cffb2(0x258)][_0x4cffb2(0x1ea)]);const _0x245f65=await this[_0x4cffb2(0x154)][_0x4cffb2(0x22c)]({'id':_0x3b40a8},{'rec':0x1,'squareType':_0x4ba714})[_0x4cffb2(0xb2)](_0x3d0352=>{const _0xf43667=_0x4cffb2;throw new common_1[(_0xf43667(0x174))](_0x3d0352,common_1['HttpStatus'][_0xf43667(0x1ea)]);});if(_0x245f65[_0x4cffb2(0x168)]<=0x0)throw new common_1['HttpException'](_0x4cffb2(0x172),common_1[_0x4cffb2(0x258)][_0x4cffb2(0x1ea)]);return await this['redisCacheService'][_0x4cffb2(0xc0)]({'key':_0x4cffb2(0x241)}),!![];}async[_0x32b9f0(0x194)](_0x41a78b,_0x3d3c33){return this['czTaskService']['workflowDetail']({'data':{'workflowId':_0x41a78b,'versionId':_0x3d3c33}});}async[_0x32b9f0(0x1f3)](_0xd76886,_0x149124){const _0x137cb6=_0x32b9f0;try{const _0x3d0678={'page':_0x149124[_0x137cb6(0x1f2)],'size':_0x149124[_0x137cb6(0x1a3)],'modelName':_0x149124[_0x137cb6(0xe5)],'modelType':model_constant_1[_0x137cb6(0x11e)]['WORKFLOW']};(0x0,utils_1[_0x137cb6(0x1d5)])(this[_0x137cb6(0x20c)])?_0x149124[_0x137cb6(0x266)]!==undefined&&(_0x3d0678[_0x137cb6(0x266)]=Boolean(_0x149124[_0x137cb6(0x266)])):_0x3d0678['status']=!![];const _0x2fd9f7=await this[_0x137cb6(0x1e3)][_0x137cb6(0xe2)](_0xd76886,_0x3d0678);let _0x9e14c5=[];if(_0x2fd9f7[_0x137cb6(0x1e9)][_0x137cb6(0x19e)]){const _0x25ac7a=new Set(),_0xa4e95f=(0x0,utils_1[_0x137cb6(0xb9)])(this[_0x137cb6(0x20c)]),_0x45d31b=_0x2fd9f7[_0x137cb6(0x1e9)][_0x137cb6(0x24d)](_0x959935=>_0x959935['id']);if(_0x45d31b[_0x137cb6(0x19e)]&&_0xa4e95f){const _0x5a95ed=await this[_0x137cb6(0x15b)][_0x137cb6(0xd0)](_0xa4e95f,user_constant_1[_0x137cb6(0x117)][_0x137cb6(0x179)],_0x45d31b);_0x5a95ed['forEach'](_0x1c2bec=>_0x25ac7a[_0x137cb6(0x232)](Number(_0x1c2bec['relateId'])));}_0x9e14c5=_0x2fd9f7[_0x137cb6(0x1e9)][_0x137cb6(0x24d)](_0x57d843=>{const _0x110a82=_0x137cb6,_0x2e878f={'id':_0x57d843['id'],'cover':_0x57d843[_0x110a82(0x1f6)],'name':_0x57d843['modelName'],'workflowId':_0x57d843[_0x110a82(0xaf)],'versionId':Number(_0x57d843['key']),'deduct':_0x57d843[_0x110a82(0x275)],'vipFreeNum':_0x57d843[_0x110a82(0x1df)],'displaySort':_0x57d843[_0x110a82(0x1ee)],'description':_0x57d843[_0x110a82(0x1b4)],'status':_0x57d843['status'],'createdAt':_0x57d843[_0x110a82(0x13d)],'updatedAt':_0x57d843[_0x110a82(0x26c)],'useCount':_0x57d843[_0x110a82(0xac)],'tutorial':_0x57d843[_0x110a82(0x180)],'freeUsed':_0x57d843[_0x110a82(0x250)],'favorite':_0x25ac7a['has'](_0x57d843['id'])};return _0x2e878f;});}return{'count':_0x2fd9f7[_0x137cb6(0x253)],'rows':_0x9e14c5};}catch(_0x3c348b){throw new common_1[(_0x137cb6(0x174))](_0x3c348b[_0x137cb6(0x1de)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x32b9f0(0x135)](_0x34edf0,_0x1da441){const _0x6c3c80=_0x32b9f0;try{let _0x3fc354;const _0x550b24=(0x0,utils_1['getUserId'])(this[_0x6c3c80(0x20c)]),_0xc0b455=new Set(),_0x44c17b=await this[_0x6c3c80(0x1e3)]['getModelById'](_0x1da441);if(!_0x44c17b)throw new common_1[(_0x6c3c80(0x174))](_0x6c3c80(0x109),common_1[_0x6c3c80(0x258)][_0x6c3c80(0x1ea)]);if(_0x550b24){const _0x542e32=await this[_0x6c3c80(0x15b)][_0x6c3c80(0xc5)](_0x550b24);if(_0x542e32[_0x6c3c80(0x244)]||_0x542e32[_0x6c3c80(0xc3)]){const _0x158d2b=redisKey_constant_1[_0x6c3c80(0x245)]+'-'+_0x550b24+'-'+_0x44c17b['id'];_0x3fc354=await await this[_0x6c3c80(0x129)][_0x6c3c80(0xf8)]({'key':_0x158d2b});}const _0x480d5d=await this[_0x6c3c80(0x15b)][_0x6c3c80(0xd0)](_0x550b24,user_constant_1[_0x6c3c80(0x117)][_0x6c3c80(0x179)],[_0x44c17b['id']]);_0x480d5d[_0x6c3c80(0x203)](_0xabe6e6=>_0xc0b455[_0x6c3c80(0x232)](Number(_0xabe6e6['relateId'])));}const _0x3611a2={'id':_0x44c17b['id'],'cover':_0x44c17b['cover'],'name':_0x44c17b[_0x6c3c80(0x1b8)],'workflowId':_0x44c17b['model'],'versionId':Number(_0x44c17b['key']),'deduct':_0x44c17b[_0x6c3c80(0x275)],'vipFreeNum':_0x44c17b[_0x6c3c80(0x1df)],'displaySort':_0x44c17b[_0x6c3c80(0x1ee)],'description':_0x44c17b[_0x6c3c80(0x1b4)],'status':_0x44c17b[_0x6c3c80(0x266)],'createdAt':_0x44c17b[_0x6c3c80(0x13d)],'updatedAt':_0x44c17b[_0x6c3c80(0x26c)],'useCount':_0x44c17b[_0x6c3c80(0xac)],'tutorial':_0x44c17b['remark'],'freeUsed':Number(_0x3fc354),'favorite':_0xc0b455[_0x6c3c80(0x1b9)](_0x44c17b['id'])};return _0x3611a2;}catch(_0x781099){throw new common_1['HttpException'](_0x781099['message'],common_1[_0x6c3c80(0x258)]['BAD_REQUEST']);}}async[_0x32b9f0(0xa1)](_0x3b6642){const _0x15c378=_0x32b9f0;try{const _0x5388cb={'id':_0x3b6642['id'],'keyType':0x5,'modelType':model_constant_1[_0x15c378(0x11e)]['WORKFLOW'],'cover':_0x3b6642['cover'],'modelName':_0x3b6642['name'],'model':_0x3b6642[_0x15c378(0x155)],'key':'','deduct':_0x3b6642[_0x15c378(0x275)],'vipFreeNum':_0x3b6642[_0x15c378(0x1df)],'displaySort':_0x3b6642[_0x15c378(0x1ee)],'description':_0x3b6642[_0x15c378(0x1b4)],'status':_0x3b6642[_0x15c378(0x266)],'remark':_0x3b6642[_0x15c378(0x15d)]};return _0x3b6642[_0x15c378(0x192)]&&(_0x5388cb['key']=String(_0x3b6642[_0x15c378(0x192)])),await this[_0x15c378(0x1e3)][_0x15c378(0xf2)](_0x5388cb),!![];}catch(_0x2ea279){throw new common_1['HttpException'](_0x2ea279[_0x15c378(0x1de)],common_1[_0x15c378(0x258)][_0x15c378(0x1ea)]);}}async[_0x32b9f0(0x18e)](_0x46ca39){const _0x51b26e=_0x32b9f0;return this[_0x51b26e(0x1e3)][_0x51b26e(0xa4)](_0x46ca39[_0x51b26e(0x122)]);}async[_0x32b9f0(0xee)](){const _0x5a9af1=_0x32b9f0,_0x2de681=await this['dictService'][_0x5a9af1(0x126)](_0x5a9af1(0xa0)),_0x3df928=await this['dictService'][_0x5a9af1(0x126)]('effect_category'),_0x44c901=await this[_0x5a9af1(0x231)][_0x5a9af1(0x126)](_0x5a9af1(0x20a)),_0x957cf4=await this[_0x5a9af1(0x231)][_0x5a9af1(0x126)]('application_fields');return{'style':_0x2de681,'effect_category':_0x3df928,'effect_main_body':_0x44c901,'application_fields':_0x957cf4};}async[_0x32b9f0(0xc2)](_0x53a9a9){const _0x5e3a03=_0x32b9f0;try{const {page:page=0x1,size:size=0x14,keyword:_0x517f41,type:_0x56fc13,version:_0x1590a2,style:_0x5f59be,effectCategory:_0x2b9041,effectMainBody:_0x3ecc96,applicationFields:_0x5585cf,disabled:_0x44f523}=_0x53a9a9,_0x5db934={};_0x517f41&&(_0x5db934[_0x5e3a03(0x151)]=(0x0,typeorm_2['Like'])('%'+_0x517f41+'%'));_0x56fc13&&(_0x5db934[_0x5e3a03(0x16e)]=_0x56fc13);_0x1590a2&&(_0x5db934['version']=_0x1590a2);_0x5f59be&&(_0x5db934['style']=_0x5f59be);_0x2b9041&&(_0x5db934[_0x5e3a03(0x1cb)]=_0x2b9041);_0x3ecc96&&(_0x5db934['effectMainBody']=_0x3ecc96);_0x5585cf&&(_0x5db934[_0x5e3a03(0x11c)]=_0x5585cf);(0x0,utils_1[_0x5e3a03(0x1d5)])(this[_0x5e3a03(0x20c)])?(0x0,utils_1[_0x5e3a03(0x1c4)])(_0x44f523)&&(_0x5db934[_0x5e3a03(0x133)]=_0x44f523):_0x5db934[_0x5e3a03(0x133)]=0x0;const [_0x40dca5,_0x4b2c0a]=await this[_0x5e3a03(0x1b2)][_0x5e3a03(0x205)]({'where':_0x5db934,'take':size,'skip':(page-0x1)*size,'order':{'id':_0x5e3a03(0x1bf)}});return{'rows':_0x40dca5,'count':_0x4b2c0a};}catch(_0x17ca1d){throw new common_1[(_0x5e3a03(0x174))](_0x17ca1d[_0x5e3a03(0x1de)],common_1[_0x5e3a03(0x258)][_0x5e3a03(0x1ea)]);}}async['workflowModelUpdate'](_0x5a6900){const _0x193cdb=_0x32b9f0;try{const {id:_0x1a94a7,name:_0x432411,cover:_0x62cfc5,description:_0x36e117,disabled:_0x615756}=_0x5a6900,_0xc343a8={};return _0x432411&&(_0xc343a8[_0x193cdb(0x151)]=_0x432411),_0x62cfc5&&(_0xc343a8['cover']=_0x62cfc5),_0x36e117&&(_0xc343a8[_0x193cdb(0x1b4)]=_0x36e117),_0x615756&&(_0xc343a8['disabled']=_0x615756),await this[_0x193cdb(0x1b2)][_0x193cdb(0x22c)]({'id':_0x1a94a7},_0xc343a8),!![];}catch(_0x385d1c){throw new common_1[(_0x193cdb(0x174))](_0x385d1c[_0x193cdb(0x1de)],common_1['HttpStatus'][_0x193cdb(0x1ea)]);}}async[_0x32b9f0(0x240)](_0x19adbd){const _0x41d633=_0x32b9f0,_0x4bc28b=_0x19adbd[_0x41d633(0x1d1)](',');if(!_0x19adbd[_0x41d633(0x19e)])throw new common_1[(_0x41d633(0x174))](_0x41d633(0xda),common_1['HttpStatus'][_0x41d633(0x1ea)]);return this[_0x41d633(0x1b2)][_0x41d633(0xd1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4bc28b),'disabled':0x0}});}async['workflowTaskSubmit'](_0x2bb00d,_0x27261a){const _0x3b7781=_0x32b9f0;try{const _0x538ecc=await this[_0x3b7781(0x1e3)][_0x3b7781(0x21e)](_0x27261a['workflowId']);if(!_0x538ecc[_0x3b7781(0x266)])throw new Error(_0x3b7781(0xcf));let _0x4a176d;const _0x2a9704=(0x0,utils_1[_0x3b7781(0x17e)])(this[_0x3b7781(0x20c)]);return await this[_0x3b7781(0x1d6)][_0x3b7781(0x110)](async()=>{const _0x1ee2f3=_0x3b7781;_0x4a176d=await this[_0x1ee2f3(0xca)]({'originPrompt':'','saasId':_0x2a9704,'userId':_0x2bb00d['user']['id'],'mode':midjourney_constant_1[_0x1ee2f3(0x238)][_0x1ee2f3(0x11a)],'botType':DrawTaskPage_dto_1['EBotType'][_0x1ee2f3(0x179)],'workflowId':_0x27261a['workflowId'],'fullPrompt':JSON[_0x1ee2f3(0x105)](_0x27261a[_0x1ee2f3(0x282)])}),await this[_0x1ee2f3(0x15b)][_0x1ee2f3(0x100)](_0x2bb00d[_0x1ee2f3(0xea)]['id'],_0x538ecc,_0x4a176d['id']);const _0x3812be=await this[_0x1ee2f3(0x212)][_0x1ee2f3(0x185)]({'data':{'workflowId':Number(_0x538ecc[_0x1ee2f3(0xaf)]),'versionId':Number(_0x538ecc['key']),'inputs':_0x27261a[_0x1ee2f3(0x282)]}});_0x4a176d[_0x1ee2f3(0x1a7)]=_0x3812be[_0x1ee2f3(0x1c3)],await this[_0x1ee2f3(0x154)][_0x1ee2f3(0x22c)]({'id':_0x4a176d['id']},{'mjpTaskId':_0x3812be[_0x1ee2f3(0x1c3)]});}),_0x4a176d;}catch(_0x4e2e0b){throw new common_1[(_0x3b7781(0x174))](_0x4e2e0b['message'],common_1[_0x3b7781(0x258)][_0x3b7781(0x1ea)]);}}async[_0x32b9f0(0x9f)](_0xd8d2f5,_0x18172b){const _0x3bb6c5=_0x32b9f0,{page:page=0x1,size:size=0x14}=_0x18172b,[_0xfcff7b]=await this['connection'][_0x3bb6c5(0xc1)](_0x3bb6c5(0x257)+_0xd8d2f5[_0x3bb6c5(0xea)]['id']+_0x3bb6c5(0x1f9)),_0x1c433f=await this[_0x3bb6c5(0x1d6)][_0x3bb6c5(0xc1)](_0x3bb6c5(0x285)+_0xd8d2f5[_0x3bb6c5(0xea)]['id']+'\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.createdAt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+size+_0x3bb6c5(0x1fc)+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20');return{'rows':_0x1c433f,'count':Number(_0xfcff7b?.[_0x3bb6c5(0x253)]||0x0)};}async['workflowFavorite'](_0x5e3996,_0x5c0316){const _0x300cee=_0x32b9f0,_0x3b80eb=_0x5e3996['user']['id'],{page:page=0x1,size:size=0x14}=_0x5c0316,[_0x535119]=await this[_0x300cee(0x1d6)][_0x300cee(0xc1)](_0x300cee(0x27c)+_0x5e3996['user']['id']+_0x300cee(0x147)+user_constant_1[_0x300cee(0x117)][_0x300cee(0x179)]+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x560a69=await this[_0x300cee(0x1d6)]['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27'+_0x5e3996[_0x300cee(0xea)]['id']+_0x300cee(0x147)+user_constant_1['EFavorite'][_0x300cee(0x179)]+_0x300cee(0x10a)+size+_0x300cee(0x1fc)+(page-0x1)*size+_0x300cee(0x10c));if(_0x5e3996[_0x300cee(0xea)]['id']){const _0x4594a5=await this['userService'][_0x300cee(0xc5)](_0x3b80eb);if(_0x4594a5[_0x300cee(0x244)]||_0x4594a5[_0x300cee(0xc3)])for(let _0x2cd852=0x0;_0x2cd852<_0x560a69[_0x300cee(0x19e)];_0x2cd852++){const _0xfb56c6=_0x560a69[_0x2cd852],_0x5a4099=redisKey_constant_1[_0x300cee(0x245)]+'-'+_0x3b80eb+'-'+_0xfb56c6['id'],_0x3b413e=await await this[_0x300cee(0x129)][_0x300cee(0xf8)]({'key':_0x5a4099});_0xfb56c6[_0x300cee(0xdd)]=Number(_0x3b413e||0x0);}}return{'rows':_0x560a69,'count':_0x535119?.[_0x300cee(0x253)]||0x0};}async['sdTaskSubmit'](_0x1c678a,_0x405636){const _0xbf3b23=_0x32b9f0;try{let _0x4106ad;const _0x5602bc=(0x0,utils_1['getReqSaasId'])(this['clsService']);return await this[_0xbf3b23(0x1d6)]['transaction'](async()=>{const _0x965591=_0xbf3b23;_0x4106ad=await this[_0x965591(0xca)]({'saasId':_0x5602bc,'userId':_0x1c678a[_0x965591(0xea)]['id'],'mode':midjourney_constant_1[_0x965591(0x238)]['fast'],'botType':DrawTaskPage_dto_1[_0x965591(0x165)]['SD'],'originPrompt':_0x405636[_0x965591(0x251)],'fullPrompt':JSON[_0x965591(0x105)](_0x405636)}),await this[_0x965591(0x15b)]['deductBalance4SD'](_0x1c678a[_0x965591(0xea)]['id'],_0x4106ad['id']);const _0x47df10=await this[_0x965591(0x212)][_0x965591(0x16c)]({'data':_0x405636});_0x4106ad[_0x965591(0x1a7)]=_0x47df10[_0x965591(0x163)],await this['midjourneyEntity'][_0x965591(0x22c)]({'id':_0x4106ad['id']},{'mjpTaskId':_0x47df10[_0x965591(0x163)]});}),_0x4106ad;}catch(_0x14d050){throw new common_1[(_0xbf3b23(0x174))](_0x14d050[_0xbf3b23(0x1de)],common_1[_0xbf3b23(0x258)][_0xbf3b23(0x1ea)]);}}async[_0x32b9f0(0x28a)](_0x171f62,_0x326899){const _0x1ee278=_0x32b9f0;try{const _0x511c62=await this[_0x1ee278(0x154)][_0x1ee278(0x252)]({'where':{'id':Number(_0x326899[_0x1ee278(0x1c3)])}});if(!_0x511c62)throw new Error(_0x1ee278(0x1a2));let _0x585445;const _0x22cb8f=(0x0,utils_1['getReqSaasId'])(this[_0x1ee278(0x20c)]);return await this[_0x1ee278(0x1d6)]['transaction'](async()=>{const _0x29bb4f=_0x1ee278;_0x585445=await this[_0x29bb4f(0xca)]({'saasId':_0x22cb8f,'userId':_0x171f62['user']['id'],'mode':midjourney_constant_1[_0x29bb4f(0x238)][_0x29bb4f(0x11a)],'botType':DrawTaskPage_dto_1[_0x29bb4f(0x165)]['SD'],'originPrompt':_0x326899[_0x29bb4f(0x251)],'originTaskId':_0x326899[_0x29bb4f(0x1c3)],'fullPrompt':JSON[_0x29bb4f(0x105)](_0x326899)}),await this[_0x29bb4f(0x15b)][_0x29bb4f(0x207)](_0x171f62['user']['id'],_0x585445['id']);const _0x4645fd=await this[_0x29bb4f(0x212)][_0x29bb4f(0x26e)]({'data':{'mask':_0x326899[_0x29bb4f(0x177)],'prompt':_0x326899[_0x29bb4f(0x251)],'taskId':_0x511c62['mjpTaskId'],'denoisingStrength':_0x326899[_0x29bb4f(0xf6)]}});_0x585445['mjpTaskId']=_0x4645fd[_0x29bb4f(0x163)],await this[_0x29bb4f(0x154)][_0x29bb4f(0x22c)]({'id':_0x585445['id']},{'mjpTaskId':_0x4645fd['paintingSign']});}),_0x585445;}catch(_0x2f9fc7){throw new common_1['HttpException'](_0x2f9fc7[_0x1ee278(0x1de)],common_1['HttpStatus'][_0x1ee278(0x1ea)]);}}async[_0x32b9f0(0x11b)](_0x43c7cb){const _0x579cb8=_0x32b9f0,{id:_0x1b0bdf,favorite:_0x12ba57}=_0x43c7cb,_0x2f0ea3=await this[_0x579cb8(0x154)]['findOne']({'where':{'id':_0x1b0bdf}})[_0x579cb8(0xb2)](_0x4f67b7=>{const _0x47b3ef=_0x579cb8;common_1[_0x47b3ef(0x16f)][_0x47b3ef(0xce)](_0x4f67b7);});if(!_0x2f0ea3)throw new common_1[(_0x579cb8(0x174))](_0x579cb8(0x217),common_1[_0x579cb8(0x258)][_0x579cb8(0x1ea)]);const _0x2fe1d9=await this[_0x579cb8(0x154)][_0x579cb8(0x22c)]({'id':_0x1b0bdf},{'favorite':_0x12ba57});if(_0x2fe1d9[_0x579cb8(0x168)]<=0x0)throw new common_1[(_0x579cb8(0x174))](_0x579cb8(0x172),common_1[_0x579cb8(0x258)][_0x579cb8(0x1ea)]);return!![];}async['deleteDraw'](_0x261745,_0x444cae){const _0x138615=_0x32b9f0;try{const _0x1e1c2f=await this[_0x138615(0x154)][_0x138615(0x252)]({'where':{'id':_0x261745,'userId':_0x444cae[_0x138615(0xea)]['id']}});if(!_0x1e1c2f)throw new Error(_0x138615(0x1e7));if(_0x1e1c2f[_0x138615(0x266)]===midjourney_constant_1[_0x138615(0x1a0)][_0x138615(0x1bc)])throw new Error(_0x138615(0x274));await this[_0x138615(0x1f4)][_0x138615(0x162)](null,_0x1e1c2f[_0x138615(0x1a7)]);const _0x4b023e=await this[_0x138615(0x154)][_0x138615(0x16b)]({'id':_0x261745});if(_0x4b023e[_0x138615(0x168)]>0x0)return _0x138615(0x16a);else throw new Error(_0x138615(0x196));}catch(_0x2b333f){throw new common_1[(_0x138615(0x174))](_0x2b333f[_0x138615(0x1de)],common_1[_0x138615(0x258)][_0x138615(0x1ea)]);}}async[_0x32b9f0(0x13c)](_0x1efa19,_0x342b99){const _0x2c011d=_0x32b9f0,{id:_0x5be33}=_0x342b99;if(!_0x5be33)throw new common_1[(_0x2c011d(0x174))](_0x2c011d(0x14e),common_1[_0x2c011d(0x258)][_0x2c011d(0x1ea)]);const _0x48801c=await this[_0x2c011d(0x154)]['delete']({'id':_0x5be33});if(_0x48801c[_0x2c011d(0x168)]<=0x0)throw new common_1[(_0x2c011d(0x174))]('删除记录失败！',common_1[_0x2c011d(0x258)][_0x2c011d(0x1ea)]);return!![];}async[_0x32b9f0(0xb7)](_0x5b6940,_0x13bc95){const _0x24c72b=_0x32b9f0;try{const {prompt:_0x3f35b2,status:_0x9af6f7,isCarryParams:_0x54d862,imageUrl:_0x4d0289,title:_0x1b804b,order:_0xe8c076,id:_0x4b083e,aspect:_0x1fdcdf}=_0x13bc95;if(_0x4b083e)return await this[_0x24c72b(0xbf)]['update']({'id':_0x4b083e},{'title':_0x1b804b,'prompt':_0x3f35b2,'imageUrl':_0x4d0289,'status':_0x9af6f7,'isCarryParams':_0x54d862,'order':_0xe8c076,'aspect':_0x1fdcdf})['then'](_0x5148c2=>!!_0x5148c2);else{const _0x36a725=(0x0,utils_1[_0x24c72b(0x17e)])(this[_0x24c72b(0x20c)]);return await this[_0x24c72b(0xbf)][_0x24c72b(0x1ae)]({'prompt':_0x3f35b2,'status':_0x9af6f7,'imageUrl':_0x4d0289,'isCarryParams':_0x54d862,'title':_0x1b804b,'order':_0xe8c076,'aspect':_0x1fdcdf,'saasId':_0x36a725})[_0x24c72b(0x1e8)](_0x467dd7=>!!_0x467dd7);}}catch(_0x57525b){console[_0x24c72b(0xd7)](_0x24c72b(0xf0),_0x57525b);}}async['delPrompt'](_0x12b035,_0x31ac82){const _0x26e860=_0x32b9f0,{id:_0xe592bb}=_0x31ac82;if(!_0xe592bb)throw new common_1[(_0x26e860(0x174))]('非法操作！',common_1['HttpStatus'][_0x26e860(0x1ea)]);return await this[_0x26e860(0xbf)][_0x26e860(0x16b)]({'id':_0xe592bb});}async[_0x32b9f0(0x17d)](){const _0xe2748e=_0x32b9f0,_0xbc2ace=(0x0,utils_1[_0xe2748e(0x17e)])(this[_0xe2748e(0x20c)]);return await this['mjPromptsEntity'][_0xe2748e(0xd1)]({'where':{'saasId':_0xbc2ace},'order':{'order':_0xe2748e(0x1cf)}})[_0xe2748e(0x1e8)](_0x3a22e4=>_0x3a22e4||[])[_0xe2748e(0xb2)](_0x19b21c=>{const _0x133aea=_0xe2748e;common_1[_0x133aea(0x16f)][_0x133aea(0xce)](_0x19b21c);});}async[_0x32b9f0(0x1cc)](_0x14eb56){const _0x18d401=_0x32b9f0;try{const {page:_0x35ca0a,size:_0x303c3b,keyword:_0x239c8b,saasId:_0x5f31ba}=_0x14eb56,_0x2683bb=(0x0,utils_1[_0x18d401(0x17e)])(this[_0x18d401(0x20c)]),_0x51e0e2={'status':!![]};(0x0,utils_1['isPlatform'])(this['clsService'])?(0x0,utils_1[_0x18d401(0x1c4)])(_0x5f31ba)&&(_0x51e0e2['saasId']=_0x5f31ba):_0x51e0e2['saasId']=_0x2683bb;const [_0x3774f4,_0x10e098]=await this[_0x18d401(0xbf)]['findAndCount']({'where':[{..._0x51e0e2,'title':(0x0,typeorm_2[_0x18d401(0x200)])('%'+_0x239c8b+'%')},{..._0x51e0e2,'prompt':(0x0,typeorm_2['Like'])('%'+_0x239c8b+'%')}],'take':_0x303c3b,'skip':(_0x35ca0a-0x1)*_0x303c3b,'order':{'order':'DESC'}});return{'rows':_0x3774f4,'count':_0x10e098};}catch(_0x44b54c){throw new common_1[(_0x18d401(0x174))](_0x44b54c[_0x18d401(0x1de)],common_1[_0x18d401(0x258)]['BAD_REQUEST']);}}async[_0x32b9f0(0xfd)](_0x2115dd){const _0x58a2fb=_0x32b9f0;try{const {name:_0x668309,value:_0x34dd67}=_0x2115dd,_0x235d42=(0x0,utils_1['getReqSaasId'])(this[_0x58a2fb(0x20c)]),_0x38ccb0=await this[_0x58a2fb(0x277)]['findOneBy']({'name':_0x668309,'saasId':_0x235d42});if(_0x38ccb0)throw new common_1[(_0x58a2fb(0x174))]('名称不能重复',common_1[_0x58a2fb(0x258)][_0x58a2fb(0x1ea)]);return await this[_0x58a2fb(0x277)][_0x58a2fb(0x1ae)]({'name':_0x668309,'value':_0x34dd67,'saasId':_0x235d42})[_0x58a2fb(0x1e8)](_0x5f275b=>!!_0x5f275b)[_0x58a2fb(0xb2)](_0x584956=>{const _0x1a50bb=_0x58a2fb;console[_0x1a50bb(0xd7)](_0x584956);throw new common_1['HttpException'](_0x584956,common_1[_0x1a50bb(0x258)][_0x1a50bb(0x1ea)]);});}catch(_0x1bce23){return![];}}async[_0x32b9f0(0x1ba)](_0x408c87){const _0x18aca7=_0x32b9f0,{id:_0x135b7d,name:_0x5ae5c1,value:_0x3e6e63}=_0x408c87;return await this[_0x18aca7(0x277)][_0x18aca7(0x22c)](_0x135b7d,{'name':_0x5ae5c1,'value':_0x3e6e63})['then'](_0x1ba709=>!!_0x1ba709);}async[_0x32b9f0(0x1c0)](_0x4363d6){const _0x5072b1=_0x32b9f0,{id:_0x5e75db}=_0x4363d6;return await this['mjInspireClassifyEntity'][_0x5072b1(0x16b)]({'id':_0x5e75db})[_0x5072b1(0xb2)](_0x4f0dc1=>{const _0x3788e8=_0x5072b1;throw new common_1[(_0x3788e8(0x174))](_0x4f0dc1,common_1[_0x3788e8(0x258)][_0x3788e8(0x1ea)]);});}async[_0x32b9f0(0x115)](_0x1e1488){const _0x1eb83e=_0x32b9f0,{size:_0x47a7cd,page:_0x18d2d7,saasId:_0x112fbb}=_0x1e1488,_0x2f2228=(0x0,utils_1['getReqSaasId'])(this[_0x1eb83e(0x20c)]),_0x5507fe={};(0x0,utils_1['isPlatform'])(this[_0x1eb83e(0x20c)])?(0x0,utils_1[_0x1eb83e(0x1c4)])(_0x112fbb)&&(_0x5507fe[_0x1eb83e(0x186)]=_0x112fbb):_0x5507fe['saasId']=_0x2f2228;const _0x15187d=await this[_0x1eb83e(0x277)][_0x1eb83e(0x205)]({'where':_0x5507fe,'order':{'createdAt':_0x1eb83e(0x1cf)},'take':_0x47a7cd,'skip':(_0x18d2d7-0x1)*_0x47a7cd})[_0x1eb83e(0xb2)](_0x21489b=>{const _0x20eefc=_0x1eb83e;throw new common_1['HttpException'](_0x21489b,common_1[_0x20eefc(0x258)][_0x20eefc(0x1ea)]);});if(!_0x15187d)throw new common_1['HttpException'](_0x1eb83e(0xe7),common_1['HttpStatus'][_0x1eb83e(0x1ea)]);const [_0x34e69e,_0x37c458]=_0x15187d;return{'rows':_0x34e69e,'count':_0x37c458};}async[_0x32b9f0(0x26a)](_0x1e90ab){const _0x3a9f28=_0x32b9f0,{id:_0x3c092c}=_0x1e90ab;return await this[_0x3a9f28(0x277)][_0x3a9f28(0x252)]({'where':{'id':_0x3c092c}});}async[_0x32b9f0(0x19c)](_0x103ce8){const _0xc5440e=_0x32b9f0;try{const _0x5d7458=(0x0,utils_1['getReqSaasId'])(this[_0xc5440e(0x20c)]),{classifyName:_0x3cb2b0,level:_0x33cb21,type:_0x4fd201,pid:pid=0x0}=_0x103ce8;return await this[_0xc5440e(0xd9)][_0xc5440e(0x1ae)]({'classifyName':_0x3cb2b0,'level':_0x33cb21,'type':_0x4fd201,'pid':pid,'saasId':_0x5d7458})[_0xc5440e(0x1e8)](_0x59e66b=>!!_0x59e66b)['catch'](_0x2a9f4d=>{const _0x27e270=_0xc5440e;console[_0x27e270(0xd7)](_0x2a9f4d);throw new common_1[(_0x27e270(0x174))](_0x2a9f4d,common_1[_0x27e270(0x258)][_0x27e270(0x1ea)]);});}catch(_0x23fe85){return![];}}async[_0x32b9f0(0x102)](_0x25f4a3){const _0x58b88e=_0x32b9f0,{id:_0x21100a,classifyName:_0x156ada,level:_0x51e18c,type:_0xf432b9,pid:_0x356ec7}=_0x25f4a3;return this['connection'][_0x58b88e(0x110)](async()=>{const _0x555e22=_0x58b88e,_0xae45e5=await this['mjIncantationClassifyEntity'][_0x555e22(0x252)]({'where':{'id':_0x21100a}});_0xae45e5['type']!==_0xf432b9&&await this[_0x555e22(0xd9)][_0x555e22(0x22c)]({'pid':_0x21100a},{'type':_0xf432b9}),await this[_0x555e22(0xd9)]['update'](_0x21100a,{'classifyName':_0x156ada,'level':_0x51e18c,'type':_0xf432b9,'pid':_0x356ec7});}),!![];}async['removeMjIncantationClassify'](_0x51c1ae){const _0x15d353=_0x32b9f0,{id:_0x587b50}=_0x51c1ae;return await this[_0x15d353(0xd9)][_0x15d353(0x16b)]({'id':_0x587b50})[_0x15d353(0x1e8)](_0x32ae20=>_0x32ae20[_0x15d353(0x168)]>0x0);}async[_0x32b9f0(0x10f)](_0x68f545){const _0x1a5f8f=_0x32b9f0,{id:_0x4d7069}=_0x68f545;return await this[_0x1a5f8f(0xd9)][_0x1a5f8f(0x252)]({'where':{'id':_0x4d7069}});}async[_0x32b9f0(0x224)](){const _0x5df372=_0x32b9f0,_0x141138=(0x0,utils_1['getReqSaasId'])(this[_0x5df372(0x20c)]);return this[_0x5df372(0xd9)][_0x5df372(0xd1)]({'where':{'level':0x1,'saasId':_0x141138}});}async['queryMjIncantationClassify'](_0x45f764){const _0x9f3ad2=_0x32b9f0,{size:_0x3c001a,page:_0x1270e7,type:_0x3ea69f,keyword:_0x84676e,level:_0x480144,saasId:_0x399f35}=_0x45f764,_0x545dce=(0x0,utils_1[_0x9f3ad2(0x17e)])(this[_0x9f3ad2(0x20c)]);let _0xa84854={};_0x480144>0x0&&(_0xa84854[_0x9f3ad2(0x221)]=_0x480144);_0x3ea69f&&(_0xa84854['type']=_0x3ea69f);_0x84676e&&(_0xa84854[_0x9f3ad2(0x11d)]=(0x0,typeorm_2[_0x9f3ad2(0x200)])('%'+_0x84676e+'%'));(0x0,utils_1['isPlatform'])(this[_0x9f3ad2(0x20c)])?(0x0,utils_1[_0x9f3ad2(0x1c4)])(_0x399f35)&&(_0xa84854['saasId']=_0x399f35):_0xa84854[_0x9f3ad2(0x186)]=_0x545dce;const _0x3be5aa=await this[_0x9f3ad2(0xd9)][_0x9f3ad2(0x205)]({'order':{'createdAt':'DESC'},'where':_0xa84854,'take':_0x3c001a,'skip':(_0x1270e7-0x1)*_0x3c001a})[_0x9f3ad2(0xb2)](_0x38e7a7=>{console['log'](_0x38e7a7);});if(!_0x3be5aa)throw new common_1['HttpException']('查询咒语分类失败',common_1[_0x9f3ad2(0x258)][_0x9f3ad2(0x1ea)]);const [_0x112333,_0x1350dc]=_0x3be5aa;return{'rows':_0x112333,'count':_0x1350dc};}async[_0x32b9f0(0x191)](_0x326131){const _0x39a253=_0x32b9f0,{level:_0x4f5490,type:_0x1b1607,saasId:_0x219b63}=_0x326131,_0x514aff=(0x0,utils_1[_0x39a253(0x17e)])(this[_0x39a253(0x20c)]),_0x193048={};_0x4f5490===0x0?_0x193048['level']=(0x0,typeorm_2[_0x39a253(0x167)])(_0x4f5490):_0x193048[_0x39a253(0x221)]=_0x4f5490;_0x1b1607&&(_0x193048[_0x39a253(0x16e)]=_0x1b1607);(0x0,utils_1['isPlatform'])(this[_0x39a253(0x20c)])?(0x0,utils_1[_0x39a253(0x1c4)])(_0x219b63)&&(_0x193048['saasId']=_0x219b63):_0x193048[_0x39a253(0x186)]=_0x514aff;const _0x378abe=await this[_0x39a253(0xd9)][_0x39a253(0x15c)](_0x193048)[_0x39a253(0xb2)](_0x567b6f=>{console['log'](_0x567b6f);});if(!_0x378abe)throw new common_1[(_0x39a253(0x174))](_0x39a253(0x259),common_1['HttpStatus'][_0x39a253(0x1ea)]);if(_0x4f5490===0x0)return{'level1':_0x378abe[_0x39a253(0x111)](_0x219193=>_0x219193[_0x39a253(0x221)]===0x1),'level2':_0x378abe[_0x39a253(0x111)](_0x56a2ce=>_0x56a2ce[_0x39a253(0x221)]===0x2)};return _0x378abe;}async['addMjIncantation'](_0x14c747){const _0x2e1466=_0x32b9f0;try{const _0x13033a=(0x0,utils_1[_0x2e1466(0x17e)])(this[_0x2e1466(0x20c)]),{incantationEn:_0x424c63,incantationCn:_0x45a797,img:_0x4c4e01,pid:_0x41a54d}=_0x14c747;return await this[_0x2e1466(0xab)]['save']({'incantationEn':_0x424c63,'incantationCn':_0x45a797,'img':_0x4c4e01,'pid':_0x41a54d,'saasId':_0x13033a})['then'](_0x420777=>!!_0x420777)['catch'](_0x1ae55d=>{throw _0x1ae55d;});}catch(_0x1decb3){return console[_0x2e1466(0xd7)](_0x1decb3),![];}}async['modifyMjIncantation'](_0x26bd54){const _0x491796=_0x32b9f0,{id:_0x4c39cf,incantationEn:_0x217281,incantationCn:_0x1af0d1,img:_0xfd5194,pid:_0x2b7fbe}=_0x26bd54;return await this[_0x491796(0xab)][_0x491796(0x22c)](_0x4c39cf,{'incantationCn':_0x1af0d1,'incantationEn':_0x217281,'img':_0xfd5194,'pid':_0x2b7fbe});}async['removeMjIncantation'](_0x394e17){const _0x30f2b5=_0x32b9f0,{id:_0xe77b50}=_0x394e17;return await this[_0x30f2b5(0xab)][_0x30f2b5(0x16b)]({'id':_0xe77b50})['then'](_0x2c89d3=>_0x2c89d3[_0x30f2b5(0x168)]>0x0);}async['getMjIncantation'](_0x178310){const _0x5e48e2=_0x32b9f0,{id:_0x5f3fa6}=_0x178310;return await this[_0x5e48e2(0xab)][_0x5e48e2(0x252)]({'where':{'id':_0x5f3fa6}});}async['queryMjIncantation'](_0x363d44){const _0x1b7f61=_0x32b9f0,_0xc25ec0=(0x0,utils_1[_0x1b7f61(0x17e)])(this[_0x1b7f61(0x20c)]),{size:_0x2e008b,page:_0xab2f36,keyword:_0x85094e,pid:_0x5ade28,saasId:_0x46ea33}=_0x363d44;let _0x1b7039={};_0x5ade28>0x0&&(_0x1b7039[_0x1b7f61(0x19b)]=_0x5ade28);_0x85094e&&(_0x1b7039[_0x1b7f61(0x1bb)]=(0x0,typeorm_2['Like'])('%'+_0x85094e+'%'));(0x0,utils_1[_0x1b7f61(0x1aa)])(this[_0x1b7f61(0x20c)])?(0x0,utils_1[_0x1b7f61(0x1c4)])(_0x46ea33)&&(_0x1b7039[_0x1b7f61(0x186)]=_0x46ea33):_0x1b7039[_0x1b7f61(0x186)]=_0xc25ec0;const _0x428426=await this[_0x1b7f61(0xab)][_0x1b7f61(0x205)]({'order':{'createdAt':_0x1b7f61(0x1cf)},'where':_0x1b7039,'take':_0x2e008b,'skip':(_0xab2f36-0x1)*_0x2e008b})[_0x1b7f61(0xb2)](_0x1e83b5=>{const _0x2e121f=_0x1b7f61;console[_0x2e121f(0xd7)](_0x1e83b5);});if(!_0x428426)throw new common_1[(_0x1b7f61(0x174))](_0x1b7f61(0x1d7),common_1['HttpStatus'][_0x1b7f61(0x1ea)]);const [_0x403ca8,_0x2b908c]=_0x428426;return{'rows':_0x403ca8,'count':_0x2b908c};}async['queryMjIncantationByClassify'](_0xcabe74){const _0x5c4052=_0x32b9f0,{id:_0x4a6018}=_0xcabe74,_0x258e4a=await this[_0x5c4052(0xd9)][_0x5c4052(0x252)]({'where':{'level':0x1,'id':_0x4a6018}})['catch'](_0x10ea88=>{const _0x1584a4=_0x5c4052;common_1[_0x1584a4(0x16f)][_0x1584a4(0xce)](_0x10ea88);});if(!_0x258e4a)throw new common_1['HttpException'](_0x5c4052(0x213),common_1[_0x5c4052(0x258)][_0x5c4052(0x1ea)]);const _0x474904=await this[_0x5c4052(0xd9)][_0x5c4052(0xd1)]({'where':{'level':0x2,'pid':_0x258e4a['id']}})['catch'](_0x36b479=>{const _0x3a5bc3=_0x5c4052;common_1[_0x3a5bc3(0x16f)][_0x3a5bc3(0xce)](_0x36b479);});if(!_0x474904||_0x474904[_0x5c4052(0x19e)]===0x0)return{'rows':[]};const _0x522730=_0x474904[_0x5c4052(0x24d)](_0x41f0bc=>_0x41f0bc['id']),_0x474947=await this[_0x5c4052(0xab)]['find']({'where':{'pid':(0x0,typeorm_2['In'])(_0x522730)}})[_0x5c4052(0xb2)](_0x2e69e3=>{const _0x2daa72=_0x5c4052;common_1[_0x2daa72(0x16f)][_0x2daa72(0xce)](_0x2e69e3);});if(!_0x474947)throw new common_1[(_0x5c4052(0x174))]('查询咒语失败',common_1[_0x5c4052(0x258)][_0x5c4052(0x1ea)]);const _0x420de9=_0x474904[_0x5c4052(0x24d)](_0x33d6a9=>{const _0x5b4279=_0x5c4052;return{'children':_0x474947[_0x5b4279(0x111)](_0x4d999f=>_0x4d999f[_0x5b4279(0x19b)]===_0x33d6a9['id'])||[],..._0x33d6a9};});return{'rows':_0x420de9};}async['queryMjIncantationAll'](){const _0x4c4c74=_0x32b9f0,_0x473d5d=(0x0,utils_1[_0x4c4c74(0x17e)])(this[_0x4c4c74(0x20c)]),_0x28227a=await this['mjIncantationEntity']['find']({'where':{'saasId':_0x473d5d},'order':{'createdAt':'DESC'}})[_0x4c4c74(0xb2)](_0x25a087=>{const _0x31f2fb=_0x4c4c74;console[_0x31f2fb(0xd7)](_0x25a087);});if(!_0x28227a)throw new common_1[(_0x4c4c74(0x174))](_0x4c4c74(0x1d7),common_1[_0x4c4c74(0x258)][_0x4c4c74(0x1ea)]);return _0x28227a;}async[_0x32b9f0(0x209)](_0x47150d){const _0x164229=_0x32b9f0,_0x423eed=(0x0,utils_1['getReqSaasId'])(this[_0x164229(0x20c)]),{id:_0x148f76,suggestCn:_0x217a65,suggestEn:_0xd973e,order:_0x5be326,image:_0x5f2201}=_0x47150d,_0x574185=await this[_0x164229(0xae)][_0x164229(0x252)]({'where':{'suggestCn':_0x217a65,'saasId':_0x423eed}});if(_0x148f76){if(_0x574185&&_0x574185['id']!==_0x148f76)throw new common_1[(_0x164229(0x174))](_0x164229(0x124),common_1[_0x164229(0x258)][_0x164229(0x1ea)]);}else{if(_0x574185)throw new common_1[(_0x164229(0x174))]('推荐关键词已存在，不可重复添加',common_1['HttpStatus'][_0x164229(0x1ea)]);}const _0x1f2cb5=await this[_0x164229(0xae)][_0x164229(0x1ae)]({'id':_0x148f76,'suggestCn':_0x217a65,'suggestEn':_0xd973e,'order':_0x5be326||0x64,'image':_0x5f2201||'','saasId':_0x423eed})[_0x164229(0x1e8)](_0x499ccf=>!!_0x499ccf['id'])[_0x164229(0xb2)](_0x478317=>{console['log'](_0x478317);});if(!_0x1f2cb5)throw new common_1[(_0x164229(0x174))](_0x164229(0x1a8),common_1[_0x164229(0x258)][_0x164229(0x1ea)]);return _0x1f2cb5;}async[_0x32b9f0(0x26d)](_0x3dd026){const _0x1c99d6=_0x32b9f0,{id:_0x469937}=_0x3dd026,_0x130748=await this['mjSuggestWordEntity'][_0x1c99d6(0xc7)]({'where':{'id':_0x469937}});if(!_0x130748)throw new common_1[(_0x1c99d6(0x174))](_0x1c99d6(0x208),common_1[_0x1c99d6(0x258)][_0x1c99d6(0x1ea)]);const _0x538d10=await this[_0x1c99d6(0xae)][_0x1c99d6(0x16b)](_0x469937)['then'](_0x2f8c25=>_0x2f8c25['affected']>0x0)[_0x1c99d6(0xb2)](_0x457333=>{const _0x42de36=_0x1c99d6;console[_0x42de36(0xd7)](_0x457333);});if(!_0x538d10)throw new common_1[(_0x1c99d6(0x174))](_0x1c99d6(0x268),common_1[_0x1c99d6(0x258)][_0x1c99d6(0x1ea)]);return _0x538d10;}async[_0x32b9f0(0xcd)](_0x351a70){const _0x3fcbbc=_0x32b9f0;let _0x13a4f2={};const {page:_0x88962,size:_0x3518e4,saasId:_0x289697}=_0x351a70,_0x26e04c=(0x0,utils_1['getReqSaasId'])(this[_0x3fcbbc(0x20c)]);(0x0,utils_1['isPlatform'])(this[_0x3fcbbc(0x20c)])?(0x0,utils_1[_0x3fcbbc(0x1c4)])(_0x289697)&&(_0x13a4f2['saasId']=_0x289697):_0x13a4f2[_0x3fcbbc(0x186)]=_0x26e04c;const _0x535b3d=await this[_0x3fcbbc(0xae)][_0x3fcbbc(0x205)]({'where':_0x13a4f2,'take':_0x3518e4,'skip':(_0x88962-0x1)*_0x3518e4,'order':{'order':'DESC'}})[_0x3fcbbc(0x1e8)](([_0x1ee6ea,_0x8a5be6])=>({'rows':_0x1ee6ea,'count':_0x8a5be6}))['catch'](_0x465d94=>{const _0x49ada8=_0x3fcbbc;console[_0x49ada8(0xd7)](_0x465d94);});if(!_0x535b3d)throw new common_1[(_0x3fcbbc(0x174))](_0x3fcbbc(0x1d2),common_1['HttpStatus'][_0x3fcbbc(0x1ea)]);return _0x535b3d;}async[_0x32b9f0(0xb5)](_0x24b1ee){const _0x327de6=_0x32b9f0,_0x586d4b=await this[_0x327de6(0x128)]({'rec':_0x24b1ee[_0x327de6(0x119)],'page':_0x24b1ee[_0x327de6(0x1f2)],'size':_0x24b1ee['size'],'status':_0x24b1ee[_0x327de6(0x266)],'keyword':_0x24b1ee['keyword'],'squareType':_0x24b1ee[_0x327de6(0x188)]});return _0x586d4b['rows'][_0x327de6(0x203)](_0x4efffb=>{const _0xb02986=_0x327de6;_0x4efffb[_0xb02986(0x158)]=_0x4efffb[_0xb02986(0x158)]?JSON[_0xb02986(0x273)](_0x4efffb[_0xb02986(0x158)]):{};}),_0x586d4b;}[_0x32b9f0(0x1a4)](_0x354686){const _0x58181e=_0x32b9f0;if(!_0x354686)return _0x58181e(0x11a);if(_0x354686===midjourney_constant_1['DrawSpeed'][_0x58181e(0x11a)])return _0x58181e(0x11a);if(_0x354686===midjourney_constant_1['DrawSpeed'][_0x58181e(0x267)])return _0x58181e(0x267);if(_0x354686===midjourney_constant_1['DrawSpeed']['turbo'])return _0x58181e(0x279);return _0x58181e(0x11a);}async['syncWorkFlowDict'](){const _0x253e8d=_0x32b9f0;if(process[_0x253e8d(0x181)][_0x253e8d(0x144)]===_0x253e8d(0x1ab))return;try{const _0x3e69f5=await this[_0x253e8d(0x212)][_0x253e8d(0xee)]({});for(let _0x245f6f in _0x3e69f5){let _0x5c033a=_0x245f6f;for(let _0x5c940a=0x0;_0x5c940a<_0x3e69f5[_0x245f6f][_0x253e8d(0x19e)];_0x5c940a++){const _0x25dbee=_0x3e69f5[_0x245f6f][_0x5c940a];let _0x11ae72=await this[_0x253e8d(0x231)][_0x253e8d(0x1ce)](_0x5c033a,String(_0x25dbee['id']));_0x11ae72?(_0x11ae72[_0x253e8d(0x286)]=_0x5c033a,_0x11ae72[_0x253e8d(0x204)]=_0x25dbee[_0x253e8d(0x151)],_0x11ae72[_0x253e8d(0x27a)]=String(_0x25dbee['id'])):_0x11ae72={'dictType':_0x5c033a,'dictName':_0x25dbee[_0x253e8d(0x151)],'dictValue':String(_0x25dbee['id'])},await this[_0x253e8d(0x231)][_0x253e8d(0x14f)](_0x11ae72);}}common_1[_0x253e8d(0x16f)][_0x253e8d(0xd7)]('触站::运用领域、风格画风、作用主体、作用类别字典同步完成');}catch(_0x5755ce){common_1[_0x253e8d(0x16f)]['error'](_0x5755ce,_0x253e8d(0x12e));}}async[_0x32b9f0(0x243)](_0x19b38c){const _0x3825dd=_0x32b9f0;let _0x3413f1=[];try{const _0x475c87=await this[_0x3825dd(0x212)][_0x3825dd(0x235)]({'data':{'size':0x32,'index':0x1,'tagIds':[_0x19b38c]}});_0x3413f1=_0x3413f1['concat'](_0x475c87[_0x3825dd(0x227)]);for(let _0x41746f=0x2;_0x41746f<=_0x475c87[_0x3825dd(0x166)];_0x41746f++){const _0x203a29=await this[_0x3825dd(0x212)][_0x3825dd(0x235)]({'data':{'index':_0x41746f,'size':0x32,'tagIds':[_0x19b38c]}});_0x3413f1=_0x3413f1[_0x3825dd(0x134)](_0x203a29[_0x3825dd(0x227)]);}return _0x3413f1;}catch(_0x11186c){return common_1[_0x3825dd(0x16f)][_0x3825dd(0xce)](_0x11186c,_0x3825dd(0xf5)),[];}}async[_0x32b9f0(0x25d)](){const _0x126f84=_0x32b9f0;if(process[_0x126f84(0x181)][_0x126f84(0x144)]===_0x126f84(0x1ab))return;try{const _0x201e38=await this[_0x126f84(0x231)][_0x126f84(0x160)]([_0x126f84(0xa0),_0x126f84(0x17b),_0x126f84(0x20a),_0x126f84(0x1d3)]),_0x437baf=new Map(),_0x31bf63=await this[_0x126f84(0x1b2)]['find']();_0x31bf63[_0x126f84(0x203)](_0x1caf32=>_0x437baf[_0x126f84(0xe0)](_0x1caf32['id'],_0x1caf32));for(let _0x5a5942=0x0;_0x5a5942<_0x201e38['length'];_0x5a5942++){const _0x331dc8=_0x201e38[_0x5a5942][_0x126f84(0x204)],_0x439ba8=Number(_0x201e38[_0x5a5942][_0x126f84(0x27a)]),_0x48b955=await this[_0x126f84(0x243)](_0x439ba8);_0x48b955[_0x126f84(0x203)](_0xf71657=>{const _0x18e471=_0x126f84,_0x3b64c6=String(_0xf71657['id']);!_0x437baf[_0x18e471(0x1b9)](_0x3b64c6)&&_0x437baf[_0x18e471(0xe0)](_0x3b64c6,{'id':_0x3b64c6,'type':_0xf71657[_0x18e471(0x20e)],'name':_0xf71657['name'],'cover':_0x18e471(0x15a)+_0xf71657[_0x18e471(0x1b5)],'version':_0xf71657['modelVersion'],'description':'','triggerWords':_0xf71657[_0x18e471(0xbd)]});const _0x362657=_0x437baf[_0x18e471(0xf8)](_0x3b64c6);_0x201e38[_0x5a5942]['dictType']==='style'&&(_0x362657['style']=_0x439ba8,_0x362657[_0x18e471(0x12b)]=_0x331dc8),_0x201e38[_0x5a5942][_0x18e471(0x286)]===_0x18e471(0x17b)&&(_0x362657[_0x18e471(0x1cb)]=_0x439ba8,_0x362657[_0x18e471(0x21c)]=_0x331dc8),_0x201e38[_0x5a5942][_0x18e471(0x286)]==='effect_main_body'&&(_0x362657['effectMainBody']=_0x439ba8,_0x362657[_0x18e471(0x1f8)]=_0x331dc8),_0x201e38[_0x5a5942][_0x18e471(0x286)]===_0x18e471(0x1d3)&&(_0x362657[_0x18e471(0x11c)]=_0x439ba8,_0x362657[_0x18e471(0x21b)]=_0x331dc8);});}await this[_0x126f84(0x1b2)][_0x126f84(0x1ae)](Array[_0x126f84(0x140)](_0x437baf[_0x126f84(0xfc)]())),common_1['Logger'][_0x126f84(0xd7)]('触站::模型信息同步完成');}catch(_0x4eec5f){common_1['Logger']['error'](_0x4eec5f,'触站::模型信息同步失败');}}async[_0x32b9f0(0x19f)](_0xc0757e){const _0xc08507=_0x32b9f0,_0x4f45f0=await this['mjpTaskService'][_0xc08507(0x25e)]({'data':{'ids':[_0xc0757e]}});common_1[_0xc08507(0x16f)][_0xc08507(0xd7)](_0xc08507(0x108)),this[_0xc08507(0x1fa)](_0x4f45f0[0x0]);}async['vipFreeUsed'](_0x3a40c6){const _0x2e5bdc=_0x32b9f0,_0x48d2f9=await this[_0x2e5bdc(0x15b)][_0x2e5bdc(0xc5)](_0x3a40c6[_0x2e5bdc(0xea)]['id']),_0x58c782={'fast':0x0,'relax':0x0,'trubo':0x0};let _0x16ec49=redisKey_constant_1['VIP_FREE']+'-'+_0x48d2f9['id']+'-';if(_0x48d2f9[_0x2e5bdc(0x244)]||_0x48d2f9['lifetimeVip']){const [_0x5bc496,_0x363b0f,_0x5e74c8]=await Promise['all']([this['redisCacheService']['get']({'key':_0x16ec49+_0x2e5bdc(0x1a6)}),this[_0x2e5bdc(0x129)][_0x2e5bdc(0xf8)]({'key':_0x16ec49+'relax_vip_free'}),this[_0x2e5bdc(0x129)][_0x2e5bdc(0xf8)]({'key':_0x16ec49+_0x2e5bdc(0x125)})]);_0x58c782[_0x2e5bdc(0x11a)]=Number(_0x5bc496||0x0),_0x58c782[_0x2e5bdc(0x267)]=Number(_0x363b0f||0x0),_0x58c782[_0x2e5bdc(0x141)]=Number(_0x5e74c8||0x0);}return _0x58c782;}[_0x32b9f0(0x281)](_0x303493){const _0x449f5f=_0x32b9f0;if(typeof _0x303493===_0x449f5f(0xc4))return midjourney_constant_1[_0x449f5f(0x118)][_0x449f5f(0xf8)](_0x303493);if(typeof _0x303493===_0x449f5f(0x17a))return midjourney_constant_1[_0x449f5f(0x150)][_0x449f5f(0xf8)](_0x303493);}async[_0x32b9f0(0x1fa)](_0x364bd1){const _0x59f794=_0x32b9f0;common_1[_0x59f794(0x16f)][_0x59f794(0xd7)](_0x364bd1,_0x59f794(0x14b));try{let _0x26d5c5=[];const _0x5356b3=this[_0x59f794(0x281)](_0x364bd1['status']),_0x4b54a7=_0x364bd1[_0x59f794(0x270)]?parseFloat(_0x364bd1[_0x59f794(0x270)]):null;let _0x194843=await this[_0x59f794(0x154)]['findOne']({'where':{'mjpTaskId':_0x364bd1['id']}});if(_0x364bd1['status']===_0x59f794(0x132)&&_0x194843[_0x59f794(0x19d)]){common_1[_0x59f794(0x16f)][_0x59f794(0xd7)](_0x59f794(0x21d),_0x59f794(0x228));return;}_0x364bd1[_0x59f794(0x211)]&&(_0x26d5c5=_0x364bd1[_0x59f794(0x211)]['filter'](_0x14c07e=>_0x14c07e['label']!==_0x59f794(0x248)&&_0x14c07e[_0x59f794(0x1c5)]!=='Imagine\x20all'&&_0x14c07e[_0x59f794(0x183)]!=='❤️'));common_1[_0x59f794(0x16f)][_0x59f794(0xd7)](_0x364bd1['imageUrl'],_0x59f794(0xe9)),common_1['Logger'][_0x59f794(0xd7)](store_1[_0x59f794(0xd3)][_0x59f794(0x1a5)],_0x59f794(0xa2));store_1[_0x59f794(0xd3)][_0x59f794(0x1a5)]&&_0x364bd1[_0x59f794(0xf1)]&&(_0x364bd1[_0x59f794(0xf1)]=_0x364bd1[_0x59f794(0xf1)][_0x59f794(0x287)](_0x59f794(0x159),store_1[_0x59f794(0xd3)][_0x59f794(0x1a5)]));common_1[_0x59f794(0x16f)][_0x59f794(0xd7)](_0x364bd1[_0x59f794(0xf1)],'入库图片地址：');const _0x291436={'id':_0x194843['id'],'status':_0x5356b3,'progress':_0x4b54a7,'buttons':_0x26d5c5,'durationSpent':null,'imageUrl':_0x364bd1[_0x59f794(0xf1)],'failReason':_0x364bd1[_0x59f794(0x195)]};return(_0x364bd1[_0x59f794(0x260)]===_0x59f794(0x21a)||_0x364bd1[_0x59f794(0x260)]===0x4)&&(_0x291436['prompt']=_0x364bd1['finalPrompt']||_0x364bd1['properties']?.[_0x59f794(0xa9)],_0x291436[_0x59f794(0x1c6)]=_0x364bd1[_0x59f794(0xa9)]||_0x364bd1['properties']?.[_0x59f794(0xa9)]),_0x364bd1['finishTime']&&_0x364bd1[_0x59f794(0xd8)]&&(_0x291436[_0x59f794(0xf9)]=(_0x364bd1[_0x59f794(0xdb)]-_0x364bd1[_0x59f794(0xd8)])/0x3e8),_0x194843=await this[_0x59f794(0x154)]['save'](_0x291436),_0x364bd1[_0x59f794(0x266)]==='SUCCESS'&&_0x194843['imageUrl']&&this[_0x59f794(0xb8)]['transferImg'](_0x194843['id'],_0x194843[_0x59f794(0xf1)]),null;}catch(_0x50541a){common_1[_0x59f794(0x16f)][_0x59f794(0xce)](_0x59f794(0x1a9),_0x50541a);}}async[_0x32b9f0(0x1e6)](_0x24e13d){const _0x2e54a9=_0x32b9f0;common_1[_0x2e54a9(0x16f)]['log'](_0x24e13d,_0x2e54a9(0x103));try{const _0xfc99c9=midjourney_constant_1[_0x2e54a9(0x237)]['get'](_0x24e13d[_0x2e54a9(0x22f)]),_0x38150f=Number(_0x24e13d['progress'])*0x64;let _0x8b92ce=await this[_0x2e54a9(0x154)][_0x2e54a9(0x252)]({'where':{'mjpTaskId':_0x24e13d[_0x2e54a9(0x1c3)]}});const _0x205005={'id':_0x8b92ce['id'],'status':_0xfc99c9,'progress':_0x38150f,'imageUrl':_0x24e13d[_0x2e54a9(0x1bd)]?.[_0x2e54a9(0x24d)](_0x2a44d3=>_0x2a44d3[_0x2e54a9(0x143)])[_0x2e54a9(0x1f7)]('↢↣')};return _0x8b92ce=await this['midjourneyEntity'][_0x2e54a9(0x1ae)](_0x205005),_0x8b92ce[_0x2e54a9(0x266)]===0x3&&_0x8b92ce['imageUrl']&&this[_0x2e54a9(0xb8)]['transferImg'](_0x8b92ce['id'],_0x8b92ce[_0x2e54a9(0xf1)]),null;}catch(_0x1438c9){common_1['Logger'][_0x2e54a9(0xce)]('触站工作流任务通知异常:\x20',_0x1438c9);}}async[_0x32b9f0(0x1ef)](_0x95ce52){const _0x4d3580=_0x32b9f0;common_1['Logger'][_0x4d3580(0xd7)](_0x95ce52,_0x4d3580(0x153));try{const _0x12262d=midjourney_constant_1['CzStateMap'][_0x4d3580(0xf8)](_0x95ce52['state']),_0x525182=Number(_0x95ce52[_0x4d3580(0x270)])*0x64;let _0x155007=await this[_0x4d3580(0x154)][_0x4d3580(0x252)]({'where':{'mjpTaskId':_0x95ce52[_0x4d3580(0x1c3)]}});const _0x55069f={'id':_0x155007['id'],'status':_0x12262d,'progress':_0x525182,'imageUrl':_0x95ce52['images']?.[_0x4d3580(0x24d)](_0x8a704c=>_0x8a704c[_0x4d3580(0xf1)])[_0x4d3580(0x1f7)]('↢↣')};return _0x155007=await this[_0x4d3580(0x154)][_0x4d3580(0x1ae)](_0x55069f),_0x155007[_0x4d3580(0x266)]===0x3&&_0x155007[_0x4d3580(0xf1)]&&this[_0x4d3580(0xb8)][_0x4d3580(0x120)](_0x155007['id'],_0x155007[_0x4d3580(0xf1)]),null;}catch(_0x205b9d){common_1[_0x4d3580(0x16f)]['error'](_0x4d3580(0x12f),_0x205b9d);}}async[_0x32b9f0(0x24b)](){const _0x22a2c2=_0x32b9f0;this[_0x22a2c2(0x193)](),this[_0x22a2c2(0x263)](),this[_0x22a2c2(0x25b)]();}async['syncMjTask'](){const _0x1152fd=_0x32b9f0;try{const _0x4640c3=await this[_0x1152fd(0x154)][_0x1152fd(0xd1)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6]),'botType':(0x0,typeorm_2['In'])([DrawTaskPage_dto_1[_0x1152fd(0x165)][_0x1152fd(0x215)],DrawTaskPage_dto_1['EBotType']['NIJI_JOURNEY']])}});if(_0x4640c3[_0x1152fd(0x19e)])for(let _0x2d7408=0x0;_0x2d7408<_0x4640c3['length'];_0x2d7408++){const _0x4edd4b=redisKey_constant_1[_0x1152fd(0xaa)]+_0x4640c3[_0x2d7408][_0x1152fd(0x1a7)],_0x3d8ece=await this['redisCacheService']['get']({'key':_0x4edd4b});if(_0x3d8ece)continue;else this['redisCacheService']['set']({'key':_0x4edd4b,'val':'lock'}),this[_0x1152fd(0x1f4)]['listByCondition']({'data':{'ids':[_0x4640c3[_0x2d7408][_0x1152fd(0x1a7)]]}})[_0x1152fd(0x1e8)](async _0x5a8b29=>{const _0x1fa12a=_0x1152fd,_0x318e1b=_0x5a8b29[0x0],_0x432fb8=_0x4640c3[_0x2d7408],_0x54ef9e=this[_0x1fa12a(0x281)](_0x318e1b[_0x1fa12a(0x266)]),_0x1da689=_0x318e1b[_0x1fa12a(0x270)]?parseFloat(_0x318e1b[_0x1fa12a(0x270)]):null;if(_0x432fb8[_0x1fa12a(0x270)]===_0x1da689&&_0x432fb8['status']===_0x54ef9e){}else{const _0x1b2b8a=_0x318e1b[_0x1fa12a(0x211)][_0x1fa12a(0x111)](_0x37870b=>_0x37870b['label']!==_0x1fa12a(0x248)&&_0x37870b[_0x1fa12a(0x1c5)]!==_0x1fa12a(0x146)&&_0x37870b[_0x1fa12a(0x183)]!=='❤️'),_0x3cfa6e={'id':_0x432fb8['id'],'mjpTaskId':_0x318e1b['id'],'status':_0x54ef9e,'progress':_0x1da689,'buttons':_0x1b2b8a,'durationSpent':null,'imageUrl':_0x318e1b['imageUrl'],'failReason':_0x318e1b[_0x1fa12a(0x195)]};store_1[_0x1fa12a(0xd3)][_0x1fa12a(0x1a5)]&&_0x3cfa6e['imageUrl']&&(_0x3cfa6e[_0x1fa12a(0xf1)]=_0x3cfa6e[_0x1fa12a(0xf1)][_0x1fa12a(0x287)](_0x1fa12a(0x159),store_1[_0x1fa12a(0xd3)][_0x1fa12a(0x1a5)])),(_0x318e1b[_0x1fa12a(0x260)]==='DESCRIBE'||_0x318e1b['action']===0x4)&&(_0x3cfa6e[_0x1fa12a(0x251)]=_0x318e1b['finalPrompt']||_0x318e1b[_0x1fa12a(0x1ca)]?.[_0x1fa12a(0xa9)],_0x3cfa6e[_0x1fa12a(0x1c6)]=_0x318e1b[_0x1fa12a(0xa9)]||_0x318e1b['properties']?.[_0x1fa12a(0xa9)]),_0x318e1b['finishTime']&&_0x318e1b['startTime']&&(_0x3cfa6e['durationSpent']=(_0x318e1b[_0x1fa12a(0xdb)]-_0x318e1b[_0x1fa12a(0xd8)])/0x3e8),await this[_0x1fa12a(0x154)]['save'](_0x3cfa6e);}})[_0x1152fd(0xb2)](_0x24ceef=>{const _0x6cc835=_0x1152fd;common_1[_0x6cc835(0x16f)]['error'](_0x6cc835(0x22e),_0x24ceef);})[_0x1152fd(0xd6)](()=>{const _0x57ade5=_0x1152fd;this[_0x57ade5(0x129)]['del']({'key':_0x4edd4b});});}}catch(_0x5d3f4a){}}async[_0x32b9f0(0x263)](){const _0x168c3e=_0x32b9f0;try{const _0x2063d6=await this[_0x168c3e(0x154)][_0x168c3e(0xd1)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'mjpTaskId':(0x0,typeorm_2[_0x168c3e(0x123)])((0x0,typeorm_2[_0x168c3e(0x1da)])()),'botType':DrawTaskPage_dto_1[_0x168c3e(0x165)][_0x168c3e(0x179)]}});if(_0x2063d6[_0x168c3e(0x19e)])for(let _0x5d5c49=0x0;_0x5d5c49<_0x2063d6[_0x168c3e(0x19e)];_0x5d5c49++){const _0x194de8=redisKey_constant_1[_0x168c3e(0xaa)]+_0x2063d6[_0x5d5c49][_0x168c3e(0x1a7)],_0x4319ee=await this[_0x168c3e(0x129)][_0x168c3e(0xf8)]({'key':_0x194de8});if(_0x4319ee)continue;else{this[_0x168c3e(0x129)][_0x168c3e(0xe0)]({'key':_0x194de8,'val':'lock'});try{const _0xdca31c=await this[_0x168c3e(0x212)]['workflowTaskDetail']({'data':{'taskId':_0x2063d6[_0x5d5c49]['mjpTaskId']}});this[_0x168c3e(0x1e6)](_0xdca31c);}catch(_0x7629){common_1[_0x168c3e(0x16f)][_0x168c3e(0xce)]('wfTaskUpdateJob:\x20',_0x7629);}finally{this[_0x168c3e(0x129)][_0x168c3e(0xc0)]({'key':_0x194de8});}}}}catch(_0x9a3ced){}}async[_0x32b9f0(0x25b)](){const _0x26c877=_0x32b9f0;try{const _0x5a72d8=await this[_0x26c877(0x154)]['find']({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'botType':DrawTaskPage_dto_1[_0x26c877(0x165)]['SD']}});if(_0x5a72d8['length'])for(let _0x2d1d41=0x0;_0x2d1d41<_0x5a72d8[_0x26c877(0x19e)];_0x2d1d41++){const _0x23a505=redisKey_constant_1[_0x26c877(0xaa)]+_0x5a72d8[_0x2d1d41][_0x26c877(0x1a7)],_0x41a1d7=await this[_0x26c877(0x129)][_0x26c877(0xf8)]({'key':_0x23a505});if(_0x41a1d7)continue;else{this['redisCacheService'][_0x26c877(0xe0)]({'key':_0x23a505,'val':_0x26c877(0xa5)});try{const _0x2017e6=await this[_0x26c877(0x212)][_0x26c877(0xb4)]({'data':{'taskId':_0x5a72d8[_0x2d1d41][_0x26c877(0x1a7)]}});this[_0x26c877(0x1ef)](_0x2017e6);}catch(_0x1b2d1a){common_1[_0x26c877(0x16f)][_0x26c877(0xce)](_0x26c877(0x18c),_0x1b2d1a);}finally{this[_0x26c877(0x129)]['del']({'key':_0x23a505});}}}}catch(_0x8b6b34){}}async[_0x32b9f0(0x1d4)](){const _0x2c6f5c=_0x32b9f0;if(store_1[_0x2c6f5c(0xd3)][_0x2c6f5c(0x206)])return;try{const _0x419cd5=[{'status':0x3,'imageUrl':(0x0,typeorm_2[_0x2c6f5c(0x200)])(_0x2c6f5c(0x25c))}];store_1['MjConfig'][_0x2c6f5c(0x1a5)]&&_0x419cd5['push']({'status':0x3,'imageUrl':(0x0,typeorm_2[_0x2c6f5c(0x200)])(store_1[_0x2c6f5c(0xd3)][_0x2c6f5c(0x1a5)]+'%')});const _0x1fe9f6=await this[_0x2c6f5c(0x154)][_0x2c6f5c(0xd1)]({'where':_0x419cd5});if(_0x1fe9f6['length'])for(let _0x2ef12e=0x0;_0x2ef12e<_0x1fe9f6['length'];_0x2ef12e++){let {id:_0x3fc974,imageUrl:_0x5bfcd9}=_0x1fe9f6[_0x2ef12e];this[_0x2c6f5c(0xb8)][_0x2c6f5c(0x120)](_0x3fc974,_0x5bfcd9);}}catch(_0x4fc7a9){common_1[_0x2c6f5c(0x16f)][_0x2c6f5c(0xce)](_0x4fc7a9);}}};MidjourneyService=__decorate([(0x0,common_1[_0x32b9f0(0x280)])(),__param(0x0,(0x0,typeorm_1[_0x32b9f0(0x1eb)])(mjModel_entity_1[_0x32b9f0(0x14a)])),__param(0x1,(0x0,typeorm_1[_0x32b9f0(0x1eb)])(mjParam_entity_1[_0x32b9f0(0x278)])),__param(0x2,(0x0,typeorm_1[_0x32b9f0(0x1eb)])(mjPrompts_entity_1[_0x32b9f0(0x283)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1['MidjourneyEntity'])),__param(0x4,(0x0,typeorm_1[_0x32b9f0(0x1eb)])(mjSuggestWord_entity_1[_0x32b9f0(0x210)])),__param(0x5,(0x0,typeorm_1['InjectRepository'])(mjIncantation_entity_1[_0x32b9f0(0xed)])),__param(0x6,(0x0,typeorm_1[_0x32b9f0(0x1eb)])(mjInspireClassify_entity_1[_0x32b9f0(0x157)])),__param(0x7,(0x0,typeorm_1[_0x32b9f0(0x1eb)])(mjIncantationClassify_entity_1[_0x32b9f0(0x10b)])),__metadata('design:paramtypes',[typeorm_2[_0x32b9f0(0xfe)],typeorm_2['Repository'],typeorm_2[_0x32b9f0(0xfe)],typeorm_2[_0x32b9f0(0xfe)],typeorm_2[_0x32b9f0(0xfe)],typeorm_2[_0x32b9f0(0xfe)],typeorm_2[_0x32b9f0(0xfe)],typeorm_2[_0x32b9f0(0xfe)],nestjs_cls_1[_0x32b9f0(0x261)],dict_service_1[_0x32b9f0(0xbc)],user_service_1[_0x32b9f0(0x1b7)],file_service_1[_0x32b9f0(0x284)],fanyi_service_1['FanyiService'],aiLog_service_1[_0x32b9f0(0x1c9)],models_service_1[_0x32b9f0(0x220)],czTask_service_1[_0x32b9f0(0x288)],mjpTask_service_1[_0x32b9f0(0x156)],badwords_service_1[_0x32b9f0(0x216)],redisCache_service_1['RedisCacheService'],mjpAccount_service_1[_0x32b9f0(0x20f)],globalConfig_service_1[_0x32b9f0(0x164)],typeorm_2[_0x32b9f0(0x189)]])],MidjourneyService),exports[_0x32b9f0(0x145)]=MidjourneyService;