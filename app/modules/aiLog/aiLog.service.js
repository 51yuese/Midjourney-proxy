'use strict';const _0x5e821d=_0x83cc;(function(_0x1137c7,_0x349308){const _0x34205f=_0x83cc,_0x2a9f36=_0x1137c7();while(!![]){try{const _0x16b684=-parseInt(_0x34205f(0x1ad))/0x1+-parseInt(_0x34205f(0x1ca))/0x2+-parseInt(_0x34205f(0x1a5))/0x3+-parseInt(_0x34205f(0x1c2))/0x4*(-parseInt(_0x34205f(0x1a2))/0x5)+parseInt(_0x34205f(0x1b7))/0x6+parseInt(_0x34205f(0x1a1))/0x7*(parseInt(_0x34205f(0x1b6))/0x8)+-parseInt(_0x34205f(0x1b8))/0x9;if(_0x16b684===_0x349308)break;else _0x2a9f36['push'](_0x2a9f36['shift']());}catch(_0x3648f2){_0x2a9f36['push'](_0x2a9f36['shift']());}}}(_0x243d,0xf10ee));var __decorate=this&&this[_0x5e821d(0x1ae)]||function(_0x53bfb9,_0x3384da,_0x694ba9,_0x38259c){const _0x1afdc6=_0x5e821d;var _0x239e1b=arguments[_0x1afdc6(0x198)],_0x51e260=_0x239e1b<0x3?_0x3384da:_0x38259c===null?_0x38259c=Object[_0x1afdc6(0x199)](_0x3384da,_0x694ba9):_0x38259c,_0x3f2689;if(typeof Reflect===_0x1afdc6(0x1cc)&&typeof Reflect['decorate']===_0x1afdc6(0x19e))_0x51e260=Reflect[_0x1afdc6(0x1c7)](_0x53bfb9,_0x3384da,_0x694ba9,_0x38259c);else{for(var _0x27a3cf=_0x53bfb9['length']-0x1;_0x27a3cf>=0x0;_0x27a3cf--)if(_0x3f2689=_0x53bfb9[_0x27a3cf])_0x51e260=(_0x239e1b<0x3?_0x3f2689(_0x51e260):_0x239e1b>0x3?_0x3f2689(_0x3384da,_0x694ba9,_0x51e260):_0x3f2689(_0x3384da,_0x694ba9))||_0x51e260;}return _0x239e1b>0x3&&_0x51e260&&Object[_0x1afdc6(0x1b2)](_0x3384da,_0x694ba9,_0x51e260),_0x51e260;},__metadata=this&&this[_0x5e821d(0x1b5)]||function(_0x410d8f,_0x4f2d8c){const _0x1e2d74=_0x5e821d;if(typeof Reflect===_0x1e2d74(0x1cc)&&typeof Reflect[_0x1e2d74(0x1bd)]===_0x1e2d74(0x19e))return Reflect[_0x1e2d74(0x1bd)](_0x410d8f,_0x4f2d8c);},__param=this&&this[_0x5e821d(0x1a8)]||function(_0x25427b,_0x34b247){return function(_0x284bbe,_0x2ffba1){_0x34b247(_0x284bbe,_0x2ffba1,_0x25427b);};};Object[_0x5e821d(0x1b2)](exports,_0x5e821d(0x1bf),{'value':!![]}),exports[_0x5e821d(0x1c0)]=void 0x0;const typeorm_1=require(_0x5e821d(0x1c6)),common_1=require(_0x5e821d(0x1af)),typeorm_2=require('@nestjs/typeorm'),aiLogExt_entity_1=require(_0x5e821d(0x19d)),aiAgreeLog_entity_1=require('./aiAgreeLog.entity');function _0x243d(){const _0x52d028=['AiLogService','set','7184bmVTWo','message','playNum','agreeNum','typeorm','decorate','play','getAgreeByRelateId','3870742wcZqXO','connection','object','length','getOwnPropertyDescriptor','save','round','user','./aiLogExt.entity','function','BAD_REQUEST','HttpException','357uIsuIG','3795fWHgtE','delete','relateId','48918duSimA','aiAgreeLogEntity','action','__param','find','getAgreeMap','random','agree','208966ANgsah','__decorate','@nestjs/common','relateType','Connection','defineProperty','findOne','AiLogExtEntity','__metadata','141032UCYDux','7735368JWaCHS','3631086PeAXLU','InjectRepository','aiLogExtEntity','AiAgreeLogEntity','design:paramtypes','metadata','visitNum','__esModule'];_0x243d=function(){return _0x52d028;};return _0x243d();}let AiLogService=class AiLogService{constructor(_0x483e0d,_0x39fd59,_0x423c6b){const _0x1fa916=_0x5e821d;this[_0x1fa916(0x1ba)]=_0x483e0d,this[_0x1fa916(0x1a6)]=_0x39fd59,this['connection']=_0x423c6b;}async[_0x5e821d(0x1c9)](_0x28cb33,_0x4e28d7){const _0x5db60d=_0x5e821d,_0x43bddf=await this[_0x5db60d(0x1a6)][_0x5db60d(0x1b3)]({'where':{'relateId':_0x4e28d7,'relateType':_0x28cb33}});return _0x43bddf;}async[_0x5e821d(0x1aa)](_0x16b9ae,_0x2c6db9,_0xfb9ddf){const _0x44c741=_0x5e821d,_0x1b3bff=new Map();if(!_0x2c6db9[_0x44c741(0x198)])return _0x1b3bff;const _0x1d5332=await this[_0x44c741(0x1a6)][_0x44c741(0x1a9)]({'where':{'userId':_0x16b9ae,'relateType':_0xfb9ddf,'relateId':(0x0,typeorm_1['In'])(_0x2c6db9)}});return _0x1d5332['forEach'](_0x657e26=>{const _0x1ee7ac=_0x44c741;_0x1b3bff[_0x1ee7ac(0x1c1)](_0x657e26[_0x1ee7ac(0x1a4)],_0x657e26[_0x1ee7ac(0x1a7)]);}),_0x1b3bff;}async['getExtByRelate'](_0x1deece,_0x54d8bc){const _0x384c12=_0x5e821d,_0x1fdb5b=new Map();if(!_0x1deece[_0x384c12(0x198)])return _0x1fdb5b;const _0x74fad9=await this[_0x384c12(0x1ba)][_0x384c12(0x1a9)]({'where':{'relateId':(0x0,typeorm_1['In'])(_0x1deece),'relateType':_0x54d8bc}});return _0x74fad9['forEach'](_0x1925c1=>{const _0x1d0d77=_0x384c12;_0x1fdb5b['set'](_0x1925c1[_0x1d0d77(0x1a4)],_0x1925c1);}),_0x1fdb5b;}async[_0x5e821d(0x1ac)](_0x1e95d3,_0x465793){const _0x4385b1=_0x5e821d;try{const _0x43fe7c=_0x1e95d3[_0x4385b1(0x19c)]['id'],_0x3683c2=await this[_0x4385b1(0x1a6)]['findOne']({'where':{'userId':_0x43fe7c,'relateId':_0x465793[_0x4385b1(0x1a4)],'relateType':_0x465793[_0x4385b1(0x1b0)]}});return await this[_0x4385b1(0x1cb)]['transaction'](async()=>{const _0x364b7c=_0x4385b1;if(_0x3683c2&&_0x3683c2['action']===_0x465793['action'])await this[_0x364b7c(0x1a6)][_0x364b7c(0x1a3)]({'id':_0x3683c2['id']});else{const _0x1cc8aa={..._0x465793,'userId':_0x43fe7c,'relateId':_0x465793[_0x364b7c(0x1a4)],'relateType':_0x465793[_0x364b7c(0x1b0)],'id':_0x3683c2?_0x3683c2['id']:null};await this[_0x364b7c(0x1a6)]['save'](_0x1cc8aa);}let _0x27d329=await this[_0x364b7c(0x1ba)][_0x364b7c(0x1b3)]({'where':{'relateId':_0x465793['relateId']}});!_0x27d329&&(_0x27d329=new aiLogExt_entity_1[(_0x364b7c(0x1b4))](),_0x27d329[_0x364b7c(0x1a4)]=_0x465793[_0x364b7c(0x1a4)],_0x27d329[_0x364b7c(0x1b0)]=_0x465793[_0x364b7c(0x1b0)],_0x27d329['agreeNum']=0x0),_0x3683c2&&_0x3683c2[_0x364b7c(0x1a7)]===_0x465793[_0x364b7c(0x1a7)]?_0x465793['action']===_0x364b7c(0x1ac)?_0x27d329[_0x364b7c(0x1c5)]=_0x27d329[_0x364b7c(0x1c5)]-0x1:_0x27d329[_0x364b7c(0x1c5)]=_0x27d329[_0x364b7c(0x1c5)]+0x1:_0x465793[_0x364b7c(0x1a7)]==='agree'?_0x27d329[_0x364b7c(0x1c5)]=_0x27d329[_0x364b7c(0x1c5)]+Math[_0x364b7c(0x19b)](Math[_0x364b7c(0x1ab)]()*0x14):_0x27d329[_0x364b7c(0x1c5)]=_0x27d329[_0x364b7c(0x1c5)]-0x1,_0x27d329[_0x364b7c(0x1c5)]=_0x27d329['agreeNum']<0x0?0x0:_0x27d329['agreeNum'],await this[_0x364b7c(0x1ba)][_0x364b7c(0x19a)](_0x27d329);}),!![];}catch(_0x2be025){throw new common_1[(_0x4385b1(0x1a0))](_0x2be025[_0x4385b1(0x1c3)],common_1['HttpStatus'][_0x4385b1(0x19f)]);}}async['getByRelateId'](_0xf22e42,_0x1dbccc){const _0x2d6002=_0x5e821d,_0xf1e652=await this['aiLogExtEntity'][_0x2d6002(0x1b3)]({'where':{'relateId':_0x1dbccc,'relateType':_0xf22e42}});return _0xf1e652;}async[_0x5e821d(0x1c8)](_0xa13bac,_0x4556dc){const _0x3b6029=_0x5e821d;let _0xef7f42=await this[_0x3b6029(0x1ba)][_0x3b6029(0x1b3)]({'where':{'relateId':_0xa13bac,'relateType':_0x4556dc}});!_0xef7f42&&(_0xef7f42=new aiLogExt_entity_1['AiLogExtEntity'](),_0xef7f42['relateId']=_0xa13bac,_0xef7f42[_0x3b6029(0x1b0)]=_0x4556dc),_0xef7f42[_0x3b6029(0x1c4)]=_0xef7f42['playNum']+Math['round'](Math[_0x3b6029(0x1ab)]()*0x14),await this[_0x3b6029(0x1ba)][_0x3b6029(0x19a)](_0xef7f42);}async['increaseVisit'](_0x2ed6e5,_0xda6550){const _0x55f2ec=_0x5e821d;let _0x2b9630=await this[_0x55f2ec(0x1ba)]['findOne']({'where':{'relateId':_0xda6550,'relateType':_0x2ed6e5}});!_0x2b9630&&(_0x2b9630=new aiLogExt_entity_1[(_0x55f2ec(0x1b4))](),_0x2b9630[_0x55f2ec(0x1a4)]=_0xda6550,_0x2b9630[_0x55f2ec(0x1b0)]=_0x2ed6e5),_0x2b9630[_0x55f2ec(0x1be)]=_0x2b9630['visitNum']+Math[_0x55f2ec(0x19b)](Math['random']()*0x14),await this[_0x55f2ec(0x1ba)][_0x55f2ec(0x19a)](_0x2b9630);}};function _0x83cc(_0x33f63,_0x4f11b3){const _0x243d26=_0x243d();return _0x83cc=function(_0x83cc8d,_0x4625ae){_0x83cc8d=_0x83cc8d-0x198;let _0x3b6bb6=_0x243d26[_0x83cc8d];return _0x3b6bb6;},_0x83cc(_0x33f63,_0x4f11b3);}AiLogService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x5e821d(0x1b9)])(aiLogExt_entity_1['AiLogExtEntity'])),__param(0x1,(0x0,typeorm_2[_0x5e821d(0x1b9)])(aiAgreeLog_entity_1[_0x5e821d(0x1bb)])),__metadata(_0x5e821d(0x1bc),[typeorm_1['Repository'],typeorm_1['Repository'],typeorm_1[_0x5e821d(0x1b1)]])],AiLogService),exports['AiLogService']=AiLogService;