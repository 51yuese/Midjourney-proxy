'use strict';const _0x3b384a=_0x4f8f;(function(_0x46684e,_0x441b44){const _0x362013=_0x4f8f,_0x5ac5a3=_0x46684e();while(!![]){try{const _0x249eb4=parseInt(_0x362013(0xc6))/0x1+-parseInt(_0x362013(0xe7))/0x2*(-parseInt(_0x362013(0xe1))/0x3)+-parseInt(_0x362013(0xce))/0x4*(-parseInt(_0x362013(0xb2))/0x5)+-parseInt(_0x362013(0xc2))/0x6+parseInt(_0x362013(0xbb))/0x7*(-parseInt(_0x362013(0xd6))/0x8)+parseInt(_0x362013(0xc8))/0x9*(-parseInt(_0x362013(0xdd))/0xa)+-parseInt(_0x362013(0xc1))/0xb*(-parseInt(_0x362013(0xb7))/0xc);if(_0x249eb4===_0x441b44)break;else _0x5ac5a3['push'](_0x5ac5a3['shift']());}catch(_0x54ed91){_0x5ac5a3['push'](_0x5ac5a3['shift']());}}}(_0x3bf8,0x85d32));var __decorate=this&&this['__decorate']||function(_0x9e65f7,_0x5f47fd,_0x2db539,_0xd0ccb5){const _0x4d496f=_0x4f8f;var _0x448182=arguments[_0x4d496f(0xb9)],_0xd8ebfe=_0x448182<0x3?_0x5f47fd:_0xd0ccb5===null?_0xd0ccb5=Object[_0x4d496f(0xcf)](_0x5f47fd,_0x2db539):_0xd0ccb5,_0x5417a8;if(typeof Reflect===_0x4d496f(0xd7)&&typeof Reflect['decorate']===_0x4d496f(0xe8))_0xd8ebfe=Reflect[_0x4d496f(0xb5)](_0x9e65f7,_0x5f47fd,_0x2db539,_0xd0ccb5);else{for(var _0x42c440=_0x9e65f7[_0x4d496f(0xb9)]-0x1;_0x42c440>=0x0;_0x42c440--)if(_0x5417a8=_0x9e65f7[_0x42c440])_0xd8ebfe=(_0x448182<0x3?_0x5417a8(_0xd8ebfe):_0x448182>0x3?_0x5417a8(_0x5f47fd,_0x2db539,_0xd8ebfe):_0x5417a8(_0x5f47fd,_0x2db539))||_0xd8ebfe;}return _0x448182>0x3&&_0xd8ebfe&&Object['defineProperty'](_0x5f47fd,_0x2db539,_0xd8ebfe),_0xd8ebfe;},__metadata=this&&this[_0x3b384a(0xde)]||function(_0x618089,_0xf36ad4){const _0x31c2f8=_0x3b384a;if(typeof Reflect===_0x31c2f8(0xd7)&&typeof Reflect[_0x31c2f8(0xc4)]===_0x31c2f8(0xe8))return Reflect[_0x31c2f8(0xc4)](_0x618089,_0xf36ad4);},__param=this&&this[_0x3b384a(0xda)]||function(_0xf6fdf9,_0x131dc1){return function(_0x406b7b,_0xb70119){_0x131dc1(_0x406b7b,_0xb70119,_0xf6fdf9);};};Object[_0x3b384a(0xb1)](exports,_0x3b384a(0xd5),{'value':!![]}),exports[_0x3b384a(0xbd)]=void 0x0;function _0x4f8f(_0x48c6ef,_0xb685ed){const _0x3bf8db=_0x3bf8();return _0x4f8f=function(_0x4f8fa4,_0x17ccc1){_0x4f8fa4=_0x4f8fa4-0xaf;let _0x15e5eb=_0x3bf8db[_0x4f8fa4];return _0x15e5eb;},_0x4f8f(_0x48c6ef,_0xb685ed);}const typeorm_1=require(_0x3b384a(0xb6)),common_1=require(_0x3b384a(0xe2)),typeorm_2=require('@nestjs/typeorm'),aiLogExt_entity_1=require(_0x3b384a(0xc3)),aiAgreeLog_entity_1=require(_0x3b384a(0xcd));let AiLogService=class AiLogService{constructor(_0x3375d9,_0x2705e0,_0x47b08b){const _0x5955dd=_0x3b384a;this[_0x5955dd(0xd8)]=_0x3375d9,this[_0x5955dd(0xba)]=_0x2705e0,this[_0x5955dd(0xe3)]=_0x47b08b;}async[_0x3b384a(0xdc)](_0x1240c5,_0x4dbac0){const _0x348b7d=_0x3b384a,_0x1a0d6f=await this[_0x348b7d(0xba)]['findOne']({'where':{'relateId':_0x4dbac0,'relateType':_0x1240c5}});return _0x1a0d6f;}async[_0x3b384a(0xe4)](_0x162ac4,_0x5cd279,_0x4b639b){const _0xaf425c=_0x3b384a,_0xa1452e=new Map();if(!_0x5cd279[_0xaf425c(0xb9)])return _0xa1452e;const _0x339e4d=await this[_0xaf425c(0xba)]['find']({'where':{'userId':_0x162ac4,'relateType':_0x4b639b,'relateId':(0x0,typeorm_1['In'])(_0x5cd279)}});return _0x339e4d[_0xaf425c(0xb8)](_0x43f2c4=>{const _0x440362=_0xaf425c;_0xa1452e[_0x440362(0xd9)](_0x43f2c4['relateId'],_0x43f2c4[_0x440362(0xc7)]);}),_0xa1452e;}async[_0x3b384a(0xdf)](_0x2bf960,_0x2c1103){const _0x1f59b7=_0x3b384a,_0x499a82=new Map();if(!_0x2bf960[_0x1f59b7(0xb9)])return _0x499a82;const _0x540ebb=await this[_0x1f59b7(0xd8)]['find']({'where':{'relateId':(0x0,typeorm_1['In'])(_0x2bf960),'relateType':_0x2c1103}});return _0x540ebb[_0x1f59b7(0xb8)](_0xd55770=>{const _0x34c5a6=_0x1f59b7;_0x499a82[_0x34c5a6(0xd9)](_0xd55770[_0x34c5a6(0xcc)],_0xd55770);}),_0x499a82;}async[_0x3b384a(0xea)](_0x5bf938,_0x329f45){const _0x3e4ba9=_0x3b384a;try{const _0x4664e3=_0x5bf938[_0x3e4ba9(0xec)]['id'],_0x4ea0ec=await this[_0x3e4ba9(0xba)][_0x3e4ba9(0xd1)]({'where':{'userId':_0x4664e3,'relateId':_0x329f45[_0x3e4ba9(0xcc)],'relateType':_0x329f45['relateType']}});return await this[_0x3e4ba9(0xe3)]['transaction'](async()=>{const _0x1a0887=_0x3e4ba9;if(_0x4ea0ec&&_0x4ea0ec['action']===_0x329f45[_0x1a0887(0xc7)])await this[_0x1a0887(0xba)][_0x1a0887(0xd3)]({'id':_0x4ea0ec['id']});else{const _0x388ea1={..._0x329f45,'userId':_0x4664e3,'relateId':_0x329f45[_0x1a0887(0xcc)],'relateType':_0x329f45[_0x1a0887(0xc0)],'id':_0x4ea0ec?_0x4ea0ec['id']:null};await this[_0x1a0887(0xba)][_0x1a0887(0xb3)](_0x388ea1);}let _0x104e0a=await this[_0x1a0887(0xd8)][_0x1a0887(0xd1)]({'where':{'relateId':_0x329f45['relateId']}});!_0x104e0a&&(_0x104e0a=new aiLogExt_entity_1[(_0x1a0887(0xdb))](),_0x104e0a[_0x1a0887(0xcc)]=_0x329f45[_0x1a0887(0xcc)],_0x104e0a['relateType']=_0x329f45[_0x1a0887(0xc0)],_0x104e0a[_0x1a0887(0xc9)]=0x0),_0x4ea0ec&&_0x4ea0ec['action']===_0x329f45[_0x1a0887(0xc7)]?_0x329f45[_0x1a0887(0xc7)]==='agree'?_0x104e0a[_0x1a0887(0xc9)]=_0x104e0a[_0x1a0887(0xc9)]-0x1:_0x104e0a[_0x1a0887(0xc9)]=_0x104e0a['agreeNum']+0x1:_0x329f45['action']===_0x1a0887(0xea)?_0x104e0a[_0x1a0887(0xc9)]=_0x104e0a[_0x1a0887(0xc9)]+Math[_0x1a0887(0xe9)](Math[_0x1a0887(0xe5)]()*0x14):_0x104e0a['agreeNum']=_0x104e0a[_0x1a0887(0xc9)]-0x1,_0x104e0a[_0x1a0887(0xc9)]=_0x104e0a[_0x1a0887(0xc9)]<0x0?0x0:_0x104e0a['agreeNum'],await this[_0x1a0887(0xd8)]['save'](_0x104e0a);}),!![];}catch(_0x54d658){throw new common_1[(_0x3e4ba9(0xbe))](_0x54d658[_0x3e4ba9(0xe6)],common_1[_0x3e4ba9(0xd4)][_0x3e4ba9(0xe0)]);}}async[_0x3b384a(0xc5)](_0x386037,_0x315de4){const _0x204999=_0x3b384a,_0x58eeb2=await this[_0x204999(0xd8)][_0x204999(0xd1)]({'where':{'relateId':_0x315de4,'relateType':_0x386037}});return _0x58eeb2;}async[_0x3b384a(0xcb)](_0x31c7c7,_0x1e9596){const _0x284bb2=_0x3b384a;let _0x583dd5=await this[_0x284bb2(0xd8)][_0x284bb2(0xd1)]({'where':{'relateId':_0x31c7c7,'relateType':_0x1e9596}});!_0x583dd5&&(_0x583dd5=new aiLogExt_entity_1['AiLogExtEntity'](),_0x583dd5[_0x284bb2(0xcc)]=_0x31c7c7,_0x583dd5[_0x284bb2(0xc0)]=_0x1e9596),_0x583dd5[_0x284bb2(0xd2)]=_0x583dd5['playNum']+Math[_0x284bb2(0xe9)](Math[_0x284bb2(0xe5)]()*0x14),await this[_0x284bb2(0xd8)][_0x284bb2(0xb3)](_0x583dd5);}async[_0x3b384a(0xb0)](_0x1bfa02,_0x4d309f){const _0x4be970=_0x3b384a;let _0x25e95c=await this['aiLogExtEntity'][_0x4be970(0xd1)]({'where':{'relateId':_0x4d309f,'relateType':_0x1bfa02}});!_0x25e95c&&(_0x25e95c=new aiLogExt_entity_1[(_0x4be970(0xdb))](),_0x25e95c[_0x4be970(0xcc)]=_0x4d309f,_0x25e95c[_0x4be970(0xc0)]=_0x1bfa02),_0x25e95c[_0x4be970(0xbf)]=_0x25e95c[_0x4be970(0xbf)]+Math[_0x4be970(0xe9)](Math[_0x4be970(0xe5)]()*0x14),await this[_0x4be970(0xd8)][_0x4be970(0xb3)](_0x25e95c);}};function _0x3bf8(){const _0x1af95a=['./aiAgreeLog.entity','8wLeTCl','getOwnPropertyDescriptor','InjectRepository','findOne','playNum','delete','HttpStatus','__esModule','8cfsvAG','object','aiLogExtEntity','set','__param','AiLogExtEntity','getAgreeByRelateId','1390KojkyB','__metadata','getExtByRelate','BAD_REQUEST','66363LeivTJ','@nestjs/common','connection','getAgreeMap','random','message','76XtKVyE','function','round','agree','Injectable','user','Repository','increaseVisit','defineProperty','121715ZRMbYN','save','Connection','decorate','typeorm','240ZUkrhk','forEach','length','aiAgreeLogEntity','7321503ogXVRQ','AiAgreeLogEntity','AiLogService','HttpException','visitNum','relateType','663982HOtgIe','695886tjWbUI','./aiLogExt.entity','metadata','getByRelateId','199973QLPpmH','action','37971YRDdEJ','agreeNum','design:paramtypes','play','relateId'];_0x3bf8=function(){return _0x1af95a;};return _0x3bf8();}AiLogService=__decorate([(0x0,common_1[_0x3b384a(0xeb)])(),__param(0x0,(0x0,typeorm_2[_0x3b384a(0xd0)])(aiLogExt_entity_1['AiLogExtEntity'])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(aiAgreeLog_entity_1[_0x3b384a(0xbc)])),__metadata(_0x3b384a(0xca),[typeorm_1['Repository'],typeorm_1[_0x3b384a(0xaf)],typeorm_1[_0x3b384a(0xb4)]])],AiLogService),exports[_0x3b384a(0xbd)]=AiLogService;