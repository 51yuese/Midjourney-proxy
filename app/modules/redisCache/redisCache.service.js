'use strict';const _0x5afb80=_0x5031;function _0x5031(_0x56d973,_0x4cec21){const _0x2b84ae=_0x2b84();return _0x5031=function(_0x5031f3,_0x39e640){_0x5031f3=_0x5031f3-0x17c;let _0xbb345=_0x2b84ae[_0x5031f3];return _0xbb345;},_0x5031(_0x56d973,_0x4cec21);}function _0x2b84(){const _0xc5eab3=['zRange','user','visitor','2kTlvCQ','set','checkTokenAuth','ttl','6812624OZKVtj','38272PlkWmE','getOwnPropertyDescriptor','forEach','expire','metadata','2365947jZVcLw','saveToken','您已在其他设备覆盖登录、请您重新登录！','defineProperty','function','../../common/constants/Role.constant','2466bTYdTT','invalidateTokens','30MbPWDp','HttpStatus','1589207yhCIsT','756970efSeoG','fuzzy','length','object','__esModule','ERole','HttpException','Injectable','UNAUTHORIZED','del','keys','token:','980mLzFLO','__param','design:paramtypes','992492iAALfR','redisClient','__decorate','get','BAD_REQUEST','497948HFvOJD'];_0x2b84=function(){return _0xc5eab3;};return _0x2b84();}(function(_0x35b817,_0x43f2ea){const _0x2ac11c=_0x5031,_0x414e19=_0x35b817();while(!![]){try{const _0x2a8c8f=parseInt(_0x2ac11c(0x1a7))/0x1*(-parseInt(_0x2ac11c(0x193))/0x2)+parseInt(_0x2ac11c(0x19d))/0x3+parseInt(_0x2ac11c(0x18a))/0x4+parseInt(_0x2ac11c(0x1a8))/0x5*(-parseInt(_0x2ac11c(0x1a5))/0x6)+-parseInt(_0x2ac11c(0x197))/0x7+-parseInt(_0x2ac11c(0x198))/0x8*(parseInt(_0x2ac11c(0x1a3))/0x9)+parseInt(_0x2ac11c(0x187))/0xa*(parseInt(_0x2ac11c(0x18f))/0xb);if(_0x2a8c8f===_0x43f2ea)break;else _0x414e19['push'](_0x414e19['shift']());}catch(_0x11071c){_0x414e19['push'](_0x414e19['shift']());}}}(_0x2b84,0xcdc3b));var __decorate=this&&this[_0x5afb80(0x18c)]||function(_0x2db830,_0x149d22,_0x1707e8,_0xd9a617){const _0x3ee811=_0x5afb80;var _0x138e6a=arguments[_0x3ee811(0x17d)],_0x344aff=_0x138e6a<0x3?_0x149d22:_0xd9a617===null?_0xd9a617=Object[_0x3ee811(0x199)](_0x149d22,_0x1707e8):_0xd9a617,_0x475de6;if(typeof Reflect===_0x3ee811(0x17e)&&typeof Reflect['decorate']===_0x3ee811(0x1a1))_0x344aff=Reflect['decorate'](_0x2db830,_0x149d22,_0x1707e8,_0xd9a617);else{for(var _0x3311d8=_0x2db830['length']-0x1;_0x3311d8>=0x0;_0x3311d8--)if(_0x475de6=_0x2db830[_0x3311d8])_0x344aff=(_0x138e6a<0x3?_0x475de6(_0x344aff):_0x138e6a>0x3?_0x475de6(_0x149d22,_0x1707e8,_0x344aff):_0x475de6(_0x149d22,_0x1707e8))||_0x344aff;}return _0x138e6a>0x3&&_0x344aff&&Object[_0x3ee811(0x1a0)](_0x149d22,_0x1707e8,_0x344aff),_0x344aff;},__metadata=this&&this['__metadata']||function(_0x1ffe2c,_0x24a762){const _0x353da9=_0x5afb80;if(typeof Reflect===_0x353da9(0x17e)&&typeof Reflect[_0x353da9(0x19c)]===_0x353da9(0x1a1))return Reflect[_0x353da9(0x19c)](_0x1ffe2c,_0x24a762);},__param=this&&this[_0x5afb80(0x188)]||function(_0x1369a9,_0x3f0543){return function(_0x27554e,_0x159878){_0x3f0543(_0x27554e,_0x159878,_0x1369a9);};};Object['defineProperty'](exports,_0x5afb80(0x17f),{'value':!![]}),exports['RedisCacheService']=void 0x0;const common_1=require('@nestjs/common'),Role_constant_1=require(_0x5afb80(0x1a2));let RedisCacheService=class RedisCacheService{constructor(_0x85b9de){const _0x504d34=_0x5afb80;this[_0x504d34(0x18b)]=_0x85b9de;}async[_0x5afb80(0x18d)](_0xf41704){const _0x4f9e4d=_0x5afb80,{key:_0x3ebd9e}=_0xf41704;return await this[_0x4f9e4d(0x18b)]['get'](_0x3ebd9e);}async[_0x5afb80(0x194)](_0x574f25,_0x318c81){const _0x3684da=_0x5afb80;try{const {key:_0x66901f,val:_0x2b1065}=_0x574f25;await this['redisClient'][_0x3684da(0x194)](_0x66901f,_0x2b1065),_0x318c81&&await this[_0x3684da(0x18b)][_0x3684da(0x19b)](_0x66901f,_0x318c81);return;}catch(_0x1c96b7){throw new common_1[(_0x3684da(0x181))](_0x1c96b7,common_1[_0x3684da(0x1a6)][_0x3684da(0x18e)]);}}[_0x5afb80(0x17c)](_0x667954){const _0x4670d2=_0x5afb80;return this[_0x4670d2(0x18b)][_0x4670d2(0x185)](_0x667954+'*');}async[_0x5afb80(0x196)](_0x5b3000){const _0x1077cf=_0x5afb80;return await this[_0x1077cf(0x18b)][_0x1077cf(0x196)](_0x5b3000);}async[_0x5afb80(0x184)](_0x37d572){const _0x16518f=_0x5afb80,{key:_0x1d1c38}=_0x37d572;return await this[_0x16518f(0x18b)][_0x16518f(0x184)](_0x1d1c38);}async[_0x5afb80(0x19e)](_0x702e49,_0x4fbf5c){const _0x4e8493=_0x5afb80,_0x291215=await this[_0x4e8493(0x18b)][_0x4e8493(0x190)]('tokens:'+_0x702e49,0x0,-0x1);await this[_0x4e8493(0x1a4)](_0x702e49,_0x291215),await this['redisClient'][_0x4e8493(0x194)](_0x4e8493(0x186)+_0x702e49,_0x4fbf5c);}async[_0x5afb80(0x1a4)](_0x35d08e,_0x297e04){const _0x10ce45=_0x5afb80;_0x297e04[_0x10ce45(0x19a)](_0xf3104c=>{const _0x3c690c=_0x10ce45;this[_0x3c690c(0x18b)][_0x3c690c(0x184)](_0x3c690c(0x186)+_0x35d08e+':'+_0xf3104c);});}async[_0x5afb80(0x195)](_0x367a10,_0xdfce2f){const _0x4b2232=_0x5afb80,{id:_0x1bd174,role:_0x3d215e}=_0xdfce2f[_0x4b2232(0x191)];if(_0x3d215e===_0x4b2232(0x192))return!![];const _0x5d677f=await this['redisClient']['get']('token:'+_0x1bd174);if(_0x5d677f===null)return await this[_0x4b2232(0x18b)]['set']('token:'+_0x1bd174,_0x367a10),!![];if(_0x5d677f!==_0x367a10){if(_0x3d215e===Role_constant_1[_0x4b2232(0x180)]['SUPER'])return!![];throw new common_1[(_0x4b2232(0x181))](_0x4b2232(0x19f),common_1[_0x4b2232(0x1a6)][_0x4b2232(0x183)]);}}};RedisCacheService=__decorate([(0x0,common_1[_0x5afb80(0x182)])(),__param(0x0,(0x0,common_1['Inject'])('REDIS_CLIENT')),__metadata(_0x5afb80(0x189),[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;