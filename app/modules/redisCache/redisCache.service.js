'use strict';function _0x479f(){const _0x597cfb=['您已在其他设备覆盖登录、请您重新登录！','4087610RReVXQ','defineProperty','80780ujNSwD','get','13xtTamk','HttpStatus','decorate','124nEQyGK','__esModule','14EhOADR','3706373rQDPwJ','set','__metadata','36egRbGP','SUPER','4547832wnLImX','BAD_REQUEST','69507HFsCOh','tokens:','object','__param','visitor','Inject','length','invalidateTokens','ttl','metadata','../../common/constants/Role.constant','del','__decorate','RedisCacheService','expire','user','10570240cvAVHb','checkTokenAuth','HttpException','redisClient','576BSpjsD','48201rMHyNI','token:','REDIS_CLIENT','@nestjs/common','ERole','forEach','Injectable'];_0x479f=function(){return _0x597cfb;};return _0x479f();}const _0x24c68c=_0x5db9;(function(_0x52af60,_0x300c00){const _0x554452=_0x5db9,_0x3c9c1a=_0x52af60();while(!![]){try{const _0x9e0584=parseInt(_0x554452(0x1c6))/0x1*(-parseInt(_0x554452(0x1c4))/0x2)+-parseInt(_0x554452(0x1ba))/0x3*(parseInt(_0x554452(0x19b))/0x4)+parseInt(_0x554452(0x1c2))/0x5+parseInt(_0x554452(0x1a3))/0x6*(-parseInt(_0x554452(0x19d))/0x7)+-parseInt(_0x554452(0x1b9))/0x8*(-parseInt(_0x554452(0x1a5))/0x9)+parseInt(_0x554452(0x1b5))/0xa+-parseInt(_0x554452(0x19e))/0xb*(-parseInt(_0x554452(0x1a1))/0xc);if(_0x9e0584===_0x300c00)break;else _0x3c9c1a['push'](_0x3c9c1a['shift']());}catch(_0x512378){_0x3c9c1a['push'](_0x3c9c1a['shift']());}}}(_0x479f,0xdc4c4));function _0x5db9(_0x597622,_0x3b50d7){const _0x479ff3=_0x479f();return _0x5db9=function(_0x5db931,_0x392c03){_0x5db931=_0x5db931-0x19b;let _0x403ca5=_0x479ff3[_0x5db931];return _0x403ca5;},_0x5db9(_0x597622,_0x3b50d7);}var __decorate=this&&this[_0x24c68c(0x1b1)]||function(_0x524686,_0x4386d2,_0x23af11,_0x57c993){const _0x471cad=_0x24c68c;var _0x18b8c1=arguments[_0x471cad(0x1ab)],_0x10272c=_0x18b8c1<0x3?_0x4386d2:_0x57c993===null?_0x57c993=Object['getOwnPropertyDescriptor'](_0x4386d2,_0x23af11):_0x57c993,_0x22c954;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x10272c=Reflect[_0x471cad(0x1c8)](_0x524686,_0x4386d2,_0x23af11,_0x57c993);else{for(var _0x252145=_0x524686[_0x471cad(0x1ab)]-0x1;_0x252145>=0x0;_0x252145--)if(_0x22c954=_0x524686[_0x252145])_0x10272c=(_0x18b8c1<0x3?_0x22c954(_0x10272c):_0x18b8c1>0x3?_0x22c954(_0x4386d2,_0x23af11,_0x10272c):_0x22c954(_0x4386d2,_0x23af11))||_0x10272c;}return _0x18b8c1>0x3&&_0x10272c&&Object[_0x471cad(0x1c3)](_0x4386d2,_0x23af11,_0x10272c),_0x10272c;},__metadata=this&&this[_0x24c68c(0x1a0)]||function(_0x2bf3f7,_0x30122a){const _0x73cbe=_0x24c68c;if(typeof Reflect===_0x73cbe(0x1a7)&&typeof Reflect['metadata']==='function')return Reflect[_0x73cbe(0x1ae)](_0x2bf3f7,_0x30122a);},__param=this&&this[_0x24c68c(0x1a8)]||function(_0x2fd70e,_0x2a1b85){return function(_0x52579b,_0x379a61){_0x2a1b85(_0x52579b,_0x379a61,_0x2fd70e);};};Object[_0x24c68c(0x1c3)](exports,_0x24c68c(0x19c),{'value':!![]}),exports['RedisCacheService']=void 0x0;const common_1=require(_0x24c68c(0x1bd)),Role_constant_1=require(_0x24c68c(0x1af));let RedisCacheService=class RedisCacheService{constructor(_0x218fcc){this['redisClient']=_0x218fcc;}async[_0x24c68c(0x1c5)](_0x218658){const _0x1b7014=_0x24c68c,{key:_0x2513bf}=_0x218658;return await this[_0x1b7014(0x1b8)][_0x1b7014(0x1c5)](_0x2513bf);}async[_0x24c68c(0x19f)](_0x5a138a,_0x160327){const _0x13e951=_0x24c68c;try{const {key:_0x4002d9,val:_0x23a3a4}=_0x5a138a;await this['redisClient'][_0x13e951(0x19f)](_0x4002d9,_0x23a3a4),_0x160327&&await this[_0x13e951(0x1b8)][_0x13e951(0x1b3)](_0x4002d9,_0x160327);return;}catch(_0x4505ec){throw new common_1[(_0x13e951(0x1b7))](_0x4505ec,common_1[_0x13e951(0x1c7)][_0x13e951(0x1a4)]);}}['fuzzy'](_0xd6e2a1){const _0x4dd9a9=_0x24c68c;return this[_0x4dd9a9(0x1b8)]['keys'](_0xd6e2a1+'*');}async[_0x24c68c(0x1ad)](_0x541303){const _0x596fba=_0x24c68c;return await this[_0x596fba(0x1b8)]['ttl'](_0x541303);}async[_0x24c68c(0x1b0)](_0x9197a7){const _0x4d3dd6=_0x24c68c,{key:_0x3a3744}=_0x9197a7;return await this['redisClient'][_0x4d3dd6(0x1b0)](_0x3a3744);}async['saveToken'](_0x362be9,_0x5b5002){const _0x3f0147=_0x24c68c,_0x42c6c7=await this[_0x3f0147(0x1b8)]['zRange'](_0x3f0147(0x1a6)+_0x362be9,0x0,-0x1);await this[_0x3f0147(0x1ac)](_0x362be9,_0x42c6c7),await this['redisClient'][_0x3f0147(0x19f)]('token:'+_0x362be9,_0x5b5002);}async['invalidateTokens'](_0x15b90d,_0x127f78){const _0x110821=_0x24c68c;_0x127f78[_0x110821(0x1bf)](_0x529b3c=>{const _0x4c28ba=_0x110821;this['redisClient'][_0x4c28ba(0x1b0)](_0x4c28ba(0x1bb)+_0x15b90d+':'+_0x529b3c);});}async[_0x24c68c(0x1b6)](_0xe12782,_0x4322ea){const _0xf01c21=_0x24c68c,{id:_0x2c2121,role:_0x42c5c4}=_0x4322ea[_0xf01c21(0x1b4)];if(_0x42c5c4===_0xf01c21(0x1a9))return!![];const _0x27f625=await this[_0xf01c21(0x1b8)]['get'](_0xf01c21(0x1bb)+_0x2c2121);if(_0x27f625===null)return await this[_0xf01c21(0x1b8)][_0xf01c21(0x19f)]('token:'+_0x2c2121,_0xe12782),!![];if(_0x27f625!==_0xe12782){if(_0x42c5c4===Role_constant_1[_0xf01c21(0x1be)][_0xf01c21(0x1a2)])return!![];throw new common_1[(_0xf01c21(0x1b7))](_0xf01c21(0x1c1),common_1[_0xf01c21(0x1c7)]['UNAUTHORIZED']);}}};RedisCacheService=__decorate([(0x0,common_1[_0x24c68c(0x1c0)])(),__param(0x0,(0x0,common_1[_0x24c68c(0x1aa)])(_0x24c68c(0x1bc))),__metadata('design:paramtypes',[Object])],RedisCacheService),exports[_0x24c68c(0x1b2)]=RedisCacheService;