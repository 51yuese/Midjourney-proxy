'use strict';const _0x359479=_0x1d2a;function _0x395a(){const _0x39c83d=['getOne','__metadata','length','分页参数错误','get','28uOjkDe','password','filter','map','setManagerDelete','set','assign','queryManagerAccess','16703550NejTdT','queryAccessByIds','handleManagerUpdate','accessEntity','accessLabel','24562CDgIYN','添加管理员失败','GONE','save','parse','createRandomUid','flat','comparePassword','getManagerAccess','createUser','stringify','update','__decorate','userId','queryUserInfoByIds','../../common/utils','defineProperty','managerStatus','BAD_REQUEST','__param','queryAccessCount','1175280xWWJaM','Injectable','checked','createdAt','@nestjs/typeorm','123456','handleManagerAdd','catch','6xVHRce','HttpException','3913984eJLUac','handleSaveAccess','metadata','userMap','count','InjectRepository','./access.entity','handleUpdateStatus','findAndCount','queryOne','HttpStatus','createPsd','7CDSfZd','@manager.com','findOne','decorate','@nestjs/common','forEach','queryUserByUsername','affected','管理员已存在','typeorm','find','queryByPage','includes','updateUserPassword','getUserById','getOwnPropertyDescriptor','../user/user.service','AccessService','Repository','AccessEntity','管理员不存在','userService','48582880RPsXDF','function','6841060wCCroF','用户不存在','findBy','2946415FNEDKD','log','delete'];_0x395a=function(){return _0x39c83d;};return _0x395a();}(function(_0x42ce31,_0x52cf0c){const _0x1c7dbc=_0x1d2a,_0x134def=_0x42ce31();while(!![]){try{const _0x372455=-parseInt(_0x1c7dbc(0x15c))/0x1*(-parseInt(_0x1c7dbc(0x169))/0x2)+parseInt(_0x1c7dbc(0x17e))/0x3+-parseInt(_0x1c7dbc(0x151))/0x4+parseInt(_0x1c7dbc(0x154))/0x5*(-parseInt(_0x1c7dbc(0x186))/0x6)+-parseInt(_0x1c7dbc(0x194))/0x7*(parseInt(_0x1c7dbc(0x188))/0x8)+-parseInt(_0x1c7dbc(0x164))/0x9+parseInt(_0x1c7dbc(0x1aa))/0xa;if(_0x372455===_0x52cf0c)break;else _0x134def['push'](_0x134def['shift']());}catch(_0x15240c){_0x134def['push'](_0x134def['shift']());}}}(_0x395a,0xe7bb2));function _0x1d2a(_0xf486f2,_0x31333c){const _0x395ae2=_0x395a();return _0x1d2a=function(_0x1d2a58,_0x3dbe20){_0x1d2a58=_0x1d2a58-0x150;let _0xb34a4e=_0x395ae2[_0x1d2a58];return _0xb34a4e;},_0x1d2a(_0xf486f2,_0x31333c);}var __decorate=this&&this[_0x359479(0x175)]||function(_0x176529,_0x2c2834,_0x9c6f6e,_0x3d4b1e){const _0x11b971=_0x359479;var _0x15c34a=arguments[_0x11b971(0x159)],_0x1f9d46=_0x15c34a<0x3?_0x2c2834:_0x3d4b1e===null?_0x3d4b1e=Object[_0x11b971(0x1a3)](_0x2c2834,_0x9c6f6e):_0x3d4b1e,_0x5a86a0;if(typeof Reflect==='object'&&typeof Reflect[_0x11b971(0x197)]===_0x11b971(0x150))_0x1f9d46=Reflect[_0x11b971(0x197)](_0x176529,_0x2c2834,_0x9c6f6e,_0x3d4b1e);else{for(var _0x5e2505=_0x176529['length']-0x1;_0x5e2505>=0x0;_0x5e2505--)if(_0x5a86a0=_0x176529[_0x5e2505])_0x1f9d46=(_0x15c34a<0x3?_0x5a86a0(_0x1f9d46):_0x15c34a>0x3?_0x5a86a0(_0x2c2834,_0x9c6f6e,_0x1f9d46):_0x5a86a0(_0x2c2834,_0x9c6f6e))||_0x1f9d46;}return _0x15c34a>0x3&&_0x1f9d46&&Object[_0x11b971(0x179)](_0x2c2834,_0x9c6f6e,_0x1f9d46),_0x1f9d46;},__metadata=this&&this[_0x359479(0x158)]||function(_0xc0d4d4,_0x38222a){const _0x1a4c07=_0x359479;if(typeof Reflect==='object'&&typeof Reflect[_0x1a4c07(0x18a)]==='function')return Reflect[_0x1a4c07(0x18a)](_0xc0d4d4,_0x38222a);},__param=this&&this[_0x359479(0x17c)]||function(_0x1c7227,_0x576d90){return function(_0x2b4007,_0x36b54b){_0x576d90(_0x2b4007,_0x36b54b,_0x1c7227);};};Object[_0x359479(0x179)](exports,'__esModule',{'value':!![]}),exports['AccessService']=void 0x0;const common_1=require(_0x359479(0x198)),typeorm_1=require(_0x359479(0x182)),access_entity_1=require(_0x359479(0x18e)),typeorm_2=require(_0x359479(0x19d)),user_service_1=require(_0x359479(0x1a4)),utils_1=require(_0x359479(0x178));let AccessService=class AccessService{constructor(_0x5e6a4f,_0x29ea85){const _0x500716=_0x359479;this['accessEntity']=_0x5e6a4f,this['userService']=_0x29ea85,this[_0x500716(0x18b)]=new Map(),this[_0x500716(0x18b)]['clear']();}async[_0x359479(0x157)](_0x2824b3){const _0x37a88f=_0x359479;return await this['accessEntity'][_0x37a88f(0x196)]({'where':{'userId':_0x2824b3}});}async[_0x359479(0x171)](_0xa02f3c){const _0x203f92=_0x359479,{id:_0x40ac4a}=_0xa02f3c;if(!_0x40ac4a)throw new common_1[(_0x203f92(0x187))]('参数错误',common_1[_0x203f92(0x192)]['BAD_REQUEST']);const _0x5a4ca9=await this[_0x203f92(0x1a9)][_0x203f92(0x1a2)](_0x40ac4a);if(!_0x5a4ca9)throw new common_1[(_0x203f92(0x187))](_0x203f92(0x152),common_1[_0x203f92(0x192)]['BAD_REQUEST']);const _0x45ca39=await this[_0x203f92(0x167)]['findOne']({'where':{'userId':_0x5a4ca9['id']}});if(!_0x45ca39)throw new common_1['HttpException'](_0x203f92(0x1a8),common_1[_0x203f92(0x192)][_0x203f92(0x17b)]);const {role:_0x3edd30,username:_0x8a09a2}=_0x5a4ca9;return{..._0x45ca39,'role':_0x3edd30,'password':_0x5a4ca9[_0x203f92(0x15d)],'username':_0x8a09a2,'id':_0x5a4ca9['id']};}async[_0x359479(0x163)](_0x1e0146,_0x156323){const _0x154e26=_0x359479,{page:page=0x1,size:size=0xa,username:_0x1154bb,status:_0x3ed8c3,phone:_0x427d50}=_0x1e0146;if(!page||!size)throw new common_1[(_0x154e26(0x187))](_0x154e26(0x15a),0x190);const _0x2f1219={'userType':0x1};if(_0x1154bb){const {rows:_0x8967d8}=await this[_0x154e26(0x1a9)][_0x154e26(0x19f)]({'page':page,'size':size,'username':_0x1154bb,'email':'','status':0x0,'keyword':'','phone':_0x427d50}),_0x3cd514=_0x8967d8[_0x154e26(0x15f)](_0x417471=>_0x417471['id']),_0xd52969=await this[_0x154e26(0x167)][_0x154e26(0x153)]({'userId':(0x0,typeorm_2['In'])(_0x3cd514)}),_0x1fc3f5=new Map();_0x8967d8[_0x154e26(0x199)](_0x3c3b94=>{const _0x4c6d1d=_0x154e26;_0x1fc3f5[_0x4c6d1d(0x161)](_0x3c3b94['id'],_0x3c3b94);});const _0x27b94a=_0xd52969['map'](_0x2496ea=>Object[_0x154e26(0x162)]({},_0x2496ea,_0x1fc3f5[_0x154e26(0x15b)](_0x2496ea[_0x154e26(0x176)])));let _0x11f2e6=_0x3ed8c3>0x0?_0x27b94a[_0x154e26(0x15e)](_0x15fa1e=>_0x15fa1e[_0x154e26(0x17a)]===_0x3ed8c3):_0x27b94a;return{'rows':_0x11f2e6||[],'count':_0x11f2e6[_0x154e26(0x159)]||0x0};}[0x1,0x2,'1','2'][_0x154e26(0x1a0)](_0x3ed8c3)&&(_0x2f1219[_0x154e26(0x17a)]=_0x3ed8c3);const [_0x6b89fe,_0x456906]=await this[_0x154e26(0x167)][_0x154e26(0x190)]({'skip':(page-0x1)*size,'where':_0x2f1219,'take':size,'order':{'createdAt':'DESC'},'cache':!![],'select':[_0x154e26(0x17a),_0x154e26(0x176),_0x154e26(0x168),'id']}),_0x18884a=_0x6b89fe['map'](_0x57430a=>_0x57430a[_0x154e26(0x176)]),_0x4565c0=await this[_0x154e26(0x1a9)][_0x154e26(0x177)](_0x18884a);_0x4565c0['forEach'](_0x1a8057=>this['userMap']['set'](_0x1a8057['id'],_0x1a8057));const _0x16123c=_0x6b89fe[_0x154e26(0x15f)](_0xd5ed88=>{const _0x19c34b=_0x154e26,_0x23b9ac=this['userMap'][_0x19c34b(0x15b)](_0xd5ed88[_0x19c34b(0x176)]);return Object[_0x19c34b(0x162)]({},_0x23b9ac,_0xd5ed88);});return{'rows':_0x16123c||[],'count':_0x456906||0x0};}async[_0x359479(0x165)](_0x37e6fb){const _0xf5b24d=_0x359479;return await this[_0xf5b24d(0x167)][_0xf5b24d(0x19e)]({'where':{'userId':(0x0,typeorm_2['In'])(_0x37e6fb)},'select':['id','accessLabel',_0xf5b24d(0x181),_0xf5b24d(0x176)]});}async[_0x359479(0x17d)](){const _0x31e3fa=_0x359479;return await this[_0x31e3fa(0x167)][_0x31e3fa(0x18c)]();}async[_0x359479(0x160)](_0x3a6316){const _0x26e127=_0x359479,{id:_0x4443b7}=_0x3a6316,_0x187d58=await this[_0x26e127(0x167)][_0x26e127(0x196)]({'where':{'id':_0x4443b7}}),_0x100459=await this['userService']['delUser']({'id':_0x187d58[_0x26e127(0x176)],'moreId':0x0});if(_0x100459)return this[_0x26e127(0x167)][_0x26e127(0x156)]({'id':_0x4443b7});return![];}async[_0x359479(0x184)](_0x1d061e){const _0x10775a=_0x359479,{username:_0x32b2a1,access:_0x33c07a,role:_0x1cf969,password:_0xaf1b05}=_0x1d061e,_0x41be78=await this[_0x10775a(0x1a9)][_0x10775a(0x19a)](_0x32b2a1);if(_0x41be78&&(0x0,utils_1[_0x10775a(0x170)])(_0x32b2a1,_0x41be78[_0x10775a(0x15d)]))throw new common_1['HttpException'](_0x10775a(0x19c),common_1[_0x10775a(0x192)][_0x10775a(0x17b)]);const _0x4efeb0=(0x0,utils_1[_0x10775a(0x193)])(_0xaf1b05),_0x23cb40=(0x0,utils_1[_0x10775a(0x16e)])()+_0x10775a(0x195),_0x46ff22=await this[_0x10775a(0x1a9)][_0x10775a(0x172)]({'email':_0x23cb40,'username':_0x32b2a1,'status':0x1,'password':_0x4efeb0,'sex':0x1,'role':_0x1cf969});if(!_0x46ff22)throw new common_1['HttpException'](_0x10775a(0x16a),common_1[_0x10775a(0x192)][_0x10775a(0x17b)]);try{const _0x36079f=_0x33c07a[_0x10775a(0x159)]&&JSON[_0x10775a(0x16d)](_0x33c07a)[_0x10775a(0x15f)](_0x2e6984=>_0x2e6984[_0x10775a(0x180)])[_0x10775a(0x16f)](),_0x208a8c=await this['handleSaveAccess']({'userType':0x1,'access':_0x33c07a,'userId':_0x46ff22['id'],'accessLabel':_0x36079f[_0x10775a(0x159)]?_0x36079f:''});return!!_0x208a8c;}catch(_0x4057da){console[_0x10775a(0x155)]('error:\x20',_0x4057da);throw new common_1['HttpException'](_0x4057da,common_1[_0x10775a(0x192)][_0x10775a(0x17b)]);}}async[_0x359479(0x189)](_0x1dd7de){const _0x2dca95=_0x359479,{userType:_0x399f83,access:_0x35d7b7,userId:_0x1ea6bf,accessLabel:_0x1a506f}=_0x1dd7de;return await this[_0x2dca95(0x167)][_0x2dca95(0x16c)]({'userType':_0x399f83,'access':_0x35d7b7,'userId':_0x1ea6bf,'accessLabel':_0x1a506f&&JSON[_0x2dca95(0x173)](_0x1a506f)||''});}async[_0x359479(0x166)](_0x5d6469){const _0x26db98=_0x359479,{id:_0x20f230,userId:_0x1b87a7,access:_0x4d787b}=_0x5d6469,_0x514639=await this[_0x26db98(0x1a9)][_0x26db98(0x191)]({'id':_0x1b87a7});if(!_0x514639)throw new common_1[(_0x26db98(0x187))]('管理员不存在，请核对',common_1[_0x26db98(0x192)][_0x26db98(0x16b)]);try{const _0x3c9de2=_0x4d787b[_0x26db98(0x159)]&&JSON[_0x26db98(0x16d)](_0x4d787b)[_0x26db98(0x15f)](_0x1a2898=>_0x1a2898[_0x26db98(0x180)])[_0x26db98(0x16f)](),_0x1d8815=await this[_0x26db98(0x167)]['update']({'userId':_0x514639['id']},{'userId':_0x1b87a7,'access':_0x4d787b,'accessLabel':_0x3c9de2&&JSON[_0x26db98(0x173)](_0x3c9de2)||''})[_0x26db98(0x185)](_0x179c68=>{throw _0x179c68;});return!!_0x1d8815;}catch(_0x30cf8b){return console[_0x26db98(0x155)](_0x30cf8b),![];}}async[_0x359479(0x18f)](_0x5b6bd3){const _0x2f39e2=_0x359479,{id:_0x4b6352,status:_0x1fcff1}=_0x5b6bd3,_0x3cdfd4=await this[_0x2f39e2(0x167)][_0x2f39e2(0x174)](_0x4b6352,{'managerStatus':_0x1fcff1});return _0x3cdfd4[_0x2f39e2(0x19b)]>0x0;}async['handleResetPassword'](_0x3a6dc8){const _0xe67568=_0x359479,{id:_0x1a074f}=_0x3a6dc8,_0x382244=_0xe67568(0x183),_0x1a1aec=await this[_0xe67568(0x167)][_0xe67568(0x196)]({'where':{'id':_0x1a074f}});return this[_0xe67568(0x1a9)][_0xe67568(0x1a1)](_0x1a1aec[_0xe67568(0x176)],_0x382244);}};AccessService=__decorate([(0x0,common_1[_0x359479(0x17f)])(),__param(0x0,(0x0,typeorm_1[_0x359479(0x18d)])(access_entity_1[_0x359479(0x1a7)])),__metadata('design:paramtypes',[typeorm_2[_0x359479(0x1a6)],user_service_1['UserService']])],AccessService),exports[_0x359479(0x1a5)]=AccessService;