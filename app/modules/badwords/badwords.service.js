'use strict';const _0x56c6af=_0x3961;(function(_0x4f4b11,_0x1618e3){const _0x2af2d9=_0x3961,_0xe18df8=_0x4f4b11();while(!![]){try{const _0x43e1fe=-parseInt(_0x2af2d9(0x21a))/0x1+parseInt(_0x2af2d9(0x23e))/0x2+parseInt(_0x2af2d9(0x208))/0x3+parseInt(_0x2af2d9(0x212))/0x4*(-parseInt(_0x2af2d9(0x217))/0x5)+parseInt(_0x2af2d9(0x20b))/0x6+-parseInt(_0x2af2d9(0x209))/0x7*(-parseInt(_0x2af2d9(0x22b))/0x8)+-parseInt(_0x2af2d9(0x1f3))/0x9*(parseInt(_0x2af2d9(0x245))/0xa);if(_0x43e1fe===_0x1618e3)break;else _0xe18df8['push'](_0xe18df8['shift']());}catch(_0x46f121){_0xe18df8['push'](_0xe18df8['shift']());}}}(_0x2d1c,0x49dae));var __decorate=this&&this['__decorate']||function(_0x444917,_0x4df4c2,_0x5c11cd,_0x2c4dea){const _0xc7f011=_0x3961;var _0x4c216e=arguments[_0xc7f011(0x1f9)],_0x77a3f=_0x4c216e<0x3?_0x4df4c2:_0x2c4dea===null?_0x2c4dea=Object[_0xc7f011(0x1f7)](_0x4df4c2,_0x5c11cd):_0x2c4dea,_0x5e1eba;if(typeof Reflect===_0xc7f011(0x229)&&typeof Reflect[_0xc7f011(0x21e)]==='function')_0x77a3f=Reflect[_0xc7f011(0x21e)](_0x444917,_0x4df4c2,_0x5c11cd,_0x2c4dea);else{for(var _0x3475e4=_0x444917[_0xc7f011(0x1f9)]-0x1;_0x3475e4>=0x0;_0x3475e4--)if(_0x5e1eba=_0x444917[_0x3475e4])_0x77a3f=(_0x4c216e<0x3?_0x5e1eba(_0x77a3f):_0x4c216e>0x3?_0x5e1eba(_0x4df4c2,_0x5c11cd,_0x77a3f):_0x5e1eba(_0x4df4c2,_0x5c11cd))||_0x77a3f;}return _0x4c216e>0x3&&_0x77a3f&&Object[_0xc7f011(0x206)](_0x4df4c2,_0x5c11cd,_0x77a3f),_0x77a3f;},__metadata=this&&this['__metadata']||function(_0x55e4a9,_0x30471c){const _0x54487e=_0x3961;if(typeof Reflect===_0x54487e(0x229)&&typeof Reflect['metadata']===_0x54487e(0x216))return Reflect[_0x54487e(0x202)](_0x55e4a9,_0x30471c);},__param=this&&this['__param']||function(_0x3a5e5d,_0x369cb2){return function(_0x20f831,_0x5554e7){_0x369cb2(_0x20f831,_0x5554e7,_0x3a5e5d);};};Object[_0x56c6af(0x206)](exports,_0x56c6af(0x247),{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x56c6af(0x215)),badwords_entity_1=require(_0x56c6af(0x203)),typeorm_1=require(_0x56c6af(0x233)),typeorm_2=require(_0x56c6af(0x25e)),axios_1=require(_0x56c6af(0x238)),violationLog_entity_1=require(_0x56c6af(0x253)),utils_1=require(_0x56c6af(0x211)),user_service_1=require(_0x56c6af(0x214)),nestjs_cls_1=require(_0x56c6af(0x20d));function _0x3961(_0x1bdfb9,_0x5bb388){const _0x2d1cee=_0x2d1c();return _0x3961=function(_0x3961ef,_0x415515){_0x3961ef=_0x3961ef-0x1ed;let _0x6d27af=_0x2d1cee[_0x3961ef];return _0x6d27af;},_0x3961(_0x1bdfb9,_0x5bb388);}function _0x2d1c(){const _0x8d9a07=['status','keyword','axios','您提交的信息中包含','删除敏感词成功','敏感词已存在,请检查您的提交信息','category','design:paramtypes','764234NwmHaD','自定义','HttpException','typeOriginCn','formarTips','phone','forEach','16130GeUzxw','NineAi检测','__esModule','敏感词不存在,请检查您的提交信息','getSensitiveConfig','violationLogEntity','userId','DESC','error:\x20','nineaiCheckBadWords','delBadWords','application/x-www-form-urlencoded','BAD_REQUEST','delete','./violationLog.entity','code','敏感词检测\x20|\x20','hideString','user','删除敏感词失败','log','BadwordsService','default','affected','globalConfigService','@nestjs/typeorm','Repository','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','InjectRepository','email','isSuper','addBadWord','badWordsEntity','recordUserBadWords','violation','2718maUduC','的内容、我们已对您的账户进行标记、请合规使用！','join','checkBadWordsByConfig','getOwnPropertyDescriptor','findOne','length','检测失败','checkBadWords','您提交的内容中包含','getUserListByIds','push','HttpStatus','***','updateViolationCount','metadata','./badwords.entity','baiduTextAccessToken','baidu','defineProperty','badWords','1580751bxofPV','49BFmlgw','UserService','791412SBuxTZ','loadBadWords','nestjs-cls','post','自定义检测','delViolation','../../common/utils','48iITbAp','百度文本检测出现错误、请查看配置信息:\x20','../user/user.service','@nestjs/common','function','113020QZiugJ','ClsService','application/json','446245nwuTCH','save','data','baiduCheckBadWords','decorate','stringify','updateBadWords','word_list','的信息、我们已对您账号进行标记、请合规使用！','userservice','userInfo','GlobalConfigService','更新敏感词失败','ids','msg','object','百度云检测','532792fSCkJo','onModuleInit','添加敏感词成功','word','extractContent','customSensitiveWords','ViolationLogEntity','map','typeorm','更新敏感词成功','clsService'];_0x2d1c=function(){return _0x8d9a07;};return _0x2d1c();}let BadwordsService=class BadwordsService{constructor(_0x445626,_0x3ac4b8,_0x3ef083,_0x50e9b7,_0x6ceafb){const _0x1c24d1=_0x56c6af;this['badWordsEntity']=_0x445626,this[_0x1c24d1(0x24a)]=_0x3ac4b8,this[_0x1c24d1(0x235)]=_0x3ef083,this[_0x1c24d1(0x223)]=_0x50e9b7,this[_0x1c24d1(0x25d)]=_0x6ceafb,this[_0x1c24d1(0x207)]=[];}async[_0x56c6af(0x22c)](){const _0x57eb38=_0x56c6af;this[_0x57eb38(0x20c)]();}async[_0x56c6af(0x230)](_0x2b295a,_0x15fe43){const _0x3f6604=_0x56c6af,_0x3da3d7=[];for(let _0x140a07=0x0;_0x140a07<this['badWords'][_0x3f6604(0x1f9)];_0x140a07++){const _0x3fa1f6=this[_0x3f6604(0x207)][_0x140a07];_0x2b295a['includes'](_0x3fa1f6)&&_0x3da3d7[_0x3f6604(0x1fe)](_0x3fa1f6);}if(_0x3da3d7[_0x3f6604(0x1f9)]){await this[_0x3f6604(0x1f1)](_0x15fe43,_0x2b295a,_0x3da3d7,[_0x3f6604(0x23f)],_0x3f6604(0x20f));const _0x3b6ed9='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x3f6604(0x240))](_0x3b6ed9,common_1[_0x3f6604(0x1ff)][_0x3f6604(0x251)]);}return!![];}async[_0x56c6af(0x1fb)](_0x584670,_0x4ec725){const _0x2b3b20=_0x56c6af,_0xce35a0=await this[_0x2b3b20(0x25d)][_0x2b3b20(0x249)]();_0xce35a0&&await this[_0x2b3b20(0x1f6)](_0x584670,_0xce35a0,_0x4ec725),await this[_0x2b3b20(0x230)](_0x584670,_0x4ec725);}async[_0x56c6af(0x1f6)](_0x1ac37e,_0x75ab0d,_0x2c5da8){const _0x3002d5=_0x56c6af,{useType:_0x279a8d}=_0x75ab0d;_0x279a8d===_0x3002d5(0x205)&&await this[_0x3002d5(0x21d)](_0x1ac37e,_0x75ab0d[_0x3002d5(0x204)],_0x2c5da8),_0x279a8d==='nineai'&&await this[_0x3002d5(0x24e)](_0x1ac37e,_0x75ab0d,_0x2c5da8);}[_0x56c6af(0x22f)](_0x15ce58){const _0xf83c8d=/存在(.*?)不合规/,_0x48647a=_0x15ce58['match'](_0xf83c8d);return _0x48647a?_0x48647a[0x1]:'';}async[_0x56c6af(0x21d)](_0x4c6ae9,_0x29ed03,_0x1a4429){const _0x32bb62=_0x56c6af;if(!_0x29ed03)return;const _0x6005ac=_0x32bb62(0x260)+_0x29ed03+'}',_0x3898bb={'Content-Type':_0x32bb62(0x250),'Accept':_0x32bb62(0x219)},_0x5c7071=await axios_1[_0x32bb62(0x25b)]['post'](_0x6005ac,{'text':_0x4c6ae9},{'headers':_0x3898bb}),{conclusion:_0x511928,error_code:_0x11d8c7,error_msg:_0x29d3b6,conclusionType:_0x255749,data:_0x5bb58a}=_0x5c7071[_0x32bb62(0x21c)];_0x11d8c7&&console[_0x32bb62(0x259)](_0x32bb62(0x213),_0x29d3b6);if(_0x255749!==0x1){const _0x173a9e=[...new Set(_0x5bb58a['map'](_0x2d2263=>this['extractContent'](_0x2d2263[_0x32bb62(0x228)])))];await this['recordUserBadWords'](_0x1a4429,_0x4c6ae9,[_0x32bb62(0x200)],_0x173a9e,_0x32bb62(0x22a));const _0x41cd66=_0x32bb62(0x239)+_0x173a9e[_0x32bb62(0x1f5)](',')+_0x32bb62(0x1f4);throw new common_1[(_0x32bb62(0x240))](_0x41cd66,common_1[_0x32bb62(0x1ff)][_0x32bb62(0x251)]);}}async[_0x56c6af(0x24e)](_0x597122,_0x531624,_0x418d11){const _0x5b1c4b=_0x56c6af,{nineaiBuiltInSensitiveApiBase:_0x2cdd79,nineaiBuiltInSensitiveAuthKey:_0x348530}=_0x531624;if(!_0x2cdd79||!_0x348530)return;const _0x45137e=await axios_1[_0x5b1c4b(0x25b)][_0x5b1c4b(0x20e)](_0x2cdd79,{'content':_0x597122},{'headers':{'Content-Type':_0x5b1c4b(0x219),'Authorization':_0x348530}});if(!_0x45137e[_0x5b1c4b(0x21c)])return;if(_0x45137e[_0x5b1c4b(0x21c)][_0x5b1c4b(0x254)]!=='0'){const {msg:msg=_0x5b1c4b(0x1fa)}=_0x45137e[_0x5b1c4b(0x21c)];throw new common_1[(_0x5b1c4b(0x240))](_0x5b1c4b(0x255)+msg,common_1[_0x5b1c4b(0x1ff)][_0x5b1c4b(0x251)]);}if(_0x45137e[_0x5b1c4b(0x21c)][_0x5b1c4b(0x221)]&&_0x45137e[_0x5b1c4b(0x21c)][_0x5b1c4b(0x221)]?.[_0x5b1c4b(0x1f9)]){const _0x4c43df=[...new Set(_0x45137e[_0x5b1c4b(0x21c)]['word_list'][_0x5b1c4b(0x232)](_0x15a2ee=>_0x15a2ee[_0x5b1c4b(0x237)]))],_0x1c70f6=[...new Set(_0x45137e[_0x5b1c4b(0x21c)][_0x5b1c4b(0x221)][_0x5b1c4b(0x232)](_0x20338e=>_0x20338e['category']))];await this[_0x5b1c4b(0x1f1)](_0x418d11,_0x597122,_0x4c43df,_0x1c70f6,_0x5b1c4b(0x246));const _0x2b1790=this[_0x5b1c4b(0x242)](_0x45137e['data'][_0x5b1c4b(0x221)]);throw new common_1['HttpException'](_0x2b1790,common_1[_0x5b1c4b(0x1ff)][_0x5b1c4b(0x251)]);}}[_0x56c6af(0x242)](_0x4220f3){const _0x50e620=_0x56c6af,_0x1b85e5=_0x4220f3[_0x50e620(0x232)](_0x12cc09=>_0x12cc09[_0x50e620(0x23c)]),_0x55b458=[...new Set(_0x1b85e5)];return _0x50e620(0x1fc)+_0x55b458[_0x50e620(0x1f5)](',')+_0x50e620(0x222);}async['loadBadWords'](){const _0x3653b0=_0x56c6af,_0x1a58c8=await this['badWordsEntity']['find']({'where':{'status':0x1},'select':[_0x3653b0(0x22e)]});this[_0x3653b0(0x207)]=_0x1a58c8[_0x3653b0(0x232)](_0x1cb7a9=>_0x1cb7a9[_0x3653b0(0x22e)]);}async['queryBadWords'](_0x7b7127){const _0x39ab27=_0x56c6af,{page:page=0x1,size:size=0x1f4,word:_0xe2247,status:_0x146689}=_0x7b7127,_0x3c5c26={};[0x0,0x1,'0','1']['includes'](_0x146689)&&(_0x3c5c26[_0x39ab27(0x236)]=_0x146689),_0xe2247&&(_0x3c5c26[_0x39ab27(0x22e)]=(0x0,typeorm_1['Like'])('%'+_0xe2247+'%'));const [_0x393b24,_0x5170ef]=await this[_0x39ab27(0x1f0)]['findAndCount']({'where':_0x3c5c26,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x393b24,'count':_0x5170ef};}async[_0x56c6af(0x24f)](_0x503f30){const _0x2f4552=_0x56c6af,_0x3dc9d6=await this[_0x2f4552(0x1f0)][_0x2f4552(0x1f8)]({'where':{'id':_0x503f30['id']}});if(!_0x3dc9d6)throw new common_1['HttpException'](_0x2f4552(0x248),common_1[_0x2f4552(0x1ff)][_0x2f4552(0x251)]);const _0x25b90d=await this[_0x2f4552(0x1f0)][_0x2f4552(0x252)]({'id':_0x503f30['id']});if(_0x25b90d[_0x2f4552(0x25c)]>0x0)return await this[_0x2f4552(0x20c)](),_0x2f4552(0x23a);else throw new common_1[(_0x2f4552(0x240))](_0x2f4552(0x258),common_1[_0x2f4552(0x1ff)][_0x2f4552(0x251)]);}async[_0x56c6af(0x220)](_0x43489f){const _0x10a78c=_0x56c6af,{id:_0x3d033c,word:_0x1a7e78,status:_0x3e9e12}=_0x43489f,_0x2a325c=await this[_0x10a78c(0x1f0)][_0x10a78c(0x1f8)]({'where':{'word':_0x1a7e78}});if(_0x2a325c)throw new common_1[(_0x10a78c(0x240))]('敏感词已经存在了、请勿重复添加',common_1[_0x10a78c(0x1ff)]['BAD_REQUEST']);const _0x2d3ebe=await this[_0x10a78c(0x1f0)]['update']({'id':_0x3d033c},{'word':_0x1a7e78,'status':_0x3e9e12});if(_0x2d3ebe[_0x10a78c(0x25c)]>0x0)return await this['loadBadWords'](),_0x10a78c(0x234);else throw new common_1['HttpException'](_0x10a78c(0x226),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x56c6af(0x1ef)](_0x55de04){const _0x44edac=_0x56c6af,{word:_0x53b889}=_0x55de04,_0x4581d2=await this['badWordsEntity']['findOne']({'where':{'word':_0x53b889}});if(_0x4581d2)throw new common_1[(_0x44edac(0x240))](_0x44edac(0x23b),common_1[_0x44edac(0x1ff)][_0x44edac(0x251)]);return await this['badWordsEntity'][_0x44edac(0x21b)]({'word':_0x53b889}),await this[_0x44edac(0x20c)](),_0x44edac(0x22d);}async[_0x56c6af(0x1f1)](_0x4eb33f,_0x1f75fd,_0x2242d6,_0x15d840,_0x176ad3){const _0x596c20=_0x56c6af,_0x1a7324={'userId':_0x4eb33f,'content':_0x1f75fd,'words':JSON[_0x596c20(0x21f)](_0x2242d6),'typeCn':JSON[_0x596c20(0x21f)](_0x15d840),'typeOriginCn':_0x176ad3};try{await this[_0x596c20(0x223)][_0x596c20(0x201)](_0x4eb33f),await this[_0x596c20(0x24a)][_0x596c20(0x21b)](_0x1a7324);}catch(_0x568ae4){console['log'](_0x596c20(0x24d),_0x568ae4);}}async[_0x56c6af(0x1f2)](_0x6bddb7,_0x7145dc){const _0x3ee973=_0x56c6af,{role:_0xf23763}=_0x6bddb7[_0x3ee973(0x257)],{page:page=0x1,size:size=0xa,userId:_0x4de36c,typeOriginCn:_0x3d7950}=_0x7145dc,_0x5e768c={'delFlag':0x0};_0x4de36c&&(_0x5e768c['userId']=_0x4de36c),_0x3d7950&&(_0x5e768c[_0x3ee973(0x241)]=_0x3d7950);const [_0x27f1ab,_0x343e1a]=await this[_0x3ee973(0x24a)]['findAndCount']({'where':_0x5e768c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3ee973(0x24c)}}),_0x2e5af0=[...new Set(_0x27f1ab[_0x3ee973(0x232)](_0x444f47=>_0x444f47[_0x3ee973(0x24b)]))],_0x9ad38c=await this[_0x3ee973(0x223)][_0x3ee973(0x1fd)](_0x2e5af0);return _0x27f1ab[_0x3ee973(0x244)](_0x5c4020=>{const _0x52d938=_0x3ee973,_0x5000e0=_0x9ad38c['find'](_0x2e19d8=>_0x2e19d8['id']===_0x5c4020[_0x52d938(0x24b)]);!(0x0,utils_1[_0x52d938(0x1ee)])(this[_0x52d938(0x235)])&&(_0x5000e0[_0x52d938(0x1ed)]=(0x0,utils_1[_0x52d938(0x256)])(_0x5000e0[_0x52d938(0x1ed)]),_0x5000e0[_0x52d938(0x243)]=(0x0,utils_1[_0x52d938(0x256)])(_0x5000e0[_0x52d938(0x243)])),_0x5c4020[_0x52d938(0x224)]=_0x5000e0;}),{'rows':_0x27f1ab,'count':_0x343e1a};}async[_0x56c6af(0x210)](_0x318f87){const _0x22f1c8=_0x56c6af;if(!_0x318f87[_0x22f1c8(0x227)][_0x22f1c8(0x1f9)])return!![];return await this[_0x22f1c8(0x24a)]['update']({'id':(0x0,typeorm_1['In'])(_0x318f87[_0x22f1c8(0x227)])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x56c6af(0x261)])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0x56c6af(0x261)])(violationLog_entity_1[_0x56c6af(0x231)])),__metadata(_0x56c6af(0x23d),[typeorm_1[_0x56c6af(0x25f)],typeorm_1[_0x56c6af(0x25f)],nestjs_cls_1[_0x56c6af(0x218)],user_service_1[_0x56c6af(0x20a)],globalConfig_service_1[_0x56c6af(0x225)]])],BadwordsService),exports[_0x56c6af(0x25a)]=BadwordsService;