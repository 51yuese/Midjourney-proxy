'use strict';const _0x2f81f6=_0xdbe1;function _0x1070(){const _0x278a17=['cheveretoUploadPath','message','data','ali-oss','onModuleInit','tencentCos','@nestjs/typeorm','save','toString','tencent','stringify','https://$2','uploadFile','1790050kbZTHL','readFileSync','env','任务原始图片获取失败','aliOssBucket','transferAndCover','HttpStatus','MjConfig','HttpException','exec','image','putObject','\x0a\x20\x20\x20\x20\x20\x20','imageUrl','writeHead','base64','../../common/utils','../../common/store','uploadFileByTencentCos','metadata','../midjourney/midjourney.entity','https://','BAD_REQUEST','replace','cosSecretId','.mp4','log','uploadFileByAliOss','axios','transferAndCover\x20error:\x20','131865mpcPiJ','getUploadConfig','transferFile','split','mj-','chevereto','originTaskId','.jpg','aliOssRegion','default','existsSync','ali','findOne','__param','content-type','getOwnPropertyDescriptor','response','from','pop','url','globalConfigService','264282XjmQOy','del','上传图片失败[ali]','__esModule','image-size','aliCos','\x0a\x20\x20\x20\x20\x20\x20\x20\x20ffmpeg\x20-i\x20','arraybuffer','transferFile\x20error:\x20','binary','status','ali\x20开始上传','uploadFileByLocal','Injectable','../../common/constants/redisKey.constant','function','createRandomUid','1968684iApuko','object','上传图片失败[ten]','key','8RQnkYA','mkdirSync','webroot','join','put','tencentCosStatus','cheveretoKey','append','removeSpecialCharacters','length','RedisCacheService','上传图片失败[Chevereto|buffer]\x20-->\x20','error:\x20','defineProperty','error','1084848MFmWlN','2764818FctKUP','aliOssAccessKeyId','cheveretoStatus','FileService','data:image/jpeg;base64,','tencentCosAcceleratedDomain','aliOssStatus','source','13429843adKbZo','.png','/upload/','当前已开启全球加速----------------->','path','__decorate','design:paramtypes','Repository','typeorm','rmSync','Location','cos-nodejs-sdk-v5','transferImg','@nestjs/common','get','上传图片失败[Chevereto]','__metadata','midjourneyEntity','Logger','redisCacheService','MidjourneyEntity','uploadFileByChevereto','getCover','\x20-y\x20-f\x20image2\x20-ss\x202\x20-frames:v\x201\x20-update\x20true\x20','headers','InjectRepository','child_process','getConfigByKeys'];_0x1070=function(){return _0x278a17;};return _0x1070();}(function(_0x5059d1,_0x194a22){const _0x9fbbe3=_0xdbe1,_0x132b0d=_0x5059d1();while(!![]){try{const _0x20b29e=parseInt(_0x9fbbe3(0xa8))/0x1+-parseInt(_0x9fbbe3(0xda))/0x2+-parseInt(_0x9fbbe3(0xa9))/0x3+-parseInt(_0x9fbbe3(0x95))/0x4+-parseInt(_0x9fbbe3(0xf8))/0x5+-parseInt(_0x9fbbe3(0x84))/0x6+-parseInt(_0x9fbbe3(0xb1))/0x7*(-parseInt(_0x9fbbe3(0x99))/0x8);if(_0x20b29e===_0x194a22)break;else _0x132b0d['push'](_0x132b0d['shift']());}catch(_0x33bbda){_0x132b0d['push'](_0x132b0d['shift']());}}}(_0x1070,0x9862f));var __decorate=this&&this[_0x2f81f6(0xb6)]||function(_0x7ca72,_0x1bd1f2,_0x588bfe,_0x3681bc){const _0x5e01e9=_0x2f81f6;var _0x542b5a=arguments['length'],_0x4430fb=_0x542b5a<0x3?_0x1bd1f2:_0x3681bc===null?_0x3681bc=Object[_0x5e01e9(0x7e)](_0x1bd1f2,_0x588bfe):_0x3681bc,_0x3fcaa4;if(typeof Reflect===_0x5e01e9(0x96)&&typeof Reflect['decorate']==='function')_0x4430fb=Reflect['decorate'](_0x7ca72,_0x1bd1f2,_0x588bfe,_0x3681bc);else{for(var _0x2dcbc7=_0x7ca72[_0x5e01e9(0xa2)]-0x1;_0x2dcbc7>=0x0;_0x2dcbc7--)if(_0x3fcaa4=_0x7ca72[_0x2dcbc7])_0x4430fb=(_0x542b5a<0x3?_0x3fcaa4(_0x4430fb):_0x542b5a>0x3?_0x3fcaa4(_0x1bd1f2,_0x588bfe,_0x4430fb):_0x3fcaa4(_0x1bd1f2,_0x588bfe))||_0x4430fb;}return _0x542b5a>0x3&&_0x4430fb&&Object[_0x5e01e9(0xa6)](_0x1bd1f2,_0x588bfe,_0x4430fb),_0x4430fb;},__metadata=this&&this[_0x2f81f6(0xc1)]||function(_0x588743,_0x39d214){const _0x454618=_0x2f81f6;if(typeof Reflect===_0x454618(0x96)&&typeof Reflect[_0x454618(0xed)]===_0x454618(0x93))return Reflect[_0x454618(0xed)](_0x588743,_0x39d214);},__param=this&&this[_0x2f81f6(0x7c)]||function(_0x229f8c,_0x273a7a){return function(_0x2c4cd9,_0x393b4b){_0x273a7a(_0x2c4cd9,_0x393b4b,_0x229f8c);};};Object[_0x2f81f6(0xa6)](exports,_0x2f81f6(0x87),{'value':!![]}),exports[_0x2f81f6(0xac)]=void 0x0;const common_1=require(_0x2f81f6(0xbe)),TENCENTCOS=require(_0x2f81f6(0xbc)),ALIOSS=require(_0x2f81f6(0xd0)),axios_1=require(_0x2f81f6(0xf6)),image_size_1=require(_0x2f81f6(0x88)),utils_1=require(_0x2f81f6(0xea)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),FormData=require('form-data'),midjourney_entity_1=require(_0x2f81f6(0xee)),typeorm_1=require(_0x2f81f6(0xd3)),typeorm_2=require(_0x2f81f6(0xb9)),redisKey_constant_1=require(_0x2f81f6(0x92)),redisCache_service_1=require('../redisCache/redisCache.service'),store_1=require(_0x2f81f6(0xeb)),path_1=require(_0x2f81f6(0xb5)),promises_1=require('fs/promises'),fs_1=require('fs'),child_process_1=require(_0x2f81f6(0xcb));function _0xdbe1(_0x5139af,_0x4fc506){const _0x10709c=_0x1070();return _0xdbe1=function(_0xdbe1b1,_0x5800b5){_0xdbe1b1=_0xdbe1b1-0x77;let _0x2600ca=_0x10709c[_0xdbe1b1];return _0x2600ca;},_0xdbe1(_0x5139af,_0x4fc506);}let FileService=class FileService{constructor(_0x493d5d,_0x320533,_0x301208){const _0x4409e1=_0x2f81f6;this['midjourneyEntity']=_0x493d5d,this[_0x4409e1(0x83)]=_0x320533,this[_0x4409e1(0xc4)]=_0x301208;}async[_0x2f81f6(0xd1)](){const _0xaab3d3=_0x2f81f6,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0xaab3d3(0x83)][_0xaab3d3(0xcc)]([_0xaab3d3(0x9e),_0xaab3d3(0xaf),'cheveretoStatus']);!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus)&&common_1['Logger'][_0xaab3d3(0xa7)]('请先前往后台配置上传图片的方式');if(Number(tencentCosStatus)===0x1){const {SecretId:_0xe1b28a,SecretKey:_0x4f928e}=await this[_0xaab3d3(0xf9)](_0xaab3d3(0xd6));this[_0xaab3d3(0xd2)]=new TENCENTCOS({'SecretId':_0xe1b28a,'SecretKey':_0x4f928e,'FileParallelLimit':0xa});}if(Number(aliOssStatus)===0x1){const {region:_0x5bdabd,bucket:_0x979f9a,accessKeyId:_0x1b650e,accessKeySecret:_0x3b2b66}=await this[_0xaab3d3(0xf9)](_0xaab3d3(0x7a));this['aliCos']=new ALIOSS({'region':(0x0,utils_1['removeSpecialCharacters'])(_0x5bdabd),'accessKeyId':_0x1b650e,'accessKeySecret':_0x3b2b66,'bucket':(0x0,utils_1[_0xaab3d3(0xa1)])(_0x979f9a)});}}async[_0x2f81f6(0xf9)](_0x3afb97){const _0x1707cc=_0x2f81f6;if(_0x3afb97===_0x1707cc(0x7a)){const {aliOssRegion:_0x32846d,aliOssBucket:_0xd160f0,aliOssAccessKeyId:_0x2024e0,aliOssAccessKeySecret:_0xcfd241}=await this[_0x1707cc(0x83)][_0x1707cc(0xcc)]([_0x1707cc(0x77),_0x1707cc(0xde),_0x1707cc(0xaa),'aliOssAccessKeySecret']);return{'region':_0x32846d,'bucket':_0xd160f0,'accessKeyId':_0x2024e0,'accessKeySecret':_0xcfd241};}if(_0x3afb97===_0x1707cc(0xd6)){const {cosBucket:_0x48496d,cosRegion:_0x53d62a,cosSecretId:_0x50d0c2,cosSecretKey:_0x143aa0,tencentCosAcceleratedDomain:_0x1d26dd}=await this[_0x1707cc(0x83)][_0x1707cc(0xcc)](['cosBucket','cosRegion',_0x1707cc(0xf2),'cosSecretKey',_0x1707cc(0xae)]);return{'Bucket':_0x48496d,'Region':_0x53d62a,'SecretId':_0x50d0c2,'SecretKey':_0x143aa0,'acceleratedDomain':_0x1d26dd};}if(_0x3afb97==='chevereto'){const {cheveretoKey:_0x50f59c,cheveretoUploadPath:_0x66e99b}=await this['globalConfigService']['getConfigByKeys']([_0x1707cc(0x9f),_0x1707cc(0xcd)]);return{'key':_0x50f59c,'uploadPath':_0x66e99b};}}async[_0x2f81f6(0xd9)](_0x56912b){const _0x25cb4a=_0x2f81f6,{filename:_0x30e0c4,buffer:_0x203cab,dir:dir='ai'}=_0x56912b,{aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x25cb4a(0x83)][_0x25cb4a(0xcc)]([_0x25cb4a(0x9e),'aliOssStatus','cheveretoStatus']);if(Number(tencentCosStatus)===0x1)return this[_0x25cb4a(0xec)]({'filename':_0x30e0c4,'buffer':_0x203cab,'dir':dir});if(Number(aliOssStatus)===0x1)return this[_0x25cb4a(0xf5)]({'filename':_0x30e0c4,'buffer':_0x203cab,'dir':dir});if(Number(cheveretoStatus)){const {filename:_0x553030,buffer:_0x3310f5,dir:_0x67eb7}=_0x56912b;return this[_0x25cb4a(0xc6)]({'filename':_0x553030,'buffer':_0x3310f5[_0x25cb4a(0xd5)]('base64'),'dir':_0x67eb7});}const [_0x2859d5,_0x4a3fd7]=await this[_0x25cb4a(0x90)]({'filename':_0x30e0c4,'buffer':_0x203cab,'dir':dir});return _0x2859d5;}async['upload2Local'](_0x5ef8f7){const {filename:_0x3e1bed,buffer:_0x3df9f7,dir:dir='ai'}=_0x5ef8f7,[_0x4f8199,_0x217432]=await this['uploadFileByLocal']({'filename':_0x3e1bed,'buffer':_0x3df9f7,'dir':dir});return _0x4f8199;}async[_0x2f81f6(0xec)]({filename:_0x11e06d,buffer:_0x2c3e7e,dir:_0x167863}){const _0x5e422c=_0x2f81f6;try{const {Bucket:_0x778205,Region:_0xd64d0,SecretId:_0x5c7be9,SecretKey:_0x2652a1}=await this[_0x5e422c(0xf9)](_0x5e422c(0xd6));!this[_0x5e422c(0xd2)]&&(this[_0x5e422c(0xd2)]=new TENCENTCOS({'SecretId':_0x5c7be9,'SecretKey':_0x2652a1,'FileParallelLimit':0xa}));const _0x15c07d=await this[_0x5e422c(0xd2)][_0x5e422c(0xe5)]({'Bucket':(0x0,utils_1[_0x5e422c(0xa1)])(_0x778205),'Region':(0x0,utils_1[_0x5e422c(0xa1)])(_0xd64d0),'Key':_0x167863+'/'+(_0x11e06d||(0x0,utils_1['createRandomUid'])()+_0x5e422c(0xb2)),'StorageClass':'STANDARD','Body':_0x2c3e7e});let _0x4012c6=_0x15c07d[_0x5e422c(0xbb)][_0x5e422c(0xf1)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x5e422c(0xd8));const {acceleratedDomain:_0x568511}=await this[_0x5e422c(0xf9)](_0x5e422c(0xd6));return _0x568511&&(_0x4012c6=_0x4012c6[_0x5e422c(0xf1)](/^(https:\/\/[^/]+)(\/.*)$/,_0x5e422c(0xef)+_0x568511+'$2'),console['log'](_0x5e422c(0xb4),_0x4012c6)),_0x4012c6;}catch(_0x54a54c){console['log']('error:\x20',_0x54a54c);throw new common_1[(_0x5e422c(0xe2))](_0x5e422c(0x97),common_1[_0x5e422c(0xe0)][_0x5e422c(0xf0)]);}}async[_0x2f81f6(0xf5)]({filename:_0x398466,buffer:_0x36b89e,dir:_0x2dc0d3}){const _0x1de536=_0x2f81f6;if(!this[_0x1de536(0x89)]){const {region:_0xb1b5c4,bucket:_0x2af6d4,accessKeyId:_0xa1b396,accessKeySecret:_0x48feab}=await this[_0x1de536(0xf9)](_0x1de536(0x7a));this[_0x1de536(0x89)]=new ALIOSS({'region':(0x0,utils_1['removeSpecialCharacters'])(_0xb1b5c4),'accessKeyId':_0xa1b396,'accessKeySecret':_0x48feab,'bucket':(0x0,utils_1[_0x1de536(0xa1)])(_0x2af6d4)});}try{console[_0x1de536(0xf4)](_0x1de536(0x8f));const _0x99eef0=await this[_0x1de536(0x89)][_0x1de536(0x9d)](_0x2dc0d3+'/'+(_0x398466||(0x0,utils_1[_0x1de536(0x94)])()+'.png'),_0x36b89e);return _0x99eef0[_0x1de536(0x82)];}catch(_0x374cb5){throw new common_1[(_0x1de536(0xe2))](_0x1de536(0x86),common_1['HttpStatus'][_0x1de536(0xf0)]);}}async[_0x2f81f6(0xc6)]({filename:filename='',buffer:_0x38a117,dir:dir='ai'}){const _0x59bc80=_0x2f81f6,{key:_0x419afd,uploadPath:_0x555a77}=await this['getUploadConfig'](_0x59bc80(0xfd)),_0x14b464=new FormData();_0x14b464[_0x59bc80(0xa0)](_0x59bc80(0xb0),_0x38a117[_0x59bc80(0xd5)](_0x59bc80(0xe9))),_0x14b464[_0x59bc80(0xa0)](_0x59bc80(0x98),_0x419afd);try{const _0xcc11fb=await axios_1[_0x59bc80(0x78)]['post'](_0x555a77,_0x14b464,{'headers':{'X-API-Key':_0x419afd},'timeout':0xa*0x3c*0x3e8});if(_0xcc11fb?.[_0x59bc80(0x8e)]===0xc8)return _0xcc11fb['data'][_0x59bc80(0xe4)][_0x59bc80(0x82)];else{common_1['Logger'][_0x59bc80(0xa7)](_0x59bc80(0xc0),JSON[_0x59bc80(0xd7)](_0xcc11fb[_0x59bc80(0xcf)]));throw new Error(_0x59bc80(0xc0));}}catch(_0x57392b){console[_0x59bc80(0xf4)](_0x59bc80(0xa5),_0x57392b['response']);throw new common_1[(_0x59bc80(0xe2))](_0x59bc80(0xa4)+_0x57392b[_0x59bc80(0x7f)]?.[_0x59bc80(0xcf)][_0x59bc80(0xa7)][_0x59bc80(0xce)],common_1[_0x59bc80(0xe0)][_0x59bc80(0xf0)]);}}async['uploadFileByLocal']({filename:_0x1e9eac,buffer:_0x1cf256,dir:_0x1ae3a5}){const _0x4b5c5b=_0x2f81f6;let _0x237a31=(0x0,path_1[_0x4b5c5b(0x9c)])(process['cwd'](),_0x4b5c5b(0x9b),'upload'),_0x5456a1='/upload',_0x4a51ff='';_0x1ae3a5&&(_0x237a31=(0x0,path_1[_0x4b5c5b(0x9c)])(_0x237a31,_0x1ae3a5),_0x5456a1=_0x4b5c5b(0xb3)+_0x1ae3a5);_0x5456a1=_0x5456a1+'/'+_0x1e9eac;!(0x0,fs_1[_0x4b5c5b(0x79)])(_0x237a31)&&(0x0,fs_1[_0x4b5c5b(0x9a)])(_0x237a31,{'recursive':!![]});_0x237a31=(0x0,path_1[_0x4b5c5b(0x9c)])(_0x237a31,_0x1e9eac),await(0x0,promises_1['writeFile'])(_0x237a31,_0x1cf256);let _0x50dfa1=process[_0x4b5c5b(0xdc)]['GOMAXAI_HOST'];return _0x50dfa1['startsWith']('http')?_0x4a51ff=_0x50dfa1+_0x5456a1:_0x4a51ff='https://'+_0x50dfa1+_0x5456a1,[_0x4a51ff,_0x237a31];}async['downFile'](_0x3eaf3c,_0xef5144,_0x1625cb){const _0x3fd8b8=_0x2f81f6;try{const _0x59bc9a=_0x3eaf3c[_0x3fd8b8(0xfb)]('/')[_0x3fd8b8(0x81)](),_0x28f3b7=await(0x0,axios_1[_0x3fd8b8(0x78)])(_0x3eaf3c,{'headers':{'Content-Type':'application/json;charset=UTF-8'},'responseType':_0x3fd8b8(0x8b),'timeout':0x493e0});_0x1625cb[_0x3fd8b8(0xe8)](0xc8,{'Content-Type':_0x28f3b7[_0x3fd8b8(0xc9)][_0x3fd8b8(0x7d)],'Content-Disposition':_0x59bc9a}),_0x1625cb['end'](_0x28f3b7['data'],_0x3fd8b8(0x8d));}catch(_0x583946){throw new common_1[(_0x3fd8b8(0xe2))](_0x583946[_0x3fd8b8(0xce)],common_1[_0x3fd8b8(0xe0)][_0x3fd8b8(0xf0)]);}}async['getModalImgById'](_0x5028f9){const _0x1a9232=_0x2f81f6;try{const _0x363f3f=await this['midjourneyEntity']['findOne']({'where':{'id':Number(_0x5028f9['query']['taskId'])}});let _0x5382ca;if(_0x363f3f[_0x1a9232(0xe7)])_0x5382ca=_0x363f3f['imageUrl'];else{const _0x19a300=await this[_0x1a9232(0xc2)][_0x1a9232(0x7b)]({'where':{'id':Number(_0x363f3f[_0x1a9232(0xfe)])}});_0x5382ca=_0x19a300[_0x1a9232(0xe7)];}if(!_0x5382ca)throw new Error(_0x1a9232(0xdd));const _0x46f334=await axios_1['default'][_0x1a9232(0xbf)](_0x5382ca,{'responseType':'arraybuffer'}),_0xcb41b3=Buffer[_0x1a9232(0x80)](_0x46f334['data'])[_0x1a9232(0xd5)](_0x1a9232(0xe9));return _0x1a9232(0xad)+_0xcb41b3;}catch(_0x20367c){throw new common_1[(_0x1a9232(0xe2))](_0x20367c['message'],common_1[_0x1a9232(0xe0)][_0x1a9232(0xf0)]);}}async[_0x2f81f6(0xfa)](_0xfaf81c){const _0x51aa08=_0x2f81f6;try{const _0x59758f=await axios_1[_0x51aa08(0x78)][_0x51aa08(0xbf)](_0xfaf81c,{'responseType':_0x51aa08(0x8b)}),_0x33f13c=_0xfaf81c['split']('/')[_0x51aa08(0x81)](),_0x5c866e=await this[_0x51aa08(0xd9)]({'filename':_0x33f13c,'buffer':_0x59758f['data']});return _0x5c866e;}catch(_0x2a918f){return common_1[_0x51aa08(0xc3)][_0x51aa08(0xa7)](_0x51aa08(0x8c),_0x2a918f),null;}}async[_0x2f81f6(0xc7)](_0x495305){return new Promise((_0x13a209,_0x5eb02e)=>{const _0x57123d=_0xdbe1,_0xa0d95=_0x495305[_0x57123d(0xf1)](_0x57123d(0xf3),_0x57123d(0xff));(0x0,child_process_1[_0x57123d(0xe3)])(_0x57123d(0x8a)+_0x495305+_0x57123d(0xc8)+_0xa0d95+_0x57123d(0xe6),function(_0x3ea57c,_0x3cafea,_0x5cfa8e){const _0x18a83f=_0x57123d;_0x3ea57c?(console[_0x18a83f(0xf4)](_0x5cfa8e),_0x5eb02e(_0x3ea57c)):_0x13a209(_0xa0d95);});});}async[_0x2f81f6(0xdf)](_0x1d67a2){const _0x273e42=_0x2f81f6;let _0x1b136a=null,_0x4715c9=null;try{const _0x290370=await axios_1['default']['get'](_0x1d67a2,{'responseType':_0x273e42(0x8b)}),_0x2f960d=_0x1d67a2[_0x273e42(0xfb)]('/')[_0x273e42(0x81)](),[_0x4aa601,_0x3b2556]=await this[_0x273e42(0x90)]({'filename':_0x2f960d,'buffer':_0x290370[_0x273e42(0xcf)],'dir':'ai'}),_0x2ff19a=await this[_0x273e42(0xc7)](_0x3b2556);let {aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x273e42(0x83)]['getConfigByKeys']([_0x273e42(0x9e),_0x273e42(0xaf),_0x273e42(0xab)]);aliOssStatus=Number(aliOssStatus),cheveretoStatus=Number(cheveretoStatus),tencentCosStatus=Number(tencentCosStatus);if(aliOssStatus||cheveretoStatus||tencentCosStatus){console[_0x273e42(0xf4)]('需要转存到云'),_0x1b136a=await this['uploadFile']({'filename':_0x2f960d,'buffer':_0x290370[_0x273e42(0xcf)]});const _0x3f4352=(0x0,fs_1[_0x273e42(0xdb)])(_0x2ff19a);_0x4715c9=await this[_0x273e42(0xd9)]({'filename':_0x2f960d[_0x273e42(0xf1)](/mp4$/,'jpg'),'buffer':_0x3f4352}),(0x0,fs_1[_0x273e42(0xba)])(_0x3b2556),(0x0,fs_1[_0x273e42(0xba)])(_0x2ff19a);}else _0x1b136a=_0x4aa601,_0x4715c9=_0x4aa601[_0x273e42(0xf1)](_0x273e42(0xf3),'.jpg');return[_0x1b136a,_0x4715c9];}catch(_0x4d2e5b){return common_1['Logger'][_0x273e42(0xa7)](_0x273e42(0xf7),_0x4d2e5b),[null,null];}}async[_0x2f81f6(0xbd)](_0x5ab863,_0x295a09){const _0x2ceb26=_0x2f81f6,_0x2928a2=redisKey_constant_1['MJ_IMG_TRANSFER']+_0x5ab863;try{const _0xdccec0=await this[_0x2ceb26(0xc4)]['get']({'key':_0x2928a2});if(_0xdccec0)return;this[_0x2ceb26(0xc4)]['set']({'key':_0x2928a2,'val':'lock'});const _0x49ea6e=await axios_1[_0x2ceb26(0x78)][_0x2ceb26(0xbf)](_0x295a09,{'responseType':_0x2ceb26(0x8b)}),{width:_0x4f705c,height:_0x37348d}=await(0x0,image_size_1['default'])(_0x49ea6e[_0x2ceb26(0xcf)]);!store_1[_0x2ceb26(0xe1)]['mjNotSaveImg']&&(_0x295a09=await this[_0x2ceb26(0xd9)]({'filename':_0x2ceb26(0xfc)+_0x5ab863+_0x2ceb26(0xb2),'buffer':_0x49ea6e[_0x2ceb26(0xcf)]})),await this['midjourneyEntity'][_0x2ceb26(0xd4)]({'id':_0x5ab863,'imageUrl':_0x295a09,'fileInfo':JSON[_0x2ceb26(0xd7)]({'width':_0x4f705c,'height':_0x37348d})});}catch(_0x55414c){common_1[_0x2ceb26(0xc3)][_0x2ceb26(0xa7)](_0x2928a2,'：',_0x55414c);}finally{this[_0x2ceb26(0xc4)][_0x2ceb26(0x85)]({'key':_0x2928a2});}}};FileService=__decorate([(0x0,common_1[_0x2f81f6(0x91)])(),__param(0x0,(0x0,typeorm_1[_0x2f81f6(0xca)])(midjourney_entity_1[_0x2f81f6(0xc5)])),__metadata(_0x2f81f6(0xb7),[typeorm_2[_0x2f81f6(0xb8)],globalConfig_service_1['GlobalConfigService'],redisCache_service_1[_0x2f81f6(0xa3)]])],FileService),exports[_0x2f81f6(0xac)]=FileService;