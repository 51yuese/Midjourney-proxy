'use strict';const _0x12994f=_0x5f36;(function(_0x4fee66,_0x139215){const _0x24f64b=_0x5f36,_0xad00bc=_0x4fee66();while(!![]){try{const _0x3e9aad=parseInt(_0x24f64b(0x172))/0x1*(-parseInt(_0x24f64b(0x196))/0x2)+parseInt(_0x24f64b(0x183))/0x3*(parseInt(_0x24f64b(0x11d))/0x4)+parseInt(_0x24f64b(0x158))/0x5+-parseInt(_0x24f64b(0x160))/0x6*(parseInt(_0x24f64b(0x15c))/0x7)+parseInt(_0x24f64b(0x190))/0x8+parseInt(_0x24f64b(0x141))/0x9+-parseInt(_0x24f64b(0x139))/0xa;if(_0x3e9aad===_0x139215)break;else _0xad00bc['push'](_0xad00bc['shift']());}catch(_0x49049f){_0xad00bc['push'](_0xad00bc['shift']());}}}(_0x610d,0xeaa3b));function _0x5f36(_0x7c2a4e,_0x10fcfb){const _0x610d7e=_0x610d();return _0x5f36=function(_0x5f3672,_0x3a4052){_0x5f3672=_0x5f3672-0x103;let _0x33af01=_0x610d7e[_0x5f3672];return _0x33af01;},_0x5f36(_0x7c2a4e,_0x10fcfb);}var __decorate=this&&this[_0x12994f(0x144)]||function(_0x3710f8,_0x8ddb0,_0x1ec1f5,_0x12f98d){const _0x102d8d=_0x12994f;var _0x2091ac=arguments[_0x102d8d(0x189)],_0x468366=_0x2091ac<0x3?_0x8ddb0:_0x12f98d===null?_0x12f98d=Object[_0x102d8d(0x11f)](_0x8ddb0,_0x1ec1f5):_0x12f98d,_0x3dfeee;if(typeof Reflect==='object'&&typeof Reflect[_0x102d8d(0x104)]===_0x102d8d(0x125))_0x468366=Reflect['decorate'](_0x3710f8,_0x8ddb0,_0x1ec1f5,_0x12f98d);else{for(var _0x30515b=_0x3710f8[_0x102d8d(0x189)]-0x1;_0x30515b>=0x0;_0x30515b--)if(_0x3dfeee=_0x3710f8[_0x30515b])_0x468366=(_0x2091ac<0x3?_0x3dfeee(_0x468366):_0x2091ac>0x3?_0x3dfeee(_0x8ddb0,_0x1ec1f5,_0x468366):_0x3dfeee(_0x8ddb0,_0x1ec1f5))||_0x468366;}return _0x2091ac>0x3&&_0x468366&&Object[_0x102d8d(0x174)](_0x8ddb0,_0x1ec1f5,_0x468366),_0x468366;},__metadata=this&&this[_0x12994f(0x10a)]||function(_0x38b650,_0x5bb751){const _0x551fd0=_0x12994f;if(typeof Reflect===_0x551fd0(0x169)&&typeof Reflect['metadata']===_0x551fd0(0x125))return Reflect[_0x551fd0(0x146)](_0x38b650,_0x5bb751);},__param=this&&this['__param']||function(_0x407e69,_0x2088f2){return function(_0x301041,_0xbfcc81){_0x2088f2(_0x301041,_0xbfcc81,_0x407e69);};};Object[_0x12994f(0x174)](exports,_0x12994f(0x164),{'value':!![]}),exports[_0x12994f(0x132)]=void 0x0;const common_1=require(_0x12994f(0x17e)),TENCENTCOS=require(_0x12994f(0x13a)),ALIOSS=require(_0x12994f(0x14d)),axios_1=require(_0x12994f(0x150)),image_size_1=require(_0x12994f(0x110)),utils_1=require('../../common/utils'),globalConfig_service_1=require(_0x12994f(0x194)),FormData=require(_0x12994f(0x187)),midjourney_entity_1=require(_0x12994f(0x18e)),typeorm_1=require(_0x12994f(0x122)),typeorm_2=require('typeorm'),redisKey_constant_1=require('../../common/constants/redisKey.constant'),redisCache_service_1=require(_0x12994f(0x118)),store_1=require(_0x12994f(0x124)),path_1=require(_0x12994f(0x195)),promises_1=require(_0x12994f(0x17a)),fs_1=require('fs'),child_process_1=require('child_process');function _0x610d(){const _0x4a6f3f=['tencentCosStatus','MJ_IMG_TRANSFER','url','__metadata','removeSpecialCharacters','readFileSync','log','upload','mjNotSaveImg','image-size','aliOssRegion','base64','put','stringify','message','writeHead','taskId','../redisCache/redisCache.service','onModuleInit','existsSync','binary','/upload','8UbiDdq','status','getOwnPropertyDescriptor','transferImg','pop','@nestjs/typeorm','transferAndCover','../../common/store','function','findOne','Logger','end','uploadFileByChevereto','transferAndCover\x20error:\x20','tencentCos','error:\x20','data:image/jpeg;base64,','.jpg','jpg','lock','HttpException','FileService','get','midjourneyEntity','uploadFile','data','source','cosRegion','23196430URZRqk','cos-nodejs-sdk-v5','cosSecretKey','HttpStatus','tencent','imageUrl','BAD_REQUEST','content-type','6111936LdsODO','当前已开启全球加速----------------->','上传图片失败[Chevereto]','__decorate','application/json;charset=UTF-8','metadata','Repository','error','https://$2','set','cheveretoStatus','downFile','ali-oss','createRandomUid','ali\x20开始上传','axios','getConfigByKeys','aliOssStatus','http','请先前往后台配置上传图片的方式','cheveretoUploadPath','rmSync','getUploadConfig','5251450ZYIdZG','chevereto','query','globalConfigService','146741BoQDmB','save','exec','replace','114HTkRjX','https://','GlobalConfigService','\x20-y\x20-f\x20image2\x20-ss\x202\x20-frames:v\x201\x20-update\x20true\x20','__esModule','.png','putObject','append','transferFile','object','Location','Injectable','cosSecretId','split','aliOssAccessKeySecret','.mp4','uploadFileByLocal','default','5LYAUvT','post','defineProperty','上传图片失败[Chevereto|buffer]\x20-->\x20','uploadFileByAliOss','uploadFileByTencentCos','writeFile','design:paramtypes','fs/promises','mkdirSync','\x0a\x20\x20\x20\x20\x20\x20\x20\x20ffmpeg\x20-i\x20','aliOssBucket','@nestjs/common','arraybuffer','join','ali','response','2541309TdOfVs','RedisCacheService','toString','cheveretoKey','form-data','redisCacheService','length','del','originTaskId','webroot','aliCos','../midjourney/midjourney.entity','transferFile\x20error:\x20','9957344xspDbW','\x0a\x20\x20\x20\x20\x20\x20','headers','cosBucket','../globalConfig/globalConfig.service','path','395698gbOYCO','MjConfig','decorate','/upload/','STANDARD'];_0x610d=function(){return _0x4a6f3f;};return _0x610d();}let FileService=class FileService{constructor(_0x12defd,_0x2ecd84,_0xf96a17){const _0x5ac283=_0x12994f;this[_0x5ac283(0x134)]=_0x12defd,this['globalConfigService']=_0x2ecd84,this[_0x5ac283(0x188)]=_0xf96a17;}async[_0x12994f(0x119)](){const _0x541bd8=_0x12994f,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x541bd8(0x15b)][_0x541bd8(0x151)](['tencentCosStatus',_0x541bd8(0x152),'cheveretoStatus']);!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus)&&common_1[_0x541bd8(0x127)]['error'](_0x541bd8(0x154));if(Number(tencentCosStatus)===0x1){const {SecretId:_0x1d726a,SecretKey:_0x333adc}=await this['getUploadConfig'](_0x541bd8(0x13d));this[_0x541bd8(0x12b)]=new TENCENTCOS({'SecretId':_0x1d726a,'SecretKey':_0x333adc,'FileParallelLimit':0xa});}if(Number(aliOssStatus)===0x1){const {region:_0x3bd8e3,bucket:_0x2f8353,accessKeyId:_0x1df868,accessKeySecret:_0x4b971a}=await this[_0x541bd8(0x157)](_0x541bd8(0x181));this[_0x541bd8(0x18d)]=new ALIOSS({'region':(0x0,utils_1[_0x541bd8(0x10b)])(_0x3bd8e3),'accessKeyId':_0x1df868,'accessKeySecret':_0x4b971a,'bucket':(0x0,utils_1[_0x541bd8(0x10b)])(_0x2f8353)});}}async[_0x12994f(0x157)](_0x25460b){const _0x204b81=_0x12994f;if(_0x25460b===_0x204b81(0x181)){const {aliOssRegion:_0x49d156,aliOssBucket:_0x4d3f30,aliOssAccessKeyId:_0x482806,aliOssAccessKeySecret:_0x3bb398}=await this[_0x204b81(0x15b)][_0x204b81(0x151)]([_0x204b81(0x111),_0x204b81(0x17d),'aliOssAccessKeyId',_0x204b81(0x16e)]);return{'region':_0x49d156,'bucket':_0x4d3f30,'accessKeyId':_0x482806,'accessKeySecret':_0x3bb398};}if(_0x25460b===_0x204b81(0x13d)){const {cosBucket:_0x473940,cosRegion:_0x22908b,cosSecretId:_0x2e4d89,cosSecretKey:_0x75adca,tencentCosAcceleratedDomain:_0x17ce73}=await this[_0x204b81(0x15b)]['getConfigByKeys']([_0x204b81(0x193),_0x204b81(0x138),_0x204b81(0x16c),_0x204b81(0x13b),'tencentCosAcceleratedDomain']);return{'Bucket':_0x473940,'Region':_0x22908b,'SecretId':_0x2e4d89,'SecretKey':_0x75adca,'acceleratedDomain':_0x17ce73};}if(_0x25460b===_0x204b81(0x159)){const {cheveretoKey:_0x1656a7,cheveretoUploadPath:_0x260983}=await this['globalConfigService']['getConfigByKeys']([_0x204b81(0x186),_0x204b81(0x155)]);return{'key':_0x1656a7,'uploadPath':_0x260983};}}async[_0x12994f(0x135)](_0xe6a11d){const _0x5ad20d=_0x12994f,{filename:_0x15cb44,buffer:_0x5832aa,dir:dir='ai'}=_0xe6a11d,{aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x5ad20d(0x15b)]['getConfigByKeys']([_0x5ad20d(0x107),_0x5ad20d(0x152),_0x5ad20d(0x14b)]);if(Number(tencentCosStatus)===0x1)return this[_0x5ad20d(0x177)]({'filename':_0x15cb44,'buffer':_0x5832aa,'dir':dir});if(Number(aliOssStatus)===0x1)return this[_0x5ad20d(0x176)]({'filename':_0x15cb44,'buffer':_0x5832aa,'dir':dir});if(Number(cheveretoStatus)){const {filename:_0x586b66,buffer:_0x5e01e4,dir:_0x12a22d}=_0xe6a11d;return this[_0x5ad20d(0x129)]({'filename':_0x586b66,'buffer':_0x5e01e4['toString'](_0x5ad20d(0x112)),'dir':_0x12a22d});}const [_0xccb8a0,_0x111fd8]=await this['uploadFileByLocal']({'filename':_0x15cb44,'buffer':_0x5832aa,'dir':dir});return _0xccb8a0;}async['upload2Local'](_0x4e8c54){const _0x520c32=_0x12994f,{filename:_0x1a1dbe,buffer:_0x3b3eed,dir:dir='ai'}=_0x4e8c54,[_0x5cbb53,_0x5054ef]=await this[_0x520c32(0x170)]({'filename':_0x1a1dbe,'buffer':_0x3b3eed,'dir':dir});return _0x5cbb53;}async[_0x12994f(0x177)]({filename:_0x38e6fd,buffer:_0x43cdcc,dir:_0x17b42c}){const _0x3de7c0=_0x12994f;try{const {Bucket:_0x2dae50,Region:_0x418713,SecretId:_0x215607,SecretKey:_0x6c3b3a}=await this['getUploadConfig'](_0x3de7c0(0x13d));!this[_0x3de7c0(0x12b)]&&(this['tencentCos']=new TENCENTCOS({'SecretId':_0x215607,'SecretKey':_0x6c3b3a,'FileParallelLimit':0xa}));const _0x250a84=await this['tencentCos'][_0x3de7c0(0x166)]({'Bucket':(0x0,utils_1[_0x3de7c0(0x10b)])(_0x2dae50),'Region':(0x0,utils_1[_0x3de7c0(0x10b)])(_0x418713),'Key':_0x17b42c+'/'+(_0x38e6fd||(0x0,utils_1[_0x3de7c0(0x14e)])()+'.png'),'StorageClass':_0x3de7c0(0x106),'Body':_0x43cdcc});let _0x58343f=_0x250a84[_0x3de7c0(0x16a)][_0x3de7c0(0x15f)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x3de7c0(0x149));const {acceleratedDomain:_0x409e35}=await this[_0x3de7c0(0x157)]('tencent');return _0x409e35&&(_0x58343f=_0x58343f['replace'](/^(https:\/\/[^/]+)(\/.*)$/,'https://'+_0x409e35+'$2'),console[_0x3de7c0(0x10d)](_0x3de7c0(0x142),_0x58343f)),_0x58343f;}catch(_0xcfe71){console[_0x3de7c0(0x10d)](_0x3de7c0(0x12c),_0xcfe71);throw new common_1[(_0x3de7c0(0x131))]('上传图片失败[ten]',common_1[_0x3de7c0(0x13c)][_0x3de7c0(0x13f)]);}}async[_0x12994f(0x176)]({filename:_0x1a71ba,buffer:_0x385f54,dir:_0x53693f}){const _0x34d25d=_0x12994f;if(!this[_0x34d25d(0x18d)]){const {region:_0x18c382,bucket:_0x99efe9,accessKeyId:_0x44631e,accessKeySecret:_0x1710fc}=await this[_0x34d25d(0x157)](_0x34d25d(0x181));this[_0x34d25d(0x18d)]=new ALIOSS({'region':(0x0,utils_1[_0x34d25d(0x10b)])(_0x18c382),'accessKeyId':_0x44631e,'accessKeySecret':_0x1710fc,'bucket':(0x0,utils_1[_0x34d25d(0x10b)])(_0x99efe9)});}try{console[_0x34d25d(0x10d)](_0x34d25d(0x14f));const _0x63094=await this[_0x34d25d(0x18d)][_0x34d25d(0x113)](_0x53693f+'/'+(_0x1a71ba||(0x0,utils_1[_0x34d25d(0x14e)])()+_0x34d25d(0x165)),_0x385f54);return _0x63094[_0x34d25d(0x109)];}catch(_0x336090){throw new common_1['HttpException']('上传图片失败[ali]',common_1[_0x34d25d(0x13c)][_0x34d25d(0x13f)]);}}async[_0x12994f(0x129)]({filename:filename='',buffer:_0x205dca,dir:dir='ai'}){const _0x51e6e7=_0x12994f,{key:_0x4fa8e2,uploadPath:_0xfe7df9}=await this[_0x51e6e7(0x157)]('chevereto'),_0x11917c=new FormData();_0x11917c[_0x51e6e7(0x167)](_0x51e6e7(0x137),_0x205dca[_0x51e6e7(0x185)](_0x51e6e7(0x112))),_0x11917c[_0x51e6e7(0x167)]('key',_0x4fa8e2);try{const _0x6f6018=await axios_1['default'][_0x51e6e7(0x173)](_0xfe7df9,_0x11917c,{'headers':{'X-API-Key':_0x4fa8e2},'timeout':0xa*0x3c*0x3e8});if(_0x6f6018?.[_0x51e6e7(0x11e)]===0xc8)return _0x6f6018[_0x51e6e7(0x136)]['image']['url'];else{common_1[_0x51e6e7(0x127)][_0x51e6e7(0x148)]('上传图片失败[Chevereto]',JSON[_0x51e6e7(0x114)](_0x6f6018[_0x51e6e7(0x136)]));throw new Error(_0x51e6e7(0x143));}}catch(_0x2b8aa9){console['log'](_0x51e6e7(0x12c),_0x2b8aa9[_0x51e6e7(0x182)]);throw new common_1['HttpException'](_0x51e6e7(0x175)+_0x2b8aa9[_0x51e6e7(0x182)]?.[_0x51e6e7(0x136)][_0x51e6e7(0x148)][_0x51e6e7(0x115)],common_1[_0x51e6e7(0x13c)][_0x51e6e7(0x13f)]);}}async[_0x12994f(0x170)]({filename:_0x24aacd,buffer:_0x528c11,dir:_0x5f2dd7}){const _0x4b85be=_0x12994f;let _0x3f7447=(0x0,path_1[_0x4b85be(0x180)])(process['cwd'](),_0x4b85be(0x18c),_0x4b85be(0x10e)),_0x41b7d7=_0x4b85be(0x11c),_0x4142e3='';_0x5f2dd7&&(_0x3f7447=(0x0,path_1[_0x4b85be(0x180)])(_0x3f7447,_0x5f2dd7),_0x41b7d7=_0x4b85be(0x105)+_0x5f2dd7);_0x41b7d7=_0x41b7d7+'/'+_0x24aacd;!(0x0,fs_1[_0x4b85be(0x11a)])(_0x3f7447)&&(0x0,fs_1[_0x4b85be(0x17b)])(_0x3f7447,{'recursive':!![]});_0x3f7447=(0x0,path_1[_0x4b85be(0x180)])(_0x3f7447,_0x24aacd),await(0x0,promises_1[_0x4b85be(0x178)])(_0x3f7447,_0x528c11);let _0x55bc8e=process['env']['GOMAXAI_HOST'];return _0x55bc8e['startsWith'](_0x4b85be(0x153))?_0x4142e3=_0x55bc8e+_0x41b7d7:_0x4142e3=_0x4b85be(0x161)+_0x55bc8e+_0x41b7d7,[_0x4142e3,_0x3f7447];}async[_0x12994f(0x14c)](_0x46bb8f,_0x159925,_0x35540d){const _0x2975b8=_0x12994f;try{const _0x5f1d3d=_0x46bb8f[_0x2975b8(0x16d)]('/')[_0x2975b8(0x121)](),_0x502380=await(0x0,axios_1[_0x2975b8(0x171)])(_0x46bb8f,{'headers':{'Content-Type':_0x2975b8(0x145)},'responseType':_0x2975b8(0x17f),'timeout':0x493e0});_0x35540d[_0x2975b8(0x116)](0xc8,{'Content-Type':_0x502380[_0x2975b8(0x192)][_0x2975b8(0x140)],'Content-Disposition':_0x5f1d3d}),_0x35540d[_0x2975b8(0x128)](_0x502380[_0x2975b8(0x136)],_0x2975b8(0x11b));}catch(_0x598144){throw new common_1['HttpException'](_0x598144[_0x2975b8(0x115)],common_1[_0x2975b8(0x13c)]['BAD_REQUEST']);}}async['getModalImgById'](_0x4cb88e){const _0x9c57de=_0x12994f;try{const _0x195129=await this['midjourneyEntity'][_0x9c57de(0x126)]({'where':{'id':Number(_0x4cb88e[_0x9c57de(0x15a)][_0x9c57de(0x117)])}});let _0x5eeaf8;if(_0x195129[_0x9c57de(0x13e)])_0x5eeaf8=_0x195129[_0x9c57de(0x13e)];else{const _0x9b4d9b=await this[_0x9c57de(0x134)][_0x9c57de(0x126)]({'where':{'id':Number(_0x195129[_0x9c57de(0x18b)])}});_0x5eeaf8=_0x9b4d9b[_0x9c57de(0x13e)];}if(!_0x5eeaf8)throw new Error('任务原始图片获取失败');const _0x544ef3=await axios_1[_0x9c57de(0x171)][_0x9c57de(0x133)](_0x5eeaf8,{'responseType':_0x9c57de(0x17f)}),_0x1e041c=Buffer['from'](_0x544ef3[_0x9c57de(0x136)])[_0x9c57de(0x185)](_0x9c57de(0x112));return _0x9c57de(0x12d)+_0x1e041c;}catch(_0x5866e0){throw new common_1[(_0x9c57de(0x131))](_0x5866e0['message'],common_1['HttpStatus'][_0x9c57de(0x13f)]);}}async[_0x12994f(0x168)](_0x4f8e61){const _0x58699c=_0x12994f;try{const _0x57c780=await axios_1[_0x58699c(0x171)][_0x58699c(0x133)](_0x4f8e61,{'responseType':_0x58699c(0x17f)}),_0x22b0b5=_0x4f8e61[_0x58699c(0x16d)]('/')[_0x58699c(0x121)](),_0x2ba71a=await this['uploadFile']({'filename':_0x22b0b5,'buffer':_0x57c780[_0x58699c(0x136)]});return _0x2ba71a;}catch(_0x4e1a96){return common_1[_0x58699c(0x127)]['error'](_0x58699c(0x18f),_0x4e1a96),null;}}async['getCover'](_0x34508c){return new Promise((_0x5b8cde,_0x1593c1)=>{const _0x536057=_0x5f36,_0x2aaa21=_0x34508c[_0x536057(0x15f)](_0x536057(0x16f),_0x536057(0x12e));(0x0,child_process_1[_0x536057(0x15e)])(_0x536057(0x17c)+_0x34508c+_0x536057(0x163)+_0x2aaa21+_0x536057(0x191),function(_0x2a0c1b,_0x44ffb7,_0x13f1cc){_0x2a0c1b?(console['log'](_0x13f1cc),_0x1593c1(_0x2a0c1b)):_0x5b8cde(_0x2aaa21);});});}async[_0x12994f(0x123)](_0xf51988){const _0x3a7e67=_0x12994f;let _0x260093=null,_0x2a8bf8=null;try{const _0x39acd2=await axios_1[_0x3a7e67(0x171)][_0x3a7e67(0x133)](_0xf51988,{'responseType':_0x3a7e67(0x17f)}),_0x8b18a1=_0xf51988[_0x3a7e67(0x16d)]('/')[_0x3a7e67(0x121)](),[_0x652c5a,_0x4a628a]=await this[_0x3a7e67(0x170)]({'filename':_0x8b18a1,'buffer':_0x39acd2[_0x3a7e67(0x136)],'dir':'ai'}),_0x27b355=await this['getCover'](_0x4a628a);let {aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this['globalConfigService'][_0x3a7e67(0x151)](['tencentCosStatus','aliOssStatus',_0x3a7e67(0x14b)]);aliOssStatus=Number(aliOssStatus),cheveretoStatus=Number(cheveretoStatus),tencentCosStatus=Number(tencentCosStatus);if(aliOssStatus||cheveretoStatus||tencentCosStatus){console['log']('需要转存到云'),_0x260093=await this[_0x3a7e67(0x135)]({'filename':_0x8b18a1,'buffer':_0x39acd2[_0x3a7e67(0x136)]});const _0x56d92b=(0x0,fs_1[_0x3a7e67(0x10c)])(_0x27b355);_0x2a8bf8=await this['uploadFile']({'filename':_0x8b18a1[_0x3a7e67(0x15f)](/mp4$/,_0x3a7e67(0x12f)),'buffer':_0x56d92b}),(0x0,fs_1[_0x3a7e67(0x156)])(_0x4a628a),(0x0,fs_1[_0x3a7e67(0x156)])(_0x27b355);}else _0x260093=_0x652c5a,_0x2a8bf8=_0x652c5a[_0x3a7e67(0x15f)]('.mp4',_0x3a7e67(0x12e));return[_0x260093,_0x2a8bf8];}catch(_0x3f6af1){return common_1[_0x3a7e67(0x127)]['error'](_0x3a7e67(0x12a),_0x3f6af1),[null,null];}}async[_0x12994f(0x120)](_0x32bfa2,_0x5afee5){const _0x180f1a=_0x12994f,_0x4dc393=redisKey_constant_1[_0x180f1a(0x108)]+_0x32bfa2;try{const _0x57b12f=await this[_0x180f1a(0x188)][_0x180f1a(0x133)]({'key':_0x4dc393});if(_0x57b12f)return;this[_0x180f1a(0x188)][_0x180f1a(0x14a)]({'key':_0x4dc393,'val':_0x180f1a(0x130)});const _0x34738a=await axios_1[_0x180f1a(0x171)]['get'](_0x5afee5,{'responseType':'arraybuffer'}),{width:_0x529b70,height:_0x2aa482}=await(0x0,image_size_1[_0x180f1a(0x171)])(_0x34738a[_0x180f1a(0x136)]);!store_1[_0x180f1a(0x103)][_0x180f1a(0x10f)]&&(_0x5afee5=await this[_0x180f1a(0x135)]({'filename':'mj-'+_0x32bfa2+'.png','buffer':_0x34738a[_0x180f1a(0x136)]})),await this[_0x180f1a(0x134)][_0x180f1a(0x15d)]({'id':_0x32bfa2,'imageUrl':_0x5afee5,'fileInfo':JSON[_0x180f1a(0x114)]({'width':_0x529b70,'height':_0x2aa482})});}catch(_0x53732c){common_1[_0x180f1a(0x127)]['error'](_0x4dc393,'：',_0x53732c);}finally{this['redisCacheService'][_0x180f1a(0x18a)]({'key':_0x4dc393});}}};FileService=__decorate([(0x0,common_1[_0x12994f(0x16b)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1['MidjourneyEntity'])),__metadata(_0x12994f(0x179),[typeorm_2[_0x12994f(0x147)],globalConfig_service_1[_0x12994f(0x162)],redisCache_service_1[_0x12994f(0x184)]])],FileService),exports[_0x12994f(0x132)]=FileService;