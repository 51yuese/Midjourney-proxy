'use strict';const _0x5c7c09=_0x360d;(function(_0x487007,_0x180fe6){const _0x16bc7e=_0x360d,_0x59a5bc=_0x487007();while(!![]){try{const _0x8bafa8=parseInt(_0x16bc7e(0x1ad))/0x1+parseInt(_0x16bc7e(0x1d3))/0x2*(parseInt(_0x16bc7e(0x1a2))/0x3)+parseInt(_0x16bc7e(0x19f))/0x4*(parseInt(_0x16bc7e(0x1b7))/0x5)+-parseInt(_0x16bc7e(0x19a))/0x6*(parseInt(_0x16bc7e(0x1c5))/0x7)+-parseInt(_0x16bc7e(0x1fe))/0x8+parseInt(_0x16bc7e(0x1b0))/0x9*(parseInt(_0x16bc7e(0x1ec))/0xa)+-parseInt(_0x16bc7e(0x1e7))/0xb*(parseInt(_0x16bc7e(0x1a9))/0xc);if(_0x8bafa8===_0x180fe6)break;else _0x59a5bc['push'](_0x59a5bc['shift']());}catch(_0x333b70){_0x59a5bc['push'](_0x59a5bc['shift']());}}}(_0x26ce,0x7c5b7));function _0x26ce(){const _0x298391=['./accountVipLog.entity','__esModule','Connection','AccountVipLogEntity','userPage','%\x27\x20)','PurchasePackage','35sYiGtt','connection','../sales/salesUsers.entity','ids','@nestjs/common','充值的订单信息:','log','getOwnPropertyDescriptor','saveCommissionAmount','myPage','isManage','__param','decorate','days','21278OxGWzV','invitedBy','changeScore4Other','nestjs-cls','function','object','UserService','count','insertAccountLog','maskEmail','\x20AND\x20al.userId\x20=\x20','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','%\x27\x20OR\x20u.email\x20LIKE\x20\x27%','@nestjs/typeorm','Injectable','__decorate','../crami/cramiPackage.entity','user','>\x200','../user/user.service','11bHgqYB','clsService','createSalesRecords','commissionAmount','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20account_log\x20al\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20al.userId\x20=\x20u.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','5799670sAKbsx','getReqSaasId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','EChangeType','BAD_REQUEST','../sales/sales.service','isSuper','CramiPackageEntity','metadata','typeorm','error:\x20','total','AccountLogEntity','ClsService','getUserByInviteCode','update','email','\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20LIMIT\x20','4621464QONiUf','Inject','购买套餐:\x20','UserBalanceService','__metadata','getUserById','design:paramtypes','cramiPackageEntity','findOne','../../common/constants/balance.constant','length','accountVipLogEntity','HttpStatus','defineProperty','199488xXpqve','toFixed','accountLogEntity','SalesService','Repository','4QtKdnP','save','addBalanceToOrder','6jXneNm','deleteAccountLog','购买套餐：','score','../../common/utils','InjectRepository','salesService','4951836ktnKdK','updateVipExpire','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20al.del_flag\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','SalesUsersEntity','498852erjywp','query','\x20AND\x20al.createdAt\x20<=\x20\x27','9ZojXRr','<\x200','\x20AND\x20al.saasId\x20=\x20','name','\x20AND\x20al.createdAt\x20>=\x20\x27','\x20AND\x20al.change_type\x20=\x20','phone','2829230cSbLys','\x0a\x20\x20\x20\x20','userService','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.raw_score\x20AS\x20rawScore,\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.new_score\x20AS\x20newScore,\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.change_score\x20AS\x20changeScore,\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.change_type\x20AS\x20changeType,\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.relate_id\x20AS\x20relateId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.rebate_user_id\x20AS\x20rebateUserId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20al.del_flag\x20AS\x20delFlag,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.email\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20account_log\x20al\x0a\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20al.userId\x20=\x20u.id\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20','HttpException','salesUsersEntity','insertAccountVipLog'];_0x26ce=function(){return _0x298391;};return _0x26ce();}var __decorate=this&&this[_0x5c7c09(0x1e2)]||function(_0x844980,_0x373587,_0x537379,_0x5549b1){const _0xb26189=_0x5c7c09;var _0x5d115a=arguments[_0xb26189(0x196)],_0x52a5a7=_0x5d115a<0x3?_0x373587:_0x5549b1===null?_0x5549b1=Object[_0xb26189(0x1cc)](_0x373587,_0x537379):_0x5549b1,_0x2b3ae3;if(typeof Reflect===_0xb26189(0x1d8)&&typeof Reflect[_0xb26189(0x1d1)]===_0xb26189(0x1d7))_0x52a5a7=Reflect['decorate'](_0x844980,_0x373587,_0x537379,_0x5549b1);else{for(var _0x4125ec=_0x844980[_0xb26189(0x196)]-0x1;_0x4125ec>=0x0;_0x4125ec--)if(_0x2b3ae3=_0x844980[_0x4125ec])_0x52a5a7=(_0x5d115a<0x3?_0x2b3ae3(_0x52a5a7):_0x5d115a>0x3?_0x2b3ae3(_0x373587,_0x537379,_0x52a5a7):_0x2b3ae3(_0x373587,_0x537379))||_0x52a5a7;}return _0x5d115a>0x3&&_0x52a5a7&&Object[_0xb26189(0x199)](_0x373587,_0x537379,_0x52a5a7),_0x52a5a7;},__metadata=this&&this[_0x5c7c09(0x190)]||function(_0x2dafe3,_0x47b91a){const _0x2bb4f4=_0x5c7c09;if(typeof Reflect===_0x2bb4f4(0x1d8)&&typeof Reflect['metadata']==='function')return Reflect[_0x2bb4f4(0x1f4)](_0x2dafe3,_0x47b91a);},__param=this&&this[_0x5c7c09(0x1d0)]||function(_0x5d0e44,_0x1bab3d){return function(_0x10c244,_0x36cb31){_0x1bab3d(_0x10c244,_0x36cb31,_0x5d0e44);};};function _0x360d(_0x376b28,_0x3d32c2){const _0x26cebe=_0x26ce();return _0x360d=function(_0x360da0,_0x557416){_0x360da0=_0x360da0-0x18f;let _0x3c6961=_0x26cebe[_0x360da0];return _0x3c6961;},_0x360d(_0x376b28,_0x3d32c2);}Object[_0x5c7c09(0x199)](exports,_0x5c7c09(0x1bf),{'value':!![]}),exports['UserBalanceService']=void 0x0;const typeorm_1=require(_0x5c7c09(0x1e0)),common_1=require(_0x5c7c09(0x1c9)),typeorm_2=require(_0x5c7c09(0x1f5)),balance_constant_1=require(_0x5c7c09(0x195)),accountLog_entity_1=require('./accountLog.entity'),cramiPackage_entity_1=require(_0x5c7c09(0x1e3)),salesUsers_entity_1=require(_0x5c7c09(0x1c7)),sales_service_1=require(_0x5c7c09(0x1f1)),user_service_1=require(_0x5c7c09(0x1e6)),accountVipLog_entity_1=require(_0x5c7c09(0x1be)),utils_1=require(_0x5c7c09(0x1a6)),nestjs_cls_1=require(_0x5c7c09(0x1d6));let UserBalanceService=class UserBalanceService{constructor(_0x51a00e,_0x150fde,_0x2ac9c2,_0x4baa09,_0x419e3f,_0x34a9cb,_0x42116d,_0x15b69f){const _0x358ed5=_0x5c7c09;this[_0x358ed5(0x19c)]=_0x51a00e,this[_0x358ed5(0x197)]=_0x150fde,this[_0x358ed5(0x193)]=_0x2ac9c2,this[_0x358ed5(0x1bc)]=_0x4baa09,this['userService']=_0x419e3f,this[_0x358ed5(0x1a8)]=_0x34a9cb,this[_0x358ed5(0x1e8)]=_0x42116d,this[_0x358ed5(0x1c6)]=_0x15b69f;}async[_0x5c7c09(0x1a1)](_0x129fae){const _0x48932a=_0x5c7c09;console[_0x48932a(0x1cb)](_0x48932a(0x1ca),_0x129fae);try{const {userId:_0x26322f,goodsId:_0x7d24a5}=_0x129fae,_0x6530e2=await this[_0x48932a(0x193)][_0x48932a(0x194)]({'where':{'id':_0x7d24a5,'status':0x1}});if(!_0x6530e2)throw new common_1['HttpException']('非法操作、当前充值套餐暂不存在！',common_1[_0x48932a(0x198)]['BAD_REQUEST']);const _0x3f20c7=await this[_0x48932a(0x1b9)][_0x48932a(0x191)](_0x26322f);_0x6530e2[_0x48932a(0x1a5)]>0x0&&await this[_0x48932a(0x1b9)][_0x48932a(0x1d5)](_0x3f20c7,balance_constant_1[_0x48932a(0x1ef)]['PurchasePackage'],_0x6530e2[_0x48932a(0x1a5)],_0x48932a(0x1a4)+_0x6530e2[_0x48932a(0x1b3)],_0x6530e2['id']);_0x6530e2['days']!==0x0&&await this[_0x48932a(0x1b9)][_0x48932a(0x1aa)](_0x3f20c7,balance_constant_1[_0x48932a(0x1ef)][_0x48932a(0x1c4)],_0x6530e2[_0x48932a(0x1d2)],_0x48932a(0x200)+_0x6530e2[_0x48932a(0x1b3)],_0x6530e2['id']);if(_0x3f20c7[_0x48932a(0x1d4)]){const _0x1a882b=await this['userService'][_0x48932a(0x1fa)](_0x3f20c7['invitedBy']);if(!_0x1a882b)return;const _0x2a5825=await this[_0x48932a(0x1bc)][_0x48932a(0x194)]({'where':{'userId':_0x1a882b['id']}}),{id:_0x5e1179}=_0x1a882b,{performanceRatio:_0x2bc542}=_0x2a5825,_0x5567e2={'inviterUserId':_0x5e1179,'inviteeUserId':_0x26322f,'orderId':_0x129fae['id'],'orderPrice':_0x129fae[_0x48932a(0x1f7)],'commissionPercentage':_0x2bc542,'commissionAmount':(_0x129fae[_0x48932a(0x1f7)]*_0x2bc542/0x64)[_0x48932a(0x19b)](0x2)};await this[_0x48932a(0x1a8)][_0x48932a(0x1e9)](_0x5567e2),await this['salesService'][_0x48932a(0x1cd)](_0x5e1179,_0x5567e2[_0x48932a(0x1ea)]);}}catch(_0x172a56){console['log'](_0x48932a(0x1f6),_0x172a56);throw new common_1[(_0x48932a(0x1bb))]('充值失败！',common_1['HttpStatus'][_0x48932a(0x1f0)]);}}async[_0x5c7c09(0x1c2)](_0x2fb5ef,_0x452701,_0x56a773){const _0x39e9b1=_0x5c7c09,_0x48b015=(0x0,utils_1[_0x39e9b1(0x1ed)])(this[_0x39e9b1(0x1e8)]),{page:page=0x1,size:size=0x14,startTime:_0x131b91,endTime:_0x52485a,keyword:_0x706cce,saasId:_0x5ac4ed,changeType:_0x15713f,creaseType:_0x3577d6}=_0x452701;let _0xc299dd=_0x39e9b1(0x1ab)+(_0x56a773?_0x39e9b1(0x1dd)+_0x56a773:'')+_0x39e9b1(0x1ee)+(_0x15713f?_0x39e9b1(0x1b5)+_0x15713f:'')+_0x39e9b1(0x1ee)+(_0x3577d6?'\x20AND\x20al.change_score\x20'+(_0x3577d6==='increase'?_0x39e9b1(0x1e5):_0x39e9b1(0x1b1)):'')+_0x39e9b1(0x1ee)+(_0x131b91?_0x39e9b1(0x1b4)+_0x131b91+'\x27':'')+_0x39e9b1(0x1ee)+(_0x52485a?_0x39e9b1(0x1af)+_0x52485a+'\x27':'')+_0x39e9b1(0x1ee)+(_0x706cce?'\x20AND\x20(\x20u.username\x20LIKE\x20\x27%'+_0x706cce+_0x39e9b1(0x1de)+_0x706cce+'%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%'+_0x706cce+_0x39e9b1(0x1df)+_0x706cce+_0x39e9b1(0x1c3):'')+_0x39e9b1(0x1b8);(0x0,utils_1['isPlatform'])(this['clsService'])?(0x0,utils_1[_0x39e9b1(0x1cf)])(this[_0x39e9b1(0x1e8)])&&_0x5ac4ed&&(_0xc299dd=_0xc299dd+('\x20AND\x20al.saasId\x20=\x20'+_0x5ac4ed)):_0xc299dd=_0xc299dd+(_0x39e9b1(0x1b2)+_0x48b015);const _0x3cb910=_0x39e9b1(0x1eb)+_0xc299dd+_0x39e9b1(0x1b8),_0x24d1a0=_0x39e9b1(0x1ba)+_0xc299dd+_0x39e9b1(0x1fd)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x39e9b1(0x1b8),_0x541fa0=await this['connection'][_0x39e9b1(0x1ae)](_0x3cb910),_0x13aea6=await this[_0x39e9b1(0x1c6)][_0x39e9b1(0x1ae)](_0x24d1a0);return!(0x0,utils_1[_0x39e9b1(0x1f2)])(this[_0x39e9b1(0x1e8)])&&_0x13aea6['forEach'](_0x196e54=>{const _0x3adef5=_0x39e9b1;_0x196e54[_0x3adef5(0x1fc)]=(0x0,utils_1[_0x3adef5(0x1dc)])(_0x196e54[_0x3adef5(0x1fc)]),_0x196e54[_0x3adef5(0x1b6)]=(0x0,utils_1[_0x3adef5(0x1dc)])(_0x196e54[_0x3adef5(0x1b6)]);}),{'rows':_0x13aea6,'count':Number(_0x541fa0[0x0]?.[_0x39e9b1(0x1da)]||0x0)};}async[_0x5c7c09(0x1ce)](_0x2ab6c4,_0x1751de){const _0x36dd4d=_0x5c7c09;return this['userPage'](_0x2ab6c4,_0x1751de,_0x2ab6c4[_0x36dd4d(0x1e4)]['id']);}async[_0x5c7c09(0x1a3)](_0x2c9848){const _0x5f4631=_0x5c7c09;if(!_0x2c9848[_0x5f4631(0x1c8)]['length'])return!![];return await this['accountLogEntity'][_0x5f4631(0x1fb)]({'id':(0x0,typeorm_2['In'])(_0x2c9848['ids'])},{'delFlag':0x1}),!![];}async[_0x5c7c09(0x1db)](_0x38a4c2){const _0x120e97=_0x5c7c09,_0x3f3f7f=(0x0,utils_1[_0x120e97(0x1ed)])(this[_0x120e97(0x1e8)]);await this[_0x120e97(0x19c)][_0x120e97(0x1a0)]({..._0x38a4c2,'saasId':_0x3f3f7f});}async[_0x5c7c09(0x1bd)](_0x55d86e){const _0x2e9484=_0x5c7c09;await this['accountVipLogEntity'][_0x2e9484(0x1a0)](_0x55d86e);}};UserBalanceService=__decorate([(0x0,common_1[_0x5c7c09(0x1e1)])(),__param(0x0,(0x0,typeorm_1[_0x5c7c09(0x1a7)])(accountLog_entity_1[_0x5c7c09(0x1f8)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(accountVipLog_entity_1[_0x5c7c09(0x1c1)])),__param(0x2,(0x0,typeorm_1[_0x5c7c09(0x1a7)])(cramiPackage_entity_1[_0x5c7c09(0x1f3)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(salesUsers_entity_1[_0x5c7c09(0x1ac)])),__param(0x4,(0x0,common_1[_0x5c7c09(0x1ff)])((0x0,common_1['forwardRef'])(()=>user_service_1[_0x5c7c09(0x1d9)]))),__metadata(_0x5c7c09(0x192),[typeorm_2[_0x5c7c09(0x19e)],typeorm_2[_0x5c7c09(0x19e)],typeorm_2[_0x5c7c09(0x19e)],typeorm_2[_0x5c7c09(0x19e)],user_service_1['UserService'],sales_service_1[_0x5c7c09(0x19d)],nestjs_cls_1[_0x5c7c09(0x1f9)],typeorm_2[_0x5c7c09(0x1c0)]])],UserBalanceService),exports[_0x5c7c09(0x18f)]=UserBalanceService;