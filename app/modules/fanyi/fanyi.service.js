'use strict';const _0x36d9cc=_0x3b31;function _0x3b31(_0x5def1e,_0x441036){const _0x4d13e9=_0x4d13();return _0x3b31=function(_0x3b31b8,_0x18e1f6){_0x3b31b8=_0x3b31b8-0x1e8;let _0x4bbe8d=_0x4d13e9[_0x3b31b8];return _0x4bbe8d;},_0x3b31(_0x5def1e,_0x441036);}(function(_0x31086c,_0x1b6015){const _0x47d19d=_0x3b31,_0x419f36=_0x31086c();while(!![]){try{const _0x2fa592=parseInt(_0x47d19d(0x200))/0x1+parseInt(_0x47d19d(0x1fb))/0x2+-parseInt(_0x47d19d(0x1fd))/0x3+-parseInt(_0x47d19d(0x208))/0x4*(parseInt(_0x47d19d(0x223))/0x5)+parseInt(_0x47d19d(0x1f5))/0x6+parseInt(_0x47d19d(0x22a))/0x7+-parseInt(_0x47d19d(0x20d))/0x8;if(_0x2fa592===_0x1b6015)break;else _0x419f36['push'](_0x419f36['shift']());}catch(_0x3b1172){_0x419f36['push'](_0x419f36['shift']());}}}(_0x4d13,0x296fc));var __decorate=this&&this[_0x36d9cc(0x1ff)]||function(_0x2100e0,_0x5a0d57,_0x49d185,_0x24f6eb){const _0x5b1c67=_0x36d9cc;var _0x19c229=arguments['length'],_0x2948b9=_0x19c229<0x3?_0x5a0d57:_0x24f6eb===null?_0x24f6eb=Object[_0x5b1c67(0x1f8)](_0x5a0d57,_0x49d185):_0x24f6eb,_0x2f76f0;if(typeof Reflect===_0x5b1c67(0x225)&&typeof Reflect['decorate']===_0x5b1c67(0x1f2))_0x2948b9=Reflect[_0x5b1c67(0x1f1)](_0x2100e0,_0x5a0d57,_0x49d185,_0x24f6eb);else{for(var _0x2d889f=_0x2100e0[_0x5b1c67(0x227)]-0x1;_0x2d889f>=0x0;_0x2d889f--)if(_0x2f76f0=_0x2100e0[_0x2d889f])_0x2948b9=(_0x19c229<0x3?_0x2f76f0(_0x2948b9):_0x19c229>0x3?_0x2f76f0(_0x5a0d57,_0x49d185,_0x2948b9):_0x2f76f0(_0x5a0d57,_0x49d185))||_0x2948b9;}return _0x19c229>0x3&&_0x2948b9&&Object['defineProperty'](_0x5a0d57,_0x49d185,_0x2948b9),_0x2948b9;},__metadata=this&&this['__metadata']||function(_0x1abd77,_0x55eae9){const _0x26cc37=_0x36d9cc;if(typeof Reflect===_0x26cc37(0x225)&&typeof Reflect[_0x26cc37(0x1ee)]==='function')return Reflect['metadata'](_0x1abd77,_0x55eae9);};function _0x4d13(){const _0x4c8524=['getConfigByKeys','api','error','ModelsService','log','message','/v1','data','gpt-4-all','openai','https://fanyi-api.baidu.com/api/trans/vip/translate','metadata','create','OTHER','decorate','function','请输入要翻译的内容!','openaiBaseUrl','2033508JFhWZc','dst','choices','getOwnPropertyDescriptor','./../globalConfig/globalConfig.service','convertToEnglish','27066AeNWdH','apiKey','967806CssnRh','now','__decorate','265946JNWaDw','update','auto','translateToEnglish','BAD_REQUEST','当前管理员还未开放翻译服务、请联系管理员开通吧!','baseURL','HttpException','116780UanqiL','default','catch','Logger','defaultUrl','2090008tUTZDw','fanyi-error','../../common/utils','default-gomaxai-key','axios','user','FanyiService','GlobalConfigService','https://api.openai.com','post','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','translate\x20key','@nestjs/common','createHash','content','globalConfigService','翻译花费时间\x20%s\x20秒','design:paramtypes','timeout','digest','modelsService','../../common/constants/model.constant','5GtbulO','翻译失败[','object','HttpStatus','length','gpt-fanyi','application/x-www-form-urlencoded','1150625azHIdN','md5'];_0x4d13=function(){return _0x4c8524;};return _0x4d13();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x36d9cc(0x213)]=void 0x0;const globalConfig_service_1=require(_0x36d9cc(0x1f9)),common_1=require(_0x36d9cc(0x219)),axios_1=require(_0x36d9cc(0x211)),crypto=require('crypto'),openai_1=require(_0x36d9cc(0x1ec)),utils_1=require(_0x36d9cc(0x20f)),models_service_1=require('../models/models.service'),model_constant_1=require(_0x36d9cc(0x222));let FanyiService=class FanyiService{constructor(_0x1df7c3,_0x5c0237){const _0x4fc547=_0x36d9cc;this[_0x4fc547(0x21c)]=_0x1df7c3,this['modelsService']=_0x5c0237,this[_0x4fc547(0x20c)]=_0x4fc547(0x215);}['onModuleInit'](){const _0x182bb5=_0x36d9cc;this[_0x182bb5(0x22d)]=new openai_1[(_0x182bb5(0x209))]({'apiKey':_0x182bb5(0x210),'baseURL':this[_0x182bb5(0x20c)]+_0x182bb5(0x1e9)});}async[_0x36d9cc(0x1fa)](_0x1515e3){const _0x580fdf=_0x36d9cc;if(!_0x1515e3)throw new common_1[(_0x580fdf(0x207))](_0x580fdf(0x1f3),common_1[_0x580fdf(0x226)][_0x580fdf(0x204)]);const {baiduFanyiAppId:_0x37078a,baiduFanyiSecret:_0x2acd4b}=await this[_0x580fdf(0x21c)]['getConfigByKeys'](['baiduFanyiAppId','baiduFanyiSecret']);if(!_0x37078a||!_0x2acd4b)throw new common_1[(_0x580fdf(0x207))](_0x580fdf(0x205),common_1[_0x580fdf(0x226)][_0x580fdf(0x204)]);const _0x580c3e=Date[_0x580fdf(0x1fe)]()['toString'](),_0x555d47=crypto[_0x580fdf(0x21a)](_0x580fdf(0x22b))[_0x580fdf(0x201)](_0x37078a+_0x1515e3+_0x580c3e+_0x2acd4b)[_0x580fdf(0x220)]('hex'),_0x3108f3=_0x580fdf(0x1ed),_0x3bb5d7={'q':_0x1515e3['toString'](),'from':_0x580fdf(0x202),'to':'en','appid':_0x37078a,'salt':_0x580c3e,'sign':_0x555d47},_0x1c0b25=await axios_1[_0x580fdf(0x209)][_0x580fdf(0x216)](_0x3108f3,_0x3bb5d7,{'headers':{'Content-Type':_0x580fdf(0x229)}}),{from:_0x44fc2b,to:_0x4b9c0d,trans_result:_0xe0abf1,error_code:_0x916443,error_msg:_0x997586}=_0x1c0b25[_0x580fdf(0x1ea)];if(_0x916443)throw new common_1['HttpException'](_0x580fdf(0x224)+_0x916443+']['+_0x997586+']!',common_1['HttpStatus'][_0x580fdf(0x204)]);if(!_0xe0abf1||!_0xe0abf1[_0x580fdf(0x227)])throw new common_1[(_0x580fdf(0x207))](_0x580fdf(0x224)+_0x916443+']['+_0x997586+']!',common_1['HttpStatus'][_0x580fdf(0x204)]);else return _0xe0abf1[0x0][_0x580fdf(0x1f6)];}async[_0x36d9cc(0x203)](_0x56b788){const _0x276403=_0x36d9cc,_0x67b4b2='接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！';let _0xff7e7b=await this[_0x276403(0x221)]['getRandomKey'](model_constant_1['EModelType'][_0x276403(0x1f0)]);if(!_0xff7e7b)throw new common_1[(_0x276403(0x207))](_0x276403(0x217),common_1[_0x276403(0x226)][_0x276403(0x204)]);const {timeout:_0x17bc70,model:_0x5772b5,key:_0x1d6df,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x3d846c}=_0xff7e7b;let _0x587ce8=_0x3d846c;!_0x3d846c&&(_0x587ce8=await this[_0x276403(0x21c)][_0x276403(0x22c)]([_0x276403(0x1f4)]));this[_0x276403(0x22d)][_0x276403(0x1fc)]=(0x0,utils_1['removeSpecialCharacters'])(_0x1d6df),this['api'][_0x276403(0x206)]=(_0x587ce8||this[_0x276403(0x20c)])+'/v1',this['api'][_0x276403(0x21f)]=0x493e0;try{common_1[_0x276403(0x20b)]['log'](_0x1d6df,_0x276403(0x218)),common_1[_0x276403(0x20b)]['log'](_0x587ce8,_0x276403(0x228));const _0x271c5a=Date[_0x276403(0x1fe)](),_0xceaff7=await this['api']['chat']['completions'][_0x276403(0x1ef)]({'messages':[{'role':'system','content':_0x67b4b2},{'role':_0x276403(0x212),'content':_0x56b788}],'model':_0x276403(0x1eb),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':'text'}})['then'](_0x599142=>{const _0x5e8970=_0x276403;return _0x599142?.[_0x5e8970(0x1f7)][0x0]?.[_0x5e8970(0x1e8)][_0x5e8970(0x21b)]||'';})[_0x276403(0x20a)](_0x2a82ca=>{const _0x1b448d=_0x276403;return common_1[_0x1b448d(0x20b)][_0x1b448d(0x22e)](_0x2a82ca),'';}),_0x19e980=Date[_0x276403(0x1fe)](),_0x3f9de7=(_0x19e980-_0x271c5a)/0x3e8;return common_1[_0x276403(0x20b)][_0x276403(0x230)](_0x3f9de7,_0x276403(0x21d)),_0xceaff7;}catch(_0x135f19){console[_0x276403(0x230)](_0x276403(0x20e),_0x1d6df,_0x135f19);throw new common_1[(_0x276403(0x207))](_0x135f19['message'],common_1[_0x276403(0x226)][_0x276403(0x204)]);}}};FanyiService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x36d9cc(0x21e),[globalConfig_service_1[_0x36d9cc(0x214)],models_service_1[_0x36d9cc(0x22f)]])],FanyiService),exports[_0x36d9cc(0x213)]=FanyiService;