'use strict';const _0x18b871=_0x4354;(function(_0x4dc02c,_0x1b794a){const _0x464805=_0x4354,_0x43355b=_0x4dc02c();while(!![]){try{const _0x5f127f=-parseInt(_0x464805(0x103))/0x1+parseInt(_0x464805(0xfb))/0x2+parseInt(_0x464805(0xee))/0x3+-parseInt(_0x464805(0x113))/0x4+-parseInt(_0x464805(0x104))/0x5+parseInt(_0x464805(0x10c))/0x6+parseInt(_0x464805(0xec))/0x7;if(_0x5f127f===_0x1b794a)break;else _0x43355b['push'](_0x43355b['shift']());}catch(_0x257934){_0x43355b['push'](_0x43355b['shift']());}}}(_0xb793,0x30ce4));Object[_0x18b871(0xeb)](exports,_0x18b871(0xef),{'value':!![]}),exports[_0x18b871(0x10e)]=void 0x0;const uuid_1=require(_0x18b871(0x108)),tiktoken_1=require(_0x18b871(0xf1)),tokenizer=(0x0,tiktoken_1[_0x18b871(0xf7)])(_0x18b871(0x112));class NineStore{constructor(_0x232d89){const _0x10c3a3=_0x18b871,{store:_0x12e61f,namespace:_0x4b0367,expires:_0x1d382d}=this[_0x10c3a3(0xed)](_0x232d89);this[_0x10c3a3(0xf0)]=_0x12e61f,this['namespace']=_0x4b0367,this[_0x10c3a3(0xfc)]=_0x1d382d;}[_0x18b871(0xed)](_0x57e581){const {store:_0x35523d,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace='chat'}=_0x57e581;return{'store':_0x35523d,'namespace':namespace,'expires':expires};}[_0x18b871(0x10d)](_0x18dd3a){const _0x1281a7=_0x18b871;return this[_0x1281a7(0x102)]?this['namespace']+'-'+_0x18dd3a:_0x18dd3a;}async[_0x18b871(0x10f)](_0x4bb16f){const _0x3e4984=_0x18b871,_0x2ea61a=await this['store'][_0x3e4984(0x10a)](_0x4bb16f);return _0x2ea61a;}async[_0x18b871(0xf8)](_0x48a833,_0x2d221d=this[_0x18b871(0xfc)]){const _0x2e6080=_0x18b871;await this[_0x2e6080(0xf0)][_0x2e6080(0x109)](_0x48a833['id'],_0x48a833,_0x2d221d);}async[_0x18b871(0x10b)](_0x4d7ca9,_0x1a7743){const _0x148532=_0x18b871;let {maxRounds:_0x3036a2,maxModelToken:_0x462ed5,maxResponseTokens:_0x134732,systemMessage:systemMessage='',name:_0x22ddb4}=_0x1a7743,{parentMessageId:_0x51125a}=_0x1a7743,_0x405a42=[],_0x7118b3=0x0;systemMessage&&_0x405a42[_0x148532(0xfd)]({'role':_0x148532(0xf3),'content':systemMessage});const _0x54b157=_0x405a42[_0x148532(0x101)];let _0xc2818b=0x0,_0x554e09=_0x4d7ca9?_0x405a42[_0x148532(0xf4)]([{'role':_0x148532(0xfe),'content':_0x4d7ca9,'name':_0x22ddb4}]):_0x405a42;do{if(!_0x51125a)break;const _0x33c85b=await this[_0x148532(0x10f)](_0x51125a);if(!_0x33c85b)break;const {text:_0x1fecc5,name:_0x12eabd,role:_0x4c2ab5}=_0x33c85b;_0x554e09=_0x554e09['slice'](0x0,_0x54b157)['concat']([{'role':_0x4c2ab5,'content':_0x1fecc5,'name':_0x12eabd},..._0x554e09[_0x148532(0xf5)](_0x54b157)]),_0xc2818b++;if(_0x3036a2&&_0xc2818b>=_0x3036a2)break;if(_0x462ed5&&_0x134732){const _0x242f9f=_0x462ed5-_0x134732;_0x7118b3=await this['_getTokenCount'](_0x554e09);const _0x4313b4=_0x7118b3+0xc8<=_0x242f9f;!_0x4313b4&&(_0x554e09=this[_0x148532(0x100)](_0x405a42,_0x242f9f,systemMessage));}_0x51125a=_0x33c85b[_0x148532(0x105)];}while(!![]);const _0x5c91d7=Math[_0x148532(0x110)](0x1,Math[_0x148532(0xff)](_0x462ed5-_0x7118b3,_0x134732));return _0x554e09;}async['_getTokenCount'](_0xbfda3f){const _0xcda34c=_0x18b871;let _0xe4a08e=_0xbfda3f[_0xcda34c(0x111)]((_0x2e243c,_0x1495a9)=>{return _0x2e243c+=_0x1495a9['content'];},'');return console[_0xcda34c(0xf6)](_0xcda34c(0x107),_0xe4a08e),_0xe4a08e=_0xe4a08e[_0xcda34c(0xfa)](/<\|endoftext\|>/g,''),tokenizer[_0xcda34c(0xf2)](_0xe4a08e)['length'];}async[_0x18b871(0x100)](_0x1326bd,_0x311122,_0x598347){const _0x6051e3=_0x18b871,_0x430c9b=await this[_0x6051e3(0x106)](_0x1326bd);if(_0x430c9b<=_0x311122)return _0x1326bd;return _0x1326bd['splice'](_0x598347?0x1:0x0,0x1),this[_0x6051e3(0x100)](_0x1326bd,_0x311122,_0x598347);}[_0x18b871(0xf9)](){return(0x0,uuid_1['v4'])();}}function _0x4354(_0x5eeac3,_0x575589){const _0xb79365=_0xb793();return _0x4354=function(_0x4354fa,_0x342c73){_0x4354fa=_0x4354fa-0xeb;let _0x1d1c5b=_0xb79365[_0x4354fa];return _0x1d1c5b;},_0x4354(_0x5eeac3,_0x575589);}function _0xb793(){const _0xe74479=['162702RsAxKX','expires','push','user','min','_recursivePruning','length','namespace','374728jmfzzf','821700gqrJXM','parentMessageId','_getTokenCount','汇总的文本数量:\x20','uuid','set','get','buildMessageFromParentMessageId','73044Hqtmnw','generateKey','NineStore','getData','max','reduce','cl100k_base','1132188zfzmbw','defineProperty','4420031aPzEdN','formatOptions','891195mbatwt','__esModule','store','@dqbd/tiktoken','encode','system','concat','slice','log','get_encoding','setData','getUuid','replace'];_0xb793=function(){return _0xe74479;};return _0xb793();}exports[_0x18b871(0x10e)]=NineStore;