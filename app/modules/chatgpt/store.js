'use strict';const _0x4d416a=_0x41fb;(function(_0x10fda4,_0x407e30){const _0x5d61ee=_0x41fb,_0x28635d=_0x10fda4();while(!![]){try{const _0x2cfc9d=-parseInt(_0x5d61ee(0x96))/0x1+-parseInt(_0x5d61ee(0xae))/0x2+-parseInt(_0x5d61ee(0x9a))/0x3*(-parseInt(_0x5d61ee(0xa5))/0x4)+parseInt(_0x5d61ee(0xb7))/0x5*(parseInt(_0x5d61ee(0xb1))/0x6)+parseInt(_0x5d61ee(0xaf))/0x7*(parseInt(_0x5d61ee(0x9b))/0x8)+-parseInt(_0x5d61ee(0x95))/0x9+parseInt(_0x5d61ee(0x98))/0xa;if(_0x2cfc9d===_0x407e30)break;else _0x28635d['push'](_0x28635d['shift']());}catch(_0x38b9b0){_0x28635d['push'](_0x28635d['shift']());}}}(_0x1801,0xaa242));Object[_0x4d416a(0xb4)](exports,'__esModule',{'value':!![]}),exports['NineStore']=void 0x0;const uuid_1=require(_0x4d416a(0xb6)),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1['get_encoding'])(_0x4d416a(0xaa));function _0x41fb(_0x21ecbe,_0x51eabf){const _0x1801af=_0x1801();return _0x41fb=function(_0x41fb96,_0x51f961){_0x41fb96=_0x41fb96-0x93;let _0x8a4a58=_0x1801af[_0x41fb96];return _0x8a4a58;},_0x41fb(_0x21ecbe,_0x51eabf);}class NineStore{constructor(_0x2b1ebe){const _0x25a9bd=_0x4d416a,{store:_0x16c4d6,namespace:_0x2846d4,expires:_0x4a6120}=this['formatOptions'](_0x2b1ebe);this['store']=_0x16c4d6,this['namespace']=_0x2846d4,this[_0x25a9bd(0x9d)]=_0x4a6120;}[_0x4d416a(0xb2)](_0x522bcb){const {store:_0x517169,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace='chat'}=_0x522bcb;return{'store':_0x517169,'namespace':namespace,'expires':expires};}[_0x4d416a(0xad)](_0x28b51b){const _0x356b9f=_0x4d416a;return this['namespace']?this[_0x356b9f(0xa3)]+'-'+_0x28b51b:_0x28b51b;}async[_0x4d416a(0x93)](_0x10da5e){const _0x54cbd8=_0x4d416a,_0x44f937=await this['store'][_0x54cbd8(0x97)](_0x10da5e);return _0x44f937;}async['setData'](_0x4a9533,_0x388e3f=this[_0x4d416a(0x9d)]){await this['store']['set'](_0x4a9533['id'],_0x4a9533,_0x388e3f);}async['buildMessageFromParentMessageId'](_0x3ef1f0,_0x33acef){const _0x522b14=_0x4d416a;let {maxRounds:_0x4b3566,maxModelToken:_0x287d09,maxResponseTokens:_0x3dabfe,systemMessage:systemMessage='',name:_0x5dc1ec}=_0x33acef,{parentMessageId:_0x4767e2}=_0x33acef,_0x4f7ef9=[],_0x1a2e5f=0x0;systemMessage&&_0x4f7ef9[_0x522b14(0x94)]({'role':_0x522b14(0xb0),'content':systemMessage});const _0x45e08c=_0x4f7ef9[_0x522b14(0xa9)];let _0x12bb72=0x0,_0x3272c6=_0x3ef1f0?_0x4f7ef9[_0x522b14(0xb3)]([{'role':_0x522b14(0x9c),'content':_0x3ef1f0,'name':_0x5dc1ec}]):_0x4f7ef9;do{if(!_0x4767e2)break;const _0x13aea8=await this[_0x522b14(0x93)](_0x4767e2);if(!_0x13aea8)break;const {text:_0x41b761,name:_0x3dcfc3,role:_0x53d0c7}=_0x13aea8;_0x3272c6=_0x3272c6['slice'](0x0,_0x45e08c)[_0x522b14(0xb3)]([{'role':_0x53d0c7,'content':_0x41b761,'name':_0x3dcfc3},..._0x3272c6[_0x522b14(0xa0)](_0x45e08c)]),_0x12bb72++;if(_0x4b3566&&_0x12bb72>=_0x4b3566)break;if(_0x287d09&&_0x3dabfe){const _0x3e4a1a=_0x287d09-_0x3dabfe;_0x1a2e5f=await this[_0x522b14(0x9f)](_0x3272c6);const _0x2f7f45=_0x1a2e5f+0xc8<=_0x3e4a1a;!_0x2f7f45&&(_0x3272c6=this[_0x522b14(0xa7)](_0x4f7ef9,_0x3e4a1a,systemMessage));}_0x4767e2=_0x13aea8['parentMessageId'];}while(!![]);const _0x37ff08=Math[_0x522b14(0xa8)](0x1,Math[_0x522b14(0xa2)](_0x287d09-_0x1a2e5f,_0x3dabfe));return _0x3272c6;}async['_getTokenCount'](_0x4b76b1){const _0x594b4f=_0x4d416a;let _0x3d12f8=_0x4b76b1[_0x594b4f(0x99)]((_0x2f8930,_0x35a9a4)=>{const _0x1c6c1b=_0x594b4f;return _0x2f8930+=_0x35a9a4[_0x1c6c1b(0xac)];},'');return console[_0x594b4f(0x9e)](_0x594b4f(0xb5),_0x3d12f8),_0x3d12f8=_0x3d12f8['replace'](/<\|endoftext\|>/g,''),tokenizer[_0x594b4f(0xa1)](_0x3d12f8)[_0x594b4f(0xa9)];}async[_0x4d416a(0xa7)](_0x33cd1f,_0x839719,_0x15e0b5){const _0x3135e4=_0x4d416a,_0x374a07=await this[_0x3135e4(0x9f)](_0x33cd1f);if(_0x374a07<=_0x839719)return _0x33cd1f;return _0x33cd1f[_0x3135e4(0xa4)](_0x15e0b5?0x1:0x0,0x1),this[_0x3135e4(0xa7)](_0x33cd1f,_0x839719,_0x15e0b5);}[_0x4d416a(0xa6)](){return(0x0,uuid_1['v4'])();}}function _0x1801(){const _0x5e70ca=['getData','push','9484551MWZjTZ','1358032armLrt','get','11777470GDAEiY','reduce','104679PMacQd','337480QYhZqa','user','expires','log','_getTokenCount','slice','encode','min','namespace','splice','140lMaPlr','getUuid','_recursivePruning','max','length','cl100k_base','NineStore','content','generateKey','1467282qbqoDX','42mLojLQ','system','36JtivcD','formatOptions','concat','defineProperty','汇总的文本数量:\x20','uuid','991915OQtMXI'];_0x1801=function(){return _0x5e70ca;};return _0x1801();}exports[_0x4d416a(0xab)]=NineStore;