'use strict';const _0x346eee=_0x4595;(function(_0x29776f,_0x494d4c){const _0x4053d3=_0x4595,_0x591614=_0x29776f();while(!![]){try{const _0x53dca6=-parseInt(_0x4053d3(0x2fd))/0x1+-parseInt(_0x4053d3(0x212))/0x2+parseInt(_0x4053d3(0x1bc))/0x3*(-parseInt(_0x4053d3(0x281))/0x4)+-parseInt(_0x4053d3(0x1ee))/0x5+-parseInt(_0x4053d3(0x158))/0x6+-parseInt(_0x4053d3(0x214))/0x7+parseInt(_0x4053d3(0x28e))/0x8*(parseInt(_0x4053d3(0x32d))/0x9);if(_0x53dca6===_0x494d4c)break;else _0x591614['push'](_0x591614['shift']());}catch(_0x433c15){_0x591614['push'](_0x591614['shift']());}}}(_0x219b,0x671db));var __decorate=this&&this['__decorate']||function(_0x42295b,_0x56ac8c,_0x324be5,_0x2a244d){const _0x5a65d0=_0x4595;var _0x2dddc0=arguments[_0x5a65d0(0x242)],_0x186225=_0x2dddc0<0x3?_0x56ac8c:_0x2a244d===null?_0x2a244d=Object[_0x5a65d0(0x24d)](_0x56ac8c,_0x324be5):_0x2a244d,_0x2831cb;if(typeof Reflect===_0x5a65d0(0x17c)&&typeof Reflect[_0x5a65d0(0x257)]===_0x5a65d0(0x169))_0x186225=Reflect[_0x5a65d0(0x257)](_0x42295b,_0x56ac8c,_0x324be5,_0x2a244d);else{for(var _0x2c90c7=_0x42295b[_0x5a65d0(0x242)]-0x1;_0x2c90c7>=0x0;_0x2c90c7--)if(_0x2831cb=_0x42295b[_0x2c90c7])_0x186225=(_0x2dddc0<0x3?_0x2831cb(_0x186225):_0x2dddc0>0x3?_0x2831cb(_0x56ac8c,_0x324be5,_0x186225):_0x2831cb(_0x56ac8c,_0x324be5))||_0x186225;}return _0x2dddc0>0x3&&_0x186225&&Object[_0x5a65d0(0x284)](_0x56ac8c,_0x324be5,_0x186225),_0x186225;},__metadata=this&&this[_0x346eee(0x326)]||function(_0x1fcfef,_0x92a343){const _0x312d97=_0x346eee;if(typeof Reflect===_0x312d97(0x17c)&&typeof Reflect[_0x312d97(0x2df)]===_0x312d97(0x169))return Reflect[_0x312d97(0x2df)](_0x1fcfef,_0x92a343);},__param=this&&this[_0x346eee(0x2bc)]||function(_0x390e49,_0x4ff854){return function(_0x88a273,_0x4a242b){_0x4ff854(_0x88a273,_0x4a242b,_0x390e49);};};function _0x4595(_0x4a7aaf,_0x28534b){const _0x219bac=_0x219b();return _0x4595=function(_0x45951b,_0x3d8c68){_0x45951b=_0x45951b-0x158;let _0x5a3e29=_0x219bac[_0x45951b];return _0x5a3e29;},_0x4595(_0x4a7aaf,_0x28534b);}Object[_0x346eee(0x284)](exports,_0x346eee(0x1ae),{'value':!![]}),exports[_0x346eee(0x32f)]=void 0x0;const file_service_1=require(_0x346eee(0x23c)),user_service_1=require(_0x346eee(0x1dc)),openai_1=require(_0x346eee(0x1c2)),common_1=require(_0x346eee(0x199)),errorMessage_constant_1=require(_0x346eee(0x299)),utils_1=require(_0x346eee(0x18e)),axios_1=require(_0x346eee(0x287)),balance_constant_1=require('../../common/constants/balance.constant'),chatLog_service_1=require(_0x346eee(0x1e4)),uuid=require(_0x346eee(0x195)),fs=require('fs'),typeorm_1=require(_0x346eee(0x30b)),typeorm_2=require('@nestjs/typeorm'),badwords_service_1=require(_0x346eee(0x1a7)),autoreply_service_1=require(_0x346eee(0x2f4)),globalConfig_service_1=require(_0x346eee(0x1bd)),chatGroup_service_1=require(_0x346eee(0x29e)),models_service_1=require(_0x346eee(0x2c1)),baidu_1=require(_0x346eee(0x2c7)),helper_1=require(_0x346eee(0x2ab)),store_1=require(_0x346eee(0x332)),zhipu_1=require(_0x346eee(0x21f)),spark_1=require(_0x346eee(0x1c7)),model_constant_1=require('../../common/constants/model.constant'),fs_1=require('fs'),path_1=require(_0x346eee(0x2ff)),gpts_service_1=require(_0x346eee(0x1b6)),yooPPT_service_1=require(_0x346eee(0x207)),pptTask_entity_1=require(_0x346eee(0x221)),ppt_constant_1=require(_0x346eee(0x192)),lumaTask_service_1=require(_0x346eee(0x1f5)),nestjs_cls_1=require(_0x346eee(0x300)),doubao_service_1=require(_0x346eee(0x2b8)),crypto_1=require('crypto'),chat_constant_1=require(_0x346eee(0x1e3)),result_1=require(_0x346eee(0x202));let ChatgptService=class ChatgptService{constructor(_0x251dd9,_0x60c269,_0x5c5858,_0x14b82d,_0xfac26a,_0x3fd9dc,_0x1157f1,_0x10ff11,_0x4330cf,_0xac51c5,_0x322dde,_0x27184f,_0x453a8f,_0x3cf9ca,_0x2645bb){const _0x276b8b=_0x346eee;this['pptTaskEntity']=_0x251dd9,this['clsService']=_0x60c269,this[_0x276b8b(0x244)]=_0x5c5858,this['fileService']=_0x14b82d,this[_0x276b8b(0x317)]=_0xfac26a,this[_0x276b8b(0x1d7)]=_0x3fd9dc,this[_0x276b8b(0x1b1)]=_0x1157f1,this[_0x276b8b(0x170)]=_0x10ff11,this[_0x276b8b(0x217)]=_0x4330cf,this[_0x276b8b(0x23d)]=_0xac51c5,this[_0x276b8b(0x29b)]=_0x322dde,this[_0x276b8b(0x31f)]=_0x27184f,this[_0x276b8b(0x2f9)]=_0x453a8f,this[_0x276b8b(0x2b3)]=_0x3cf9ca,this[_0x276b8b(0x283)]=_0x2645bb,this[_0x276b8b(0x1e8)]=_0x276b8b(0x2e1),this[_0x276b8b(0x32e)]=null,this[_0x276b8b(0x166)]=null,this[_0x276b8b(0x2a9)]=_0x400b38=>{return fs['unlink'](_0x400b38,_0x16cc43=>{const _0x1c4afe=_0x4595;_0x16cc43?console[_0x1c4afe(0x302)](_0x1c4afe(0x22b),_0x16cc43):console['log']('remove\x20file\x20%s\x20success',_0x400b38);});};}async[_0x346eee(0x22c)](){const _0x591cae=_0x346eee;let _0x5a5781=await(0x0,utils_1[_0x591cae(0x29d)])(_0x591cae(0x16c));_0x5a5781=_0x5a5781?.[_0x591cae(0x298)]?_0x5a5781[_0x591cae(0x298)]:_0x5a5781,this[_0x591cae(0x230)]=_0x5a5781['ChatGPTAPI'];let _0x190823=await(0x0,utils_1[_0x591cae(0x29d)])(_0x591cae(0x2de));_0x190823=_0x190823?.[_0x591cae(0x298)]?_0x190823['default']:_0x190823;let _0x2d4c4f=await(0x0,utils_1[_0x591cae(0x29d)])(_0x591cae(0x1f4));_0x2d4c4f=_0x2d4c4f?.['default']?_0x2d4c4f['default']:_0x2d4c4f;const _0x37f4f5=+process[_0x591cae(0x21d)][_0x591cae(0x253)],_0x28e415=process[_0x591cae(0x21d)]['REDIS_HOST'],_0x2dac9a=process[_0x591cae(0x21d)][_0x591cae(0x1f3)],_0x39c38d=process[_0x591cae(0x21d)][_0x591cae(0x1ad)],_0x3aa859=_0x591cae(0x301)+(_0x39c38d||'')+':'+(_0x2dac9a||'')+'@'+_0x28e415+':'+_0x37f4f5,_0x28ad2e=new _0x2d4c4f(_0x3aa859);this['messageStore']=new _0x190823({'store':_0x28ad2e,'namespace':'gomaxai-chatlog'}),this[_0x591cae(0x166)]=new store_1[(_0x591cae(0x246))]({'store':this[_0x591cae(0x32e)],'namespace':_0x591cae(0x1b3)}),!this[_0x591cae(0x2dc)]&&this[_0x591cae(0x1be)]();}[_0x346eee(0x1be)](){const _0x359848=_0x346eee;this['openAi']=new openai_1['default']({'apiKey':_0x359848(0x2f2),'baseURL':this[_0x359848(0x1e8)]+'/v1'});}async['getModelConfig'](_0x3dc434){const _0x2fd9b7=_0x346eee,{type:_0x378128,groupId:_0x17930c,modelType:_0x51535e}=_0x3dc434;let _0x5dc2eb,_0x410eaa;_0x378128&&_0x378128===_0x2fd9b7(0x1f7)?(_0x410eaa=await this[_0x2fd9b7(0x317)][_0x2fd9b7(0x267)](_0x17930c),_0x5dc2eb=_0x410eaa[_0x2fd9b7(0x30e)]):_0x410eaa=await this[_0x2fd9b7(0x2f9)][_0x2fd9b7(0x267)](_0x17930c);let _0x39f3e6;if(_0x410eaa)_0x39f3e6=JSON['parse'](_0x410eaa[_0x2fd9b7(0x2b6)]);else _0x51535e?_0x39f3e6=await this[_0x2fd9b7(0x170)]['getModelByType'](_0x51535e):_0x39f3e6=await this['modelsService'][_0x2fd9b7(0x24e)](model_constant_1[_0x2fd9b7(0x256)][_0x2fd9b7(0x1c9)]);if(!_0x39f3e6)throw new common_1[(_0x2fd9b7(0x262))]('未获取到模型基础配置，请前往后台配置并启用',common_1[_0x2fd9b7(0x1aa)][_0x2fd9b7(0x17e)]);return{'appId':_0x5dc2eb,'modelConfig':_0x39f3e6};}async[_0x346eee(0x205)](_0x3e9b75){const _0x1eda44=_0x346eee,_0x13974b=this;let _0x532b4b='',_0x7f7828='',{type:_0x5c260d,appId:_0x46a816,prompt:_0x256be3,custom:_0x1ab2ee,usingNetwork:_0x464cb7,systemMessage:_0x4a4099,customSystemMessage:_0x3cc778}=_0x3e9b75;const _0x4b1ed3=async function(){const _0x32d415=_0x4595,_0x3a67bd=new Date()[_0x32d415(0x2dd)]()[_0x32d415(0x1b0)]('T')[0x0];return _0x7f7828=await _0x13974b[_0x32d415(0x2b3)][_0x32d415(0x1ce)]([_0x32d415(0x20a)]),_0x7f7828+(_0x32d415(0x314)+_0x3a67bd);};if(_0x46a816){const _0x555ffd=await this[_0x1eda44(0x317)][_0x1eda44(0x2d1)](_0x46a816,0x1);if(!_0x555ffd)throw new common_1['HttpException'](_0x1eda44(0x2fe),common_1[_0x1eda44(0x1aa)][_0x1eda44(0x17e)]);_0x555ffd[_0x1eda44(0x278)]&&(_0x4a4099=_0x555ffd[_0x1eda44(0x278)]);}else{if(_0x1ab2ee)_0x4a4099=_0x4a4099;else _0x3cc778?_0x4a4099=_0x3cc778:_0x5c260d!==_0x1eda44(0x1f7)&&(_0x4a4099=await _0x4b1ed3());}return _0x464cb7&&(_0x532b4b=await(0x0,utils_1[_0x1eda44(0x15a)])(_0x256be3),!_0x7f7828&&(_0x4a4099=await _0x4b1ed3())),{'systemMessage':_0x4a4099,'netWorkPrompt':_0x532b4b};}async[_0x346eee(0x25b)](_0x2b9783){const _0x5467e2=_0x346eee,{type:_0x1134d2,custom:_0x204f03,groupId:_0x4484f4,modelConfig:_0x56fcbb}=_0x2b9783;let _0x35a698=null;if(!_0x204f03&&!_0x1134d2){const _0x52791b=await this[_0x5467e2(0x170)][_0x5467e2(0x24e)](model_constant_1[_0x5467e2(0x256)][_0x5467e2(0x2f1)],_0x56fcbb[_0x5467e2(0x1d6)][_0x5467e2(0x25a)]);_0x35a698=_0x52791b['modelInfo'];}else{if(_0x1134d2===_0x5467e2(0x1f7))_0x35a698=await this[_0x5467e2(0x317)][_0x5467e2(0x2d0)](_0x4484f4);else{if(_0x1134d2==='file'){const _0x36cfe6=await this['modelsService']['getModelByType'](model_constant_1[_0x5467e2(0x256)][_0x5467e2(0x16d)],_0x56fcbb[_0x5467e2(0x1d6)]['model']);_0x35a698=_0x36cfe6[_0x5467e2(0x1d6)];}else _0x204f03?_0x35a698=await this['modelsService']['getRandomKey'](model_constant_1['EModelType'][_0x5467e2(0x1c9)]):_0x35a698=await this['modelsService'][_0x5467e2(0x18c)](model_constant_1[_0x5467e2(0x256)][_0x5467e2(0x2f1)]);}}if(!_0x35a698)throw new common_1[(_0x5467e2(0x262))](_0x5467e2(0x17b),common_1[_0x5467e2(0x1aa)][_0x5467e2(0x17e)]);return _0x1134d2===_0x5467e2(0x1f7)?_0x56fcbb['modelInfo'][_0x5467e2(0x25a)]=_0x35a698[_0x5467e2(0x25a)]:_0x35a698[_0x5467e2(0x25a)]=_0x56fcbb[_0x5467e2(0x1d6)][_0x5467e2(0x25a)],_0x35a698;}async[_0x346eee(0x24a)](_0x4a545d){const _0x7407bb=_0x346eee,{user:_0x1de01b,prompt:_0x24a1d9,currentRequestModel:_0x4e8f15}=_0x4a545d;await this[_0x7407bb(0x244)][_0x7407bb(0x1ba)](_0x1de01b),await this['badwordsService'][_0x7407bb(0x25f)](_0x24a1d9,_0x1de01b['id']),await this[_0x7407bb(0x244)][_0x7407bb(0x30f)](_0x1de01b['id'],_0x4e8f15);}async['buildOptions'](_0x556e99,_0x862433,_0x5f189b){const _0x1bc876=_0x346eee,_0x39010b=await this['globalConfigService'][_0x1bc876(0x1ce)]([_0x1bc876(0x15c)]),_0x1cadc3=Number(_0x39010b)||0x493e0,_0x1c7018={'timeoutMs':+_0x1cadc3,'systemMessage':_0x862433||'','parentMessageId':_0x556e99||'','completionParams':{'temperature':0.8,'model':_0x5f189b[_0x1bc876(0x25a)]}};return _0x1c7018;}async['configChatGptApi'](_0x17e2c9,_0x152e67){const _0x3cbc27=_0x346eee;let _0x88385b=_0x17e2c9[_0x3cbc27(0x2b0)];if(!_0x88385b){const _0x13210f=await this['globalConfigService'][_0x3cbc27(0x1ce)]([_0x3cbc27(0x249)]);_0x13210f?_0x88385b=_0x13210f:_0x88385b='https://api.openai.com';}const _0x275442=0x1f40,_0x3240da=0x1000,_0x3b321f=new this['api']({'maxModelTokens':_0x275442,'apiBaseUrl':_0x88385b+'/v1','messageStore':this[_0x3cbc27(0x32e)],'apiKey':(0x0,utils_1[_0x3cbc27(0x1ff)])(_0x17e2c9[_0x3cbc27(0x31b)]),'maxResponseTokens':_0x3240da>=_0x275442?Math[_0x3cbc27(0x165)](Math[_0x3cbc27(0x176)](_0x275442/0x2)):_0x3240da});return console[_0x3cbc27(0x302)](_0x3cbc27(0x2af),_0x3b321f[_0x3cbc27(0x2af)]),console['log'](_0x3cbc27(0x232),_0x152e67),console[_0x3cbc27(0x302)](_0x3cbc27(0x295),_0x88385b+_0x3cbc27(0x215)),_0x3b321f;}async[_0x346eee(0x28a)](_0x130ee3){const _0x17fc2d=_0x346eee,_0x3b7982=new openai_1['default']({'baseURL':_0x130ee3['proxyUrl']+'/v1'||_0x17fc2d(0x1a8),'apiKey':_0x130ee3[_0x17fc2d(0x31b)]});return _0x3b7982;}async[_0x346eee(0x229)](_0x1acf27,_0x45b9fb){const _0x5bd6a4=_0x346eee;let _0xf0d7dd=_0x1acf27[_0x5bd6a4(0x2b0)]||'https://ark.cn-beijing.volces.com';const _0x5ede33=0x1f40,_0x52ba70=0x1000,_0x24345a=new this[(_0x5bd6a4(0x230))]({'maxModelTokens':_0x5ede33,'apiBaseUrl':_0xf0d7dd+_0x5bd6a4(0x2a8),'messageStore':this[_0x5bd6a4(0x32e)],'apiKey':(0x0,utils_1[_0x5bd6a4(0x1ff)])(_0x1acf27['key']),'maxResponseTokens':_0x52ba70>=_0x5ede33?Math[_0x5bd6a4(0x165)](Math[_0x5bd6a4(0x176)](_0x5ede33/0x2)):_0x52ba70});return console[_0x5bd6a4(0x302)](_0x5bd6a4(0x2af),_0x24345a[_0x5bd6a4(0x2af)]),console['log'](_0x5bd6a4(0x232),_0x45b9fb),console['log']('apiBaseUrl',_0xf0d7dd+_0x5bd6a4(0x2a8)),_0x24345a;}async[_0x346eee(0x1df)](_0x525d37,_0x49f5f3,_0x4dc247=null){const _0x11064b=_0x346eee;let _0x38e8d9=[];for(const _0x47cadf of _0x49f5f3){const _0x1f7002=new URL(_0x47cadf);let _0x360b26=(0x0,path_1[_0x11064b(0x28d)])(process['cwd'](),_0x11064b(0x159),_0x1f7002['pathname']);_0x360b26=decodeURIComponent(_0x360b26);const _0xfbfc3a=await _0x525d37[_0x11064b(0x2bb)][_0x11064b(0x19f)]({'file':fs[_0x11064b(0x1fa)](_0x360b26),'purpose':'file-extract'});let _0x4cd47f=await(await _0x525d37['files'][_0x11064b(0x2cf)](_0xfbfc3a['id']))['text']();_0x38e8d9[_0x11064b(0x271)]({'role':_0x11064b(0x276),'content':_0x4cd47f});}return _0x38e8d9;}async['openAiErrHandler'](_0x52f907,_0x117179){const _0x4ae8be=_0x346eee;let _0x2b1ad1='',_0x419b4e=_0x52f907[_0x4ae8be(0x181)];return!_0x2b1ad1&&(_0x2b1ad1=errorMessage_constant_1[_0x4ae8be(0x29c)][_0x419b4e]?errorMessage_constant_1['OpenAiErrorCodeMessage'][_0x419b4e]:_0x4ae8be(0x307)),_0x52f907?.[_0x4ae8be(0x305)][_0x4ae8be(0x1c8)]('The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.')&&(await this['modelsService'][_0x4ae8be(0x196)](_0x117179['id'],_0x4ae8be(0x2f7),-0x1),_0x2b1ad1=_0x4ae8be(0x1bf)),_0x52f907?.['statusCode']===0x1ad&&_0x52f907['message'][_0x4ae8be(0x1c8)](_0x4ae8be(0x180))&&(await this['modelsService']['lockKey'](_0x117179['id'],_0x4ae8be(0x28b),-0x3),_0x2b1ad1=_0x4ae8be(0x208)),_0x52f907?.[_0x4ae8be(0x181)]===0x191&&_0x52f907['message']['includes'](_0x4ae8be(0x27e))&&(await this['modelsService'][_0x4ae8be(0x196)](_0x117179['id'],_0x4ae8be(0x1de),-0x2),_0x2b1ad1=_0x4ae8be(0x25c)),_0x52f907?.['statusCode']===0x191&&(_0x2b1ad1=_0x4ae8be(0x25c)),_0x52f907?.[_0x4ae8be(0x181)]===0x191&&_0x52f907[_0x4ae8be(0x305)]['includes']('Unauthorized')&&(await this['modelsService']['lockKey'](_0x117179['id'],'模型秘钥错误或模型余额不足',-0x2),_0x2b1ad1='模型秘钥错误或模型金额不足，请联系管理员！'),_0x52f907?.['statusCode']===0x194&&_0x52f907['message']['includes'](_0x4ae8be(0x1c6))&&(await this[_0x4ae8be(0x170)]['lockKey'](_0x117179['id'],_0x4ae8be(0x241),-0x4),_0x2b1ad1=_0x4ae8be(0x2b5)),_0x2b1ad1;}async[_0x346eee(0x175)](_0x1b6ede,_0x1fa785,_0x2ec4b7,_0x4c026c=!![]){const _0x1fd275=_0x346eee;try{const _0x4bba41=_0x1fa785[_0x1fd275(0x164)],_0x1b9413=(0x0,utils_1[_0x1fd275(0x2ef)])(this[_0x1fd275(0x32c)]),{options:options={},prompt:_0x3e2810,cusromPrompt:_0x2a5f42}=_0x1b6ede,{groupId:_0x583866,usingNetwork:_0x1ae265,parentMessageId:_0x2dc78f,type:_0x4c25b2}=options,{appId:_0x316a9e,modelConfig:_0x541a76}=await this['getModelConfig']({'type':_0x4c25b2,'groupId':_0x583866}),{systemMessage:_0x164a04,netWorkPrompt:_0x37bfb6}=await this[_0x1fd275(0x205)]({'type':_0x4c25b2,'appId':_0x316a9e,'prompt':_0x3e2810,'usingNetwork':_0x1ae265,'custom':_0x2a5f42,'systemMessage':_0x1b6ede[_0x1fd275(0x235)],'customSystemMessage':_0x541a76['modelInfo']['systemMessage']}),_0x3da6a2=await this['getCurrentModel']({'type':_0x4c25b2,'groupId':_0x583866,'modelConfig':_0x541a76,'custom':_0x2a5f42});await this['validateBeforeChat']({'prompt':_0x3e2810,'currentRequestModel':_0x3da6a2,'user':_0x1fa785[_0x1fd275(0x279)]});const _0x159e35=await this[_0x1fd275(0x31f)][_0x1fd275(0x2a0)](_0x3e2810);_0x2ec4b7&&_0x4c026c&&_0x2ec4b7[_0x1fd275(0x1ef)](_0x1fd275(0x226),_0x1fd275(0x20f));if(_0x159e35){if(_0x2ec4b7&&_0x4c026c){const _0x3c2fcd={'message':_0x159e35,'code':0x1f4};_0x2ec4b7['write'](JSON[_0x1fd275(0x23e)](_0x3c2fcd)),_0x2ec4b7[_0x1fd275(0x275)]();return;}else return _0x159e35;}const _0x3d865a=await this['buildOptions'](options['parentMessageId'],_0x164a04,_0x3da6a2);options[_0x1fd275(0x25a)]&&(_0x3d865a['completionParams'][_0x1fd275(0x25a)]=options[_0x1fd275(0x25a)]);let {model:_0x59a33b,rounds:_0x4be44c,keyType:_0x1f6adb,modelType:_0x5a12fc,id:_0x177835,topN:_0x37fe5a}=_0x541a76[_0x1fd275(0x1d6)];const {key:_0x38b985,modelName:_0x367b07,id:_0x2e367a,accessToken:_0x17162f}=_0x3da6a2;_0x59a33b=_0x3d865a[_0x1fd275(0x1a1)][_0x1fd275(0x25a)];_0x2ec4b7&&_0x4c026c&&_0x2ec4b7[_0x1fd275(0x2da)](0xc8);let _0x146795=null,_0x373bfa=null;const _0x29e045=(0x0,utils_1['getClientIp'])(_0x1fa785),_0x21bafd={'appId':_0x316a9e,'curIp':_0x29e045,'prompt':_0x3e2810,'groupId':_0x583866,'modelId':_0x177835,'modelType':_0x5a12fc,'answer':'','model':_0x59a33b,'role':_0x1fd275(0x279),'userId':_0x1fa785['user']['id'],'completionTokens':0x0,'type':balance_constant_1[_0x1fd275(0x263)][_0x1fd275(0x2ed)],'logType':_0x4c25b2===_0x1fd275(0x1f7)?0x2:0x1,'requestOptions':JSON[_0x1fd275(0x23e)]({'options':options,'prompt':_0x3e2810}),'saasId':_0x1b9413},_0x22d641={..._0x21bafd,'role':'assistant','requestOptions':JSON[_0x1fd275(0x23e)]({'prompt':_0x3e2810,'options':{'model':_0x59a33b,'temperature':_0x37fe5a}})};try{if(_0x2ec4b7){let _0x3a25c3=null,_0x6f501b=![];_0x2ec4b7['on'](_0x1fd275(0x23b),async()=>{const _0x331418=_0x1fd275;if(_0x6f501b)return;_0x4bba41[_0x331418(0x1f9)]();const _0x450d0c=0x0,_0x1649ee=0x0,_0x5f0da6=_0x450d0c+_0x1649ee;_0x21bafd[_0x331418(0x2ca)]=_0x450d0c,_0x21bafd[_0x331418(0x2ae)]=_0x450d0c,await this[_0x331418(0x217)][_0x331418(0x247)](_0x21bafd),_0x22d641[_0x331418(0x28f)]=_0x3a25c3?.[_0x331418(0x1b8)],_0x22d641[_0x331418(0x2ca)]=_0x5f0da6,_0x22d641[_0x331418(0x2ae)]=_0x450d0c,_0x22d641['completionTokens']=_0x1649ee,_0x22d641[_0x331418(0x31d)]=JSON[_0x331418(0x23e)]({'conversationId':_0x3a25c3?.[_0x331418(0x1c4)],'model':_0x59a33b,'parentMessageId':_0x3a25c3?.['id'],'temperature':_0x37fe5a});const _0x5dffe1=await this['chatLogService'][_0x331418(0x247)](_0x22d641);await this['userService'][_0x331418(0x17a)](_0x1fa785[_0x331418(0x279)]['id'],_0x3da6a2,_0x5dffe1['id']);}),_0x2ec4b7['on'](_0x1fd275(0x228),_0x31f04b=>{const _0x53a410=_0x1fd275;console[_0x53a410(0x302)](_0x31f04b);});if(Number(_0x1f6adb)===0x1){let _0x43fca7=!![];const _0x194bd8=await this[_0x1fd275(0x1f2)](_0x3da6a2,_0x3d865a);_0x146795=await _0x194bd8['sendMessage'](_0x1ae265?_0x37bfb6:_0x3e2810,{..._0x3d865a,'onProgress':_0x483835=>{const _0x2dc477=_0x1fd275;_0x4c026c&&_0x2ec4b7[_0x2dc477(0x2bf)](_0x43fca7?JSON['stringify'](_0x483835):'\x0a'+JSON['stringify'](_0x483835)),_0x43fca7=![],_0x3a25c3=_0x483835;},'abortSignal':_0x4bba41[_0x1fd275(0x25e)]}),_0x6f501b=!![];}if(Number(_0x1f6adb)===0x2){let _0x57467c=!![];const _0x582c7a=await this[_0x1fd275(0x166)][_0x1fd275(0x2a5)](_0x1ae265?_0x37bfb6:_0x3e2810,{'parentMessageId':_0x2dc78f,'maxRounds':(0x0,helper_1[_0x1fd275(0x220)])(_0x4be44c)});_0x146795=await(0x0,baidu_1['sendMessageFromBaidu'])(_0x1ae265?_0x37bfb6:_0x582c7a,{'temperature':_0x37fe5a,'accessToken':_0x17162f,'model':_0x59a33b,'onProgress':_0x5797ee=>{const _0x3fd877=_0x1fd275;_0x4c026c&&_0x2ec4b7[_0x3fd877(0x2bf)](_0x57467c?JSON[_0x3fd877(0x23e)](_0x5797ee):'\x0a'+JSON[_0x3fd877(0x23e)](_0x5797ee)),_0x57467c=![],_0x3a25c3=_0x5797ee;}}),_0x6f501b=!![];}if(Number(_0x1f6adb)===0x3){let _0x8dcc4=!![];const _0x1f0a7c=await this[_0x1fd275(0x166)][_0x1fd275(0x2a5)](_0x1ae265?_0x37bfb6:_0x3e2810,{'parentMessageId':_0x2dc78f,'maxRounds':(0x0,helper_1['addOneIfOdd'])(_0x4be44c)});_0x146795=await(0x0,zhipu_1[_0x1fd275(0x22f)])(_0x1ae265?_0x37bfb6:_0x1f0a7c,{'temperature':_0x37fe5a,'key':_0x38b985,'model':_0x59a33b,'onProgress':_0x4f0a4f=>{const _0x34d9ad=_0x1fd275;_0x4c026c&&_0x2ec4b7['write'](_0x8dcc4?JSON[_0x34d9ad(0x23e)](_0x4f0a4f):'\x0a'+JSON[_0x34d9ad(0x23e)](_0x4f0a4f)),_0x8dcc4=![],_0x3a25c3=_0x4f0a4f;}}),_0x6f501b=!![];}if(Number(_0x1f6adb)===0x4){let _0x44a769=!![];const {key:_0x4ade5a,appid:_0x1f427a,secret:_0x325602,model:_0x4119d9}=_0x3da6a2,_0x579bb7=await this[_0x1fd275(0x166)][_0x1fd275(0x2a5)](_0x1ae265?_0x37bfb6:_0x3e2810,{'parentMessageId':_0x2dc78f,'maxRounds':(0x0,helper_1['addOneIfOdd'])(_0x4be44c)}),_0x353aaf=new spark_1[(_0x1fd275(0x234))]({'appid':_0x1f427a,'secret':_0x325602,'key':_0x4ade5a});_0x146795=await _0x353aaf[_0x1fd275(0x2c9)](_0x1ae265?_0x37bfb6:_0x579bb7,{'temperature':_0x37fe5a,'model':_0x4119d9,'onProgress':_0xac9880=>{const _0x52763b=_0x1fd275;_0x4c026c&&_0x2ec4b7[_0x52763b(0x2bf)](_0x44a769?JSON[_0x52763b(0x23e)](_0xac9880):'\x0a'+JSON[_0x52763b(0x23e)](_0xac9880)),_0x44a769=![],_0x3a25c3=_0xac9880;},'abortController':_0x4bba41}),_0x6f501b=!![];}if(Number(_0x1f6adb)===0x7){_0x146795={};const _0x3f638a=await this[_0x1fd275(0x28a)](_0x3da6a2);let _0x176db7=!![],_0x4d792d=[],_0x5db226=!![];const _0x56aae1=[],_0xd0553d=[],_0x5bf569=_0x3e2810[_0x1fd275(0x1b0)]('\x20');for(let _0x4a0118=0x0;_0x4a0118<_0x5bf569[_0x1fd275(0x242)];_0x4a0118++){_0x176db7&&/^[http:\/\/|https:\/\/]/[_0x1fd275(0x224)](_0x5bf569[_0x4a0118])?_0x56aae1[_0x1fd275(0x271)](_0x5bf569[_0x4a0118]):(_0x176db7=![],_0x5bf569[_0x4a0118]&&_0xd0553d[_0x1fd275(0x271)](_0x5bf569[_0x4a0118]));}if(options[_0x1fd275(0x1c0)]){const _0x2f7959=await this[_0x1fd275(0x217)][_0x1fd275(0x1cf)](options['groupId']);_0x4d792d=_0x2f7959[_0x1fd275(0x2f3)](_0x3a0e47=>{const _0x306be3=_0x1fd275;return{'role':_0x3a0e47[_0x306be3(0x1b5)]===_0x306be3(0x279)?'user':_0x306be3(0x276),'content':_0x3a0e47[_0x306be3(0x2f8)]||_0x3a0e47[_0x306be3(0x28f)]};});}const _0x7e3c62=await this[_0x1fd275(0x1df)](_0x3f638a,_0x56aae1),_0x50b2de=[..._0x4d792d,..._0x7e3c62,{'role':_0x1fd275(0x276),'content':_0x1fd275(0x2a1)+_0x1fd275(0x2a3)+_0x1fd275(0x1c5)},{'role':_0x1fd275(0x279),'content':_0xd0553d[_0x1fd275(0x28d)]('\x20')}];console['log'](_0x1fd275(0x2af),_0x3f638a[_0x1fd275(0x2af)]),console['log'](_0x1fd275(0x232),options),console[_0x1fd275(0x302)](_0x1fd275(0x295),_0x3f638a[_0x1fd275(0x1e1)]+_0x1fd275(0x215)),console[_0x1fd275(0x302)](_0x1fd275(0x273),JSON[_0x1fd275(0x23e)](_0x50b2de));const _0x4fcfc5=await _0x3f638a[_0x1fd275(0x1b3)][_0x1fd275(0x259)][_0x1fd275(0x19f)]({'stream':!![],..._0x3d865a,'messages':_0x50b2de,'model':_0x3da6a2['model']});for await(const _0x5597b9 of _0x4fcfc5){const _0x406199=_0x5597b9?.[_0x1fd275(0x274)][0x0],_0x444c82=_0x406199?.[_0x1fd275(0x2fc)];_0x146795[_0x1fd275(0x231)]=_0x5597b9,_0x5597b9['id']&&(_0x146795['id']=_0x5597b9['id']),_0x444c82[_0x1fd275(0x1b5)]&&(_0x146795[_0x1fd275(0x1b5)]=_0x444c82['role']),_0x444c82&&_0x444c82[_0x1fd275(0x2cf)]&&(_0x146795[_0x1fd275(0x1b8)]+=_0x444c82[_0x1fd275(0x2cf)],_0x146795[_0x1fd275(0x2fc)]=_0x444c82?.['content']),_0x406199[_0x1fd275(0x31c)]&&(_0x146795[_0x1fd275(0x1b8)]=_0x146795[_0x1fd275(0x1b8)][_0x1fd275(0x193)]()),_0x4fcfc5&&_0x2ec4b7[_0x1fd275(0x2bf)](_0x5db226?JSON[_0x1fd275(0x23e)](_0x146795):'\x0a'+JSON[_0x1fd275(0x23e)](_0x146795)),_0x5db226=![],_0x3a25c3=_0x5597b9;}}if(Number(_0x1f6adb)===0x8){let _0x7fba47=!![];const _0x5cd968=await this[_0x1fd275(0x229)](_0x3da6a2,_0x3d865a);_0x146795=await _0x5cd968[_0x1fd275(0x26f)](_0x1ae265?_0x37bfb6:_0x3e2810,{..._0x3d865a,'onProgress':_0x2db9b2=>{const _0x2f4fa7=_0x1fd275;_0x4c026c&&_0x2ec4b7[_0x2f4fa7(0x2bf)](_0x7fba47?JSON[_0x2f4fa7(0x23e)](_0x2db9b2):'\x0a'+JSON[_0x2f4fa7(0x23e)](_0x2db9b2)),_0x7fba47=![],_0x3a25c3=_0x2db9b2;},'abortSignal':_0x4bba41[_0x1fd275(0x25e)]}),_0x6f501b=!![];}const _0x17ceff={'id':this[_0x1fd275(0x166)][_0x1fd275(0x29a)](),'text':_0x3e2810,'role':_0x1fd275(0x279),'name':undefined,'usage':null,'parentMessageId':_0x2dc78f,'conversationId':_0x146795?.['conversationId']||null};_0x373bfa={'model':_0x59a33b,'parentMessageId':_0x2dc78f},await this['gomaxAiStore'][_0x1fd275(0x265)](_0x17ceff);const _0x2b4337={'id':_0x146795?.['id']||this[_0x1fd275(0x166)][_0x1fd275(0x29a)](),'text':_0x146795[_0x1fd275(0x1b8)],'role':_0x1fd275(0x268),'name':undefined,'usage':_0x146795[_0x1fd275(0x1fd)],'parentMessageId':_0x17ceff['id'],'conversationId':_0x146795?.[_0x1fd275(0x1c4)]};await this['gomaxAiStore'][_0x1fd275(0x265)](_0x2b4337),_0x373bfa={'model':_0x59a33b,'parentMessageId':_0x17ceff['id']};}else{console[_0x1fd275(0x302)](_0x1fd275(0x216));const _0x51ad78=await this['configChatGptApi'](_0x3da6a2,_0x3d865a);_0x146795=await _0x51ad78[_0x1fd275(0x26f)](_0x1ae265?_0x37bfb6:_0x3e2810,_0x3d865a);}const _0x5d7d5d=(0x0,helper_1[_0x1fd275(0x1a6)])(_0x1f6adb,_0x146795,_0x373bfa),{prompt_tokens:prompt_tokens=0x0,completion_tokens:completion_tokens=0x0,total_tokens:total_tokens=0x0}=_0x5d7d5d[_0x1fd275(0x1fd)];_0x4c25b2===_0x1fd275(0x1f7)?await this[_0x1fd275(0x317)]['saveGptsUseLog'](_0x2e367a,total_tokens):await this[_0x1fd275(0x170)][_0x1fd275(0x206)](_0x2e367a,total_tokens);_0x21bafd['totalTokens']=total_tokens,await this[_0x1fd275(0x217)][_0x1fd275(0x247)](_0x21bafd),_0x22d641['answer']=_0x5d7d5d?.[_0x1fd275(0x1b8)],_0x22d641[_0x1fd275(0x2ca)]=total_tokens,_0x22d641[_0x1fd275(0x2ae)]=prompt_tokens,_0x22d641[_0x1fd275(0x24f)]=completion_tokens,_0x22d641[_0x1fd275(0x31d)]=JSON[_0x1fd275(0x23e)]({'conversationId':_0x146795[_0x1fd275(0x1c4)],'model':_0x59a33b,'parentMessageId':_0x146795['id'],'temperature':_0x37fe5a});const _0x8b5248=await this[_0x1fd275(0x217)][_0x1fd275(0x247)](_0x22d641);common_1[_0x1fd275(0x1d1)][_0x1fd275(0x240)](_0x1fd275(0x2fa)+_0x1fa785[_0x1fd275(0x279)]['id']+_0x1fd275(0x22d)+_0x59a33b+'\x20key\x20->\x20'+_0x38b985+_0x1fd275(0x2b4)+_0x367b07,_0x1fd275(0x32f)),_0x146795['result']&&(_0x146795[_0x1fd275(0x21e)]=''),_0x146795[_0x1fd275(0x20c)]=!![],_0x146795[_0x1fd275(0x2bd)]=_0x8b5248['id'];if(_0x2ec4b7&&_0x4c026c)await this[_0x1fd275(0x244)][_0x1fd275(0x17a)](_0x1fa785[_0x1fd275(0x279)]['id'],_0x3da6a2,_0x8b5248['id']),_0x2ec4b7[_0x1fd275(0x2bf)]('\x0a'+JSON['stringify'](_0x146795));else return _0x146795[_0x1fd275(0x1b8)];}catch(_0x593900){_0x22d641[_0x1fd275(0x28f)]=_0x593900[_0x1fd275(0x305)],_0x22d641['errMsg']=_0x593900[_0x1fd275(0x305)],_0x22d641[_0x1fd275(0x31d)]=JSON[_0x1fd275(0x23e)]({'conversationId':_0x146795?.['conversationId'],'model':_0x59a33b,'parentMessageId':_0x146795?.['id'],'temperature':_0x37fe5a}),await this[_0x1fd275(0x217)][_0x1fd275(0x247)](_0x22d641),console[_0x1fd275(0x302)](_0x1fd275(0x16e),_0x38b985,_0x593900);const _0x38b85f=_0x593900[_0x1fd275(0x181)];_0x38b85f===0x190&&console[_0x1fd275(0x302)](_0x1fd275(0x167),_0x593900,_0x593900[_0x1fd275(0x305)]);if(_0x593900[_0x1fd275(0x2da)]&&_0x593900[_0x1fd275(0x2da)]===0x192){const _0x361cf1={'message':_0x1fd275(0x2c5)+_0x593900[_0x1fd275(0x305)],'code':0x192};if(_0x2ec4b7&&_0x4c026c){_0x2ec4b7['write'](JSON[_0x1fd275(0x23e)](_0x361cf1)),_0x2ec4b7[_0x1fd275(0x275)]();return;}else throw new common_1[(_0x1fd275(0x262))](_0x593900['message'],common_1['HttpStatus'][_0x1fd275(0x243)]);}if(!_0x38b85f){if(_0x2ec4b7&&_0x4c026c){_0x2ec4b7['write'](JSON[_0x1fd275(0x23e)]({'message':_0x593900['message'],'code':0x1f4})),_0x2ec4b7[_0x1fd275(0x275)]();return;}else throw new common_1[(_0x1fd275(0x262))](_0x593900[_0x1fd275(0x305)],common_1[_0x1fd275(0x1aa)]['BAD_REQUEST']);}const _0x43854a=await this['openAiErrHandler'](_0x593900,_0x3da6a2),_0x4df450={'message':_0x43854a||_0x1fd275(0x269),'code':_0x38b85f===0x191?0x191:_0x38b85f||0x1f4};if(_0x2ec4b7&&_0x4c026c)_0x2ec4b7[_0x1fd275(0x181)]=0x190,_0x2ec4b7[_0x1fd275(0x2bf)](JSON[_0x1fd275(0x23e)](_0x4df450));else throw new common_1['HttpException'](_0x4df450[_0x1fd275(0x305)],common_1[_0x1fd275(0x1aa)][_0x1fd275(0x17e)]);}finally{_0x2ec4b7&&_0x4c026c&&_0x2ec4b7['end']();}}catch(_0x457b31){if(_0x457b31 instanceof common_1[_0x1fd275(0x262)])throw _0x457b31;else throw new common_1[(_0x1fd275(0x262))](_0x457b31['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x346eee(0x222)](_0x2d7ab6){const _0x5336a0=_0x346eee,{userId:_0x172a6e,prompt:_0x3a0bd6,options:_0x1e1f57,answerLogDTO:_0x4563bf,currentRequestModel:_0x348040}=_0x2d7ab6;try{const _0x2c2920=await this[_0x5336a0(0x1f2)](_0x348040,_0x1e1f57),_0x538464=await _0x2c2920[_0x5336a0(0x26f)](_0x3a0bd6,{..._0x1e1f57,'onProgress':_0xd0fa36=>{}});let _0x4edbeb={'model':_0x1e1f57[_0x5336a0(0x1a1)]['model'],'parentMessageId':_0x1e1f57[_0x5336a0(0x1c0)]};const _0x3a32fe=(0x0,helper_1[_0x5336a0(0x1a6)])(0x1,_0x538464,_0x4edbeb),{prompt_tokens:prompt_tokens=0x0,completion_tokens:completion_tokens=0x0,total_tokens:total_tokens=0x0}=_0x3a32fe[_0x5336a0(0x1fd)];await this[_0x5336a0(0x170)][_0x5336a0(0x206)](_0x348040['id'],total_tokens),_0x4563bf['answer']=_0x3a32fe?.[_0x5336a0(0x1b8)],_0x4563bf[_0x5336a0(0x2ca)]=total_tokens,_0x4563bf[_0x5336a0(0x2ae)]=prompt_tokens,_0x4563bf[_0x5336a0(0x24f)]=completion_tokens,_0x4563bf[_0x5336a0(0x31d)]=JSON[_0x5336a0(0x23e)]({'conversationId':_0x538464[_0x5336a0(0x1c4)],'model':_0x3a32fe[_0x5336a0(0x25a)],'parentMessageId':_0x538464['id'],'temperature':_0x1e1f57[_0x5336a0(0x1a1)][_0x5336a0(0x2b2)]}),await this[_0x5336a0(0x217)][_0x5336a0(0x247)](_0x4563bf),common_1[_0x5336a0(0x1d1)][_0x5336a0(0x240)]('本次调用:\x20'+_0x172a6e+_0x5336a0(0x22d)+_0x348040[_0x5336a0(0x25a)]+_0x5336a0(0x1dd)+_0x348040[_0x5336a0(0x31b)]+_0x5336a0(0x2b4)+_0x348040['modelName'],_0x5336a0(0x32f));if(!_0x4563bf[_0x5336a0(0x28f)])throw new Error(_0x5336a0(0x260));await this[_0x5336a0(0x217)]['parseAndSaveMusic'](_0x4563bf);}catch(_0x42605e){console[_0x5336a0(0x302)](_0x5336a0(0x2c6),_0x348040[_0x5336a0(0x31b)],_0x42605e);const _0x57f665=await this['openAiErrHandler'](_0x42605e,_0x348040);_0x4563bf[_0x5336a0(0x1d8)]=_0x57f665,await this[_0x5336a0(0x217)][_0x5336a0(0x247)](_0x4563bf),await this[_0x5336a0(0x244)][_0x5336a0(0x270)](_0x172a6e,_0x348040,_0x4563bf['id']);}}async[_0x346eee(0x2ac)](_0x3c0855){const _0x3f28dd=_0x346eee,{data:_0x48de42,answerLogDTO:_0x2001e2,currentRequestModel:_0x30333c}=_0x3c0855;try{let _0x53f910;await this[_0x3f28dd(0x244)][_0x3f28dd(0x17a)](_0x2001e2[_0x3f28dd(0x27d)],_0x30333c,_0x2001e2['id']);_0x48de42[_0x3f28dd(0x2b9)]?_0x53f910=await this['lumaTaskService'][_0x3f28dd(0x1f6)]({'data':_0x48de42,'baseURL':_0x30333c[_0x3f28dd(0x2b0)],'headers':{'Authorization':_0x3f28dd(0x15d)+_0x30333c[_0x3f28dd(0x31b)]}},_0x48de42['thirdId']):_0x53f910=await this[_0x3f28dd(0x23d)]['creat']({'data':_0x48de42,'baseURL':_0x30333c['proxyUrl'],'headers':{'Authorization':_0x3f28dd(0x15d)+_0x30333c[_0x3f28dd(0x31b)]}});await this[_0x3f28dd(0x170)][_0x3f28dd(0x206)](_0x30333c['id'],0x0),_0x2001e2['totalTokens']=0x0,_0x2001e2[_0x3f28dd(0x2ae)]=0x0,_0x2001e2[_0x3f28dd(0x24f)]=0x0,_0x2001e2[_0x3f28dd(0x28f)]=_0x53f910[_0x3f28dd(0x21b)],_0x2001e2[_0x3f28dd(0x31d)]=JSON[_0x3f28dd(0x23e)]({'model':_0x30333c[_0x3f28dd(0x25a)],'parentMessageId':_0x53f910['id']}),await this[_0x3f28dd(0x217)][_0x3f28dd(0x247)](_0x2001e2),common_1[_0x3f28dd(0x1d1)][_0x3f28dd(0x240)](_0x3f28dd(0x2fa)+_0x2001e2[_0x3f28dd(0x27d)]+'\x20model:\x20'+_0x30333c[_0x3f28dd(0x25a)]+_0x3f28dd(0x1dd)+_0x30333c[_0x3f28dd(0x31b)]+_0x3f28dd(0x2b4)+_0x30333c['modelName'],_0x3f28dd(0x32f));if(!_0x2001e2[_0x3f28dd(0x28f)])throw new Error(_0x3f28dd(0x26b));await this[_0x3f28dd(0x217)][_0x3f28dd(0x2c8)](_0x2001e2,_0x53f910);}catch(_0x2eedce){console[_0x3f28dd(0x302)](_0x3f28dd(0x1ec),_0x30333c[_0x3f28dd(0x31b)],_0x2eedce);const _0x518ce9=await this['openAiErrHandler'](_0x2eedce,_0x30333c);_0x2001e2[_0x3f28dd(0x1d8)]=_0x518ce9,await this[_0x3f28dd(0x217)][_0x3f28dd(0x247)](_0x2001e2),await this['userService']['refundBalance4Chat'](_0x2001e2[_0x3f28dd(0x27d)],_0x30333c,_0x2001e2['id']);}}async[_0x346eee(0x1f0)](_0x390d5b){const _0x22486b=_0x346eee;try{const _0x25352a=(0x0,utils_1['getReqSaasId'])(this[_0x22486b(0x32c)]),{req:_0x1b07fd,model:_0xef2084,modelType:_0x534e6c,datas:_0x5f5849}=_0x390d5b,{prompt:_0xe65c6d,options:options={},cusromPrompt:_0x242cab}=_0x5f5849,{groupId:_0x4f3051,usingNetwork:_0x522326,type:_0x40aa96}=options,{appId:_0x397d11,modelConfig:_0x311e67}=await this['getModelConfig']({'modelType':_0x534e6c}),{systemMessage:_0x356b94,netWorkPrompt:_0x173af2}=await this[_0x22486b(0x205)]({'type':_0x40aa96,'appId':_0x397d11,'prompt':_0xe65c6d,'usingNetwork':_0x522326,'custom':_0x242cab,'systemMessage':_0x5f5849['systemMessage'],'customSystemMessage':_0x311e67[_0x22486b(0x1d6)]['systemMessage']}),_0x5c8d0d=await this[_0x22486b(0x170)]['getRandomKey'](_0x534e6c);_0x5c8d0d[_0x22486b(0x25a)]=_0xef2084,_0x311e67[_0x22486b(0x1d6)][_0x22486b(0x25a)]=_0xef2084,await this[_0x22486b(0x24a)]({'prompt':_0xe65c6d,'currentRequestModel':_0x5c8d0d,'user':_0x1b07fd[_0x22486b(0x279)]});const _0xcfa1cb=await this[_0x22486b(0x239)](options[_0x22486b(0x1c0)],_0x356b94,_0x5c8d0d);let {id:_0xd08846,topN:_0x28c58c}=_0x311e67[_0x22486b(0x1d6)];const _0x3e92cd=0x0,_0x7aee38=0x0,_0x5059df=_0x3e92cd+_0x7aee38,_0x52167c=(0x0,utils_1[_0x22486b(0x19d)])(_0x1b07fd),_0x1c9754={'appId':_0x397d11,'curIp':_0x52167c,'prompt':_0xe65c6d,'groupId':_0x4f3051,'modelId':_0xd08846,'modelType':_0x534e6c,'answer':'','model':_0xef2084,'role':'user','userId':_0x1b07fd['user']['id'],'completionTokens':0x0,'totalTokens':_0x5059df,'type':balance_constant_1[_0x22486b(0x263)][_0x22486b(0x2ed)],'logType':_0x40aa96===_0x22486b(0x1f7)?0x2:0x1,'requestOptions':JSON[_0x22486b(0x23e)]({'options':null,'prompt':_0xe65c6d}),'saasId':_0x25352a},_0x3917bc={..._0x1c9754,'role':_0x22486b(0x268),'requestOptions':JSON[_0x22486b(0x23e)]({'prompt':_0xe65c6d,'options':{'model':_0xef2084,'temperature':_0x28c58c}})};await this[_0x22486b(0x217)][_0x22486b(0x247)](_0x1c9754);const _0x1d659e=await this['chatLogService'][_0x22486b(0x247)](_0x3917bc);await this[_0x22486b(0x244)]['deductBalance4Chat'](_0x1b07fd[_0x22486b(0x279)]['id'],_0x5c8d0d,_0x1d659e['id']);if(_0x534e6c===model_constant_1[_0x22486b(0x256)][_0x22486b(0x293)])this[_0x22486b(0x222)]({'userId':_0x1b07fd['user']['id'],'currentRequestModel':_0x5c8d0d,'options':_0xcfa1cb,'answerLogDTO':_0x1d659e,'prompt':_0x522326?_0x173af2:_0xe65c6d});else _0x534e6c===model_constant_1[_0x22486b(0x256)][_0x22486b(0x213)]&&this[_0x22486b(0x2ac)]({'data':_0x5f5849,'currentRequestModel':_0x5c8d0d,'answerLogDTO':_0x1d659e});return _0x1d659e;}catch(_0x50959a){if(_0x50959a instanceof common_1[_0x22486b(0x262)])throw _0x50959a;else throw new common_1[(_0x22486b(0x262))](_0x50959a['message'],common_1[_0x22486b(0x1aa)]['BAD_REQUEST']);}}async[_0x346eee(0x223)](_0x21f76c,_0x36f096){const _0xf2fa99=_0x346eee;let {mv:_0x15e712,tags:_0x6fbce1,title:_0x15c516,prompt:_0x41041f,continue_at:_0x13ceb9,continue_clip_id:_0x46d3cd,make_instrumental:_0x16cd52}=_0x21f76c,_0x17ec8b=_0xf2fa99(0x1e2)+_0x41041f;return _0x15e712&&(_0x17ec8b=_0x17ec8b+_0xf2fa99(0x285)+_0x15e712),_0x6fbce1&&(_0x17ec8b=_0x17ec8b+_0xf2fa99(0x211)+_0x6fbce1),_0x15c516&&(_0x17ec8b=_0x17ec8b+_0xf2fa99(0x258)+_0x15c516),_0x13ceb9&&(_0x17ec8b=_0x17ec8b+',\x20continue_at\x20'+_0x13ceb9),_0x46d3cd&&(_0x17ec8b=_0x17ec8b+_0xf2fa99(0x198)+_0x46d3cd),_0x17ec8b=_0x17ec8b+',\x20make_instrumental\x20'+_0x16cd52,_0x21f76c[_0xf2fa99(0x2f8)]=_0x17ec8b,_0x41041f=_0x17ec8b,this[_0xf2fa99(0x1f0)]({'req':_0x36f096,'datas':_0x21f76c,'model':_0x15e712||_0xf2fa99(0x1af),'modelType':model_constant_1['EModelType'][_0xf2fa99(0x293)]});}async['chatVideo'](_0x4f9f96,_0x448d38){const _0x5e5e3b=_0x346eee;let {model:_0x4cb6a1,prompt:_0x4ccc36,expand_prompt:_0x3a0d52,aspect_ratio:_0x2d943c,image_url:_0x5eceaa,image_end_url:_0x336089}=_0x4f9f96,_0x1a1a07=_0x5e5e3b(0x1e2)+_0x4ccc36+_0x5e5e3b(0x1ed)+_0x3a0d52+_0x5e5e3b(0x2ec)+_0x2d943c;return _0x5eceaa&&(_0x1a1a07=_0x1a1a07+_0x5e5e3b(0x2a4)+_0x5eceaa),_0x336089&&(_0x1a1a07=_0x1a1a07+'\x20image_end_url\x20'+_0x336089),_0x4f9f96[_0x5e5e3b(0x2f8)]=_0x1a1a07,_0x4f9f96[_0x5e5e3b(0x1a9)]=_0x4ccc36,this[_0x5e5e3b(0x1f0)]({'req':_0x448d38,'datas':_0x4f9f96,'model':_0x4cb6a1||_0x5e5e3b(0x2c4),'modelType':model_constant_1[_0x5e5e3b(0x256)][_0x5e5e3b(0x213)]});}async[_0x346eee(0x2d3)](){const _0x5e7ff3=_0x346eee,_0x8d10a5=await this[_0x5e7ff3(0x217)][_0x5e7ff3(0x2fb)]();if(!_0x8d10a5[_0x5e7ff3(0x242)])return;const _0x49d2c4=[],_0x15cb26=new Map();_0x8d10a5[_0x5e7ff3(0x277)](_0x713c17=>{const _0x5e4d5c=_0x5e7ff3;_0x49d2c4[_0x5e4d5c(0x271)](_0x713c17['id']),_0x15cb26[_0x5e4d5c(0x25d)](_0x713c17['id'],_0x713c17);});const _0x4ca89b=await this[_0x5e7ff3(0x217)][_0x5e7ff3(0x1cd)](_0x49d2c4),_0x13c82f=[],_0x381903=new Map();_0x4ca89b[_0x5e7ff3(0x277)](_0x58a77b=>{const _0x320207=_0x5e7ff3;_0x13c82f['push'](_0x58a77b['sunoMusicId']),_0x381903[_0x320207(0x25d)](_0x58a77b[_0x320207(0x2c0)],_0x58a77b);});const _0x21ca9e=await this[_0x5e7ff3(0x170)]['getRandomKey'](model_constant_1['EModelType'][_0x5e7ff3(0x213)]),_0x550750=await this[_0x5e7ff3(0x23d)][_0x5e7ff3(0x26e)]({'baseURL':_0x21ca9e[_0x5e7ff3(0x2b0)],'headers':{'Authorization':'Bearer\x20'+_0x21ca9e[_0x5e7ff3(0x31b)]},'data':{'ids':_0x13c82f}});for(let _0x1072d9=0x0;_0x1072d9<_0x550750[_0x5e7ff3(0x242)];_0x1072d9++){const _0x141196=_0x550750[_0x1072d9],_0x2d10e3=_0x381903[_0x5e7ff3(0x1a5)](_0x141196[_0x5e7ff3(0x18d)]),_0x27a1f6=_0x15cb26[_0x5e7ff3(0x1a5)](_0x2d10e3['chatLogId']);await this[_0x5e7ff3(0x217)]['parseAndSaveVideo'](_0x27a1f6,_0x141196[_0x5e7ff3(0x191)]);}}async[_0x346eee(0x18b)](_0x5be35e){const _0xaa10b1=_0x346eee,{prompt:_0x47c464,userId:_0x1d5902,abortController:_0x11a478}=_0x5be35e,_0x13259d=await this[_0xaa10b1(0x170)][_0xaa10b1(0x24e)](model_constant_1[_0xaa10b1(0x256)]['CHAT']),_0x47ec6e=_0x13259d[_0xaa10b1(0x1d6)],_0x586c83=_0x13259d['modelInfo'][_0xaa10b1(0x286)];if(!_0x47ec6e)throw new common_1[(_0xaa10b1(0x262))](_0xaa10b1(0x17b),common_1[_0xaa10b1(0x1aa)][_0xaa10b1(0x17e)]);const {id:_0x2c5e9c}=_0x47ec6e;let _0x1e8434=null,_0x3c2fd3=null;try{const _0xb168c4=await this[_0xaa10b1(0x239)]('','',_0x47ec6e),_0x526b88=await this[_0xaa10b1(0x1f2)](_0x47ec6e,_0xb168c4);_0x1e8434=await _0x526b88[_0xaa10b1(0x26f)](_0x47c464,{..._0xb168c4,'abortSignal':_0x11a478[_0xaa10b1(0x25e)]});const _0x46e8cb=(0x0,helper_1['unifiedFormattingResponse'])(_0x586c83,_0x1e8434,_0x3c2fd3),{total_tokens:total_tokens=0x0}=_0x46e8cb[_0xaa10b1(0x1fd)];return await this['modelsService'][_0xaa10b1(0x206)](_0x2c5e9c,total_tokens),await this[_0xaa10b1(0x244)]['deductBalance4Chat'](_0x1d5902,_0x47ec6e,-0x1),_0x1e8434['text'];}catch(_0x152650){common_1[_0xaa10b1(0x1d1)]['log'](_0x152650);const _0x4ed226=_0x152650['statusCode'];console['log'](_0x4ed226);if(_0x152650[_0xaa10b1(0x2da)]&&_0x152650[_0xaa10b1(0x2da)]===0x192)throw new common_1[(_0xaa10b1(0x262))](_0x152650[_0xaa10b1(0x305)],common_1[_0xaa10b1(0x1aa)]['PAYMENT_REQUIRED']);if(!_0x4ed226)throw new common_1[(_0xaa10b1(0x262))](_0x152650['message'],common_1[_0xaa10b1(0x1aa)][_0xaa10b1(0x17e)]);let _0x111e39=errorMessage_constant_1['OpenAiErrorCodeMessage'][_0x4ed226]?errorMessage_constant_1['OpenAiErrorCodeMessage'][_0x4ed226]:_0xaa10b1(0x307);_0x152650?.['message'][_0xaa10b1(0x1c8)](_0xaa10b1(0x16f))&&Number(_0x586c83)===0x1&&(await this[_0xaa10b1(0x170)]['lockKey'](_0x2c5e9c,'当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',-0x1),_0x111e39='当前模型key已被封禁');_0x152650?.['statusCode']===0x1ad&&_0x152650[_0xaa10b1(0x305)][_0xaa10b1(0x1c8)](_0xaa10b1(0x180))&&Number(_0x586c83)===0x1&&(await this['modelsService'][_0xaa10b1(0x196)](_0x2c5e9c,_0xaa10b1(0x28b),-0x3),_0x111e39='当前模型key余额已耗尽');_0x152650?.[_0xaa10b1(0x181)]===0x191&&_0x152650[_0xaa10b1(0x305)][_0xaa10b1(0x1c8)]('Incorrect\x20API\x20key\x20provided')&&Number(_0x586c83)===0x1&&(await this[_0xaa10b1(0x170)][_0xaa10b1(0x196)](_0x2c5e9c,_0xaa10b1(0x30c),-0x2),_0x111e39=_0xaa10b1(0x2d2));_0x152650?.['statusCode']===0x191&&_0x152650[_0xaa10b1(0x305)][_0xaa10b1(0x1c8)](_0xaa10b1(0x2e5))&&Number(_0x586c83)===0x1&&(await this[_0xaa10b1(0x170)][_0xaa10b1(0x196)](_0x2c5e9c,_0xaa10b1(0x208),-0x2),_0x111e39='当前模型key余额已耗尽，请充值！');_0x152650?.[_0xaa10b1(0x181)]===0x194&&_0x152650[_0xaa10b1(0x305)][_0xaa10b1(0x1c8)](_0xaa10b1(0x1c6))&&Number(_0x586c83)===0x1&&(await this[_0xaa10b1(0x170)][_0xaa10b1(0x196)](_0x2c5e9c,_0xaa10b1(0x241),-0x4),_0x111e39=_0xaa10b1(0x2b5));_0x152650?.['statusCode']===0x133&&_0x152650[_0xaa10b1(0x305)][_0xaa10b1(0x1c8)](_0xaa10b1(0x324))&&Number(_0x586c83)===0x1&&(console['log'](_0xaa10b1(0x190)),_0x111e39='\x20！');_0x4ed226===0x190&&console[_0xaa10b1(0x302)](_0xaa10b1(0x167),_0x152650,_0x152650[_0xaa10b1(0x305)]);const _0x17356f={'message':_0x111e39||_0xaa10b1(0x269),'code':_0x4ed226===0x191?0x191:_0x4ed226||0x1f4};throw new common_1[(_0xaa10b1(0x262))](_0x17356f[_0xaa10b1(0x305)],common_1[_0xaa10b1(0x1aa)][_0xaa10b1(0x17e)]);}}async['chatRealTime'](_0x4f7c9c,_0x8c5779,_0x4a97a7){const _0x13142d=_0x346eee;try{const {audio:_0xeae083,voice:_0x2fdb23}=_0x4f7c9c,_0x4625b6=_0x8c5779[_0x13142d(0x164)],_0x3fadb1=await this['modelsService'][_0x13142d(0x2f0)]();if(!_0x3fadb1)throw _0x13142d(0x1a2);const {key:_0x86f2d6,proxyUrl:_0x436614}=_0x3fadb1;await this[_0x13142d(0x244)]['checkUserStatus'](_0x8c5779[_0x13142d(0x279)]),await this[_0x13142d(0x244)][_0x13142d(0x30f)](_0x8c5779[_0x13142d(0x279)]['id'],_0x3fadb1),console[_0x13142d(0x302)]('key\x20%s,\x20proxy\x20%s',_0x86f2d6,_0x436614),this[_0x13142d(0x2dc)][_0x13142d(0x2af)]=_0x86f2d6,this[_0x13142d(0x2dc)][_0x13142d(0x1e1)]=(_0x436614||this[_0x13142d(0x1e8)])+_0x13142d(0x215),this[_0x13142d(0x2dc)][_0x13142d(0x252)]=0x989680;const _0x7814df=await this[_0x13142d(0x2dc)][_0x13142d(0x194)][_0x13142d(0x16a)][_0x13142d(0x19f)]({'file':(0x0,fs_1[_0x13142d(0x1fa)])((0x0,path_1[_0x13142d(0x2db)])(_0xeae083[_0x13142d(0x2ff)])),'model':_0x13142d(0x2be),'language':'zh','response_format':_0x13142d(0x27c),'temperature':0x0})[_0x13142d(0x162)](_0x1e815b=>_0x1e815b[_0x13142d(0x1b8)])[_0x13142d(0x318)](_0x5b1967=>{const _0x33572d=_0x13142d;common_1[_0x33572d(0x1d1)][_0x33572d(0x228)](_0x5b1967);});console['log'](_0x13142d(0x177),_0x7814df);if(!_0x7814df){this[_0x13142d(0x2a9)]((0x0,path_1['resolve'])(_0xeae083[_0x13142d(0x2ff)]));throw new common_1[(_0x13142d(0x262))](_0x13142d(0x2e9),common_1[_0x13142d(0x1aa)]['BAD_REQUEST']);}await this[_0x13142d(0x244)][_0x13142d(0x17a)](_0x8c5779[_0x13142d(0x279)]['id'],_0x3fadb1,-0x1);const _0x56575f=await this['requestFromGpt']({'userId':_0x8c5779['user']['id'],'prompt':_0x7814df,'abortController':_0x4625b6});console[_0x13142d(0x302)]('request\x20gpt\x20',_0x56575f);if(!_0x56575f){this[_0x13142d(0x2a9)]((0x0,path_1['resolve'])(_0xeae083[_0x13142d(0x2ff)]));throw new common_1[(_0x13142d(0x262))](_0x13142d(0x323),common_1['HttpStatus']['BAD_REQUEST']);}console[_0x13142d(0x302)](_0x13142d(0x2c3),_0x56575f[_0x13142d(0x242)]);let _0x59306a=_0x56575f[_0x13142d(0x242)]>0x1000?_0x56575f['slice'](0x0,0xfff):_0x56575f;const _0x3cd3c9=await this['openAi'][_0x13142d(0x194)][_0x13142d(0x171)][_0x13142d(0x19f)]({'input':_0x59306a,'model':_0x13142d(0x30d),'response_format':_0x13142d(0x173),'voice':_0x2fdb23,'speed':0x1})['then'](_0x5e4f0c=>_0x5e4f0c[_0x13142d(0x1d2)]())[_0x13142d(0x318)](_0x1ae5fd=>{const _0x5f2faf=_0x13142d;common_1[_0x5f2faf(0x1d1)][_0x5f2faf(0x228)](_0x1ae5fd);});if(!_0x3cd3c9){this['removeFile']((0x0,path_1[_0x13142d(0x2db)])(_0xeae083[_0x13142d(0x2ff)]));throw new common_1[(_0x13142d(0x262))](_0x13142d(0x1fb),common_1[_0x13142d(0x1aa)][_0x13142d(0x17e)]);}await this[_0x13142d(0x244)][_0x13142d(0x17a)](_0x8c5779[_0x13142d(0x279)]['id'],_0x3fadb1,-0x1);const _0x5a80c4=Buffer['from'](_0x3cd3c9);return _0x4a97a7[_0x13142d(0x1ef)](_0x13142d(0x226),'application/octet-stream'),_0x4a97a7[_0x13142d(0x2bf)](_0x5a80c4),_0x4a97a7['end'](_0x5a80c4),this[_0x13142d(0x2a9)]((0x0,path_1[_0x13142d(0x2db)])(_0xeae083[_0x13142d(0x2ff)])),_0x5a80c4;}catch(_0x279dfb){if(_0x279dfb instanceof common_1[_0x13142d(0x262)])throw _0x279dfb;else throw new common_1[(_0x13142d(0x262))](_0x279dfb[_0x13142d(0x305)],common_1[_0x13142d(0x1aa)][_0x13142d(0x17e)]);}}async[_0x346eee(0x1ea)](_0x336a19,_0x15da98){const _0x34741f=_0x346eee;common_1['Logger']['log'](_0x34741f(0x28c)+_0x336a19[_0x34741f(0x2f8)],_0x34741f(0x290)),await this[_0x34741f(0x29b)]['checkBadWords'](_0x336a19[_0x34741f(0x2f8)],_0x15da98[_0x34741f(0x279)]['id']),await this['userService'][_0x34741f(0x1ba)](_0x15da98[_0x34741f(0x279)]);let _0x42dea5=[];const _0x3e46c0=await this[_0x34741f(0x170)][_0x34741f(0x18c)](model_constant_1[_0x34741f(0x256)][_0x34741f(0x188)]);await this[_0x34741f(0x244)][_0x34741f(0x30f)](_0x15da98[_0x34741f(0x279)]['id'],_0x3e46c0);const {key:_0x1226e8,model:_0x3e0f10,proxyUrl:_0xd3c89e}=await this[_0x34741f(0x264)](_0x3e46c0),_0x5a5a2f=_0xd3c89e+_0x34741f(0x236);try{const _0x108313=await axios_1['default']['post'](_0x5a5a2f,{..._0x336a19,'model':_0x3e0f10,'response_format':_0x34741f(0x1fc)},{'headers':{'Authorization':'Bearer\x20'+_0x1226e8}});_0x42dea5=_0x108313[_0x34741f(0x191)][_0x34741f(0x191)];}catch(_0x29a759){console[_0x34741f(0x302)](_0x34741f(0x266),_0x29a759);const _0x215347=_0x29a759?.[_0x34741f(0x219)]?.[_0x34741f(0x2da)]||0x1f4,_0x3fecf7=_0x29a759?.[_0x34741f(0x219)]?.[_0x34741f(0x191)]?.[_0x34741f(0x228)]?.[_0x34741f(0x305)];if(_0x215347===0x1ad)throw new common_1[(_0x34741f(0x262))]('当前请求已过载、请稍等会儿再试试吧！',common_1[_0x34741f(0x1aa)][_0x34741f(0x17e)]);if(_0x215347===0x190||_0x3fecf7['includes']('Your\x20request\x20was\x20rejected\x20as\x20a\x20result\x20of\x20our\x20safety\x20system'))throw new common_1[(_0x34741f(0x262))]('您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',common_1[_0x34741f(0x1aa)][_0x34741f(0x17e)]);if(_0x215347===0x1f4)throw new common_1[(_0x34741f(0x262))]('绘制图片失败，请检查你的提示词是否有非法描述！',common_1['HttpStatus'][_0x34741f(0x17e)]);if(_0x215347===0x191)throw new common_1['HttpException'](_0x34741f(0x248),common_1['HttpStatus'][_0x34741f(0x17e)]);throw new common_1['HttpException'](_0x34741f(0x26c),common_1[_0x34741f(0x1aa)][_0x34741f(0x17e)]);}const _0x305f07=[];for(const _0x254d84 of _0x42dea5){const _0x461d73=_0x254d84[_0x34741f(0x1fc)]['replace'](/^data:image\/\w+;base64,/,''),_0x546760=uuid['v4']()[_0x34741f(0x200)](0x0,0xa)+_0x34741f(0x186),_0x4dd653=Buffer['from'](_0x461d73,_0x34741f(0x291));_0x305f07['push'](this[_0x34741f(0x2d9)][_0x34741f(0x2d5)]({'filename':_0x546760,'buffer':_0x4dd653}));}const _0x855ac5=(0x0,utils_1[_0x34741f(0x19d)])(_0x15da98),_0x24e434=await Promise['all'](_0x305f07),[_0x57885d,_0x4bd26a]=_0x336a19[_0x34741f(0x2e6)][_0x34741f(0x1b0)]('x'),_0x8cd407=_0x24e434[_0x34741f(0x2f3)](_0x17cc57=>{const _0x3e2c1f=_0x34741f;return this[_0x3e2c1f(0x217)][_0x3e2c1f(0x247)]({'curIp':_0x855ac5,'logType':0x3,'answer':_0x17cc57,'totalTokens':0x0,'promptTokens':0x0,'model':_0x3e2c1f(0x261),'userId':_0x15da98[_0x3e2c1f(0x279)]['id'],'prompt':_0x336a19['prompt'],'completionTokens':0x0,'modelType':model_constant_1[_0x3e2c1f(0x256)]['DRAW'],'type':balance_constant_1[_0x3e2c1f(0x263)]['PAINT_TYPE'],'fileInfo':JSON['stringify']({'width':_0x57885d,'height':_0x4bd26a,'cosUrl':_0x17cc57})});}),_0x3fe6c9=await Promise[_0x34741f(0x27b)](_0x8cd407);return await this[_0x34741f(0x244)][_0x34741f(0x17a)](_0x15da98[_0x34741f(0x279)]['id'],_0x3e46c0,_0x3fe6c9[0x0]['id']),_0x24e434;}async[_0x346eee(0x264)](_0xcde18b){const _0x4ba723=_0x346eee,{openaiModel3MaxTokens:openaiModel3MaxTokens=0x0,openaiModel3MaxTokensRes:openaiModel3MaxTokensRes=0x0,openaiModel3MaxTokens16k:openaiModel3MaxTokens16k=0x0,openaiModel3MaxTokens16kRes:openaiModel3MaxTokens16kRes=0x0,openaiModel4MaxTokens:openaiModel4MaxTokens=0x0,openaiModel4MaxTokensRes:openaiModel4MaxTokensRes=0x0,openaiModel4MaxTokens32k:openaiModel4MaxTokens32k=0x0,openaiModel4MaxTokens32kRes:openaiModel4MaxTokens32kRes=0x0,openaiBaseUrl:openaiBaseUrl=''}=await this[_0x4ba723(0x2b3)][_0x4ba723(0x1ce)]([_0x4ba723(0x2eb),_0x4ba723(0x316),_0x4ba723(0x18f),_0x4ba723(0x315),_0x4ba723(0x296),_0x4ba723(0x233),_0x4ba723(0x251),_0x4ba723(0x1a4),'openaiBaseUrl']);let _0x8998c4=null,_0x1641de=null,_0x382c9d=null;const {model:_0x1a6a34,maxModelTokens:maxModelTokens=0x0,maxResponseTokens:maxResponseTokens=0x0,proxyUrl:_0x59989d,key:_0x1917f9}=_0xcde18b;return _0x1a6a34[_0x4ba723(0x1d3)]()[_0x4ba723(0x1c8)](_0x4ba723(0x17d))&&(_0x1a6a34[_0x4ba723(0x1d3)]()[_0x4ba723(0x1c8)](_0x4ba723(0x304))?(_0x8998c4=maxModelTokens||openaiModel4MaxTokens32k||0x8000,_0x1641de=maxResponseTokens||openaiModel4MaxTokens32kRes||0x4000):(_0x8998c4=maxModelTokens||openaiModel4MaxTokens||0x2000,_0x1641de=maxResponseTokens||openaiModel4MaxTokensRes||0x1000)),_0x1a6a34[_0x4ba723(0x1d3)]()[_0x4ba723(0x1c8)]('gpt-3')&&(_0x1a6a34[_0x4ba723(0x1d3)]()['includes'](_0x4ba723(0x20b))?(_0x8998c4=maxModelTokens||openaiModel3MaxTokens16k||0x4000,_0x1641de=maxResponseTokens||openaiModel3MaxTokens16kRes||0x2000):(_0x8998c4=maxModelTokens||openaiModel3MaxTokens||0x1000,_0x1641de=maxResponseTokens||openaiModel3MaxTokensRes||0x3e8)),_0x382c9d=_0x59989d||openaiBaseUrl||_0x4ba723(0x2e1),_0x1641de>=_0x8998c4&&(_0x1641de=Math[_0x4ba723(0x176)](_0x8998c4/0x2),common_1[_0x4ba723(0x1d1)]['debug'](_0x4ba723(0x1e9)+_0x1917f9+_0x4ba723(0x2e2)+_0x1641de)),{'key':_0x1917f9,'model':_0x1a6a34,'maxToken':_0x8998c4,'maxTokenRes':_0x1641de,'proxyUrl':_0x382c9d};}async[_0x346eee(0x2b1)](_0x280c31){const _0x23290c=_0x346eee;try{const _0x254efa=await this['pptService'][_0x23290c(0x1db)](_0x280c31),_0x3f9edb=await this['pptTaskEntity']['findOne']({'where':{'yooTaskId':_0x280c31[_0x23290c(0x2cd)]['id']}});if(!_0x3f9edb)throw new Error('PPT\x20任务不存在！');_0x3f9edb[_0x23290c(0x2da)]=_0x254efa['data'][_0x23290c(0x2da)],_0x3f9edb[_0x23290c(0x178)]=_0x254efa[_0x23290c(0x191)]['state_description'],_0x3f9edb[_0x23290c(0x2d6)]=_0x254efa[_0x23290c(0x191)][_0x23290c(0x2d6)],_0x3f9edb[_0x23290c(0x2f6)]=_0x254efa['data'][_0x23290c(0x311)],_0x3f9edb[_0x23290c(0x1e0)]=_0x254efa['data'][_0x23290c(0x2cb)],_0x3f9edb[_0x23290c(0x19a)]=_0x254efa[_0x23290c(0x191)][_0x23290c(0x1da)],_0x3f9edb['images']=_0x254efa[_0x23290c(0x191)]['images_url'],_0x3f9edb['startTime']=_0x254efa[_0x23290c(0x191)][_0x23290c(0x2d7)],_0x3f9edb[_0x23290c(0x1f8)]=_0x254efa[_0x23290c(0x191)][_0x23290c(0x1c3)],await this[_0x23290c(0x250)][_0x23290c(0x19e)](_0x3f9edb),_0x254efa[_0x23290c(0x191)]['status']===0x1&&setTimeout(()=>this[_0x23290c(0x2b1)](_0x280c31),0xbb8);}catch(_0x5ebc63){common_1[_0x23290c(0x1d1)][_0x23290c(0x228)](_0x5ebc63['message'],_0x23290c(0x21c));}}async[_0x346eee(0x15b)](_0x31601b,_0x4b5f6d){const _0x5a9678=_0x346eee;try{return this[_0x5a9678(0x283)][_0x5a9678(0x310)](async()=>{const _0x3c48d4=_0x5a9678,_0x4b2cb9=await this['modelsService']['getModelByType'](model_constant_1['EModelType']['PPT']);let _0x4cd37d={'userId':_0x31601b[_0x3c48d4(0x279)]['id'],'type':ppt_constant_1[_0x3c48d4(0x1b9)][_0x3c48d4(0x237)],'title':_0x4b5f6d[_0x3c48d4(0x24c)],'text':_0x4b5f6d[_0x3c48d4(0x1b8)],'theme':_0x4b5f6d[_0x3c48d4(0x16b)]};_0x4cd37d=await this[_0x3c48d4(0x250)][_0x3c48d4(0x19e)](_0x4cd37d),await this[_0x3c48d4(0x244)]['debuctBalance4PPT'](_0x31601b[_0x3c48d4(0x279)]['id'],_0x4cd37d['id'],_0x4cd37d[_0x3c48d4(0x23a)]);const _0x32461d=await this[_0x3c48d4(0x1d7)][_0x3c48d4(0x15b)]({'data':_0x4b5f6d,'baseURL':_0x4b2cb9[_0x3c48d4(0x1d6)][_0x3c48d4(0x2b0)],'headers':{'AccessToken':_0x4b2cb9[_0x3c48d4(0x1d6)][_0x3c48d4(0x2a7)],'AccessSecret':_0x4b2cb9[_0x3c48d4(0x1d6)][_0x3c48d4(0x32b)]}});return _0x4cd37d[_0x3c48d4(0x24c)]=_0x32461d['data']['title'],_0x4cd37d['catalogs']=_0x32461d['data'][_0x3c48d4(0x19c)],await this['pptTaskEntity']['save'](_0x4cd37d),_0x4cd37d;});}catch(_0x4c7a0c){throw new common_1[(_0x5a9678(0x262))](_0x4c7a0c[_0x5a9678(0x305)],common_1[_0x5a9678(0x1aa)][_0x5a9678(0x17e)]);}}[_0x346eee(0x23f)](_0x29ef5f,_0x33116a){const _0x318a96=_0x346eee;try{return this[_0x318a96(0x283)][_0x318a96(0x310)](async()=>{const _0x409195=_0x318a96,_0x126b09=await this[_0x409195(0x170)][_0x409195(0x24e)](model_constant_1['EModelType'][_0x409195(0x2ad)]);let _0x622a56={'userId':_0x29ef5f['user']['id'],'type':ppt_constant_1[_0x409195(0x1b9)][_0x409195(0x2f5)],'title':_0x33116a[_0x409195(0x24c)],'text':_0x33116a['text'],'author':_0x33116a[_0x409195(0x313)],'color':_0x33116a[_0x409195(0x272)],'style':_0x33116a['style']};_0x622a56=await this[_0x409195(0x250)]['save'](_0x622a56),await this[_0x409195(0x244)]['debuctBalance4PPT'](_0x29ef5f[_0x409195(0x279)]['id'],_0x622a56['id'],_0x622a56['type']);const _0x342877=await this['pptService']['pptCover']({'data':{'title':_0x33116a[_0x409195(0x24c)],'count':_0x33116a['text'],'user_name':_0x33116a[_0x409195(0x313)],'color':_0x33116a[_0x409195(0x272)],'style':_0x33116a[_0x409195(0x15e)]},'baseURL':_0x126b09[_0x409195(0x1d6)][_0x409195(0x2b0)],'headers':{'AccessToken':_0x126b09[_0x409195(0x1d6)][_0x409195(0x2a7)],'AccessSecret':_0x126b09[_0x409195(0x1d6)][_0x409195(0x32b)]}});return _0x622a56['resCover']=_0x342877[_0x409195(0x191)],await this[_0x409195(0x250)][_0x409195(0x19e)](_0x622a56),_0x622a56;});}catch(_0x1ba120){throw new common_1[(_0x318a96(0x262))](_0x1ba120['message'],common_1[_0x318a96(0x1aa)][_0x318a96(0x17e)]);}}[_0x346eee(0x227)](_0xe086e0,_0x221591){const _0x4dda59=_0x346eee;try{return this[_0x4dda59(0x283)]['transaction'](async()=>{const _0xb1b18f=_0x4dda59,_0x411f88=await this['modelsService']['getModelByType'](model_constant_1[_0xb1b18f(0x256)][_0xb1b18f(0x2ad)]);let _0x5de844={'userId':_0xe086e0[_0xb1b18f(0x279)]['id'],'type':ppt_constant_1[_0xb1b18f(0x1b9)]['RECOVER'],'title':_0x221591[_0xb1b18f(0x24c)],'text':_0x221591[_0xb1b18f(0x1b8)],'author':_0x221591[_0xb1b18f(0x313)],'coverId':_0x221591[_0xb1b18f(0x297)]};_0x5de844=await this['pptTaskEntity'][_0xb1b18f(0x19e)](_0x5de844),await this[_0xb1b18f(0x244)][_0xb1b18f(0x2e4)](_0xe086e0['user']['id'],_0x5de844['id'],_0x5de844[_0xb1b18f(0x23a)]);const _0x255d58=await this[_0xb1b18f(0x1d7)]['pptReCover']({'data':{'title':_0x221591[_0xb1b18f(0x24c)],'count':_0x221591[_0xb1b18f(0x1b8)],'user_name':_0x221591['author'],'cover_id':_0x221591[_0xb1b18f(0x297)]},'baseURL':_0x411f88[_0xb1b18f(0x1d6)]['proxyUrl'],'headers':{'AccessToken':_0x411f88[_0xb1b18f(0x1d6)][_0xb1b18f(0x2a7)],'AccessSecret':_0x411f88[_0xb1b18f(0x1d6)][_0xb1b18f(0x32b)]}});return _0x5de844[_0xb1b18f(0x204)]=_0x255d58[_0xb1b18f(0x191)],await this[_0xb1b18f(0x250)][_0xb1b18f(0x19e)](_0x5de844),_0x5de844;});}catch(_0x3bcf1f){throw new common_1[(_0x4dda59(0x262))](_0x3bcf1f['message'],common_1[_0x4dda59(0x1aa)][_0x4dda59(0x17e)]);}}[_0x346eee(0x1c1)](_0x318c05,_0x5073e5){const _0x94606d=_0x346eee;try{return this[_0x94606d(0x283)][_0x94606d(0x310)](async()=>{const _0x2ace3e=_0x94606d;let _0x1979bc;const _0x38c3c7=await this[_0x2ace3e(0x170)][_0x2ace3e(0x24e)](model_constant_1['EModelType'][_0x2ace3e(0x2ad)]);if(_0x5073e5['originTaskId']){_0x1979bc=await this[_0x2ace3e(0x250)]['findOne']({'where':{'id':_0x5073e5[_0x2ace3e(0x331)]}});if(!_0x1979bc)throw new Error(_0x2ace3e(0x2d4));}let _0x46ecab={'userId':_0x318c05[_0x2ace3e(0x279)]['id'],'type':ppt_constant_1[_0x2ace3e(0x1b9)][_0x2ace3e(0x292)],'title':_0x5073e5['title'],'subTitle':_0x5073e5[_0x2ace3e(0x21a)],'text':_0x5073e5[_0x2ace3e(0x1b8)],'catalogs':_0x5073e5[_0x2ace3e(0x19c)],'contents':_0x5073e5[_0x2ace3e(0x2e0)],'author':_0x5073e5[_0x2ace3e(0x313)],'fontName':_0x5073e5[_0x2ace3e(0x1d0)],'transition':_0x5073e5[_0x2ace3e(0x183)],'complex':_0x5073e5[_0x2ace3e(0x1d5)],'coverId':_0x5073e5[_0x2ace3e(0x297)],'originId':_0x5073e5['originTaskId']};_0x46ecab=await this[_0x2ace3e(0x250)]['save'](_0x46ecab),await this['userService'][_0x2ace3e(0x2e4)](_0x318c05[_0x2ace3e(0x279)]['id'],_0x46ecab['id'],_0x46ecab[_0x2ace3e(0x23a)]);const _0x12b9a0=await this['pptService'][_0x2ace3e(0x1c1)]({'data':{'text':_0x5073e5[_0x2ace3e(0x1b8)],'custom_data':{'title':_0x5073e5[_0x2ace3e(0x24c)],'sub_title':_0x5073e5['subTitle'],'author':_0x5073e5[_0x2ace3e(0x313)],'catalogs':_0x5073e5[_0x2ace3e(0x19c)],'contents':_0x5073e5[_0x2ace3e(0x2e0)]},'cover_id':_0x5073e5[_0x2ace3e(0x297)],'font_name':_0x5073e5[_0x2ace3e(0x1d0)],'transition':_0x5073e5[_0x2ace3e(0x183)],'complex':_0x5073e5[_0x2ace3e(0x1d5)],'user_name':_0x5073e5[_0x2ace3e(0x313)],'id':_0x1979bc[_0x2ace3e(0x20e)]},'baseURL':_0x38c3c7[_0x2ace3e(0x1d6)][_0x2ace3e(0x2b0)],'headers':{'AccessToken':_0x38c3c7['modelInfo'][_0x2ace3e(0x2a7)],'AccessSecret':_0x38c3c7[_0x2ace3e(0x1d6)][_0x2ace3e(0x32b)]}});return _0x46ecab[_0x2ace3e(0x20e)]=_0x12b9a0[_0x2ace3e(0x191)]['id'],await this[_0x2ace3e(0x250)][_0x2ace3e(0x19e)](_0x46ecab),setTimeout(()=>this[_0x2ace3e(0x2b1)]({'baseURL':_0x38c3c7[_0x2ace3e(0x1d6)][_0x2ace3e(0x2b0)],'headers':{'AccessToken':_0x38c3c7['modelInfo'][_0x2ace3e(0x2a7)],'AccessSecret':_0x38c3c7[_0x2ace3e(0x1d6)][_0x2ace3e(0x32b)]},'params':{'id':_0x46ecab[_0x2ace3e(0x20e)]}}),0xbb8),_0x46ecab;});}catch(_0x4dfc6a){throw new common_1[(_0x94606d(0x262))](_0x4dfc6a[_0x94606d(0x305)],common_1['HttpStatus'][_0x94606d(0x17e)]);}}[_0x346eee(0x31e)](_0x3d22f3,_0x209add){const _0x34af7a=_0x346eee;try{return this[_0x34af7a(0x283)][_0x34af7a(0x310)](async()=>{const _0x7af327=_0x34af7a,_0x1ff23c=await this['modelsService'][_0x7af327(0x24e)](model_constant_1[_0x7af327(0x256)]['PPT']);let _0x2c8489={'userId':_0x3d22f3[_0x7af327(0x279)]['id'],'type':ppt_constant_1['EPPTTaskType'][_0x7af327(0x280)],'title':_0x209add['title'],'color':_0x209add[_0x7af327(0x272)],'style':_0x209add[_0x7af327(0x15e)],'fileUrl':_0x209add[_0x7af327(0x1b7)],'pleader':_0x209add[_0x7af327(0x18a)],'advisor':_0x209add[_0x7af327(0x320)],'school':_0x209add[_0x7af327(0x174)],'schoolLogo':_0x209add[_0x7af327(0x245)],'schoolPicture':_0x209add[_0x7af327(0x197)]};_0x2c8489=await this['pptTaskEntity']['save'](_0x2c8489),await this[_0x7af327(0x244)][_0x7af327(0x2e4)](_0x3d22f3[_0x7af327(0x279)]['id'],_0x2c8489['id'],_0x2c8489[_0x7af327(0x23a)]);const _0x4e8602=await this['pptService']['pptCreateThesis']({'data':{'file_key':_0x209add[_0x7af327(0x1b7)],'title':_0x209add[_0x7af327(0x24c)],'color':_0x209add[_0x7af327(0x272)],'style':_0x209add[_0x7af327(0x15e)],'pleader':_0x209add[_0x7af327(0x18a)],'advisor':_0x209add[_0x7af327(0x320)],'school':_0x209add[_0x7af327(0x174)],'school_logo':_0x209add[_0x7af327(0x245)],'school_picture':_0x209add[_0x7af327(0x197)]},'baseURL':_0x1ff23c[_0x7af327(0x1d6)]['proxyUrl'],'headers':{'AccessToken':_0x1ff23c[_0x7af327(0x1d6)][_0x7af327(0x2a7)],'AccessSecret':_0x1ff23c[_0x7af327(0x1d6)][_0x7af327(0x32b)]}});return _0x2c8489[_0x7af327(0x20e)]=_0x4e8602[_0x7af327(0x191)]['id'],await this[_0x7af327(0x250)][_0x7af327(0x19e)](_0x2c8489),setTimeout(()=>this[_0x7af327(0x2b1)]({'baseURL':_0x1ff23c[_0x7af327(0x1d6)][_0x7af327(0x2b0)],'headers':{'AccessToken':_0x1ff23c[_0x7af327(0x1d6)][_0x7af327(0x2a7)],'AccessSecret':_0x1ff23c[_0x7af327(0x1d6)][_0x7af327(0x32b)]},'params':{'id':_0x2c8489[_0x7af327(0x20e)]}}),0xbb8),_0x2c8489;});}catch(_0xb5a676){throw new common_1[(_0x34af7a(0x262))](_0xb5a676[_0x34af7a(0x305)],common_1[_0x34af7a(0x1aa)]['BAD_REQUEST']);}}[_0x346eee(0x2b7)](_0x3a6104,_0x1da52d){const _0x404c3d=_0x346eee;try{return this[_0x404c3d(0x283)][_0x404c3d(0x310)](async()=>{const _0x1e8dcd=_0x404c3d,_0x1a3cc7=await this[_0x1e8dcd(0x170)][_0x1e8dcd(0x24e)](model_constant_1['EModelType'][_0x1e8dcd(0x2ad)]);let _0x345dba={'userId':_0x3a6104['user']['id'],'type':ppt_constant_1[_0x1e8dcd(0x1b9)][_0x1e8dcd(0x16d)],'fileUrl':_0x1da52d['fileUrl'],'coverId':_0x1da52d['coverId'],'author':_0x1da52d[_0x1e8dcd(0x313)]};_0x345dba=await this[_0x1e8dcd(0x250)]['save'](_0x345dba),await this[_0x1e8dcd(0x244)][_0x1e8dcd(0x2e4)](_0x3a6104[_0x1e8dcd(0x279)]['id'],_0x345dba['id'],_0x345dba['type']);const _0x41fdcc=await this[_0x1e8dcd(0x1d7)][_0x1e8dcd(0x2b7)]({'data':{'file_url':_0x1da52d['fileUrl'],'cover_id':_0x1da52d[_0x1e8dcd(0x297)],'user_name':_0x1da52d[_0x1e8dcd(0x313)]},'baseURL':_0x1a3cc7['modelInfo'][_0x1e8dcd(0x2b0)],'headers':{'AccessToken':_0x1a3cc7['modelInfo'][_0x1e8dcd(0x2a7)],'AccessSecret':_0x1a3cc7['modelInfo']['secret']}});return _0x345dba[_0x1e8dcd(0x20e)]=_0x41fdcc[_0x1e8dcd(0x191)]['id'],await this[_0x1e8dcd(0x250)][_0x1e8dcd(0x19e)](_0x345dba),setTimeout(()=>this[_0x1e8dcd(0x2b1)]({'baseURL':_0x1a3cc7[_0x1e8dcd(0x1d6)]['proxyUrl'],'headers':{'AccessToken':_0x1a3cc7[_0x1e8dcd(0x1d6)][_0x1e8dcd(0x2a7)],'AccessSecret':_0x1a3cc7[_0x1e8dcd(0x1d6)][_0x1e8dcd(0x32b)]},'params':{'id':_0x345dba[_0x1e8dcd(0x20e)]}}),0xbb8),_0x345dba;});}catch(_0x3bb1f0){throw new common_1['HttpException'](_0x3bb1f0[_0x404c3d(0x305)],common_1[_0x404c3d(0x1aa)]['BAD_REQUEST']);}}['pptDetail'](_0x5777d8){const _0x2947fe=_0x346eee;return this[_0x2947fe(0x250)][_0x2947fe(0x329)]({'where':{'id':_0x5777d8}});}[_0x346eee(0x29f)](_0xd99700,_0x58066f){const _0x2e879d=_0x346eee;try{return this[_0x2e879d(0x283)][_0x2e879d(0x310)](async()=>{const _0x42883a=_0x2e879d,_0x3a0ebd=await this[_0x42883a(0x250)][_0x42883a(0x329)]({'where':{'id':_0x58066f[_0x42883a(0x331)]}});if(!_0x3a0ebd)throw new Error('原始任务不存在！');const _0x51e226=await this[_0x42883a(0x170)][_0x42883a(0x24e)](model_constant_1[_0x42883a(0x256)][_0x42883a(0x2ad)]);let _0x26da11={'userId':_0xd99700[_0x42883a(0x279)]['id'],'type':ppt_constant_1[_0x42883a(0x1b9)]['THEME'],'originId':_0x58066f[_0x42883a(0x331)],'coverId':_0x58066f[_0x42883a(0x297)],'fontName':_0x58066f['fontName'],'transition':_0x58066f[_0x42883a(0x183)]};_0x26da11=await this['pptTaskEntity']['save'](_0x26da11),await this[_0x42883a(0x244)]['debuctBalance4PPT'](_0xd99700[_0x42883a(0x279)]['id'],_0x26da11['id'],_0x26da11[_0x42883a(0x23a)]);const _0x3c7230=await this[_0x42883a(0x1d7)]['pptChangeTheme']({'data':{'id':_0x3a0ebd['yooTaskId'],'cover_id':_0x58066f['coverId'],'font_name':_0x58066f[_0x42883a(0x1d0)],'transition':_0x58066f['transition']},'baseURL':_0x51e226['modelInfo']['proxyUrl'],'headers':{'AccessToken':_0x51e226[_0x42883a(0x1d6)][_0x42883a(0x2a7)],'AccessSecret':_0x51e226[_0x42883a(0x1d6)][_0x42883a(0x32b)]}});return _0x26da11[_0x42883a(0x20e)]=_0x3c7230[_0x42883a(0x191)]['id'],await this['pptTaskEntity'][_0x42883a(0x19e)](_0x26da11),setTimeout(()=>this[_0x42883a(0x2b1)]({'baseURL':_0x51e226[_0x42883a(0x1d6)]['proxyUrl'],'headers':{'AccessToken':_0x51e226['modelInfo']['accessToken'],'AccessSecret':_0x51e226['modelInfo'][_0x42883a(0x32b)]},'params':{'id':_0x26da11[_0x42883a(0x20e)]}}),0xbb8),_0x26da11;});}catch(_0x540927){throw new common_1[(_0x2e879d(0x262))](_0x540927['message'],common_1[_0x2e879d(0x1aa)][_0x2e879d(0x17e)]);}}[_0x346eee(0x26a)](_0x41f45e,_0x3ef455){const _0x318aac=_0x346eee;try{return this['connection'][_0x318aac(0x310)](async()=>{const _0x5c2345=_0x318aac,_0x263eaf=await this[_0x5c2345(0x250)][_0x5c2345(0x329)]({'where':{'id':_0x3ef455[_0x5c2345(0x331)]}});if(!_0x263eaf)throw new Error(_0x5c2345(0x2d4));const _0x2e8f1f=await this['modelsService'][_0x5c2345(0x24e)](model_constant_1[_0x5c2345(0x256)]['PPT']);let _0x506ab0={'userId':_0x41f45e[_0x5c2345(0x279)]['id'],'type':ppt_constant_1[_0x5c2345(0x1b9)]['ADDPAGE'],'originId':_0x3ef455['originTaskId'],'theme':_0x3ef455['theme'],'text':_0x3ef455['text'],'complex':_0x3ef455['complex']?String(_0x3ef455['complex']):'1','author':_0x3ef455['author'],'fontName':_0x3ef455[_0x5c2345(0x1d0)],'transition':_0x3ef455[_0x5c2345(0x183)],'slideNumber':_0x3ef455['slideNumber'],'slideType':_0x3ef455[_0x5c2345(0x1bb)]};_0x506ab0=await this[_0x5c2345(0x250)][_0x5c2345(0x19e)](_0x506ab0),await this['userService'][_0x5c2345(0x2e4)](_0x41f45e[_0x5c2345(0x279)]['id'],_0x506ab0['id'],_0x506ab0['type']);const _0x34a2f5=await this['pptService']['pptAddPage']({'data':{'id':_0x263eaf[_0x5c2345(0x20e)],'text':_0x3ef455[_0x5c2345(0x1b8)],'complex':_0x3ef455['complex'],'user_name':_0x3ef455[_0x5c2345(0x313)],'font_name':_0x3ef455[_0x5c2345(0x1d0)],'transition':_0x3ef455[_0x5c2345(0x183)],'slide_number':_0x3ef455[_0x5c2345(0x210)],'slide_type':_0x3ef455[_0x5c2345(0x1bb)],'theme':_0x3ef455[_0x5c2345(0x16b)]},'baseURL':_0x2e8f1f['modelInfo'][_0x5c2345(0x2b0)],'headers':{'AccessToken':_0x2e8f1f['modelInfo']['accessToken'],'AccessSecret':_0x2e8f1f[_0x5c2345(0x1d6)]['secret']}});return _0x506ab0['yooTaskId']=_0x34a2f5[_0x5c2345(0x191)]['id'],await this[_0x5c2345(0x250)][_0x5c2345(0x19e)](_0x506ab0),setTimeout(()=>this[_0x5c2345(0x2b1)]({'baseURL':_0x2e8f1f[_0x5c2345(0x1d6)][_0x5c2345(0x2b0)],'headers':{'AccessToken':_0x2e8f1f[_0x5c2345(0x1d6)][_0x5c2345(0x2a7)],'AccessSecret':_0x2e8f1f[_0x5c2345(0x1d6)]['secret']},'params':{'id':_0x506ab0[_0x5c2345(0x20e)]}}),0xbb8),_0x506ab0;});}catch(_0x532a7a){throw new common_1[(_0x318aac(0x262))](_0x532a7a[_0x318aac(0x305)],common_1[_0x318aac(0x1aa)]['BAD_REQUEST']);}}[_0x346eee(0x2ba)](_0x5b33c0,_0x38b3f1){const _0x208c0c=_0x346eee;try{return this['connection'][_0x208c0c(0x310)](async()=>{const _0x2feeb3=_0x208c0c,_0x5ee4a8=await this['pptTaskEntity'][_0x2feeb3(0x329)]({'where':{'id':_0x38b3f1[_0x2feeb3(0x331)]}});if(!_0x5ee4a8)throw new Error(_0x2feeb3(0x2d4));const _0x4615d1=await this[_0x2feeb3(0x170)][_0x2feeb3(0x24e)](model_constant_1['EModelType'][_0x2feeb3(0x2ad)]);let _0x4016a6={'userId':_0x5b33c0[_0x2feeb3(0x279)]['id'],'type':ppt_constant_1[_0x2feeb3(0x1b9)][_0x2feeb3(0x2ea)],'originId':_0x38b3f1[_0x2feeb3(0x331)],'notes':_0x38b3f1};_0x4016a6=await this[_0x2feeb3(0x250)][_0x2feeb3(0x19e)](_0x4016a6),await this[_0x2feeb3(0x244)][_0x2feeb3(0x2e4)](_0x5b33c0[_0x2feeb3(0x279)]['id'],_0x4016a6['id'],_0x4016a6['type']);const _0x27d964=await this[_0x2feeb3(0x1d7)][_0x2feeb3(0x27f)]({'data':{..._0x38b3f1,'id':_0x5ee4a8['yooTaskId']},'baseURL':_0x4615d1[_0x2feeb3(0x1d6)][_0x2feeb3(0x2b0)],'headers':{'AccessToken':_0x4615d1[_0x2feeb3(0x1d6)][_0x2feeb3(0x2a7)],'AccessSecret':_0x4615d1[_0x2feeb3(0x1d6)]['secret']}});return _0x4016a6[_0x2feeb3(0x20e)]=_0x27d964['data']['id'],await this['pptTaskEntity']['save'](_0x4016a6),setTimeout(()=>this[_0x2feeb3(0x2b1)]({'baseURL':_0x4615d1[_0x2feeb3(0x1d6)][_0x2feeb3(0x2b0)],'headers':{'AccessToken':_0x4615d1['modelInfo']['accessToken'],'AccessSecret':_0x4615d1[_0x2feeb3(0x1d6)][_0x2feeb3(0x32b)]},'params':{'id':_0x4016a6[_0x2feeb3(0x20e)]}}),0xbb8),_0x4016a6;});}catch(_0xe576c6){throw new common_1[(_0x208c0c(0x262))](_0xe576c6[_0x208c0c(0x305)],common_1['HttpStatus']['BAD_REQUEST']);}}async['pptPage'](_0x3eb618,_0x1147a4){const _0x1a9c96=_0x346eee,_0xfaaeb4=_0x1147a4[_0x1a9c96(0x279)]['id'],{page:page=0x1,size:size=0x14,keyword:_0x53276b,userKeyword:_0x58d923}=_0x3eb618,_0x1f0524=_0x1a9c96(0x24b)+(_0x53276b?_0x1a9c96(0x201)+_0x53276b+_0x1a9c96(0x321)+_0x53276b+_0x1a9c96(0x306):'')+_0x1a9c96(0x330)+(_0x58d923?_0x1a9c96(0x2c2)+_0x58d923+_0x1a9c96(0x1a3)+_0x58d923+_0x1a9c96(0x312)+_0x58d923+_0x1a9c96(0x1cc)+_0x58d923+_0x1a9c96(0x20d):'')+_0x1a9c96(0x330)+(_0xfaaeb4?_0x1a9c96(0x254)+_0xfaaeb4:'')+_0x1a9c96(0x1ab),_0x5e27a4=await this[_0x1a9c96(0x283)]['query'](_0x1a9c96(0x255)+_0x1f0524+'\x0a\x20\x20\x20\x20\x20\x20'),_0xfd5107=await this[_0x1a9c96(0x283)]['query'](_0x1a9c96(0x22e)+_0x1f0524+_0x1a9c96(0x309)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x1a9c96(0x1ab));return!(0x0,utils_1[_0x1a9c96(0x2aa)])(this[_0x1a9c96(0x32c)])&&_0xfd5107[_0x1a9c96(0x277)](_0x2b8da6=>{const _0x184717=_0x1a9c96;_0x2b8da6['email']=(0x0,utils_1[_0x184717(0x319)])(_0x2b8da6[_0x184717(0x26d)]),_0x2b8da6[_0x184717(0x327)]=(0x0,utils_1[_0x184717(0x319)])(_0x2b8da6['phone']);}),{'rows':_0xfd5107,'count':Number(_0x5e27a4[0x0]?.[_0x1a9c96(0x203)]||0x0)};}async[_0x346eee(0x2e7)](_0x9ad69c,_0x312903){const _0x3d1bd5=_0x346eee;if(!_0x9ad69c[_0x3d1bd5(0x2a6)]||!_0x9ad69c[_0x3d1bd5(0x2a6)]['length'])return!![];const _0x5d919c={'id':(0x0,typeorm_1['In'])(_0x9ad69c[_0x3d1bd5(0x2a6)])};return _0x312903&&(_0x5d919c['userId']=_0x312903),await this[_0x3d1bd5(0x250)]['update'](_0x5d919c,{'delFlag':0x1}),!![];}async[_0x346eee(0x322)](_0x56829f,_0x4bb543){const _0x54b020=_0x346eee;try{let _0x3967c9='';return await this['connection'][_0x54b020(0x310)](async()=>{const _0x1c7eb0=_0x54b020,_0x5b175b=(0x0,utils_1[_0x1c7eb0(0x2ef)])(this[_0x1c7eb0(0x32c)]),{modelInfo:_0x1d87cd}=await this[_0x1c7eb0(0x170)][_0x1c7eb0(0x24e)](model_constant_1[_0x1c7eb0(0x256)][_0x1c7eb0(0x19b)],'Speech_Synthesis7418877984234656063');await this[_0x1c7eb0(0x24a)]({'prompt':_0x4bb543['request'][_0x1c7eb0(0x1b8)],'user':_0x56829f['user'],'currentRequestModel':_0x1d87cd});const _0x4cee31={'curIp':(0x0,utils_1[_0x1c7eb0(0x19d)])(_0x56829f),'prompt':_0x4bb543[_0x1c7eb0(0x163)][_0x1c7eb0(0x1b8)],'modelId':_0x1d87cd['id'],'modelType':_0x1d87cd[_0x1c7eb0(0x160)],'answer':'','model':_0x1d87cd[_0x1c7eb0(0x25a)],'role':'user','userId':_0x56829f[_0x1c7eb0(0x279)]['id'],'completionTokens':0x0,'totalTokens':0x0,'type':balance_constant_1[_0x1c7eb0(0x263)]['CHAT_TYPE'],'logType':0x1,'requestOptions':JSON[_0x1c7eb0(0x23e)](_0x4bb543),'saasId':_0x5b175b},_0x2dfebc={..._0x4cee31,'role':_0x1c7eb0(0x268),'requestOptions':JSON[_0x1c7eb0(0x23e)]({'prompt':_0x4bb543['request'][_0x1c7eb0(0x1b8)],'options':{'model':_0x1d87cd[_0x1c7eb0(0x25a)]}})};await this['chatLogService'][_0x1c7eb0(0x247)](_0x4cee31),await this['chatLogService']['saveChatLog'](_0x2dfebc),await this[_0x1c7eb0(0x244)]['deductBalance4Chat'](_0x56829f[_0x1c7eb0(0x279)]['id'],_0x1d87cd,_0x2dfebc['id']);const _0x2c6486={'app':{'appid':_0x1d87cd[_0x1c7eb0(0x218)],'token':_0x1d87cd['appid'],'cluster':_0x1c7eb0(0x225)},'user':{'uid':String(_0x56829f[_0x1c7eb0(0x279)]['id'])},'audio':{'voice_type':'BV700_streaming','encoding':_0x1c7eb0(0x1e5)},'request':{'reqid':(0x0,crypto_1[_0x1c7eb0(0x32a)])(),'text':_0x4bb543['request'][_0x1c7eb0(0x1b8)],'operation':'query'}},_0x1ccec3=await this['doubaoService']['tts']({'data':_0x2c6486,'headers':{'Authorization':_0x1c7eb0(0x209)+_0x1d87cd['accessToken']}}),_0x4b2436=chat_constant_1[_0x1c7eb0(0x1b4)][_0x1c7eb0(0x19b)]+'-'+_0x5b175b+'-'+_0x56829f['user']['id']+'-'+new Date()[_0x1c7eb0(0x182)]()+_0x1c7eb0(0x328);let _0x34a879=(0x0,path_1['join'])(process[_0x1c7eb0(0x1eb)](),_0x1c7eb0(0x159),_0x1c7eb0(0x179)),_0x5653b5=_0x1c7eb0(0x325);_0x5653b5=_0x5653b5+'/'+_0x4b2436;!(0x0,fs_1[_0x1c7eb0(0x1d4)])(_0x34a879)&&(0x0,fs_1['mkdirSync'])(_0x34a879,{'recursive':!![]});_0x34a879=(0x0,path_1[_0x1c7eb0(0x28d)])(_0x34a879,_0x4b2436),(0x0,fs_1[_0x1c7eb0(0x288)])(_0x34a879,_0x1ccec3[_0x1c7eb0(0x191)],_0x1c7eb0(0x291));let _0x483edb=process[_0x1c7eb0(0x21d)][_0x1c7eb0(0x2d8)];_0x483edb['startsWith'](_0x1c7eb0(0x187))?_0x3967c9=_0x483edb+_0x5653b5:_0x3967c9=_0x1c7eb0(0x1ca)+_0x483edb+_0x5653b5,_0x2dfebc[_0x1c7eb0(0x28f)]=_0x3967c9,await this[_0x1c7eb0(0x217)]['saveChatLog'](_0x2dfebc);}),_0x3967c9;}catch(_0x5063bb){throw new common_1['HttpException'](_0x5063bb[_0x54b020(0x305)],common_1[_0x54b020(0x1aa)]['BAD_REQUEST']);}}async[_0x346eee(0x15f)](_0x1bac43,_0x3bbfd7,_0x2265f2){const _0x4e0715=_0x346eee;try{let _0x262141,_0x3f6f97;return await this[_0x4e0715(0x283)][_0x4e0715(0x310)](async()=>{const _0x47d32f=_0x4e0715,_0x51c66a=(0x0,utils_1['getReqSaasId'])(this[_0x47d32f(0x32c)]),{modelInfo:_0x414d0c}=await this[_0x47d32f(0x170)][_0x47d32f(0x24e)](model_constant_1['EModelType'][_0x47d32f(0x17f)],_0x47d32f(0x2e3));await this[_0x47d32f(0x244)][_0x47d32f(0x30f)](_0x1bac43[_0x47d32f(0x279)]['id'],_0x414d0c);const _0x32be86={'groupId':_0x2265f2,'curIp':(0x0,utils_1[_0x47d32f(0x19d)])(_0x1bac43),'prompt':_0x3bbfd7,'modelId':_0x414d0c['id'],'modelType':_0x414d0c['modelType'],'answer':'','model':_0x414d0c[_0x47d32f(0x25a)],'role':_0x47d32f(0x279),'userId':_0x1bac43[_0x47d32f(0x279)]['id'],'completionTokens':0x0,'totalTokens':0x0,'type':balance_constant_1[_0x47d32f(0x263)]['CHAT_TYPE'],'logType':0x1,'requestOptions':JSON[_0x47d32f(0x23e)]({'url':_0x3bbfd7}),'saasId':_0x51c66a},_0x33e6ef={..._0x32be86,'role':'assistant','requestOptions':JSON[_0x47d32f(0x23e)]({'prompt':_0x3bbfd7,'options':{'model':_0x414d0c[_0x47d32f(0x25a)]}})};await this['chatLogService'][_0x47d32f(0x247)](_0x32be86),await this['chatLogService'][_0x47d32f(0x247)](_0x33e6ef),await this[_0x47d32f(0x244)][_0x47d32f(0x17a)](_0x1bac43['user']['id'],_0x414d0c,_0x33e6ef['id']);let _0x4c2757=process[_0x47d32f(0x21d)]['GOMAXAI_HOST'];!/^http/[_0x47d32f(0x224)](_0x4c2757)&&(_0x4c2757='https://'+_0x4c2757);const _0x3d6d57={'app':{'appid':_0x414d0c[_0x47d32f(0x218)],'token':_0x414d0c[_0x47d32f(0x218)],'cluster':'volc_auc_common'},'user':{'uid':String(_0x1bac43[_0x47d32f(0x279)]['id'])},'audio':{'url':_0x3bbfd7,'format':_0x3bbfd7[_0x47d32f(0x1b0)]('.')[_0x47d32f(0x172)]()},'request':{'callback':_0x4c2757+'/api/chatgpt/notify-asr'}},_0xf157b2=await this['doubaoService'][_0x47d32f(0x15f)]({'data':_0x3d6d57,'headers':{'Authorization':_0x47d32f(0x209)+_0x414d0c[_0x47d32f(0x2a7)]}});_0x262141=_0xf157b2['id'],_0x3f6f97=await this['chatLogService'][_0x47d32f(0x247)](_0x33e6ef);}),new Promise(_0x1a061f=>{const _0x10f05f=_0x4e0715;utils_1['EE'][_0x10f05f(0x30a)](chat_constant_1[_0x10f05f(0x1b4)][_0x10f05f(0x17f)]+'-'+_0x262141,async _0x38d089=>{const _0x50e6d8=_0x10f05f;_0x3f6f97[_0x50e6d8(0x28f)]=_0x38d089[_0x50e6d8(0x1b8)],_0x3f6f97=await this[_0x50e6d8(0x217)][_0x50e6d8(0x247)](_0x3f6f97),_0x1a061f(_0x3f6f97);});});}catch(_0x2a55d9){throw new common_1[(_0x4e0715(0x262))](_0x2a55d9[_0x4e0715(0x305)],common_1[_0x4e0715(0x1aa)][_0x4e0715(0x17e)]);}}[_0x346eee(0x161)](_0x372baf){const _0x3e9796=_0x346eee;_0x372baf[_0x3e9796(0x282)]===0x3e8&&utils_1['EE']['emit'](chat_constant_1[_0x3e9796(0x1b4)][_0x3e9796(0x17f)]+'-'+_0x372baf['id'],_0x372baf);}async[_0x346eee(0x168)](_0x2b1a25,_0x38d82e,_0x15981c,_0x4a5bbd){const _0x23fed4=_0x346eee;try{let _0x5758ad='https://yuyin.qumao518.vip/upload/0001-0-45-1727599485154.mp3';await this[_0x23fed4(0x283)]['transaction'](async()=>{const _0x334936=_0x23fed4;let _0x488500=new Date()[_0x334936(0x182)](),_0x56a5d8=new Date()[_0x334936(0x182)]();const _0x2edb1a=_0x2b1a25[_0x334936(0x279)]['id'],_0x566ac0=(0x0,utils_1[_0x334936(0x2ef)])(this[_0x334936(0x32c)]),_0x14c342=chat_constant_1[_0x334936(0x1b4)][_0x334936(0x17f)]+'-'+_0x566ac0+'-'+_0x2edb1a+'-'+new Date()[_0x334936(0x182)]()+'.mp3',_0x423b12=await this[_0x334936(0x2d9)]['upload2Local']({'filename':_0x14c342,'buffer':_0x4a5bbd[_0x334936(0x185)]});_0x56a5d8=new Date()['getTime'](),console['log']('[耗时打印]保存文件耗时：',_0x56a5d8-_0x488500),_0x5758ad=_0x423b12||_0x423b12;const _0x1e4dcd=await this[_0x334936(0x15f)](_0x2b1a25,_0x423b12,_0x15981c?.[_0x334936(0x1a0)]?.['groupId']);_0x488500=new Date()['getTime'](),console[_0x334936(0x302)](_0x334936(0x1f1),_0x488500-_0x56a5d8),_0x15981c[_0x334936(0x2f8)]=_0x1e4dcd[_0x334936(0x28f)];typeof _0x15981c['options']===_0x334936(0x1d9)&&(_0x15981c[_0x334936(0x1a0)]=JSON[_0x334936(0x31a)](_0x15981c['options']));const _0xca88bb=await this['chatProcess'](_0x15981c,_0x2b1a25,_0x38d82e,![]);_0x56a5d8=new Date()[_0x334936(0x182)](),console[_0x334936(0x302)](_0x334936(0x2ce),_0x56a5d8-_0x488500);const _0x653e06=await this[_0x334936(0x322)](_0x2b1a25,{'request':{'text':_0xca88bb}});return _0x488500=new Date()[_0x334936(0x182)](),console[_0x334936(0x302)](_0x334936(0x308),_0x488500-_0x56a5d8),_0x653e06;}),_0x38d82e[_0x23fed4(0x2da)](0xc8)[_0x23fed4(0x27c)](result_1[_0x23fed4(0x303)]['success'](_0x5758ad));}catch(_0x4caaec){throw new common_1['HttpException'](_0x4caaec['message'],common_1['HttpStatus']['BAD_REQUEST']);}}};ChatgptService=__decorate([(0x0,common_1[_0x346eee(0x2ee)])(),__param(0x0,(0x0,typeorm_2[_0x346eee(0x1b2)])(pptTask_entity_1[_0x346eee(0x294)])),__metadata('design:paramtypes',[typeorm_1['Repository'],nestjs_cls_1[_0x346eee(0x2cc)],user_service_1[_0x346eee(0x22a)],file_service_1[_0x346eee(0x1ac)],gpts_service_1[_0x346eee(0x2e8)],yooPPT_service_1[_0x346eee(0x2a2)],doubao_service_1[_0x346eee(0x1fe)],models_service_1[_0x346eee(0x289)],chatLog_service_1[_0x346eee(0x1e6)],lumaTask_service_1[_0x346eee(0x27a)],badwords_service_1[_0x346eee(0x238)],autoreply_service_1[_0x346eee(0x189)],chatGroup_service_1[_0x346eee(0x1e7)],globalConfig_service_1[_0x346eee(0x184)],typeorm_1[_0x346eee(0x1cb)]])],ChatgptService),exports[_0x346eee(0x32f)]=ChatgptService;function _0x219b(){const _0x30f166=['sunoMusicId','../models/models.service','\x20AND\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username\x20LIKE\x20(\x27%','response.length','luma-video','Catch\x20Error\x20','music-task','./baidu','parseAndSaveVideo','sendMessageFromXunFei','totalTokens','page_count','ClsService','params','[耗时打印]文字对话耗时：','content','getCurrentModelByChatGroupId','getAppById','提供了错误的模型秘钥、已冻结当前调用Key、请重新尝试对话！','syncLumaTask','原始任务不存在！','uploadFile','progress','created_at','GOMAXAI_HOST','fileService','status','resolve','openAi','toISOString','keyv','metadata','contents','https://api.openai.com','\x20回复数不得大于等于模型上下文数,\x20已自动调整为\x20maxTokenRes:\x20','AUC7419233800922468658','debuctBalance4PPT','Unauthorized','size','pptDel','GptsService','语音转文本失败','ADDNOTES','openaiModel3MaxTokens','\x20--aspect_ratio\x20','CHAT_TYPE','Injectable','getReqSaasId','getRandomAudioKey','CHAT','gomaxai-default-key','map','../autoreply/autoreply.service','COVER','progressUrl','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','prompt','chatGroupService','本次调用:\x20','listUndoneVideo','delta','281256XJRETG','你当前使用的应用已被下架、请删除当前对话开启新的对话吧！','path','nestjs-cls','redis://','log','Result','32k','message','%\x27)\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','服务异常、请重新试试吧！！！','[耗时打印]文字转语音耗时：','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','once','typeorm','提供了错误的模型秘钥','tts-1','modelId','validateBalance4Chat','transaction','process_url','%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20u.phone\x20LIKE\x20(\x27%','author','\x0a\x20Respond\x20using\x20markdown.\x20\x0a\x20Current\x20date:\x20','openaiModel3MaxTokens16kRes','openaiModel3MaxTokensRes','gptsService','catch','maskEmail','parse','key','finish_reason','conversationOptions','pptCreateThesis','autoreplyService','advisor','%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20p.sub_title\x20LIKE\x20(\x27%','tts','内容提取失败','bad\x20response\x20status\x20code\x20307','/upload','__metadata','phone','.mp3','findOne','randomUUID','secret','clsService','72KRuBJP','messageStore','ChatgptService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','originTaskId','./store','115986XNBAQw','webroot','compileNetwork','pptStructure','openaiTimeoutMs','Bearer\x20','style','asr','modelType','notifyAsr','then','request','abortController','abs','gomaxAiStore','400\x20error','voiceChat','function','transcriptions','theme','chatgpt','FILE','chat-error','The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.','modelsService','speech','pop','aac','school','chatProcess','floor','audio2text\x20','stateDesc','upload','deductBalance4Chat','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','object','gpt-4','BAD_REQUEST','ASR','You\x20exceeded\x20your\x20current\x20quota,\x20please\x20check\x20your\x20plan\x20and\x20billing\x20details.','statusCode','getTime','transition','GlobalConfigService','buffer','.png','http','DRAW','AutoreplyService','pleader','requestFromGpt','getRandomKey','task_id','../../common/utils','openaiModel3MaxTokens16k','333333333333333','data','../../common/constants/ppt.constant','trim','audio','uuid','lockKey','schoolPicture',',\x20continue_clip_id\x20','@nestjs/common','downUrl','TTS','catalogs','getClientIp','save','create','options','completionParams','未配置语音模型或语音模型key，请配置并启用语音功能！','%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20u.nickname\x20LIKE\x20(\x27%','openaiModel4MaxTokens32kRes','get','unifiedFormattingResponse','../badwords/badwords.service','https://api.moonshot.cn/v1','user_prompt','HttpStatus','\x0a\x20\x20\x20\x20\x20\x20','FileService','REDIS_USER','__esModule','suno-v3','split','doubaoService','InjectRepository','chat','EChatType','role','../gpts/gpts.service','fileUrl','text','EPPTTaskType','checkUserStatus','slideType','158997wrjBFK','../globalConfig/globalConfig.service','initOpenAi','当前模型key已被封禁','parentMessageId','pptCreate','openai','updated_at','conversationId','可翻译成其他语言。','This\x20is\x20not\x20a\x20chat\x20model\x20and\x20thus\x20not\x20supported','./spark','includes','OTHER','https://','Connection','%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20u.email\x20LIKE\x20(\x27%','listAssetsBychatLogIds','getConfigByKeys','listByGroupId','fontName','Logger','arrayBuffer','toLowerCase','existsSync','complex','modelInfo','pptService','errMsg','string','pptx_url','pptResult','./../user/user.service','\x20key\x20->\x20','模型秘钥错误或模型余额不足','kimiUpload','pageCount','baseURL','prompt\x20','../../common/constants/chat.constant','../chatLog/chatLog.service','mp3','ChatLogService','ChatGroupService','defaultBaseUrl','key:\x20','chatDraw','cwd','video-task','\x20--expand_prompt\x20','4069090RFTCYl','setHeader','chatTask','[耗时打印]语音转文字耗时：','configChatGptApi','REDIS_PASSWORD','@keyv/redis','../api/lumaTask.service','extend','gpts','endTime','abort','createReadStream','语音转换失败','b64_json','usage','DoubaoService','removeSpecialCharacters','slice','\x20AND\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.title\x20LIKE\x20(\x27%','../../common/result','count','resCover','buildSystemMessage','saveUseLog','../api/yooPPT.service','当前模型key余额已耗尽','Bearer;','systemPreMessage','16k','is_end','%\x27)\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','yooTaskId','application/octet-stream;\x20charset=utf-8','slideNumber',',\x20tags\x20','316634gEcExW','VIDEO','4700108LXNoxl','/v1','fanyi\x20mj-associate','chatLogService','appid','response','subTitle','state','同步PPT生成任务进度失败！','env','result','./zhipu','addOneIfOdd','./pptTask.entity','musicTask','chatMusic','test','volcano_tts','Content-type','pptReCover','error','configDoubaoApi','UserService','remove\x20file\x20','onModuleInit','\x20model:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.type,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.user_id\x20AS\x20userId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.sub_title\x20AS\x20subTitle,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.theme,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.catalogs,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.contents,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.notes,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.author,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.color,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.style,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.font_name\x20AS\x20fontName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.transition,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.complex,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.cover_id\x20AS\x20coverId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.origin_id\x20AS\x20originId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.file_url\x20AS\x20fileUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.pleader,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.advisor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school_logo\x20AS\x20schoolLogo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school_picture\x20AS\x20schoolPicture,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.slide_number\x20AS\x20slideNumber,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.slide_type\x20AS\x20slideType,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.yoo_task_id\x20AS\x20yooTaskId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.res_cover\x20AS\x20resCover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ppt_task\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20p.user_id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','sendMessageFromZhipu','api','detail','mergedOptions','openaiModel4MaxTokensRes','XunFeiSpark','systemMessage','/v1/images/generations','STRUCTURE','BadwordsService','buildOptions','type','close','../file/file.service','lumaTaskService','stringify','pptCover','debug','当前模型不是聊天模型','length','PAYMENT_REQUIRED','userService','schoolLogo','NineStore','saveChatLog','绘制图片失败，此次绘画被拒绝了！','openaiBaseUrl','validateBeforeChat','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.del_flag\x20=\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','title','getOwnPropertyDescriptor','getModelByType','completionTokens','pptTaskEntity','openaiModel4MaxTokens32k','timeout','REDIS_PORT','\x20AND\x20p.user_id\x20=\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(p.id)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ppt_task\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20p.user_id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','EModelType','decorate',',\x20title\x20','completions','model','getCurrentModel','模型秘钥错误或模型金额不足，请联系管理员！','set','signal','checkBadWords','音乐生成失败，没有响应','DALL-E2','HttpException','DeductionKey','formatModelToken','setData','openai-draw','getGroupInfoFromId','assistant','Please\x20check\x20the\x20back-end\x20console','pptAddPage','视频生成失败，没有响应','绘制图片失败，请稍后试试吧！','email','listTaskByIds','sendMessage','refundBalance4Chat','push','color','messages','choices','end','system','forEach','preset','user','LumaTaskService','all','json','userId','Incorrect\x20API\x20key\x20provided','pptNote','THESIS','4qJdjEt','code','connection','defineProperty',',\x20mv\x20','keyType','axios','writeFileSync','ModelsService','configKimiApi','当前模型key余额已耗尽、已冻结当前调用Key、尝试重新对话试试吧！','draw\x20paompt\x20info\x20<======*******======>\x20','join','2419528bOgzQH','answer','DrawService','base64','CREATE','MUSIC','PPTTaskEntity','apiBaseUrl','openaiModel4MaxTokens','coverId','default','../../common/constants/errorMessage.constant','getUuid','badwordsService','OpenAiErrorCodeMessage','importDynamic','../chatGroup/chatGroup.service','pptChangeTheme','checkAutoReply','你是\x20Kimi，由\x20Moonshot\x20AI\x20提供的人工智能助手，你更擅长中文和英文的对话。你会为用户提供安全，有帮助，','YooPPTService','准确的回答。同时，你会拒绝一切涉及恐怖主义，种族歧视，黄色暴力等问题的回答。Moonshot\x20AI\x20为专有名词，不','\x20image_url\x20','buildMessageFromParentMessageId','ids','accessToken','/api/v3','removeFile','isSuper','./helper','videoTask','PPT','promptTokens','apiKey','proxyUrl','asyncPPTProgress','temperature','globalConfigService',',\x20模型名称:\x20','当前模型不是聊天模型、已冻结当前调用Key、请重新尝试对话！','config','pptCreateFile','../api/doubao.service','thirdId','pptAddNote','files','__param','chatLogId','whisper-1','write'];_0x219b=function(){return _0x30f166;};return _0x219b();}