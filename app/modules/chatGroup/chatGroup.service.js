'use strict';const _0x124d8b=_0x5929;(function(_0x3c58bc,_0xd11779){const _0x2d906d=_0x5929,_0x3ca582=_0x3c58bc();while(!![]){try{const _0x2ea90d=parseInt(_0x2d906d(0x137))/0x1*(-parseInt(_0x2d906d(0x10c))/0x2)+-parseInt(_0x2d906d(0xfd))/0x3*(parseInt(_0x2d906d(0x126))/0x4)+-parseInt(_0x2d906d(0x12e))/0x5*(parseInt(_0x2d906d(0x103))/0x6)+-parseInt(_0x2d906d(0x101))/0x7*(-parseInt(_0x2d906d(0x12d))/0x8)+-parseInt(_0x2d906d(0x119))/0x9*(-parseInt(_0x2d906d(0x10f))/0xa)+parseInt(_0x2d906d(0x123))/0xb+-parseInt(_0x2d906d(0x109))/0xc;if(_0x2ea90d===_0xd11779)break;else _0x3ca582['push'](_0x3ca582['shift']());}catch(_0x3cba21){_0x3ca582['push'](_0x3ca582['shift']());}}}(_0x140f,0x856a8));var __decorate=this&&this[_0x124d8b(0x131)]||function(_0x84dec8,_0x13fee1,_0x49d8b7,_0x459409){const _0x18079e=_0x124d8b;var _0x4a0945=arguments['length'],_0x37c413=_0x4a0945<0x3?_0x13fee1:_0x459409===null?_0x459409=Object[_0x18079e(0x115)](_0x13fee1,_0x49d8b7):_0x459409,_0x50ef96;if(typeof Reflect===_0x18079e(0x124)&&typeof Reflect[_0x18079e(0x13e)]==='function')_0x37c413=Reflect['decorate'](_0x84dec8,_0x13fee1,_0x49d8b7,_0x459409);else{for(var _0x4f4dfd=_0x84dec8['length']-0x1;_0x4f4dfd>=0x0;_0x4f4dfd--)if(_0x50ef96=_0x84dec8[_0x4f4dfd])_0x37c413=(_0x4a0945<0x3?_0x50ef96(_0x37c413):_0x4a0945>0x3?_0x50ef96(_0x13fee1,_0x49d8b7,_0x37c413):_0x50ef96(_0x13fee1,_0x49d8b7))||_0x37c413;}return _0x4a0945>0x3&&_0x37c413&&Object['defineProperty'](_0x13fee1,_0x49d8b7,_0x37c413),_0x37c413;},__metadata=this&&this[_0x124d8b(0x130)]||function(_0x839a42,_0x169d3c){const _0x6f4b48=_0x124d8b;if(typeof Reflect==='object'&&typeof Reflect[_0x6f4b48(0xfb)]==='function')return Reflect['metadata'](_0x839a42,_0x169d3c);},__param=this&&this[_0x124d8b(0x127)]||function(_0x21cd43,_0x4a78ea){return function(_0x518a6a,_0x5afc5f){_0x4a78ea(_0x518a6a,_0x5afc5f,_0x21cd43);};};function _0x5929(_0x3d7122,_0x23295b){const _0x140fdc=_0x140f();return _0x5929=function(_0x59297d,_0x33736e){_0x59297d=_0x59297d-0xfa;let _0xf0eb6c=_0x140fdc[_0x59297d];return _0xf0eb6c;},_0x5929(_0x3d7122,_0x23295b);}Object[_0x124d8b(0x125)](exports,_0x124d8b(0x12c),{'value':!![]}),exports[_0x124d8b(0x113)]=void 0x0;function _0x140f(){const _0x55c7bc=['modelsService','error:\x20','82NMqfFD','log','modelType','save','create','更新对话失败！','getGroupInfoFromId','decorate','undefined','metadata','InjectRepository','597RdiAXj','@nestjs/common','非法操作、您在删除一个非法资源！','HttpException','4242ugvYVc','connection','192702BDtSyf','删除失败！','DESC','BAD_REQUEST','./chatGroup.entity','map','13098204wIJLVD','Repository','findOne','5102AEDXti','delAll','get','20jRVOKR','join','stringify','EModelType','ChatGroupService','forEach','getOwnPropertyDescriptor','chatGroupEntity','del','HttpStatus','3906198RNaNgE','title','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20(','Injectable','groupId','affected','../../common/constants/model.constant','user','对话组编号和用户编号不匹配，请登录之后创建新的对话！','update','6978081GHXIfz','object','defineProperty','708dmDrcI','__param','config','删除成功','query','typeorm','__esModule','12224glNAVl','85VFxQET','design:paramtypes','__metadata','__decorate','ChatGroupEntity','isSticky','ModelsService'];_0x140f=function(){return _0x55c7bc;};return _0x140f();}const common_1=require(_0x124d8b(0xfe)),chatGroup_entity_1=require(_0x124d8b(0x107)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x124d8b(0x12b)),models_service_1=require('../models/models.service'),model_constant_1=require(_0x124d8b(0x11f));let ChatGroupService=class ChatGroupService{constructor(_0x2570a3,_0x410edf,_0x36e0f2){const _0x594c14=_0x124d8b;this[_0x594c14(0x116)]=_0x2570a3,this[_0x594c14(0x135)]=_0x410edf,this[_0x594c14(0x102)]=_0x36e0f2;}async[_0x124d8b(0x13b)](_0x5d0a35,_0x4e25a6){const _0x2e788c=_0x124d8b,{title:title='新对话',model:_0xc65599,modelType:modelType=model_constant_1[_0x2e788c(0x112)]['CHAT']}=_0x4e25a6,_0x51e332={'title':title,'modelType':modelType,'userId':_0x5d0a35['user']['id']},_0x1b07e8=await this['modelsService']['getModelByType'](modelType,_0xc65599);_0x51e332[_0x2e788c(0x128)]=JSON[_0x2e788c(0x111)](_0x1b07e8);const _0x8ffdce=await this['chatGroupEntity'][_0x2e788c(0x13a)](_0x51e332);return _0x8ffdce;}async[_0x124d8b(0x12a)](_0x2a08c2,_0x5474af){const _0x2d09e8=_0x124d8b;try{const {id:_0x1dcc8b}=_0x5474af[_0x2d09e8(0x120)],_0x4aebbd={'userId':_0x1dcc8b,'isDelete':![]};_0x2a08c2?_0x4aebbd[_0x2d09e8(0x139)]=_0x2a08c2:_0x4aebbd[_0x2d09e8(0x139)]=(0x0,typeorm_2['IsNull'])();const _0xdc399b=await this[_0x2d09e8(0x116)]['find']({'where':_0x4aebbd,'order':{'isSticky':'DESC','id':_0x2d09e8(0x105)}});if(!_0xdc399b['length'])return _0xdc399b;const _0x599df8=_0xdc399b['map'](_0x566fc2=>_0x566fc2['id']),_0x596457=await this[_0x2d09e8(0x102)]['query'](_0x2d09e8(0x11b)+_0x599df8[_0x2d09e8(0x110)]()+')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20'),_0xc5946b=new Map();_0x596457[_0x2d09e8(0x114)](_0x1e0204=>{const _0x1da7c0=_0x2d09e8;_0xc5946b['set'](_0x1e0204[_0x1da7c0(0x11d)],_0x1e0204['lastTime']);});const _0x571c25=_0xdc399b[_0x2d09e8(0x108)](_0x44eeb1=>{const _0x3d5e39=_0x2d09e8;return{..._0x44eeb1,'lastTime':_0xc5946b[_0x3d5e39(0x10e)](_0x44eeb1['id'])||null};});return _0x571c25;}catch(_0x4ba5e6){console[_0x2d09e8(0x138)](_0x2d09e8(0x136),_0x4ba5e6);}}async[_0x124d8b(0x122)](_0x3a9524,_0x1fea1b){const _0x1721af=_0x124d8b,{title:_0x4bef81,isSticky:_0x54d8d2,groupId:_0x2bc7ce,config:_0x1d112a,appType:_0x2e14a1}=_0x3a9524,{id:_0x499927}=_0x1fea1b[_0x1721af(0x120)],_0x2f85bb=await this[_0x1721af(0x116)]['findOne']({'where':{'id':_0x2bc7ce,'userId':_0x499927}});if(!_0x2f85bb)throw new common_1[(_0x1721af(0x100))](_0x1721af(0x121),common_1[_0x1721af(0x118)]['BAD_REQUEST']);const _0x23e5d5={};_0x4bef81&&(_0x23e5d5[_0x1721af(0x11a)]=_0x4bef81),typeof _0x54d8d2!==_0x1721af(0xfa)&&(_0x23e5d5[_0x1721af(0x133)]=_0x54d8d2),_0x1d112a&&(_0x23e5d5['config']=_0x1d112a);const _0x3f2781=await this[_0x1721af(0x116)][_0x1721af(0x122)]({'id':_0x2bc7ce},_0x23e5d5);if(_0x3f2781[_0x1721af(0x11e)])return!![];else throw new common_1[(_0x1721af(0x100))](_0x1721af(0x13c),common_1[_0x1721af(0x118)][_0x1721af(0x106)]);}async[_0x124d8b(0x117)](_0x514ca0,_0x1d66a9){const _0x4ab067=_0x124d8b,{groupId:_0x2eae72}=_0x514ca0,{id:_0x3bf141}=_0x1d66a9[_0x4ab067(0x120)],_0x290298=await this['chatGroupEntity'][_0x4ab067(0x10b)]({'where':{'id':_0x2eae72,'userId':_0x3bf141}});if(!_0x290298)throw new common_1[(_0x4ab067(0x100))](_0x4ab067(0xff),common_1[_0x4ab067(0x118)][_0x4ab067(0x106)]);const _0x1afca5=await this[_0x4ab067(0x116)][_0x4ab067(0x122)]({'id':_0x2eae72},{'isDelete':!![]});if(_0x1afca5[_0x4ab067(0x11e)])return _0x4ab067(0x129);else throw new common_1[(_0x4ab067(0x100))](_0x4ab067(0x104),common_1[_0x4ab067(0x118)][_0x4ab067(0x106)]);}async[_0x124d8b(0x10d)](_0x342b71){const _0x52bc7d=_0x124d8b,{id:_0x2941ff}=_0x342b71[_0x52bc7d(0x120)],_0x92728c=await this[_0x52bc7d(0x116)][_0x52bc7d(0x122)]({'userId':_0x2941ff,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x92728c['affected'])return _0x52bc7d(0x129);else throw new common_1[(_0x52bc7d(0x100))](_0x52bc7d(0x104),common_1[_0x52bc7d(0x118)][_0x52bc7d(0x106)]);}async[_0x124d8b(0x13d)](_0x569dd2){const _0x1f0547=_0x124d8b;if(!_0x569dd2||_0x569dd2===0x0)return null;return await this[_0x1f0547(0x116)][_0x1f0547(0x10b)]({'where':{'id':_0x569dd2}});}};ChatGroupService=__decorate([(0x0,common_1[_0x124d8b(0x11c)])(),__param(0x0,(0x0,typeorm_1[_0x124d8b(0xfc)])(chatGroup_entity_1[_0x124d8b(0x132)])),__metadata(_0x124d8b(0x12f),[typeorm_2[_0x124d8b(0x10a)],models_service_1[_0x124d8b(0x134)],typeorm_2['Connection']])],ChatGroupService),exports[_0x124d8b(0x113)]=ChatGroupService;