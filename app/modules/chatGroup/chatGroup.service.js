'use strict';const _0x378592=_0x45ad;(function(_0x359f97,_0x3f07ee){const _0x4f2504=_0x45ad,_0xcecb07=_0x359f97();while(!![]){try{const _0x5a9de2=parseInt(_0x4f2504(0x93))/0x1+parseInt(_0x4f2504(0x80))/0x2*(-parseInt(_0x4f2504(0x9a))/0x3)+parseInt(_0x4f2504(0x9d))/0x4+-parseInt(_0x4f2504(0x81))/0x5*(-parseInt(_0x4f2504(0xbf))/0x6)+-parseInt(_0x4f2504(0xb7))/0x7*(parseInt(_0x4f2504(0xbc))/0x8)+-parseInt(_0x4f2504(0x7c))/0x9*(-parseInt(_0x4f2504(0xb1))/0xa)+parseInt(_0x4f2504(0xb9))/0xb;if(_0x5a9de2===_0x3f07ee)break;else _0xcecb07['push'](_0xcecb07['shift']());}catch(_0x52d422){_0xcecb07['push'](_0xcecb07['shift']());}}}(_0x289e,0xb803b));function _0x289e(){const _0x48e192=['./chatGroup.entity','5887002MSGCuE','get','findOne','8MlbKBV','BAD_REQUEST','stringify','6mWVFZD','@nestjs/common','1701639iuGuEd','decorate','affected','非法操作、您在删除一个非法资源！','2Xcuslv','4886855gpXViF','find','modelType','query','DESC','map','../../common/constants/model.constant','lastTime','forEach','config','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20(','对话组编号和用户编号不匹配，请登录之后创建新的对话！','__esModule','length','HttpStatus','EModelType','HttpException','IsNull','129026aOFMJm','ChatGroupEntity','删除失败！','CHAT','typeorm','InjectRepository','chatGroupEntity','3222339RsRekO','function','@nestjs/typeorm','4642780lzjwjY','defineProperty','groupId','object','del','create','getGroupInfoFromId','ChatGroupService','metadata','connection','modelsService','更新对话失败！','undefined','error:\x20','../models/models.service','user','删除成功','delAll','__decorate','update','20KvJVBY','getOwnPropertyDescriptor','新对话','isSticky','title','getModelByType','9468060tONHgZ'];_0x289e=function(){return _0x48e192;};return _0x289e();}var __decorate=this&&this[_0x378592(0xaf)]||function(_0x249782,_0x3df2a1,_0x2e2c64,_0x229226){const _0x347771=_0x378592;var _0x250cd4=arguments[_0x347771(0x8e)],_0x41ba4b=_0x250cd4<0x3?_0x3df2a1:_0x229226===null?_0x229226=Object[_0x347771(0xb2)](_0x3df2a1,_0x2e2c64):_0x229226,_0x3158aa;if(typeof Reflect===_0x347771(0xa0)&&typeof Reflect[_0x347771(0x7d)]==='function')_0x41ba4b=Reflect[_0x347771(0x7d)](_0x249782,_0x3df2a1,_0x2e2c64,_0x229226);else{for(var _0xbd8d13=_0x249782['length']-0x1;_0xbd8d13>=0x0;_0xbd8d13--)if(_0x3158aa=_0x249782[_0xbd8d13])_0x41ba4b=(_0x250cd4<0x3?_0x3158aa(_0x41ba4b):_0x250cd4>0x3?_0x3158aa(_0x3df2a1,_0x2e2c64,_0x41ba4b):_0x3158aa(_0x3df2a1,_0x2e2c64))||_0x41ba4b;}return _0x250cd4>0x3&&_0x41ba4b&&Object['defineProperty'](_0x3df2a1,_0x2e2c64,_0x41ba4b),_0x41ba4b;},__metadata=this&&this['__metadata']||function(_0x183688,_0x2bc85c){const _0x5bedf5=_0x378592;if(typeof Reflect==='object'&&typeof Reflect[_0x5bedf5(0xa5)]===_0x5bedf5(0x9b))return Reflect[_0x5bedf5(0xa5)](_0x183688,_0x2bc85c);},__param=this&&this['__param']||function(_0x44d1a8,_0x2f604b){return function(_0x50cc11,_0x3ef8a1){_0x2f604b(_0x50cc11,_0x3ef8a1,_0x44d1a8);};};Object[_0x378592(0x9e)](exports,_0x378592(0x8d),{'value':!![]}),exports[_0x378592(0xa4)]=void 0x0;function _0x45ad(_0x236dd6,_0x43e5ff){const _0x289ed0=_0x289e();return _0x45ad=function(_0x45ada1,_0x5b4c9d){_0x45ada1=_0x45ada1-0x7b;let _0x474b7f=_0x289ed0[_0x45ada1];return _0x474b7f;},_0x45ad(_0x236dd6,_0x43e5ff);}const common_1=require(_0x378592(0x7b)),chatGroup_entity_1=require(_0x378592(0xb8)),typeorm_1=require(_0x378592(0x9c)),typeorm_2=require(_0x378592(0x97)),models_service_1=require(_0x378592(0xab)),model_constant_1=require(_0x378592(0x87));let ChatGroupService=class ChatGroupService{constructor(_0x4a4ba4,_0x5596bc,_0x29ccc5){const _0x4271e4=_0x378592;this['chatGroupEntity']=_0x4a4ba4,this[_0x4271e4(0xa7)]=_0x5596bc,this['connection']=_0x29ccc5;}async[_0x378592(0xa2)](_0x52e7c0,_0x38f939){const _0x3eee62=_0x378592,{title:title=_0x3eee62(0xb3),model:_0x3517d8,modelType:modelType=model_constant_1[_0x3eee62(0x90)][_0x3eee62(0x96)]}=_0x38f939,_0x2096f7={'title':title,'modelType':modelType,'userId':_0x52e7c0['user']['id']},_0x12ae9f=await this[_0x3eee62(0xa7)][_0x3eee62(0xb6)](modelType,_0x3517d8);_0x2096f7[_0x3eee62(0x8a)]=JSON[_0x3eee62(0xbe)](_0x12ae9f);const _0x3e6045=await this['chatGroupEntity']['save'](_0x2096f7);return _0x3e6045;}async[_0x378592(0x84)](_0x4c800b,_0x11addb){const _0x2849b4=_0x378592;try{const {id:_0x79ea66}=_0x11addb[_0x2849b4(0xac)],_0x28c6da={'userId':_0x79ea66,'isDelete':![]};_0x4c800b?_0x28c6da[_0x2849b4(0x83)]=_0x4c800b:_0x28c6da[_0x2849b4(0x83)]=(0x0,typeorm_2[_0x2849b4(0x92)])();const _0x4cac4c=await this['chatGroupEntity'][_0x2849b4(0x82)]({'where':_0x28c6da,'order':{'isSticky':_0x2849b4(0x85),'id':'DESC'}});if(!_0x4cac4c[_0x2849b4(0x8e)])return _0x4cac4c;const _0x2dd570=_0x4cac4c[_0x2849b4(0x86)](_0x493b4c=>_0x493b4c['id']),_0x14c2ff=await this[_0x2849b4(0xa6)]['query'](_0x2849b4(0x8b)+_0x2dd570['join']()+')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20'),_0x42d404=new Map();_0x14c2ff[_0x2849b4(0x89)](_0x5f3380=>{const _0x298256=_0x2849b4;_0x42d404['set'](_0x5f3380[_0x298256(0x9f)],_0x5f3380[_0x298256(0x88)]);});const _0x5829c5=_0x4cac4c[_0x2849b4(0x86)](_0x3e9edc=>{const _0x1db253=_0x2849b4;return{..._0x3e9edc,'lastTime':_0x42d404[_0x1db253(0xba)](_0x3e9edc['id'])||null};});return _0x5829c5;}catch(_0xf29f8d){console['log'](_0x2849b4(0xaa),_0xf29f8d);}}async['update'](_0x60d31a,_0x29b168){const _0x1b7b2d=_0x378592,{title:_0x52dfb3,isSticky:_0x36a996,groupId:_0x58331b,config:_0x576dda,appType:_0x53c6de}=_0x60d31a,{id:_0x4372e0}=_0x29b168[_0x1b7b2d(0xac)],_0x5d15a9=await this[_0x1b7b2d(0x99)][_0x1b7b2d(0xbb)]({'where':{'id':_0x58331b,'userId':_0x4372e0}});if(!_0x5d15a9)throw new common_1[(_0x1b7b2d(0x91))](_0x1b7b2d(0x8c),common_1[_0x1b7b2d(0x8f)][_0x1b7b2d(0xbd)]);const _0x1b5d51={};_0x52dfb3&&(_0x1b5d51[_0x1b7b2d(0xb5)]=_0x52dfb3),typeof _0x36a996!==_0x1b7b2d(0xa9)&&(_0x1b5d51[_0x1b7b2d(0xb4)]=_0x36a996),_0x576dda&&(_0x1b5d51[_0x1b7b2d(0x8a)]=_0x576dda);const _0x57059f=await this[_0x1b7b2d(0x99)][_0x1b7b2d(0xb0)]({'id':_0x58331b},_0x1b5d51);if(_0x57059f[_0x1b7b2d(0x7e)])return!![];else throw new common_1[(_0x1b7b2d(0x91))](_0x1b7b2d(0xa8),common_1[_0x1b7b2d(0x8f)][_0x1b7b2d(0xbd)]);}async[_0x378592(0xa1)](_0x40d7d9,_0xd50ea1){const _0x176495=_0x378592,{groupId:_0x6fb211}=_0x40d7d9,{id:_0x246002}=_0xd50ea1[_0x176495(0xac)],_0x841f52=await this[_0x176495(0x99)][_0x176495(0xbb)]({'where':{'id':_0x6fb211,'userId':_0x246002}});if(!_0x841f52)throw new common_1['HttpException'](_0x176495(0x7f),common_1[_0x176495(0x8f)][_0x176495(0xbd)]);const _0x455e17=await this[_0x176495(0x99)][_0x176495(0xb0)]({'id':_0x6fb211},{'isDelete':!![]});if(_0x455e17[_0x176495(0x7e)])return _0x176495(0xad);else throw new common_1[(_0x176495(0x91))](_0x176495(0x95),common_1[_0x176495(0x8f)][_0x176495(0xbd)]);}async[_0x378592(0xae)](_0x421378){const _0x3d3d44=_0x378592,{id:_0x47a68d}=_0x421378[_0x3d3d44(0xac)],_0x2d4b5d=await this[_0x3d3d44(0x99)][_0x3d3d44(0xb0)]({'userId':_0x47a68d,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x2d4b5d['affected'])return'删除成功';else throw new common_1[(_0x3d3d44(0x91))](_0x3d3d44(0x95),common_1[_0x3d3d44(0x8f)][_0x3d3d44(0xbd)]);}async[_0x378592(0xa3)](_0x11bf29){const _0x5e13ec=_0x378592;if(!_0x11bf29||_0x11bf29===0x0)return null;return await this['chatGroupEntity'][_0x5e13ec(0xbb)]({'where':{'id':_0x11bf29}});}};ChatGroupService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x378592(0x98)])(chatGroup_entity_1[_0x378592(0x94)])),__metadata('design:paramtypes',[typeorm_2['Repository'],models_service_1['ModelsService'],typeorm_2['Connection']])],ChatGroupService),exports[_0x378592(0xa4)]=ChatGroupService;