'use strict';const _0x577ddf=_0x12e7;(function(_0xac64d0,_0x21bb2a){const _0x5af73a=_0x12e7,_0x3482e0=_0xac64d0();while(!![]){try{const _0x42f844=parseInt(_0x5af73a(0x21c))/0x1*(-parseInt(_0x5af73a(0x189))/0x2)+-parseInt(_0x5af73a(0x144))/0x3+-parseInt(_0x5af73a(0x1cf))/0x4*(parseInt(_0x5af73a(0x24f))/0x5)+parseInt(_0x5af73a(0xc4))/0x6+-parseInt(_0x5af73a(0x22c))/0x7*(-parseInt(_0x5af73a(0x163))/0x8)+parseInt(_0x5af73a(0x15f))/0x9*(-parseInt(_0x5af73a(0x11a))/0xa)+parseInt(_0x5af73a(0x20d))/0xb*(parseInt(_0x5af73a(0x232))/0xc);if(_0x42f844===_0x21bb2a)break;else _0x3482e0['push'](_0x3482e0['shift']());}catch(_0x2243c6){_0x3482e0['push'](_0x3482e0['shift']());}}}(_0x1b05,0xf26a1));function _0x12e7(_0x425599,_0x4335f5){const _0x1b052b=_0x1b05();return _0x12e7=function(_0x12e708,_0x163b43){_0x12e708=_0x12e708-0xb9;let _0x19a68d=_0x1b052b[_0x12e708];return _0x19a68d;},_0x12e7(_0x425599,_0x4335f5);}var __decorate=this&&this[_0x577ddf(0x1b2)]||function(_0x4cc2b1,_0x6a7785,_0x2566a2,_0x47e1e7){const _0x3b6d33=_0x577ddf;var _0x2b76ad=arguments[_0x3b6d33(0xbd)],_0x56e848=_0x2b76ad<0x3?_0x6a7785:_0x47e1e7===null?_0x47e1e7=Object[_0x3b6d33(0xd5)](_0x6a7785,_0x2566a2):_0x47e1e7,_0xbe97b5;if(typeof Reflect===_0x3b6d33(0x117)&&typeof Reflect['decorate']===_0x3b6d33(0x1ea))_0x56e848=Reflect[_0x3b6d33(0xed)](_0x4cc2b1,_0x6a7785,_0x2566a2,_0x47e1e7);else{for(var _0x48fbbd=_0x4cc2b1[_0x3b6d33(0xbd)]-0x1;_0x48fbbd>=0x0;_0x48fbbd--)if(_0xbe97b5=_0x4cc2b1[_0x48fbbd])_0x56e848=(_0x2b76ad<0x3?_0xbe97b5(_0x56e848):_0x2b76ad>0x3?_0xbe97b5(_0x6a7785,_0x2566a2,_0x56e848):_0xbe97b5(_0x6a7785,_0x2566a2))||_0x56e848;}return _0x2b76ad>0x3&&_0x56e848&&Object['defineProperty'](_0x6a7785,_0x2566a2,_0x56e848),_0x56e848;},__metadata=this&&this['__metadata']||function(_0xce7a00,_0x5a23ae){const _0x1158f7=_0x577ddf;if(typeof Reflect==='object'&&typeof Reflect[_0x1158f7(0x1df)]===_0x1158f7(0x1ea))return Reflect[_0x1158f7(0x1df)](_0xce7a00,_0x5a23ae);},__param=this&&this['__param']||function(_0x553505,_0x305deb){return function(_0xb02f57,_0x5ca46f){_0x305deb(_0xb02f57,_0x5ca46f,_0x553505);};};Object['defineProperty'](exports,_0x577ddf(0x173),{'value':!![]}),exports[_0x577ddf(0xba)]=void 0x0;function _0x1b05(){const _0x3b62ea=['UNAUTHORIZED','design:paramtypes','File','AGENT','userBalanceService','isMobilePhone','SD绘画会员永久免费','saasMap','VIP_FREE','updateUserPassword','exists','UserInitVipEntity','onModuleInit','deduct','当前绑定用户不存在！','../../common/utils/date','diff','UserStatusEnum','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','Music','Between','upscale|describe|picread::retry|faceswap|shorten','queryAll','email','startOf','giftVip','VerificationEnum','获取邀请记录失败！','\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)','您的账户已被封禁、如有疑问、请联系管理员！','object','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','deductBalance4MJ','1670MSshUQ','ERole','verificationService','create','邀请新用户注册奖励','nestjs-cls','day','set','lifetimeVip','当前手机号已注册、请勿重复注册！','VerificationService','】调用失败退还','registerRewards','getOne','userEntity','Inject','角色信息不存在！','isDefined','EModelType','isSuper','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','days','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','InjectRepository','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','pptCreate','】使用扣减','MjDraw','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','userInitVipEntity','destroyAccount','./role.entity','sendMail','CZConfig','findOne','isInteger','verifyUserCredentials','DESC','当前用户信息失效、请重新登录！','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','zh-CN','Repository','2960403fxsNfc','ACTIVE','恭喜您绑定成功、后续可直接扫码登录了！','\x20AND\x20(username\x20LIKE\x20\x27%','queryOne','getUserByInviteCode','increment','count','get','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','savaLoginIp','HttpStatusCode','getReqSaasId','super123456','./../verification/verification.service','isEmail','avatar','updateStatus','./user.entity','yes','transaction','用户余额不足，请充值','getInviteRecord','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','HttpStatus','deductBalance4WorkFlow','VipFree','35856QqAwXA','validateBalance4Chat','inviteRewards','vipExpire','24FAqKrJ','relateType','Not','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','queryOneUserInfo','用户名已被使用！','DrawSpeed','price','assign','当前账户不存在！','非法访问','initSaasMap','Price','\x27,\x20\x271\x27,\x20\x27defaultSuper@cooper.com\x27,\x20\x27','pptOutline','compareSync','__esModule','updateVipExpire2Redis','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','invitedRewards','HttpException','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','标题大纲任务','\x09mj123456admin\x0a','%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%','管理员赠送','inviteCode','updateInfo','GPTS','turbo_mjDeduction','__keyevent@0__:expired','\x20AND\x20u.userId\x20=\x20','APP','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Connection','%\x27\x20)','无效的邀请码！','inviteLink','562elvoeB','createVerification','SaasEntity','模型【','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','手机号已被使用！','giftScore','registerVerifyExpir','Invited','\x20OFFSET\x20','当前用户不存在！','random','qureyUserInfoByInviteCode','../../common/constants/user.constant','还有用户使用相关角色，无法删除！','fast','error:\x20','../../common/constants/verification.constant','favoriteListByTypeAndIds','密码重置为[','pptThesis','重新生成封面任务','nickname','hideString','czVipFree','name','BAD_REQUEST','修改用户状态成功！','手机号格式错误！','../../common/constants/midjourney.constant','%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','clsService','modelType','-SD','增加PPT备注','修改用户状态失败！','typeorm','replace','affected','WORKFLOW','CHAT','__decorate','saasId','】会员每日限免','pSubscribe','修改密码失败、请重新试试吧。','code','registerBaseUrl','lodash','./../globalConfig/globalConfig.service','\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','username','\x20AND\x20phone\x20LIKE\x20\x27%','修改用户信息失败！','axios','update','updateSignDay','type3','\x20AND\x20saasId\x20=\x20','modelName','MUSIC','env','前台用户','ActionCN','%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%','VIEWER','../userBalance/userBalance.service','changeScore4Other','fetch|listbyids|modal|seed','DRAW','7818932LETZym','PPT【','openId','OTHER','SD绘画【','GlobalConfigService','verifyUserRegisterByPhone','desc','save','GOMAXAI_HOST','delete','】会员永久免费','password','查询用户不存在！','registerSendStatus','updateViolationCount','metadata','relateId','%\x27\x20OR\x20email\x20LIKE\x20\x27%','num','maskEmail','getClientIp','邮箱格式错误！','./userFavorite.entity','Chat','PPT','vlrk','function','MoreThan','message','ListSaasByIds','@nestjs/typeorm','connection','role','vipDays','的账号激活','受邀请注册赠送','findByIds','updateUserStatus','accessLabel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','delUser','inviterPhone','getConfigByKeys','小工具【','findAndCount','updateVipExpire','SUPER','\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','./saas.entity','formatCreateOrUpdateDate','./user_init_vip.entity','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','roleEntity','UserService\x20Init','当前密码错误！','deductBalance4Chat','代理商','MJ绘画【','default','文件生成PPT','validateBalance4MJ','10065WxdSUG','registerIp','123456','saasUpdate','RedisCacheService','vipLeavelName','find','userDefautlAvatar','invitePage','query','genUserName','generateRandomString','userFavoriteEntity','用户名已存在！','add','1813VEhPSu','没有变更，无需更改！','toDate','vipFreeKey','LessThanOrEqual','genUserNames','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27','vipLeavelId','hashSync','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','getVipLeavelRelById','mj-','forEach','phone','EChangeType','LOCKED','773885RJieIX','getMjPrice','inviterEmail','已生成过邀请码、请勿重复生成','%\x27\x20OR\x20id\x20=\x20\x27','endOf','39684pKHOnT','超级管理员','绑定微信失败、请联系管理员！','invitedRewardVip','size','inviteSendStatus','../../common/constants/model.constant','ids','userCount','valueOf','\x20AND\x20u.saasId\x20=\x20','用户不存在！','inviteRewardVip','../../common/store',']成功!','test','type1','VIP_EXPIRE','key','violationCount','../redisCache/redisCache.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','checkUserStatus','重置密码失败！','用户名\x09密码\x0a','saasName','TTS','access','user','5xjHkZt','createBatch','isVerifyEmail','bindWx','status','registerVerifyEmailFrom','rolePage','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','countByInviteCode','userId','push','VIDEO','createUser','Draw','roleDel','type2','账号注册时密码不能为空！','subscriber','getOpenIdByUserId','has','../../common/constants/redisKey.constant','disabled','UserService','queryUserInfoById','\x20AND\x20username\x20LIKE\x20\x27%','length','超级管理员不可被操作！','不可将用户置为未激活状态！','isManage','PENDING','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','findBy','10510044iKBCFf','Registration','insertAccountLog','getUserById','createdAt','getSaasById','Like','saasEntity','getUserStatus','UserBalanceService','UserEntity','queryUserByUsername','miniOpenId','updateUserPsd','map','redisCacheService','globalConfigService','getOwnPropertyDescriptor','fast_vip_free','\x20AND\x20u.createdAt\x20<=\x20\x27','registerVerifyEmailDesc','userInitVip','封面任务','filter','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27','score','includes','邮箱已被使用！','fast_mjDeduction','用户名已存在、请更换用户名！','class-validator','\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%','UserFavoriteEntity','Tool','%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%','changeScore4registe','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20AND\x20role\x20=\x20\x27','修改用户信息成功！','../../common/utils','AND\x20email\x20LIKE\x20\x27%','decorate','%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','relax','InvitationReward','description','domain','Tts','FORBIDDEN','register','vipFreeNum','生成邀请码失败，请重新试一次吧！','cloneDeep'];_0x1b05=function(){return _0x3b62ea;};return _0x1b05();}const globalConfig_service_1=require(_0x577ddf(0x1ba)),user_constant_1=require(_0x577ddf(0x196)),mailer_1=require('@nestjs-modules/mailer'),verification_service_1=require(_0x577ddf(0x152)),common_1=require('@nestjs/common'),typeorm_1=require(_0x577ddf(0x1ee)),typeorm_2=require(_0x577ddf(0x1ad)),user_entity_1=require(_0x577ddf(0x156)),bcrypt=require('bcryptjs'),_=require(_0x577ddf(0x1b9)),verification_constant_1=require(_0x577ddf(0x19a)),userBalance_service_1=require(_0x577ddf(0x1cb)),utils_1=require(_0x577ddf(0xeb)),balance_constant_1=require('../../common/constants/balance.constant'),class_validator_1=require(_0x577ddf(0xe2)),redisKey_constant_1=require(_0x577ddf(0x263)),redisCache_service_1=require(_0x577ddf(0x246)),model_constant_1=require(_0x577ddf(0x238)),midjourney_constant_1=require(_0x577ddf(0x1a6)),user_init_vip_entity_1=require(_0x577ddf(0x202)),axios_1=require(_0x577ddf(0x1bf)),date_1=require(_0x577ddf(0x108)),saas_entity_1=require(_0x577ddf(0x200)),role_entity_1=require(_0x577ddf(0x139)),store_1=require(_0x577ddf(0x23f)),nestjs_cls_1=require(_0x577ddf(0x11f)),Role_constant_1=require('../../common/constants/Role.constant'),userFavorite_entity_1=require(_0x577ddf(0x1e6));let UserService=class UserService{constructor(_0xfcb963,_0x454ad1,_0x367a5b,_0x4b9f03,_0xdb6311,_0x328b7f,_0x4d0214,_0x3e2ea3,_0x7a0708,_0x25e165,_0x67a36b,_0x3690fd,_0x48d073){const _0xecf8f0=_0x577ddf;this[_0xecf8f0(0x260)]=_0xfcb963,this[_0xecf8f0(0x128)]=_0x454ad1,this[_0xecf8f0(0xcb)]=_0x367a5b,this[_0xecf8f0(0x204)]=_0x4b9f03,this[_0xecf8f0(0x137)]=_0xdb6311,this[_0xecf8f0(0x219)]=_0x328b7f,this['clsService']=_0x4d0214,this['mailerService']=_0x3e2ea3,this['redisCacheService']=_0x7a0708,this[_0xecf8f0(0xfd)]=_0x25e165,this[_0xecf8f0(0xd4)]=_0x67a36b,this['verificationService']=_0x3690fd,this[_0xecf8f0(0x1ef)]=_0x48d073;}[_0x577ddf(0x105)](){const _0x2f7178=_0x577ddf;console['log'](_0x2f7178(0x205)),this['connection'][_0x2f7178(0x216)](_0x2f7178(0xc2)+Role_constant_1['ERole'][_0x2f7178(0x1fe)]+_0x2f7178(0x222)+Role_constant_1[_0x2f7178(0x11b)][_0x2f7178(0xfc)]+_0x2f7178(0xdc)+Role_constant_1[_0x2f7178(0x11b)][_0x2f7178(0x1ca)]+_0x2f7178(0x1ff));const _0x4fa7bb=bcrypt['hashSync'](_0x2f7178(0x151),0xa);this[_0x2f7178(0x1ef)]['query']('INSERT\x20IGNORE\x20INTO\x20users\x20(username,\x20password,\x20status,\x20email,\x20role)\x20VALUES\x20(\x27super\x27,\x20\x27'+_0x4fa7bb+_0x2f7178(0x170)+Role_constant_1['ERole'][_0x2f7178(0x1fe)]+'\x27)'),this['initSaasMap'](),this['subscriber'][_0x2f7178(0x1b5)](_0x2f7178(0x181),async _0x1c8f42=>{const _0x323f97=_0x2f7178;if(_0x1c8f42['startsWith'](redisKey_constant_1[_0x323f97(0x243)])){const _0x1a2577=_0x1c8f42[_0x323f97(0x1ae)](redisKey_constant_1[_0x323f97(0x243)],'');this['userEntity']['update']({'id':Number(_0x1a2577)},{'vipExpire':null});}});}async[_0x577ddf(0x16e)](){const _0x2d2e09=_0x577ddf,_0x5ab704=await this[_0x2d2e09(0xcb)][_0x2d2e09(0x213)]({'where':{'deleteFlag':0x0}});store_1[_0x2d2e09(0x100)]['clear'](),_0x5ab704['forEach'](_0x4b2dfc=>store_1[_0x2d2e09(0x100)][_0x2d2e09(0x121)](_0x4b2dfc[_0x2d2e09(0xf2)],_0x4b2dfc['id'])),store_1[_0x2d2e09(0x100)][_0x2d2e09(0x121)](process[_0x2d2e09(0x1c6)][_0x2d2e09(0x1d8)],0x0);}['getEntity'](){return this['userEntity'];}async[_0x577ddf(0x1ed)](_0x467e66){const _0x49015f=_0x577ddf;if(!_0x467e66['length'])return[];return this[_0x49015f(0xcb)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x467e66)}});}async['saasPage'](_0x2ac432){const _0x4628d6=_0x577ddf,{page:page=0x1,size:size=0x14,keyword:_0x344acd}=_0x2ac432;let _0xc93187;_0x344acd?_0xc93187=[{'deleteFlag':0x0,'name':(0x0,typeorm_2[_0x4628d6(0xca)])('%'+_0x344acd+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2['Like'])('%'+_0x344acd+'%')}]:_0xc93187={'deleteFlag':0x0};const [_0x4d5268,_0x30a3fd]=await this[_0x4628d6(0xcb)]['findAndCount']({'where':_0xc93187,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x4628d6(0x13f)}});if(!_0x4d5268[_0x4628d6(0xbd)])return{'rows':[],'count':_0x30a3fd};const _0xead710=_0x4d5268[_0x4628d6(0xd2)](_0x5e0418=>_0x5e0418['id']),_0x49578d=new Map(),_0x3fcca6=await this[_0x4628d6(0x128)][_0x4628d6(0x213)]({'where':{'saasId':(0x0,typeorm_2['In'])(_0xead710),'role':Role_constant_1[_0x4628d6(0x11b)][_0x4628d6(0xfc)]}});_0x3fcca6['forEach'](_0x59c7d0=>{const _0x55122b=_0x4628d6;_0x49578d['set'](_0x59c7d0[_0x55122b(0x1b3)],_0x59c7d0);});const _0x50f2d8=new Map(),_0x3195d6=await this[_0x4628d6(0x1ef)]['query'](_0x4628d6(0x18d));_0x3195d6[_0x4628d6(0x228)](_0x54eb16=>_0x50f2d8['set'](_0x54eb16[_0x4628d6(0x1b3)],_0x54eb16[_0x4628d6(0x14b)]));const _0x129009=_0x4d5268[_0x4628d6(0xd2)](_0x270315=>{const _0x16c376=_0x4628d6;let _0x4ca0ea=null,_0x30ae29=null,_0x4fc5b2=null,_0x5119f6=null;const _0x1bcdf9=_0x49578d[_0x16c376(0x14c)](_0x270315['id']);return _0x1bcdf9&&(_0x4ca0ea=_0x1bcdf9[_0x16c376(0x1bc)],_0x30ae29=_0x1bcdf9[_0x16c376(0x19f)],_0x4fc5b2=_0x1bcdf9[_0x16c376(0x229)],_0x5119f6=_0x1bcdf9[_0x16c376(0x110)]),{..._0x270315,'username':_0x4ca0ea,'nickname':_0x30ae29,'phone':_0x4fc5b2,'email':_0x5119f6,'userCount':_0x50f2d8[_0x16c376(0x14c)](_0x270315['id'])||0x0};});return{'rows':_0x129009,'count':_0x30a3fd};}async[_0x577ddf(0xc9)](_0x59143d){const _0x3ad0d5=_0x577ddf;return this[_0x3ad0d5(0xcb)][_0x3ad0d5(0x13c)]({'where':{'id':_0x59143d}});}async['saasSave'](_0x2b5c35){const _0x20b663=_0x577ddf,_0x37528b=(0x0,utils_1[_0x20b663(0x150)])(this[_0x20b663(0x1a8)]);if(_0x37528b!==0x0)throw new common_1['HttpException'](_0x20b663(0x16d),common_1['HttpStatus'][_0x20b663(0xf4)]);return await this['saasEntity']['save'](_0x2b5c35),this[_0x20b663(0x16e)](),!![];}async[_0x577ddf(0x210)](_0x1de433){const _0x1295b9=_0x577ddf,_0x1c1690=(0x0,utils_1[_0x1295b9(0x150)])(this['clsService']);return await this['saasEntity'][_0x1295b9(0x1d7)]({..._0x1de433,'id':_0x1c1690}),!![];}async['saasDel'](_0xb5394a){const _0x33586e=_0x577ddf;if(!_0xb5394a[_0x33586e(0x239)]||!_0xb5394a['ids'][_0x33586e(0xbd)])return!![];return await this[_0x33586e(0xcb)][_0x33586e(0x1c0)]({'id':(0x0,typeorm_2['In'])(_0xb5394a[_0x33586e(0x239)])},{'deleteFlag':0x1}),!![];}async[_0x577ddf(0x255)](_0x516d89,_0xfef13b){const _0x430f28=_0x577ddf,_0x81c525=await(0x0,utils_1['getReqSaasId'])(this['clsService']),{page:page=0x1,size:size=0x14,keyword:_0x3afcf2}=_0xfef13b;let _0x52d437='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20'+_0x81c525+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27'+Role_constant_1['ERole']['VIEWER']+_0x430f28(0x1bb);_0x3afcf2&&(_0x52d437=_0x430f28(0x132)+_0x81c525+'\x20AND\x20(\x20`name`\x20LIKE\x20\x27%'+_0x3afcf2+_0x430f28(0x141)+_0x3afcf2+_0x430f28(0x1a7)+Role_constant_1['ERole'][_0x430f28(0x1ca)]+_0x430f28(0x225)+_0x3afcf2+'%\x27\x20OR\x20`code`\x20LIKE\x20\x27%'+_0x3afcf2+_0x430f28(0xee));const _0xb02b69=await this[_0x430f28(0x1ef)][_0x430f28(0x216)](_0x430f28(0x1f7)+_0x52d437+_0x430f28(0x14d)),_0x21a19d=await this[_0x430f28(0x1ef)][_0x430f28(0x216)](_0x430f28(0x184)+_0x52d437+_0x430f28(0x203)+size+_0x430f28(0x192)+(page-0x1)*size+_0x430f28(0x14d)),_0x429f93=_0x21a19d[_0x430f28(0xd2)](_0x51c33a=>_0x51c33a['id']);if(_0x429f93['length']){const _0xb561e5=await this[_0x430f28(0xcb)][_0x430f28(0x13c)]({'where':{'id':_0x516d89[_0x430f28(0x24e)][_0x430f28(0x1b3)]}}),_0x551f17=new Map(),_0x18e2ef=await this[_0x430f28(0x1ef)][_0x430f28(0x216)](_0x430f28(0x166));_0x18e2ef['forEach'](_0x169869=>_0x551f17[_0x430f28(0x121)](_0x169869[_0x430f28(0x1f0)],_0x169869['count'])),_0x21a19d[_0x430f28(0x228)](_0x1c58c5=>{const _0x2435d0=_0x430f28;_0x1c58c5[_0x2435d0(0x24b)]=_0xb561e5?.[_0x2435d0(0x1a2)]||'平台',_0x1c58c5[_0x2435d0(0x23a)]=_0x551f17['get'](_0x1c58c5[_0x2435d0(0x1b7)])||0x0;});}return{'rows':_0x21a19d,'count':Number(_0xb02b69[0x0]?.['count']||0x0)};}async['roleSave'](_0x5b9958,_0x163ae5){const _0x30564d=_0x577ddf,_0x4cdf50=await(0x0,utils_1[_0x30564d(0x150)])(this[_0x30564d(0x1a8)]);if([Role_constant_1['ERole'][_0x30564d(0x1fe)][_0x30564d(0x23b)](),Role_constant_1['ERole'][_0x30564d(0xfc)]['valueOf'](),Role_constant_1[_0x30564d(0x11b)][_0x30564d(0x1ca)][_0x30564d(0x23b)]()][_0x30564d(0xde)](_0x163ae5[_0x30564d(0x1b7)])&&_0x4cdf50!==0x0)throw new common_1[(_0x30564d(0x177))]('当前角色编码不可用，请使用其他角色编码',common_1[_0x30564d(0x15c)][_0x30564d(0x1a3)]);return await this[_0x30564d(0x204)]['save']({..._0x163ae5,'saasId':_0x4cdf50,'disabled':_0x163ae5[_0x30564d(0xb9)]??0x0}),!![];}async[_0x577ddf(0x25d)](_0x43b1ae,_0x1ba2d6){const _0x5be777=_0x577ddf,_0x33907d=await(0x0,utils_1[_0x5be777(0x150)])(this[_0x5be777(0x1a8)]);if(!_0x1ba2d6[_0x5be777(0x239)]||!_0x1ba2d6['ids'][_0x5be777(0xbd)])return!![];const _0x484985=await this[_0x5be777(0x204)][_0x5be777(0x213)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1ba2d6[_0x5be777(0x239)]),'saasId':_0x33907d}});if(!_0x484985[_0x5be777(0xbd)])return!![];const _0x39759d=_0x484985[_0x5be777(0xd2)](_0x464735=>_0x464735[_0x5be777(0x1b7)]),_0x4f147a=await this['userEntity'][_0x5be777(0x14b)]({'where':{'role':(0x0,typeorm_2['In'])(_0x39759d),'saasId':_0x33907d}});if(_0x4f147a>0x0)throw new common_1[(_0x5be777(0x177))](_0x5be777(0x197),common_1[_0x5be777(0x15c)][_0x5be777(0x1a3)]);return await this[_0x5be777(0x204)][_0x5be777(0x1d9)]({'id':(0x0,typeorm_2['In'])(_0x1ba2d6['ids'])}),!![];}async[_0x577ddf(0x1f4)](_0x56fa6d){const _0x3b7df9=_0x577ddf;if(!_0x56fa6d[_0x3b7df9(0xbd)])return[];const _0x2a5b3c=await this[_0x3b7df9(0x128)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x56fa6d)}});return _0x2a5b3c;}async['createUserAndVerifycation'](_0x6ef7d0,_0x2fbe7f){const _0x1351a6=_0x577ddf,{username:_0x41d91d,email:_0xb2cdc2,password:_0x3c7be7,invitedBy:_0x5c8425,client:client=0x0}=_0x6ef7d0;if(_0x5c8425){const _0x196ba9=await this[_0x1351a6(0x128)][_0x1351a6(0x13c)]({'where':{'inviteCode':_0x5c8425}});if(!_0x196ba9)throw new common_1[(_0x1351a6(0x177))](_0x1351a6(0x187),common_1['HttpStatus'][_0x1351a6(0x1a3)]);}const _0x4d419c=[{'username':_0x41d91d},{'email':_0xb2cdc2}],_0x366dbd=await this[_0x1351a6(0x128)][_0x1351a6(0x13c)]({'where':_0x4d419c});if(_0x366dbd&&_0x366dbd[_0x1351a6(0x253)]!==user_constant_1['UserStatusEnum'][_0x1351a6(0xc1)])throw new common_1[(_0x1351a6(0x177))]('用户名或者邮箱已被注册！',common_1[_0x1351a6(0x15c)][_0x1351a6(0x1a3)]);try{const _0x5627d8=_[_0x1351a6(0xf8)](_0x6ef7d0),_0x116ce6=bcrypt[_0x1351a6(0x224)](_0x3c7be7,0xa),_0x4ac33a=(0x0,utils_1[_0x1351a6(0x1e4)])(_0x2fbe7f);_0x5627d8[_0x1351a6(0x1db)]=_0x116ce6,_0x5627d8[_0x1351a6(0x20e)]=_0x4ac33a,_0x5627d8['client']=client;let _0xb11351;if(!_0x366dbd){const _0x5d3583=await this[_0x1351a6(0xd4)]['getConfigByKeys']([_0x1351a6(0x214)]);_0x5627d8[_0x1351a6(0x154)]=_0x5d3583,_0xb11351=await this[_0x1351a6(0x128)][_0x1351a6(0x1d7)](_0x5627d8);}else _0xb11351=_0x366dbd;const _0x1b244b=await this[_0x1351a6(0xd4)][_0x1351a6(0x1fa)]([_0x1351a6(0x251),_0x1351a6(0x1b8),'registerVerifyEmailTitle',_0x1351a6(0xd8),_0x1351a6(0x254),'registerVerifyExpir']),_0x3ad8c5=_0x1b244b[_0x1351a6(0x251)]?Number(_0x1b244b[_0x1351a6(0x251)]):0x1;if(_0x3ad8c5){const _0x52fe6e=_0x1b244b['registerVerifyExpir']?Number(_0x1b244b[_0x1351a6(0x190)]):0x1e*0x3c,_0xa1cbdb=await this[_0x1351a6(0x11c)][_0x1351a6(0x18a)](_0xb11351,verification_constant_1[_0x1351a6(0x113)][_0x1351a6(0xc5)],_0x52fe6e),{code:_0x1b6bac,email:_0x1e00fc,id:_0x5bc759}=_0xa1cbdb,{registerVerifyEmailFrom:_0x1e5eab}=_0x1b244b;await this['mailerService'][_0x1351a6(0x13a)]({'to':_0x1e00fc,'subject':'来自'+_0x1e5eab+_0x1351a6(0x1f2),'template':_0x1351a6(0xf5),'context':{'baseUrl':_0x1b244b['registerBaseUrl'],'code':_0x1b6bac,'id':_0x5bc759,..._0x1b244b}});}else{const {id:_0x3fc2c9,invitedBy:_0x18f605}=_0xb11351;await this[_0x1351a6(0x1f5)](_0x3fc2c9,user_constant_1['UserStatusEnum'][_0x1351a6(0x145)]);let _0x4977bd;_0x18f605&&(_0x4977bd=await this[_0x1351a6(0x195)](_0x18f605)),await this[_0x1351a6(0xe7)](_0xb11351,_0x4977bd);}return _0xb11351;}catch(_0x23a43d){console['log'](_0x1351a6(0x199),_0x23a43d);throw _0x23a43d;}}async[_0x577ddf(0x13e)](_0x148723){const _0x5b55cf=_0x577ddf,{username:_0x32233e,password:_0x25068d,uid:uid=0x0,phone:_0x5c3341}=_0x148723;let _0x1a6301=null;if(uid>0x0){_0x1a6301=await this[_0x5b55cf(0x128)][_0x5b55cf(0x13c)]({'where':{'id':uid}});if(!_0x1a6301)throw new common_1[(_0x5b55cf(0x177))](_0x5b55cf(0x16c),common_1['HttpStatus'][_0x5b55cf(0x1a3)]);if(!bcrypt[_0x5b55cf(0x172)](_0x25068d,_0x1a6301[_0x5b55cf(0x1db)]))throw new common_1[(_0x5b55cf(0x177))](_0x5b55cf(0x206),common_1[_0x5b55cf(0x15c)][_0x5b55cf(0x1a3)]);}if(_0x32233e&&_0x25068d){const _0x4f6d30=[{'username':_0x32233e},{'email':_0x32233e}];_0x1a6301=await this[_0x5b55cf(0x128)][_0x5b55cf(0x13c)]({'where':_0x4f6d30});if(!_0x1a6301)throw new common_1[(_0x5b55cf(0x177))](_0x5b55cf(0x16c),common_1[_0x5b55cf(0x15c)][_0x5b55cf(0x1a3)]);if(!bcrypt['compareSync'](_0x25068d,_0x1a6301[_0x5b55cf(0x1db)]))throw new common_1[(_0x5b55cf(0x177))]('当前密码错误！',common_1[_0x5b55cf(0x15c)][_0x5b55cf(0x1a3)]);}if(_0x5c3341&&_0x25068d){const _0x14fbf2=[{'phone':_0x5c3341}];_0x1a6301=await this[_0x5b55cf(0x128)][_0x5b55cf(0x13c)]({'where':_0x14fbf2});if(!_0x1a6301)throw new common_1[(_0x5b55cf(0x177))](_0x5b55cf(0x16c),common_1[_0x5b55cf(0x15c)]['BAD_REQUEST']);if(!bcrypt[_0x5b55cf(0x172)](_0x25068d,_0x1a6301['password']))throw new common_1[(_0x5b55cf(0x177))](_0x5b55cf(0x206),common_1[_0x5b55cf(0x15c)][_0x5b55cf(0x1a3)]);}if(!_0x1a6301)throw new common_1[(_0x5b55cf(0x177))](_0x5b55cf(0x16c),common_1[_0x5b55cf(0x15c)]['BAD_REQUEST']);if(_0x1a6301[_0x5b55cf(0x253)]!==user_constant_1['UserStatusEnum'][_0x5b55cf(0x145)])throw new common_1[(_0x5b55cf(0x177))](user_constant_1['UserStatusErrMsg'][_0x1a6301[_0x5b55cf(0x253)]],common_1[_0x5b55cf(0x15c)]['BAD_REQUEST']);if(_0x1a6301[_0x5b55cf(0x1bc)]&&!_0x1a6301['lastLoginIp']){const _0x968c55=await this[_0x5b55cf(0x137)][_0x5b55cf(0x13c)]({'where':{'username':_0x1a6301['username']}});_0x968c55&&await this[_0x5b55cf(0x1ef)]['transaction'](async()=>{const _0x551666=_0x5b55cf;_0x968c55[_0x551666(0x1f1)]===-0x1?_0x1a6301['lifetimeVip']=0x1:_0x1a6301[_0x551666(0x162)]=(0x0,date_1[_0x551666(0x20a)])()[_0x551666(0x21b)](_0x968c55[_0x551666(0x1f1)],'day')['toDate'](),_0x1a6301=await this['userEntity'][_0x551666(0x1d7)](_0x1a6301),await this[_0x551666(0x137)]['delete']({'id':_0x968c55['id']});});}return _0x1a6301;}async['verifyUserPassword'](_0x24704d,_0x16bdf0){const _0x8f0b42=_0x577ddf,_0x495973=await this[_0x8f0b42(0x128)][_0x8f0b42(0x13c)]({'where':{'id':_0x24704d}});return bcrypt[_0x8f0b42(0x172)](_0x16bdf0,_0x495973[_0x8f0b42(0x1db)]);}async['updateUserStatus'](_0x5e3288,_0x449075){const _0x5b046b=_0x577ddf,_0x3d4895=await this[_0x5b046b(0x128)][_0x5b046b(0x1c0)]({'id':_0x5e3288},{'status':_0x449075});return _0x3d4895[_0x5b046b(0x1af)]>0x0;}async[_0x577ddf(0xcc)](_0x3365f5){const _0x3fc39a=_0x577ddf,_0x5017d8=await this[_0x3fc39a(0x128)][_0x3fc39a(0x13c)]({'where':{'id':_0x3365f5}});return _0x5017d8[_0x3fc39a(0x253)];}async[_0x577ddf(0xbb)](_0x5cdf39){const _0x47afa2=_0x577ddf;return await this[_0x47afa2(0x128)]['findOne']({'where':{'id':_0x5cdf39}});}async['queryUserInfoByIds'](_0x3ee156){const _0x3e7634=_0x577ddf;return await this[_0x3e7634(0x128)][_0x3e7634(0xc3)]({'id':(0x0,typeorm_2['In'])(_0x3ee156)});}async[_0x577ddf(0xcf)](_0x373175){const _0x3381cb=_0x577ddf;return await this[_0x3381cb(0x128)][_0x3381cb(0x13c)]({'where':{'username':_0x373175}});}async[_0x577ddf(0xd1)](_0x191f14){const _0x6f7801=_0x577ddf,{id:_0x47da5d,username:_0x1fa102,password:_0x27d9cd}=_0x191f14;return await this[_0x6f7801(0x128)][_0x6f7801(0x1c0)](_0x47da5d,{'username':_0x1fa102,'password':_0x27d9cd});}async[_0x577ddf(0x167)](_0xbfcad2){const _0x90ef5a=_0x577ddf;return await this['userEntity'][_0x90ef5a(0x13c)]({'where':{'id':_0xbfcad2}});}async[_0x577ddf(0x248)](_0x288ec2){const _0x4e6913=_0x577ddf,{id:_0x1d23e8,role:_0x365d9a}=_0x288ec2;if(_0x365d9a==='visitor')return!![];const _0x1cbda3=await this[_0x4e6913(0x128)][_0x4e6913(0x13c)]({'where':{'id':_0x1d23e8}});if(!_0x1cbda3)throw new common_1[(_0x4e6913(0x177))](_0x4e6913(0x140),common_1[_0x4e6913(0x15c)][_0x4e6913(0xf9)]);if(_0x1cbda3['status']===user_constant_1[_0x4e6913(0x10a)]['BLACKLISTED'])throw new common_1[(_0x4e6913(0x177))](_0x4e6913(0x175),common_1[_0x4e6913(0x15c)]['BAD_REQUEST']);if(_0x1cbda3[_0x4e6913(0x253)]===user_constant_1[_0x4e6913(0x10a)][_0x4e6913(0x22b)])throw new common_1['HttpException'](_0x4e6913(0x116),common_1[_0x4e6913(0x15c)][_0x4e6913(0x1a3)]);}async[_0x577ddf(0xc7)](_0x437179){const _0x4050dc=_0x577ddf;return await this[_0x4050dc(0x128)][_0x4050dc(0x13c)]({'where':{'id':_0x437179}});}['getUserListByIds'](_0x3c2f0c){return this['userEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x3c2f0c)}});}async[_0x577ddf(0x149)](_0x6d900f){const _0x1220ea=_0x577ddf;return this[_0x1220ea(0x128)][_0x1220ea(0x13c)]({'where':{'inviteCode':_0x6d900f}});}async['getUserOpenId'](_0x2dfbea){const _0x9362b7=_0x577ddf,_0x3a3189=(0x0,utils_1['getReqSaasId'])(this[_0x9362b7(0x1a8)]);return await this['userEntity'][_0x9362b7(0x13c)]({'where':{'openId':_0x2dfbea,'saasId':_0x3a3189}});}async[_0x577ddf(0x257)](_0x829532){const _0x203bd6=_0x577ddf;return this['userEntity'][_0x203bd6(0x14b)]({'where':{'invitedBy':_0x829532}});}async[_0x577ddf(0x17e)](_0x349001,_0x44fb7b){const _0x26a6dd=_0x577ddf,{id:_0x5137df}=_0x44fb7b[_0x26a6dd(0x24e)],_0xc239af=await this['userEntity'][_0x26a6dd(0x13c)]({'where':{'id':_0x5137df}});if(!_0xc239af)throw new common_1['HttpException'](_0x26a6dd(0x193),common_1['HttpStatus'][_0x26a6dd(0x1a3)]);if(_0x349001[_0x26a6dd(0x1bc)]&&_0xc239af[_0x26a6dd(0x1bc)]===_0x349001[_0x26a6dd(0x1bc)])throw new common_1['HttpException'](_0x26a6dd(0x21d),common_1['HttpStatus'][_0x26a6dd(0x1a3)]);if(_0x349001[_0x26a6dd(0x1bc)]){const _0x2def8d=await this['userEntity'][_0x26a6dd(0x13c)]({'where':{'username':_0x349001['username'],'id':(0x0,typeorm_2[_0x26a6dd(0x165)])(_0x5137df)}});if(_0x2def8d)throw new common_1['HttpException'](_0x26a6dd(0x21a),common_1[_0x26a6dd(0x15c)][_0x26a6dd(0x1a3)]);}const _0x45c5e2=await this[_0x26a6dd(0x128)][_0x26a6dd(0x1c0)]({'id':_0x5137df},_0x349001);if(_0x45c5e2['affected']<=0x0)throw new common_1[(_0x26a6dd(0x177))](_0x26a6dd(0x1be),common_1[_0x26a6dd(0x15c)][_0x26a6dd(0x1a3)]);return _0x26a6dd(0xea);}async[_0x577ddf(0x102)](_0x3546be,_0x255e25){const _0x1b43ad=_0x577ddf,_0x494da2=bcrypt[_0x1b43ad(0x224)](_0x255e25,0xa),_0x49e979=await this[_0x1b43ad(0x128)]['update']({'id':_0x3546be},{'password':_0x494da2});if(_0x49e979[_0x1b43ad(0x1af)]<=0x0)throw new common_1[(_0x1b43ad(0x177))](_0x1b43ad(0x1b6),common_1[_0x1b43ad(0x15c)]['BAD_REQUEST']);}async['favorite'](_0x3c8cca,_0x4f4723){const _0x55a54f=_0x577ddf;try{const _0x30c757=await this[_0x55a54f(0x219)][_0x55a54f(0x13c)]({'where':{'userId':_0x3c8cca[_0x55a54f(0x24e)]['id'],'relateId':_0x4f4723[_0x55a54f(0x1e0)],'relateType':_0x4f4723['relateType']}});return _0x30c757?await this[_0x55a54f(0x219)]['delete']({'id':_0x30c757['id']}):await this[_0x55a54f(0x219)]['save']({'userId':_0x3c8cca[_0x55a54f(0x24e)]['id'],'relateId':_0x4f4723[_0x55a54f(0x1e0)],'relateType':_0x4f4723[_0x55a54f(0x164)]}),!![];}catch(_0x3fdb87){throw new common_1[(_0x55a54f(0x177))](_0x3fdb87[_0x55a54f(0x1ec)],common_1[_0x55a54f(0x15c)]['BAD_REQUEST']);}}async[_0x577ddf(0x19b)](_0xda3db3,_0x17b3c0,_0xaaa9e6){const _0x4239c2=_0x577ddf;return this[_0x4239c2(0x219)][_0x4239c2(0x213)]({'where':{'userId':_0xda3db3,'relateType':_0x17b3c0,'relateId':(0x0,typeorm_2['In'])(_0xaaa9e6)}});}async['genInviteCode'](_0x5540b8){const _0x555766=_0x577ddf,{id:_0x3d8024}=_0x5540b8[_0x555766(0x24e)],_0x4092af=await this[_0x555766(0x128)][_0x555766(0x13c)]({'where':{'id':_0x3d8024}});if(!_0x4092af||_0x4092af[_0x555766(0x17d)])throw new common_1[(_0x555766(0x177))](_0x555766(0x22f),common_1['HttpStatus']['BAD_REQUEST']);const _0x2b4755=(0x0,utils_1[_0x555766(0x218)])(),_0x545834=await this[_0x555766(0x128)][_0x555766(0x13c)]({'where':{'inviteCode':_0x2b4755}});if(_0x545834)throw new common_1[(_0x555766(0x177))](_0x555766(0xf7),common_1[_0x555766(0x15c)][_0x555766(0x1a3)]);const _0x4b95aa=await this[_0x555766(0x128)][_0x555766(0x1c0)]({'id':_0x3d8024},{'inviteCode':_0x2b4755});if(_0x4b95aa[_0x555766(0x1af)]<=0x0)throw new common_1[(_0x555766(0x177))](_0x555766(0xf7),common_1[_0x555766(0x15c)]['BAD_REQUEST']);return _0x2b4755;}async[_0x577ddf(0x15a)](_0x5a000c,_0x4cea13){const _0x74ae4d=_0x577ddf;try{const {id:_0x2bd413}=_0x5a000c[_0x74ae4d(0x24e)],{page:page=0x1,size:size=0xa}=_0x4cea13,_0x58fe34=await this['userEntity'][_0x74ae4d(0x13c)]({'where':{'id':_0x2bd413}}),{inviteCode:_0x175703}=_0x58fe34;if(!_0x175703)return[];const [_0x5105da,_0x9b879]=await this[_0x74ae4d(0x128)]['findAndCount']({'where':{'inviteCode':_0x175703},'order':{'id':_0x74ae4d(0x13f)},'select':['username',_0x74ae4d(0x110),_0x74ae4d(0xc8),'status',_0x74ae4d(0x154)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x74ae4d(0x201)])(_0x5105da)['map'](_0x5e65e7=>{const _0x4f85d2=_0x74ae4d;return _0x5e65e7[_0x4f85d2(0x110)]=(0x0,utils_1[_0x4f85d2(0x1e3)])(_0x5e65e7['email']),_0x5e65e7;}),{'rows':_0x5105da,'count':_0x9b879};}catch(_0x102cd1){console['log'](_0x74ae4d(0x199),_0x102cd1);throw new common_1[(_0x74ae4d(0x177))](_0x74ae4d(0x114),common_1[_0x74ae4d(0x15c)]['BAD_REQUEST']);}}async[_0x577ddf(0x215)](_0x41384c,_0x47fe4a,_0x514bd8){const _0x3b2bde=_0x577ddf,_0x4806ee=(0x0,utils_1[_0x3b2bde(0x150)])(this[_0x3b2bde(0x1a8)]),{page:page=0x1,size:size=0x14,startTime:_0x49ea4d,endTime:_0x51d4e0,saasId:_0x46a780,keyword:_0x3dab36,inviterKeyword:_0x19bd93}=_0x47fe4a,_0x3a36b2=_0x3b2bde(0x247)+(_0x514bd8?_0x3b2bde(0x182)+_0x514bd8:'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x51d4e0?_0x3b2bde(0xd7)+_0x51d4e0+'\x27':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x49ea4d?'\x20AND\x20u.createdAt\x20>=\x20\x27'+_0x49ea4d+'\x27':'')+_0x3b2bde(0x130)+(_0x4806ee!==0x0?_0x3b2bde(0x23c)+_0x4806ee:(0x0,utils_1[_0x3b2bde(0x12b)])(_0x46a780)?_0x3b2bde(0x23c)+_0x46a780:'')+_0x3b2bde(0x130)+(_0x3dab36?'\x20AND\x20(\x20u.username\x20LIKE\x20\x27%'+_0x3dab36+'%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%'+_0x3dab36+_0x3b2bde(0xe6)+_0x3dab36+'%\x27\x20OR\x20u.email\x20LIKE\x20\x27%'+_0x3dab36+_0x3b2bde(0x186):'')+_0x3b2bde(0x130)+(_0x19bd93?_0x3b2bde(0xe3)+_0x19bd93+_0x3b2bde(0x1c9)+_0x19bd93+_0x3b2bde(0x17b)+_0x19bd93+_0x3b2bde(0x15b)+_0x19bd93+_0x3b2bde(0x186):'')+_0x3b2bde(0x14d),_0x178bb8=_0x3b2bde(0x178)+_0x3a36b2+_0x3b2bde(0x14d),_0x39444d='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3a36b2+_0x3b2bde(0x256)+size+_0x3b2bde(0x192)+(page-0x1)*size+_0x3b2bde(0x14d),_0x4a0d2d=await this['connection'][_0x3b2bde(0x216)](_0x178bb8),_0x1f06f6=await this[_0x3b2bde(0x1ef)][_0x3b2bde(0x216)](_0x39444d);return!(0x0,utils_1[_0x3b2bde(0x12d)])(this[_0x3b2bde(0x1a8)])&&_0x1f06f6[_0x3b2bde(0x228)](_0x3f07d4=>{const _0x593335=_0x3b2bde;_0x3f07d4[_0x593335(0x229)]=(0x0,utils_1['hideString'])(_0x3f07d4[_0x593335(0x229)]),_0x3f07d4[_0x593335(0x110)]=(0x0,utils_1[_0x593335(0x1a0)])(_0x3f07d4['email']),_0x3f07d4[_0x593335(0x1f9)]=(0x0,utils_1[_0x593335(0x1a0)])(_0x3f07d4[_0x593335(0x1f9)]),_0x3f07d4[_0x593335(0x22e)]=(0x0,utils_1['hideString'])(_0x3f07d4['inviterEmail']);}),{'rows':_0x1f06f6,'count':Number(_0x4a0d2d[0x0]?.['count']||0x0)};}async[_0x577ddf(0x188)](_0x47f17b){const _0x41822e=_0x577ddf,_0x42d1b5=await this[_0x41822e(0x128)]['findOne']({'where':{'inviteCode':_0x47f17b}});if(!_0x42d1b5)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x42d1b5,_0x1eefaf=await this[_0x41822e(0x128)][_0x41822e(0x1c0)]({'inviteCode':_0x47f17b},{'inviteLinkCount':inviteLinkCount+0x1});return _0x1eefaf['affected']?0x1:0x0;}async[_0x577ddf(0x195)](_0x110428){const _0x2c0580=_0x577ddf;return await this[_0x2c0580(0x128)][_0x2c0580(0x13c)]({'where':{'inviteCode':_0x110428}});}async[_0x577ddf(0x10f)](_0x58c921,_0x33a533){const _0x36f90c=_0x577ddf,_0x3b34e6=(0x0,utils_1['getReqSaasId'])(this[_0x36f90c(0x1a8)]);let {page:page=0x1,size:size=0xa,username:_0x47c4e6,phone:_0x2f0e60,email:_0x2ff2c4,status:_0x517273,keyword:_0x542a14,roleCode:_0x31d377,vip:_0x231acc,saasId:_0x4f0fb8}=_0x58c921,_0x5ba097='1\x20=\x201';_0x517273&&(_0x5ba097=_0x5ba097+('\x20AND\x20`status`\x20=\x20'+_0x517273));_0x31d377&&(_0x5ba097=_0x5ba097+(_0x36f90c(0xe9)+_0x31d377+'\x27'));_0x231acc&&(_0x231acc=Number(_0x231acc));if(_0x231acc===0x1)_0x5ba097=_0x5ba097+_0x36f90c(0x115);else _0x231acc===0x0&&(_0x5ba097=_0x5ba097+'\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL');_0x542a14?_0x5ba097=_0x5ba097+(_0x36f90c(0x147)+_0x542a14+'%\x27\x20OR\x20nickname\x20LIKE\x20\x27%'+_0x542a14+'%\x27\x20OR\x20phone\x20LIKE\x20\x27%'+_0x542a14+_0x36f90c(0x1e1)+_0x542a14+_0x36f90c(0x230)+_0x542a14+'\x27)'):(_0x47c4e6&&(_0x5ba097=_0x5ba097+(_0x36f90c(0xbc)+_0x47c4e6+'%\x27')),_0x2ff2c4&&(_0x5ba097=_0x5ba097+(_0x36f90c(0xec)+_0x2ff2c4+'%\x27')),_0x2f0e60&&(_0x5ba097=_0x5ba097+(_0x36f90c(0x1bd)+_0x2f0e60+'%\x27')));(0x0,utils_1['isPlatform'])(this[_0x36f90c(0x1a8)])?(0x0,utils_1[_0x36f90c(0xc0)])(this[_0x36f90c(0x1a8)])&&_0x4f0fb8&&(_0x5ba097=_0x5ba097+(_0x36f90c(0x1c3)+_0x4f0fb8)):_0x5ba097=_0x5ba097+('\x20AND\x20saasId\x20=\x20'+_0x3b34e6);const _0xa1a50c=await this[_0x36f90c(0x1ef)][_0x36f90c(0x216)](_0x36f90c(0x118)+_0x5ba097+_0x36f90c(0xe8)),_0x3fb9ce=await this[_0x36f90c(0x1ef)][_0x36f90c(0x216)](_0x36f90c(0x136)+_0x5ba097+_0x36f90c(0x10b)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x36f90c(0x14d)),_0x1b826e=[],_0x4c5879=(0x0,utils_1[_0x36f90c(0x12d)])(this[_0x36f90c(0x1a8)]),_0xc9c038=new Map([[Role_constant_1[_0x36f90c(0x11b)]['AGENT'],_0x36f90c(0x208)],[Role_constant_1['ERole'][_0x36f90c(0x1fe)],_0x36f90c(0x233)],[Role_constant_1[_0x36f90c(0x11b)][_0x36f90c(0x1ca)],_0x36f90c(0x1c7)]]);for(let _0x14b55b=0x0;_0x14b55b<_0x3fb9ce['length'];_0x14b55b++){const _0x31fc4e=_0x3fb9ce[_0x14b55b];let _0x32d554=_0x36f90c(0x1c7);if(_0xc9c038['has'](_0x31fc4e['role']))_0x32d554=_0xc9c038[_0x36f90c(0x14c)](_0x31fc4e[_0x36f90c(0x1f0)]);else{const _0x138709=await this[_0x36f90c(0x204)][_0x36f90c(0x13c)]({'where':{'code':_0x31fc4e['role'],'saasId':_0x31fc4e[_0x36f90c(0x1b3)]}});_0x32d554=_0x138709[_0x36f90c(0x1a2)];}_0x1b826e[_0x36f90c(0x259)]({..._0x31fc4e,'roleName':_0x32d554,'isBindWx':!!_0x31fc4e?.[_0x36f90c(0x1d1)],'password':_0x31fc4e['password']?_0x36f90c(0x157):'no','email':_0x4c5879?_0x31fc4e[_0x36f90c(0x110)]:(0x0,utils_1[_0x36f90c(0x1e3)])(_0x31fc4e[_0x36f90c(0x110)]),'phone':_0x4c5879?_0x31fc4e[_0x36f90c(0x229)]:(0x0,utils_1[_0x36f90c(0x1e3)])(_0x31fc4e[_0x36f90c(0x229)]),'lastLoginIp':_0x4c5879?_0x31fc4e['lastLoginIp']:(0x0,utils_1['maskIpAddress'])(_0x31fc4e['lastLoginIp'])});}return{'rows':_0x1b826e,'count':Number(_0xa1a50c[0x0]?.[_0x36f90c(0x14b)]||0x0)};}async['queryByPage'](_0x1fe626){const _0x4d83e4=_0x577ddf,{page:page=0x1,size:size=0xa,username:_0x5965a1,status:_0x3616d1}=_0x1fe626;let _0x8f8c39={};_0x5965a1&&Object[_0x4d83e4(0x16b)](_0x8f8c39,{'username':(0x0,typeorm_2[_0x4d83e4(0xca)])('%'+_0x5965a1+'%')}),_0x3616d1&&Object[_0x4d83e4(0x16b)](_0x8f8c39,{'status':_0x3616d1});const [_0x3a4f56,_0x3a51e7]=await this[_0x4d83e4(0x128)][_0x4d83e4(0x1fc)]({'skip':(page-0x1)*size,'where':_0x8f8c39,'take':size,'cache':!![],'order':{'createdAt':_0x4d83e4(0x13f)},'select':['username',_0x4d83e4(0x1db),_0x4d83e4(0x1f0),_0x4d83e4(0x253),'id']});return{'rows':_0x3a4f56,'count':_0x3a51e7};}async[_0x577ddf(0x148)]({id:_0x535164}){const _0xcbd5ee=_0x577ddf;let _0x2fe863,_0x54f1a3;const _0x12b0aa=await this[_0xcbd5ee(0x128)][_0xcbd5ee(0x13c)]({'where':{'id':_0x535164}});if(!_0x12b0aa)throw new common_1[(_0xcbd5ee(0x177))](_0xcbd5ee(0x1dc),common_1[_0xcbd5ee(0x15c)][_0xcbd5ee(0xf9)]);if((0x0,utils_1['shouldAccess'])(_0x12b0aa[_0xcbd5ee(0x1f0)])){const _0x80237=_0x12b0aa[_0xcbd5ee(0x1f0)]===Role_constant_1['ERole'][_0xcbd5ee(0xfc)]?0x0:_0x12b0aa[_0xcbd5ee(0x1b3)],_0x5b0955=await this[_0xcbd5ee(0x204)]['findOne']({'where':{'code':_0x12b0aa[_0xcbd5ee(0x1f0)],'saasId':_0x80237}});if(!_0x5b0955)throw new common_1[(_0xcbd5ee(0x177))](_0xcbd5ee(0x12a),common_1['HttpStatus'][_0xcbd5ee(0x1a3)]);_0x2fe863=_0x5b0955[_0xcbd5ee(0x24d)],_0x54f1a3=_0x5b0955[_0xcbd5ee(0x1f6)];}return{..._0x12b0aa,'access':_0x2fe863,'accessLabel':_0x54f1a3,'isBindWx':!!_0x12b0aa?.['openId'],'password':_0x12b0aa['password']?_0xcbd5ee(0x157):'no'};}async[_0x577ddf(0x127)](_0x13d80b){const _0xfe93dd=_0x577ddf;return await this[_0xfe93dd(0x128)][_0xfe93dd(0x13c)]({'where':{'username':_0x13d80b}});}async[_0x577ddf(0x155)](_0x2bed3c){const _0x5c3086=_0x577ddf,{id:_0x4b7785,status:_0x26dd92}=_0x2bed3c,_0x59e5fd=await this[_0x5c3086(0x128)][_0x5c3086(0x13c)]({'where':{'id':_0x4b7785}});if(!_0x59e5fd)throw new common_1[(_0x5c3086(0x177))](_0x5c3086(0x23d),common_1[_0x5c3086(0x15c)][_0x5c3086(0x1a3)]);if(_0x59e5fd[_0x5c3086(0x1f0)]===Role_constant_1[_0x5c3086(0x11b)][_0x5c3086(0x1fe)])throw new common_1[(_0x5c3086(0x177))](_0x5c3086(0xbe),common_1['HttpStatus']['BAD_REQUEST']);if(_0x59e5fd[_0x5c3086(0x253)]===user_constant_1[_0x5c3086(0x10a)][_0x5c3086(0xc1)])throw new common_1[(_0x5c3086(0x177))]('未激活用户不可手动变更状态！',common_1[_0x5c3086(0x15c)][_0x5c3086(0x1a3)]);if(_0x26dd92===user_constant_1[_0x5c3086(0x10a)][_0x5c3086(0xc1)])throw new common_1['HttpException'](_0x5c3086(0xbf),common_1['HttpStatus'][_0x5c3086(0x1a3)]);const _0x412d06=await this[_0x5c3086(0x128)][_0x5c3086(0x1c0)]({'id':_0x4b7785},{'status':_0x26dd92});if(_0x412d06['affected']<=0x0)throw new common_1[(_0x5c3086(0x177))](_0x5c3086(0x1ac),common_1[_0x5c3086(0x15c)]['BAD_REQUEST']);return _0x5c3086(0x1a4);}async['resetUserPass'](_0x5eec4c){const _0x735a42=_0x577ddf,{id:_0x4c8743}=_0x5eec4c,_0x49d980=await this['userEntity'][_0x735a42(0x13c)]({'where':{'id':_0x4c8743}});if(!_0x49d980)throw new common_1['HttpException'](_0x735a42(0x23d),common_1['HttpStatus'][_0x735a42(0x1a3)]);const _0x3e0455=_0x735a42(0x20f),_0x4e7c34=bcrypt[_0x735a42(0x224)](_0x3e0455,0xa),_0x3f7492=await this['userEntity']['update']({'id':_0x4c8743},{'password':_0x4e7c34});if(_0x3f7492['affected']<=0x0)throw new common_1['HttpException'](_0x735a42(0x249),common_1['HttpStatus'][_0x735a42(0x1a3)]);return _0x735a42(0x19c)+_0x3e0455+_0x735a42(0x240);}async[_0x577ddf(0x14e)](_0x2ced63,_0x20e40b){const _0x18a537=_0x577ddf;return await this[_0x18a537(0x128)][_0x18a537(0x1c0)]({'id':_0x2ced63},{'lastLoginIp':_0x20e40b});}async[_0x577ddf(0x252)](_0x4c7c9c,_0x23900c){const _0x3cbbad=_0x577ddf;try{const _0x260541=await this[_0x3cbbad(0x128)][_0x3cbbad(0x13c)]({'where':{'id':_0x23900c}});if(!_0x260541)return{'status':![],'msg':_0x3cbbad(0x107)};const _0x414491=await this['userEntity'][_0x3cbbad(0x13c)]({'where':{'openId':_0x4c7c9c}});if(_0x414491)return{'status':![],'msg':'该微信已绑定其他账号！'};const _0x5cf374=await this[_0x3cbbad(0x128)][_0x3cbbad(0x1c0)]({'id':_0x23900c},{'openId':_0x4c7c9c});if(_0x5cf374[_0x3cbbad(0x1af)]<=0x0)return{'status':![],'msg':'绑定微信失败、请联系管理员！'};return{'status':!![],'msg':_0x3cbbad(0x146)};}catch(_0x24da18){return{'status':![],'msg':_0x3cbbad(0x234)};}}async[_0x577ddf(0x261)](_0x3fe349){const _0x5edc0a=_0x577ddf,_0x537d7c=await this[_0x5edc0a(0x128)][_0x5edc0a(0x13c)]({'where':{'id':_0x3fe349}});return _0x537d7c?.[_0x5edc0a(0x1d1)];}async['getMiniOpenIdByUserId'](_0x549760){const _0x2b8c19=_0x577ddf,_0x2fb271=await this[_0x2b8c19(0x128)][_0x2b8c19(0x13c)]({'where':{'id':_0x549760}});return _0x2fb271?.[_0x2b8c19(0xd0)];}async[_0x577ddf(0x1d5)](_0x3d84a3){const _0x28f85a=_0x577ddf,{username:_0x2e4091,password:_0x45c4d3,phone:_0x29b197,phoneCode:_0x360368}=_0x3d84a3,_0x1f9519=await this[_0x28f85a(0x128)]['findOne']({'where':[{'username':_0x2e4091},{'phone':_0x29b197}]});if(_0x1f9519&&_0x1f9519[_0x28f85a(0x1bc)]===_0x2e4091)throw new common_1['HttpException'](_0x28f85a(0xe1),common_1[_0x28f85a(0x15c)][_0x28f85a(0x1a3)]);if(_0x1f9519&&_0x1f9519[_0x28f85a(0x229)]===_0x29b197)throw new common_1['HttpException'](_0x28f85a(0x123),common_1[_0x28f85a(0x15c)][_0x28f85a(0x1a3)]);}async['createUser'](_0x3870e9){const _0x102e2b=_0x577ddf,_0x42129d=(0x0,utils_1[_0x102e2b(0x150)])(this[_0x102e2b(0x1a8)]);if(_0x3870e9['role']!==Role_constant_1[_0x102e2b(0x11b)][_0x102e2b(0xfc)])_0x3870e9[_0x102e2b(0x1b3)]=_0x42129d;else{if(!_0x3870e9[_0x102e2b(0x1b3)])throw new common_1[(_0x102e2b(0x177))]('saasId不能为空！',common_1[_0x102e2b(0x15c)][_0x102e2b(0x1a3)]);}return await this[_0x102e2b(0x128)]['save'](_0x3870e9);}async[_0x577ddf(0x1f8)](_0x2079e1){const _0x4fd756=_0x577ddf,{id:_0x45f30e,moreId:_0x1f3824}=_0x2079e1;if(_0x45f30e)return await this[_0x4fd756(0x128)][_0x4fd756(0x1d9)]({'id':_0x45f30e});if(_0x1f3824)return await this[_0x4fd756(0x128)][_0x4fd756(0x1d9)]({'id':(0x0,typeorm_2[_0x4fd756(0x1eb)])(_0x1f3824)});}async[_0x577ddf(0x138)](_0x1e411b){const _0xb73f19=_0x577ddf,_0x3d8078=_0x1e411b['user']['id'];return await this['userEntity'][_0xb73f19(0x1d9)]({'id':_0x3d8078})['then'](_0x43e7ee=>_0x43e7ee['affected']>0x0);}async[_0x577ddf(0x11d)](_0x1dd0ac,_0x55b106){const _0x3f6dc6=_0x577ddf;try{if(!_0x1dd0ac['username']&&!_0x1dd0ac[_0x3f6dc6(0x229)]&&!_0x1dd0ac[_0x3f6dc6(0x110)])throw new Error('账号、手机、邮箱必须存在一个');if(_0x1dd0ac[_0x3f6dc6(0x1bc)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x3f6dc6(0x241)](_0x1dd0ac[_0x3f6dc6(0x1bc)]))throw new Error(_0x3f6dc6(0x12e));if(!_0x1dd0ac[_0x3f6dc6(0x1db)])throw new Error(_0x3f6dc6(0x25f));}if(_0x1dd0ac[_0x3f6dc6(0x229)]){if(!(0x0,class_validator_1[_0x3f6dc6(0xfe)])(_0x1dd0ac[_0x3f6dc6(0x229)],_0x3f6dc6(0x142)))throw new Error(_0x3f6dc6(0x1a5));}if(_0x1dd0ac[_0x3f6dc6(0x110)]){if(!(0x0,class_validator_1[_0x3f6dc6(0x153)])(_0x1dd0ac[_0x3f6dc6(0x110)]))throw new Error(_0x3f6dc6(0x1e5));}if(_0x1dd0ac[_0x3f6dc6(0x1bc)]){const _0x2bf2c6=await this[_0x3f6dc6(0x128)][_0x3f6dc6(0x103)]({'where':{'username':_0x1dd0ac['username']}});if(_0x2bf2c6)throw new Error(_0x3f6dc6(0x168));}if(_0x1dd0ac[_0x3f6dc6(0x229)]){const _0x56a04a=await this[_0x3f6dc6(0x128)]['exists']({'where':{'phone':_0x1dd0ac['phone']}});if(_0x56a04a)throw new Error(_0x3f6dc6(0x18e));}if(_0x1dd0ac[_0x3f6dc6(0x110)]){const _0x188a17=await this[_0x3f6dc6(0x128)]['exists']({'where':{'email':_0x1dd0ac[_0x3f6dc6(0x110)]}});if(_0x188a17)throw new Error(_0x3f6dc6(0xdf));}const _0x95ec1b=new user_entity_1['UserEntity']();for(let _0x2e06da in _0x1dd0ac){_0x1dd0ac[_0x2e06da]&&(_0x95ec1b[_0x2e06da]=_0x1dd0ac[_0x2e06da]);}return _0x95ec1b[_0x3f6dc6(0x1db)]&&(_0x95ec1b[_0x3f6dc6(0x1db)]=bcrypt[_0x3f6dc6(0x224)](_0x1dd0ac[_0x3f6dc6(0x1db)],0xa)),_0x95ec1b[_0x3f6dc6(0x253)]=user_constant_1[_0x3f6dc6(0x10a)][_0x3f6dc6(0x145)],!_0x95ec1b[_0x3f6dc6(0x19f)]&&(_0x95ec1b[_0x3f6dc6(0x19f)]=_0x95ec1b['nickname']||'小智'),!_0x95ec1b[_0x3f6dc6(0x154)]&&(_0x95ec1b[_0x3f6dc6(0x154)]=await this['globalConfigService'][_0x3f6dc6(0x1fa)](['userDefautlAvatar'])),await this[_0x3f6dc6(0x25b)](_0x95ec1b),!![];}catch(_0x363788){throw new common_1[(_0x3f6dc6(0x177))](_0x363788['message'],common_1[_0x3f6dc6(0x15c)][_0x3f6dc6(0x1a3)]);}}[_0x577ddf(0x217)](){const _0x28b0bb=_0x577ddf;let _0x15c561=_0x28b0bb(0x227);const _0x6ed198=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x5f0779=0x0;_0x5f0779<0xa;_0x5f0779++){_0x15c561=_0x15c561+_0x6ed198[Math['floor'](Math[_0x28b0bb(0x194)]()*0x3f)];}return _0x15c561;}async[_0x577ddf(0x221)](_0x45c634){const _0xda6c51=_0x577ddf;let _0x1ecffa=[];for(let _0x5847b9=0x0;_0x5847b9<_0x45c634;_0x5847b9++){_0x1ecffa['push'](this[_0xda6c51(0x217)]());}const _0x3ed87d=await this[_0xda6c51(0x128)][_0xda6c51(0x213)]({'where':{'username':(0x0,typeorm_2['In'])(_0x1ecffa)}});if(!_0x3ed87d[_0xda6c51(0xbd)])return _0x1ecffa;else{const _0x5ccb79=new Set(_0x3ed87d[_0xda6c51(0xd2)](_0x22b4f1=>_0x22b4f1[_0xda6c51(0x1bc)]));_0x1ecffa=_0x1ecffa[_0xda6c51(0xdb)](_0x38b6a1=>!_0x5ccb79[_0xda6c51(0x262)](_0x38b6a1));const _0x35b804=await this[_0xda6c51(0x221)](_0x5ccb79[_0xda6c51(0x236)]);return _0x1ecffa=_0x1ecffa['concat'](_0x35b804),_0x1ecffa;}}async[_0x577ddf(0x250)](_0x550b2f,_0x4f0ac1){const _0x36ecab=_0x577ddf;let _0x26aedd='';_0x26aedd=_0x36ecab(0x24a);const _0x36add1=await this['genUserNames'](_0x550b2f[_0x36ecab(0x1e2)]),_0x24c47e=[],_0x508e8d=[],_0x29f60f=await this[_0x36ecab(0xd4)][_0x36ecab(0x1fa)](['userDefautlAvatar']);for(let _0x52804f=0x0;_0x52804f<_0x550b2f[_0x36ecab(0x1e2)];_0x52804f++){const _0x4d2c7b=new user_entity_1['UserEntity']();_0x4d2c7b[_0x36ecab(0x253)]=0x1,_0x4d2c7b[_0x36ecab(0x154)]=_0x29f60f,_0x4d2c7b[_0x36ecab(0x1bc)]=_0x36add1[_0x52804f],_0x4d2c7b[_0x36ecab(0x19f)]=_0x36add1[_0x52804f],_0x4d2c7b['password']=bcrypt[_0x36ecab(0x224)]('mj123456admin',0xa),_0x26aedd=_0x26aedd+(_0x36add1[_0x52804f]+_0x36ecab(0x17a)),_0x550b2f[_0x36ecab(0x223)]&&(_0x4d2c7b[_0x36ecab(0x223)]=Number(_0x550b2f[_0x36ecab(0x223)])),_0x550b2f['vipLeavelName']&&(_0x4d2c7b['vipLeavelName']=_0x550b2f[_0x36ecab(0x212)]),_0x550b2f[_0x36ecab(0xdd)]&&(_0x4d2c7b['score']=_0x550b2f['score']),_0x550b2f[_0x36ecab(0x1f1)]&&_0x508e8d['push']({'username':_0x36add1[_0x52804f],'vipDays':_0x550b2f['vipDays']}),_0x24c47e[_0x36ecab(0x259)](_0x4d2c7b);}try{return await this[_0x36ecab(0x1ef)][_0x36ecab(0x158)](async()=>{const _0x229ea4=_0x36ecab;await this[_0x229ea4(0x128)][_0x229ea4(0x1d7)](_0x24c47e),await this[_0x229ea4(0x137)][_0x229ea4(0x1d7)](_0x508e8d);}),_0x26aedd;}catch(_0x4eef94){throw new common_1[(_0x36ecab(0x177))](_0x4eef94[_0x36ecab(0x1ec)],axios_1[_0x36ecab(0x14f)]['BadRequest']);}}async[_0x577ddf(0x18f)](_0x1b0821,_0x37b126){const _0x55b128=_0x577ddf,_0x3f8425=await this[_0x55b128(0x128)]['findOne']({'where':{'id':_0x37b126['userId']}});await this['userEntity'][_0x55b128(0x14a)]({'id':_0x3f8425['id']},_0x55b128(0xdd),_0x37b126[_0x55b128(0xdd)]),await this[_0x55b128(0xfd)][_0x55b128(0xc6)]({'userId':_0x3f8425['id'],'rawScore':_0x3f8425[_0x55b128(0xdd)],'newScore':_0x3f8425[_0x55b128(0xdd)]+_0x37b126[_0x55b128(0xdd)],'changeScore':_0x37b126[_0x55b128(0xdd)],'changeType':balance_constant_1[_0x55b128(0x22a)]['AdminGift'],'rebateUserId':_0x1b0821['user']['id'],'description':_0x55b128(0x17c)});}async[_0x577ddf(0x112)](_0x50cea2,_0x229037){const _0x17f87b=_0x577ddf,_0x1770ca=await this[_0x17f87b(0x128)]['findOne']({'where':{'id':_0x229037[_0x17f87b(0x258)]}});return await this['updateVipExpire'](_0x1770ca,balance_constant_1[_0x17f87b(0x22a)]['AdminGift'],_0x229037[_0x17f87b(0x12f)],_0x17f87b(0x17c),_0x50cea2[_0x17f87b(0x24e)]['id']),!![];}async[_0x577ddf(0xd9)](_0x1ab52d){const _0x5bfec3=_0x577ddf,_0x14b6cd=await this[_0x5bfec3(0x137)]['findOne']({'where':{'username':_0x1ab52d[_0x5bfec3(0x1bc)]}});_0x14b6cd&&await this['connection'][_0x5bfec3(0x158)](async()=>{const _0x20f30d=_0x5bfec3;_0x14b6cd[_0x20f30d(0x1f1)]===-0x1?_0x1ab52d['lifetimeVip']=0x1:_0x1ab52d[_0x20f30d(0x162)]=(0x0,date_1['default'])()['add'](_0x14b6cd[_0x20f30d(0x1f1)],'day')['toDate'](),_0x1ab52d=await this[_0x20f30d(0x128)][_0x20f30d(0x1d7)](_0x1ab52d),await this[_0x20f30d(0x137)]['delete']({'id':_0x14b6cd['id']});});}async[_0x577ddf(0x1c1)](_0xe54f71,_0x12c0a2){const _0x46c057=_0x577ddf;await this[_0x46c057(0x128)][_0x46c057(0x1c0)]({'id':_0xe54f71},{'consecutiveDays':_0x12c0a2});}async[_0x577ddf(0x1de)](_0x1fb11b){const _0x6fadf4=_0x577ddf,_0x2d5c20=await this[_0x6fadf4(0xc7)](_0x1fb11b);_0x2d5c20[_0x6fadf4(0x245)]=_0x2d5c20[_0x6fadf4(0x245)]+0x1,await this[_0x6fadf4(0x128)][_0x6fadf4(0x1d7)](_0x2d5c20);}async[_0x577ddf(0xe7)](_0x55c2fa,_0x583f49){const _0x342e0e=_0x577ddf,_0x3a6e96=await this['globalConfigService']['getConfigByKeys']([_0x342e0e(0x1dd),'registerRewards','inviteSendStatus','inviteRewards',_0x342e0e(0x23e),_0x342e0e(0x176),_0x342e0e(0x235)]),_0x1d4b6a={};for(let _0x35ac92 in _0x3a6e96){const _0x471c51=Number(_0x3a6e96[_0x35ac92]),_0x12d4e0=Number[_0x342e0e(0x13d)](_0x471c51)&&_0x471c51>0x0?_0x471c51:0x0;_0x1d4b6a[_0x35ac92]=_0x12d4e0;}_0x1d4b6a[_0x342e0e(0x1dd)]&&(await this['userEntity'][_0x342e0e(0x1c0)]({'id':_0x55c2fa['id']},{'score':_0x1d4b6a['registerRewards']}),await this[_0x342e0e(0xfd)]['insertAccountLog']({'userId':_0x55c2fa['id'],'rawScore':0x0,'newScore':_0x1d4b6a[_0x342e0e(0x126)],'changeScore':_0x1d4b6a[_0x342e0e(0x126)],'changeType':balance_constant_1[_0x342e0e(0x22a)]['Registe'],'description':'注册赠送'}));if(_0x583f49&&_0x1d4b6a[_0x342e0e(0x237)]){_0x1d4b6a[_0x342e0e(0x161)]&&(await this[_0x342e0e(0x128)][_0x342e0e(0x14a)]({'id':_0x583f49['id']},'score',_0x1d4b6a[_0x342e0e(0x161)]),await this['userBalanceService']['insertAccountLog']({'userId':_0x583f49['id'],'rawScore':_0x583f49[_0x342e0e(0xdd)],'newScore':_0x583f49[_0x342e0e(0xdd)]+_0x1d4b6a[_0x342e0e(0x161)],'changeScore':_0x1d4b6a['inviteRewards'],'changeType':balance_constant_1['EChangeType'][_0x342e0e(0xf0)],'rebateUserId':_0x55c2fa['id'],'description':_0x342e0e(0x11e)}));_0x1d4b6a[_0x342e0e(0x23e)]&&await this[_0x342e0e(0x1fd)](_0x583f49,balance_constant_1[_0x342e0e(0x22a)][_0x342e0e(0xf0)],_0x1d4b6a[_0x342e0e(0x23e)],_0x342e0e(0x11e),_0x55c2fa['id']);const _0x16bd84=await this[_0x342e0e(0x128)][_0x342e0e(0x13c)]({'where':{'id':_0x55c2fa['id']}});_0x1d4b6a[_0x342e0e(0x176)]&&(await this[_0x342e0e(0x128)][_0x342e0e(0x14a)]({'id':_0x16bd84['id']},_0x342e0e(0xdd),_0x1d4b6a['invitedRewards']),await this['userBalanceService'][_0x342e0e(0xc6)]({'userId':_0x55c2fa['id'],'rawScore':_0x16bd84['score'],'newScore':_0x16bd84[_0x342e0e(0xdd)]+_0x1d4b6a[_0x342e0e(0x176)],'changeScore':_0x1d4b6a[_0x342e0e(0x176)],'changeType':balance_constant_1[_0x342e0e(0x22a)][_0x342e0e(0x191)],'rebateUserId':_0x583f49['id'],'description':_0x342e0e(0x1f3)})),_0x1d4b6a[_0x342e0e(0x235)]&&await this[_0x342e0e(0x1fd)](_0x16bd84,balance_constant_1[_0x342e0e(0x22a)][_0x342e0e(0x191)],_0x1d4b6a[_0x342e0e(0x235)],'受邀请注册赠送',_0x583f49['id']);}}async[_0x577ddf(0x1cc)](_0x284c0b,_0x4b7db4,_0x366e85,_0x4275ea,_0x5c4cd5){const _0x255a8a=_0x577ddf;await this['userEntity'][_0x255a8a(0x1c0)]({'id':_0x284c0b['id']},{'score':_0x284c0b[_0x255a8a(0xdd)]+_0x366e85}),await this[_0x255a8a(0xfd)][_0x255a8a(0xc6)]({'userId':_0x284c0b['id'],'rawScore':_0x284c0b['score'],'newScore':_0x284c0b[_0x255a8a(0xdd)]+_0x366e85,'changeScore':_0x366e85,'changeType':_0x4b7db4,'relateId':_0x5c4cd5?String(_0x5c4cd5):null,'description':_0x4275ea});}async['updateVipExpire'](_0x1bcdb4,_0x2bb952,_0x52b376,_0x1a75cf,_0x655768){const _0x376b59=_0x577ddf;if(_0x1bcdb4[_0x376b59(0x122)])return;_0x52b376===-0x1?await this[_0x376b59(0x128)][_0x376b59(0x1c0)]({'id':_0x1bcdb4['id']},{'lifetimeVip':0x1}):(_0x1bcdb4[_0x376b59(0x162)]?_0x1bcdb4['vipExpire']=(0x0,date_1[_0x376b59(0x20a)])(_0x1bcdb4[_0x376b59(0x162)])[_0x376b59(0x21b)](_0x52b376,_0x376b59(0x120))['toDate']():_0x1bcdb4[_0x376b59(0x162)]=(0x0,date_1[_0x376b59(0x20a)])()[_0x376b59(0x21b)](_0x52b376,'day')[_0x376b59(0x21e)](),await this['userEntity'][_0x376b59(0x1c0)]({'id':_0x1bcdb4['id']},{'vipExpire':_0x1bcdb4[_0x376b59(0x162)]})),_0x1bcdb4=await this[_0x376b59(0x128)][_0x376b59(0x13c)]({'where':{'id':_0x1bcdb4['id']}}),await this['userBalanceService']['insertAccountVipLog']({'userId':_0x1bcdb4['id'],'vipDays':_0x52b376,'vipExpire':_0x1bcdb4[_0x376b59(0x162)],'relateType':_0x2bb952,'relateId':_0x655768?String(_0x655768):'','description':_0x1a75cf});}async[_0x577ddf(0x160)](_0x4ecfc9,_0x1c5b44){const _0x241a37=_0x577ddf;let _0xcf213f=!![];const _0x57be50=await this[_0x241a37(0xc7)](_0x4ecfc9);if(_0x57be50['lifetimeVip']||_0x57be50[_0x241a37(0x162)]){if(_0x1c5b44[_0x241a37(0xf6)]<0x0)_0xcf213f=!![];else{if(_0x1c5b44[_0x241a37(0xf6)]>0x0){const _0x4b2456=redisKey_constant_1[_0x241a37(0x101)]+'-'+_0x4ecfc9+'-'+_0x1c5b44['id'];let _0x354241=await this[_0x241a37(0xd3)]['get']({'key':_0x4b2456});console['log'](_0x354241);let _0x5d1dd4=Number(_0x354241||0x0);_0x5d1dd4<_0x1c5b44['vipFreeNum']?_0xcf213f=!![]:_0xcf213f=_0x57be50[_0x241a37(0xdd)]>=_0x1c5b44[_0x241a37(0x106)];}else _0xcf213f=_0x57be50[_0x241a37(0xdd)]>=_0x1c5b44[_0x241a37(0x106)];}}else _0xcf213f=_0x57be50[_0x241a37(0xdd)]>=_0x1c5b44[_0x241a37(0x106)];if(!_0xcf213f)throw new common_1[(_0x241a37(0x177))](_0x241a37(0x159),common_1[_0x241a37(0x15c)][_0x241a37(0x1a3)]);}async[_0x577ddf(0x207)](_0x25e839,_0x4b2df9,_0xcefec7){const _0x4095d4=_0x577ddf,_0x2e6493=await this[_0x4095d4(0xc7)](_0x25e839);let _0x3b53b6;switch(_0x4b2df9[_0x4095d4(0x1a9)]){case model_constant_1['EModelType']['PPT']:_0x3b53b6=balance_constant_1['EChangeType'][_0x4095d4(0x1e8)];break;case model_constant_1['EModelType'][_0x4095d4(0x183)]:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)][_0x4095d4(0x17f)];break;case model_constant_1[_0x4095d4(0x12c)][_0x4095d4(0x1c5)]:_0x3b53b6=balance_constant_1['EChangeType'][_0x4095d4(0x10c)];break;case model_constant_1[_0x4095d4(0x12c)][_0x4095d4(0x25a)]:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)]['VIDEO'];break;case model_constant_1['EModelType'][_0x4095d4(0x1ce)]:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)]['Draw'];break;case model_constant_1[_0x4095d4(0x12c)][_0x4095d4(0x1b1)]:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)][_0x4095d4(0x1e7)];break;case model_constant_1[_0x4095d4(0x12c)][_0x4095d4(0x1d2)]:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)][_0x4095d4(0xe5)];break;case model_constant_1[_0x4095d4(0x12c)]['FILE']:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)][_0x4095d4(0xfb)];break;case model_constant_1['EModelType'][_0x4095d4(0x24c)]:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)][_0x4095d4(0xf3)];break;default:_0x3b53b6=balance_constant_1[_0x4095d4(0x22a)]['Chat'];}if(_0x2e6493[_0x4095d4(0x122)]||_0x2e6493[_0x4095d4(0x162)]){if(_0x4b2df9['vipFreeNum']<0x0)await this[_0x4095d4(0x1cc)](_0x2e6493,_0x3b53b6,0x0,_0x4095d4(0x18c)+_0x4b2df9[_0x4095d4(0x1c4)]+_0x4095d4(0x1da),_0xcefec7);else{if(_0x4b2df9['vipFreeNum']>0x0){const _0x2e4127=redisKey_constant_1['VIP_FREE']+'-'+_0x25e839+'-'+_0x4b2df9['id'];let _0x3a6416=await this[_0x4095d4(0xd3)][_0x4095d4(0x14c)]({'key':_0x2e4127}),_0x33093e=Number(_0x3a6416||0x0);if(_0x33093e<_0x4b2df9[_0x4095d4(0xf6)]){const _0x3f909f=(0x0,date_1['default'])()[_0x4095d4(0x231)]('d')[_0x4095d4(0x109)]((0x0,date_1[_0x4095d4(0x20a)])(),'s');await this[_0x4095d4(0xd3)][_0x4095d4(0x121)]({'key':_0x2e4127,'val':_0x33093e+0x1},_0x3f909f),await this['changeScore4Other'](_0x2e6493,_0x3b53b6,0x0,_0x4095d4(0x18c)+_0x4b2df9[_0x4095d4(0x1c4)]+_0x4095d4(0x1b4),_0xcefec7);}else await this[_0x4095d4(0x1cc)](_0x2e6493,_0x3b53b6,-_0x4b2df9[_0x4095d4(0x106)],_0x4095d4(0x18c)+_0x4b2df9[_0x4095d4(0x1c4)]+'】使用扣减',_0xcefec7);}else await this[_0x4095d4(0x1cc)](_0x2e6493,_0x3b53b6,-_0x4b2df9[_0x4095d4(0x106)],'模型【'+_0x4b2df9[_0x4095d4(0x1c4)]+_0x4095d4(0x134),_0xcefec7);}}else await this[_0x4095d4(0x1cc)](_0x2e6493,_0x3b53b6,-_0x4b2df9['deduct'],_0x4095d4(0x18c)+_0x4b2df9[_0x4095d4(0x1c4)]+_0x4095d4(0x134),_0xcefec7);}async['refundBalance4Chat'](_0x27dd78,_0x49ccb9,_0x5e70fc){const _0x20436e=_0x577ddf,_0x1f8b5f=await this[_0x20436e(0xc7)](_0x27dd78);let _0x417a65;switch(_0x49ccb9[_0x20436e(0x1a9)]){case model_constant_1[_0x20436e(0x12c)][_0x20436e(0x183)]:_0x417a65=balance_constant_1[_0x20436e(0x22a)][_0x20436e(0x17f)];break;case model_constant_1[_0x20436e(0x12c)][_0x20436e(0x1c5)]:_0x417a65=balance_constant_1[_0x20436e(0x22a)][_0x20436e(0x10c)];break;case model_constant_1[_0x20436e(0x12c)][_0x20436e(0x1ce)]:_0x417a65=balance_constant_1['EChangeType'][_0x20436e(0x25c)];break;case model_constant_1[_0x20436e(0x12c)][_0x20436e(0x1b1)]:_0x417a65=balance_constant_1['EChangeType'][_0x20436e(0x1e7)];break;case model_constant_1[_0x20436e(0x12c)]['OTHER']:_0x417a65=balance_constant_1[_0x20436e(0x22a)][_0x20436e(0xe5)];break;default:_0x417a65=balance_constant_1[_0x20436e(0x22a)]['Chat'];}await this[_0x20436e(0x1cc)](_0x1f8b5f,_0x417a65,_0x49ccb9[_0x20436e(0x106)],_0x20436e(0x18c)+_0x49ccb9[_0x20436e(0x1c4)]+_0x20436e(0x125),_0x5e70fc);}async[_0x577ddf(0x22d)](_0x589ed7,_0xf48e48,_0x1837c4){const _0x53a110=_0x577ddf;let _0xb2170e='',_0x371015='',_0x331536='',_0x558ce9=_0xf48e48;const _0x1f23a4=_0xf48e48['toLowerCase'](),_0x3fbb81=new RegExp('imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll'),_0x2eae83=new RegExp(_0x53a110(0x10e)),_0x28f2ff=new RegExp(_0x53a110(0x1cd));if(_0x589ed7===midjourney_constant_1[_0x53a110(0x169)][_0x53a110(0x198)])_0x371015=_0x53a110(0x242),_0xb2170e=_0x53a110(0xe0),_0x331536=_0x53a110(0xd6);else{if(_0x589ed7===midjourney_constant_1[_0x53a110(0x169)][_0x53a110(0xef)])_0x371015='type2',_0xb2170e='relax_mjDeduction',_0x331536='relax_vip_free';else _0x589ed7===midjourney_constant_1['DrawSpeed']['turbo']&&(_0x371015='type3',_0xb2170e=_0x53a110(0x180),_0x331536='turbo_vip_free');}if(_0x3fbb81[_0x53a110(0x241)](_0x1f23a4))_0xb2170e=_0xb2170e+0x1;else{if(_0x2eae83[_0x53a110(0x241)](_0x1f23a4))_0xb2170e=_0xb2170e+0x2;else _0x28f2ff[_0x53a110(0x241)](_0x1f23a4)&&(_0xb2170e=_0xb2170e+0x3);}const _0x235629={},_0x4a54b6=await this['globalConfigService']['getConfigByKeys']([_0xb2170e,_0x331536]);for(let _0x3ef4e7 in _0x4a54b6){_0x235629[_0x3ef4e7]=Number(_0x4a54b6[_0x3ef4e7])||0x0;}if(_0x1837c4[_0x53a110(0x223)]){const _0x12baba=await this[_0x53a110(0xd4)][_0x53a110(0x226)](_0x1837c4['vipLeavelId'],'mj');_0x12baba&&(_0x235629[_0x331536]=_0x12baba[_0x371015]||0x0);}for(let _0x42aaef in midjourney_constant_1[_0x53a110(0x1c8)]){if(_0x1f23a4['includes'](midjourney_constant_1['ActionCN'][_0x42aaef]['action'])){_0x558ce9=midjourney_constant_1[_0x53a110(0x1c8)][_0x42aaef]['cn'];break;}}return{'price':_0x235629[_0xb2170e],'vipFreeNum':_0x235629[_0x331536],'vipFreeKey':_0x331536,'description':_0x558ce9};}async[_0x577ddf(0x20c)](_0x47c8fc,_0x17be38=midjourney_constant_1['DrawSpeed'][_0x577ddf(0xef)],_0x39b262){const _0x21b488=_0x577ddf;let _0xf2cef4=!![];const _0x129cca=await this[_0x21b488(0xc7)](_0x47c8fc),_0x35c7d0=await this['getMjPrice'](_0x17be38,_0x39b262,_0x129cca);if(_0x129cca[_0x21b488(0x122)]||_0x129cca[_0x21b488(0x162)]){if(_0x35c7d0['vipFreeNum']<0x0)_0xf2cef4=!![];else{if(_0x35c7d0[_0x21b488(0xf6)]>0x0){const _0x51da47=redisKey_constant_1[_0x21b488(0x101)]+'-'+_0x47c8fc+'-'+_0x35c7d0[_0x21b488(0x21f)];let _0x5f1d49=await this[_0x21b488(0xd3)][_0x21b488(0x14c)]({'key':_0x51da47}),_0x3beb77=Number(_0x5f1d49||0x0);_0x3beb77<_0x35c7d0['vipFreeNum']?_0xf2cef4=!![]:_0xf2cef4=_0x129cca[_0x21b488(0xdd)]>=_0x35c7d0[_0x21b488(0x16a)];}else _0xf2cef4=_0x129cca[_0x21b488(0xdd)]>=_0x35c7d0[_0x21b488(0x16a)];}}else _0xf2cef4=_0x129cca[_0x21b488(0xdd)]>=_0x35c7d0['price'];if(_0x17be38===midjourney_constant_1['DrawSpeed'][_0x21b488(0xef)]){if(!_0xf2cef4)throw new common_1[(_0x21b488(0x177))](_0x21b488(0x159),common_1[_0x21b488(0x15c)][_0x21b488(0x1a3)]);}else{if(!_0xf2cef4)return this[_0x21b488(0x20c)](_0x47c8fc,midjourney_constant_1[_0x21b488(0x169)][_0x21b488(0xef)],_0x39b262);}return _0x17be38;}async[_0x577ddf(0x119)](_0x85c202,_0x11a5bc,_0x528197,_0x385dd1){const _0x12979e=_0x577ddf,_0x5ceae5=await this[_0x12979e(0xc7)](_0x85c202),_0x5ad95d=await this[_0x12979e(0x22d)](_0x11a5bc,_0x528197,_0x5ceae5),_0x4f39e0=balance_constant_1[_0x12979e(0x22a)][_0x12979e(0x135)];if(_0x5ceae5[_0x12979e(0x122)]||_0x5ceae5[_0x12979e(0x162)]){if(_0x5ad95d[_0x12979e(0xf6)]<0x0)await this['changeScore4Other'](_0x5ceae5,_0x4f39e0,0x0,_0x12979e(0x209)+_0x5ad95d[_0x12979e(0xf1)]+_0x12979e(0x1da),_0x385dd1);else{if(_0x5ad95d[_0x12979e(0xf6)]>0x0){const _0x2e6fcf=redisKey_constant_1['VIP_FREE']+'-'+_0x85c202+'-'+_0x5ad95d[_0x12979e(0x21f)];let _0x1e8df0=await this['redisCacheService'][_0x12979e(0x14c)]({'key':_0x2e6fcf}),_0x49c34e=Number(_0x1e8df0||0x0);if(_0x49c34e<_0x5ad95d['vipFreeNum']){const _0x94cb78=(0x0,date_1[_0x12979e(0x20a)])()[_0x12979e(0x231)]('d')['diff']((0x0,date_1[_0x12979e(0x20a)])(),'s');await this[_0x12979e(0xd3)][_0x12979e(0x121)]({'key':_0x2e6fcf,'val':_0x49c34e+0x1},_0x94cb78),await this[_0x12979e(0x1cc)](_0x5ceae5,_0x4f39e0,0x0,_0x12979e(0x209)+_0x5ad95d[_0x12979e(0xf1)]+_0x12979e(0x1b4),_0x385dd1);}else await this[_0x12979e(0x1cc)](_0x5ceae5,_0x4f39e0,-_0x5ad95d['price'],_0x12979e(0x209)+_0x5ad95d[_0x12979e(0xf1)]+_0x12979e(0x134),_0x385dd1);}else await this['changeScore4Other'](_0x5ceae5,_0x4f39e0,-_0x5ad95d[_0x12979e(0x16a)],'MJ绘画【'+_0x5ad95d['description']+_0x12979e(0x134),_0x385dd1);}}else await this[_0x12979e(0x1cc)](_0x5ceae5,_0x4f39e0,-_0x5ad95d[_0x12979e(0x16a)],_0x12979e(0x209)+_0x5ad95d[_0x12979e(0xf1)]+'】使用扣减',_0x385dd1);}async['debuctBalance4PPT'](_0x145993,_0x9f9599,_0x473a65,_0x161b01=![]){const _0x4b84b0=_0x577ddf,_0x14a4a2={'structure':{'key':'pptOutline','vlrk':_0x4b84b0(0x242),'desc':_0x4b84b0(0x179)},'cover':{'key':_0x4b84b0(0x171),'vlrk':_0x4b84b0(0x242),'desc':_0x4b84b0(0xda)},'recover':{'key':_0x4b84b0(0x171),'vlrk':_0x4b84b0(0x242),'desc':_0x4b84b0(0x19e)},'create':{'key':_0x4b84b0(0x133),'vlrk':'type2','desc':'模板生成PPT'},'thesis':{'key':_0x4b84b0(0x19d),'vlrk':_0x4b84b0(0x1c2),'desc':'论文生成PPT'},'file':{'key':_0x4b84b0(0x133),'vlrk':'type2','desc':_0x4b84b0(0x20b)},'theme':{'key':_0x4b84b0(0x133),'vlrk':_0x4b84b0(0x25e),'desc':'更换模板'},'addpage':{'key':_0x4b84b0(0x133),'vlrk':_0x4b84b0(0x25e),'desc':'增加PPT单页'},'addNotes':{'key':'pptCreate','vlrk':'type2','desc':_0x4b84b0(0x1ab)}},_0x1f80cf=_0x14a4a2[_0x473a65][_0x4b84b0(0x1d6)],_0x49a3dd=_0x14a4a2[_0x473a65][_0x4b84b0(0x244)]+_0x4b84b0(0x16f),_0x17d0c9=_0x14a4a2[_0x473a65][_0x4b84b0(0x244)]+_0x4b84b0(0x15e),_0x5ad872={},_0x1900c9=await this['globalConfigService']['getConfigByKeys']([_0x49a3dd,_0x17d0c9]);for(let _0x308496 in _0x1900c9){_0x5ad872[_0x308496]=Number(_0x1900c9[_0x308496])||0x0;}const _0x53e67b=await this[_0x4b84b0(0xc7)](_0x145993);if(_0x53e67b[_0x4b84b0(0x223)]){const _0x23d3b1=await this[_0x4b84b0(0xd4)]['getVipLeavelRelById'](_0x53e67b[_0x4b84b0(0x223)],model_constant_1[_0x4b84b0(0x12c)]['PPT']);_0x23d3b1&&(_0x5ad872[_0x17d0c9]=_0x23d3b1[_0x14a4a2[_0x473a65][_0x4b84b0(0x1e9)]]||0x0);}if(_0x53e67b[_0x4b84b0(0x122)]||_0x53e67b[_0x4b84b0(0x162)]){if(_0x5ad872[_0x17d0c9]<0x0)await this[_0x4b84b0(0x1cc)](_0x53e67b,balance_constant_1[_0x4b84b0(0x22a)][_0x4b84b0(0x1e8)],0x0,_0x4b84b0(0x1d0)+_0x1f80cf+'】会员永久免费',_0x9f9599);else{if(_0x5ad872[_0x17d0c9]>0x0){const _0x20b06d=redisKey_constant_1[_0x4b84b0(0x101)]+'-'+_0x145993+'-'+_0x17d0c9;let _0x15bd77=await this['redisCacheService'][_0x4b84b0(0x14c)]({'key':_0x20b06d}),_0x4c49b7=Number(_0x15bd77||0x0);if(_0x4c49b7<_0x5ad872[_0x17d0c9]){const _0x30b0e4=(0x0,date_1[_0x4b84b0(0x20a)])()[_0x4b84b0(0x231)]('d')[_0x4b84b0(0x109)]((0x0,date_1[_0x4b84b0(0x20a)])(),'s');await this['redisCacheService']['set']({'key':_0x20b06d,'val':_0x4c49b7+0x1},_0x30b0e4),await this[_0x4b84b0(0x1cc)](_0x53e67b,balance_constant_1[_0x4b84b0(0x22a)][_0x4b84b0(0x1e8)],0x0,_0x4b84b0(0x1d0)+_0x1f80cf+_0x4b84b0(0x1b4),_0x9f9599);}else await this[_0x4b84b0(0x1cc)](_0x53e67b,balance_constant_1[_0x4b84b0(0x22a)]['PPT'],-_0x5ad872[_0x49a3dd],_0x4b84b0(0x1d0)+_0x1f80cf+_0x4b84b0(0x134),_0x9f9599);}else await this[_0x4b84b0(0x1cc)](_0x53e67b,balance_constant_1['EChangeType'][_0x4b84b0(0x1e8)],-_0x5ad872[_0x49a3dd],_0x4b84b0(0x1d0)+_0x1f80cf+_0x4b84b0(0x134),_0x9f9599);}}else await this[_0x4b84b0(0x1cc)](_0x53e67b,balance_constant_1[_0x4b84b0(0x22a)][_0x4b84b0(0x1e8)],-_0x5ad872[_0x49a3dd],_0x4b84b0(0x1d0)+_0x1f80cf+_0x4b84b0(0x134),_0x9f9599);}async[_0x577ddf(0x15d)](_0x5bc531,_0x169a36,_0xac8e15){const _0x36df38=_0x577ddf,_0x14f20c=await this['getUserById'](_0x5bc531);if(_0x14f20c[_0x36df38(0x122)]||_0x14f20c[_0x36df38(0x162)]){if(_0x169a36[_0x36df38(0xf6)]<0x0)await this[_0x36df38(0x1cc)](_0x14f20c,balance_constant_1[_0x36df38(0x22a)][_0x36df38(0x1b0)],0x0,_0x36df38(0x1fb)+_0x169a36[_0x36df38(0x1c4)]+_0x36df38(0x1da),_0xac8e15);else{if(_0x169a36[_0x36df38(0xf6)]>0x0){const _0x15d519=redisKey_constant_1[_0x36df38(0x101)]+'-'+_0x5bc531+'-'+_0x169a36['id'];let _0xed51ad=await this[_0x36df38(0xd3)][_0x36df38(0x14c)]({'key':_0x15d519}),_0x12c979=Number(_0xed51ad||0x0);if(_0x12c979<_0x169a36['vipFreeNum']){const _0x35f92d=(0x0,date_1[_0x36df38(0x20a)])()['endOf']('d')['diff']((0x0,date_1['default'])(),'s');await this['redisCacheService'][_0x36df38(0x121)]({'key':_0x15d519,'val':_0x12c979+0x1},_0x35f92d),await this[_0x36df38(0x1cc)](_0x14f20c,balance_constant_1[_0x36df38(0x22a)][_0x36df38(0x1b0)],0x0,'小工具【'+_0x169a36[_0x36df38(0x1c4)]+_0x36df38(0x1b4),_0xac8e15);}else await this['changeScore4Other'](_0x14f20c,balance_constant_1[_0x36df38(0x22a)][_0x36df38(0x1b0)],-_0x169a36[_0x36df38(0x106)],'小工具【'+_0x169a36[_0x36df38(0x1c4)]+'】使用扣减',_0xac8e15);}else await this[_0x36df38(0x1cc)](_0x14f20c,balance_constant_1[_0x36df38(0x22a)][_0x36df38(0x1b0)],-_0x169a36[_0x36df38(0x106)],'小工具【'+_0x169a36['modelName']+'】使用扣减',_0xac8e15);}}else await this[_0x36df38(0x1cc)](_0x14f20c,balance_constant_1[_0x36df38(0x22a)][_0x36df38(0x1b0)],-_0x169a36[_0x36df38(0x106)],_0x36df38(0x1fb)+_0x169a36['modelName']+_0x36df38(0x134),_0xac8e15);}async['deductBalance4SD'](_0x241863,_0x21535b){const _0x57f843=_0x577ddf,_0x259f2d=store_1[_0x57f843(0x13b)]['czProxyPrice'],_0x2d72cb=await this[_0x57f843(0xc7)](_0x241863),_0x613e6b=balance_constant_1[_0x57f843(0x22a)]['SD'];if(_0x2d72cb[_0x57f843(0x122)]||_0x2d72cb['vipExpire']){if(store_1[_0x57f843(0x13b)][_0x57f843(0x1a1)]<0x0)await this['changeScore4Other'](_0x2d72cb,_0x613e6b,0x0,_0x57f843(0xff),_0x21535b);else{if(store_1['CZConfig'][_0x57f843(0x1a1)]>0x0){const _0x5d5029=redisKey_constant_1[_0x57f843(0x101)]+'-'+_0x241863+_0x57f843(0x1aa);let _0x1eb208=await this[_0x57f843(0xd3)][_0x57f843(0x14c)]({'key':_0x5d5029}),_0x449c8a=Number(_0x1eb208||0x0);if(_0x449c8a<store_1['CZConfig'][_0x57f843(0x1a1)]){const _0x138f28=(0x0,date_1[_0x57f843(0x20a)])()['endOf']('d')['diff']((0x0,date_1[_0x57f843(0x20a)])(),'s');await this[_0x57f843(0xd3)][_0x57f843(0x121)]({'key':_0x5d5029,'val':_0x449c8a+0x1},_0x138f28),await this[_0x57f843(0x1cc)](_0x2d72cb,_0x613e6b,0x0,_0x57f843(0x1d3)+_0x259f2d+_0x57f843(0x1b4),_0x21535b);}else await this[_0x57f843(0x1cc)](_0x2d72cb,_0x613e6b,-_0x259f2d,_0x57f843(0x1d3)+_0x259f2d+_0x57f843(0x134),_0x21535b);}else await this[_0x57f843(0x1cc)](_0x2d72cb,_0x613e6b,-_0x259f2d,_0x57f843(0x1d3)+_0x259f2d+_0x57f843(0x134),_0x21535b);}}else await this['changeScore4Other'](_0x2d72cb,_0x613e6b,-_0x259f2d,'SD绘画【'+_0x259f2d+_0x57f843(0x134),_0x21535b);}async[_0x577ddf(0x174)](){const _0x2d6b35=_0x577ddf,_0x240bd7=await this[_0x2d6b35(0x128)][_0x2d6b35(0x213)]({'where':{'vipExpire':(0x0,typeorm_2[_0x2d6b35(0x10d)])((0x0,date_1[_0x2d6b35(0x20a)])()[_0x2d6b35(0x111)]('d')[_0x2d6b35(0x21e)](),(0x0,date_1['default'])()[_0x2d6b35(0x231)]('d')[_0x2d6b35(0x21e)]())}});if(_0x240bd7[_0x2d6b35(0xbd)])for(let _0x425b0b=0x0;_0x425b0b<_0x240bd7[_0x2d6b35(0xbd)];_0x425b0b++){const _0x1433c1=_0x240bd7[_0x425b0b];await this[_0x2d6b35(0xd3)][_0x2d6b35(0x121)]({'key':redisKey_constant_1[_0x2d6b35(0x243)]+_0x1433c1['id'],'val':''},(0x0,date_1[_0x2d6b35(0x20a)])()[_0x2d6b35(0x231)]('d')[_0x2d6b35(0x109)]((0x0,date_1[_0x2d6b35(0x20a)])(),'s'));}const _0x43b1e6=await this[_0x2d6b35(0x128)]['find']({'where':{'vipExpire':(0x0,typeorm_2[_0x2d6b35(0x220)])((0x0,date_1[_0x2d6b35(0x20a)])()[_0x2d6b35(0x21e)]())}});if(_0x43b1e6[_0x2d6b35(0xbd)]){const _0x3f918e=_0x43b1e6[_0x2d6b35(0xd2)](_0x2d6d61=>_0x2d6d61['id']);await this[_0x2d6b35(0x128)][_0x2d6b35(0x1c0)]({'id':(0x0,typeorm_2['In'])(_0x3f918e)},{'vipExpire':null});}}};UserService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x577ddf(0x129)])('REDIS_SUBSCRIBER')),__param(0x1,(0x0,typeorm_1[_0x577ddf(0x131)])(user_entity_1[_0x577ddf(0xce)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(saas_entity_1[_0x577ddf(0x18b)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(role_entity_1['RoleEntity'])),__param(0x4,(0x0,typeorm_1[_0x577ddf(0x131)])(user_init_vip_entity_1[_0x577ddf(0x104)])),__param(0x5,(0x0,typeorm_1[_0x577ddf(0x131)])(userFavorite_entity_1[_0x577ddf(0xe4)])),__metadata(_0x577ddf(0xfa),[Object,typeorm_2['Repository'],typeorm_2[_0x577ddf(0x143)],typeorm_2[_0x577ddf(0x143)],typeorm_2['Repository'],typeorm_2['Repository'],nestjs_cls_1['ClsService'],mailer_1['MailerService'],redisCache_service_1[_0x577ddf(0x211)],userBalance_service_1[_0x577ddf(0xcd)],globalConfig_service_1[_0x577ddf(0x1d4)],verification_service_1[_0x577ddf(0x124)],typeorm_2[_0x577ddf(0x185)]])],UserService),exports[_0x577ddf(0xba)]=UserService;