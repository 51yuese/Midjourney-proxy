'use strict';const _0x37a7ad=_0x3468;(function(_0xba0f57,_0x36723a){const _0x3b7061=_0x3468,_0xf8edd=_0xba0f57();while(!![]){try{const _0x2a63b4=parseInt(_0x3b7061(0xfc))/0x1+-parseInt(_0x3b7061(0xb1))/0x2+-parseInt(_0x3b7061(0xa3))/0x3+-parseInt(_0x3b7061(0xcf))/0x4+parseInt(_0x3b7061(0xdd))/0x5*(parseInt(_0x3b7061(0xde))/0x6)+parseInt(_0x3b7061(0x100))/0x7+-parseInt(_0x3b7061(0x112))/0x8;if(_0x2a63b4===_0x36723a)break;else _0xf8edd['push'](_0xf8edd['shift']());}catch(_0x5965c0){_0xf8edd['push'](_0xf8edd['shift']());}}}(_0x1377,0x81738));function _0x3468(_0x4d7a29,_0x5844fc){const _0x1377e9=_0x1377();return _0x3468=function(_0x3468cd,_0xa15da3){_0x3468cd=_0x3468cd-0xa3;let _0x210cbf=_0x1377e9[_0x3468cd];return _0x210cbf;},_0x3468(_0x4d7a29,_0x5844fc);}function _0x1377(){const _0x4d31a3=['scanBindWx','GetQrSceneStrDto','fromusername','axios','Req','getJsapiTicket','env','metadata','扫码绑定轮询查询','OfficialController','__metadata','ApiOperation','4053760rstaXL','1602693AOWWcq','https://saas.qumao518.vip/api/official/notify','客户端发送了文字消息','echostr','application/json','__esModule','UseGuards','design:returntype','获取注册配置','POST','ApiResponse','object','log','timestamp','1829024GrXyvq','公众号通知接口POST','Get','__param','eventkey','notify','获取绑定二维码的sceneStr','function','获取登录跳转地址','unsubscribe','official','saas.qumao518.vip：广播扫码事件失败','gomaxai.qumao518.vip','offical\x20getQRCode','获取登录二维码sceneStr','scan','@nestjs/common','catch','ApiTags','公众号静默登录','prototype','sceneStr','signature','defineProperty','url','default','JwtAuthGuard','getQRCode','send','officialBindAccountText','211504sAvzZP','获取二维码','officialSubscribeText','subscribe','./official.service','genXmlMsg','https://kaifa.qumao518.vip/api/official/notify','https://ceshi.qumao518.vip/api/official/notify','get\x20通知>>>','includes','design:paramtypes','OfficialService','Body','ceshi.qumao518.vip：广播扫码事件失败','4451515iFxBrN','6rWahhV','status','SCAN','notifyPost','Post','genXmlMsgByConfig','error','VIEW','content','length','bindWxBySceneStr','公众号通知接口GET','getQRCodeTicket','Res','GOMAXAI_HOST','./vo/Login.vo','event','text','success','Query','sceneStr:\x20','getQRSceneStrByBind','officialScanLoginText','officialService','design:type','OfficialLoginVO','Logger','https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=','getQRSceneStr','扫码登录轮询查询','1060387LbQpde','loginBySceneStr','getAccessToken','loginByCode','4115167FQatoA','GetQrCodeDto','xml:\x20','msgtype','./dto/getQrSceneStr.dto','./dto/getQrCode.dto'];_0x1377=function(){return _0x4d31a3;};return _0x1377();}var __decorate=this&&this['__decorate']||function(_0x140f86,_0x4ca806,_0xe89c37,_0x5a4aa9){const _0x26b93f=_0x3468;var _0x6504ec=arguments[_0x26b93f(0xe7)],_0x198919=_0x6504ec<0x3?_0x4ca806:_0x5a4aa9===null?_0x5a4aa9=Object['getOwnPropertyDescriptor'](_0x4ca806,_0xe89c37):_0x5a4aa9,_0x4eac9d;if(typeof Reflect===_0x26b93f(0xae)&&typeof Reflect['decorate']===_0x26b93f(0xb8))_0x198919=Reflect['decorate'](_0x140f86,_0x4ca806,_0xe89c37,_0x5a4aa9);else{for(var _0x4bab2c=_0x140f86[_0x26b93f(0xe7)]-0x1;_0x4bab2c>=0x0;_0x4bab2c--)if(_0x4eac9d=_0x140f86[_0x4bab2c])_0x198919=(_0x6504ec<0x3?_0x4eac9d(_0x198919):_0x6504ec>0x3?_0x4eac9d(_0x4ca806,_0xe89c37,_0x198919):_0x4eac9d(_0x4ca806,_0xe89c37))||_0x198919;}return _0x6504ec>0x3&&_0x198919&&Object[_0x26b93f(0xc8)](_0x4ca806,_0xe89c37,_0x198919),_0x198919;},__metadata=this&&this[_0x37a7ad(0x110)]||function(_0x42ee1f,_0x301238){const _0x75bb5c=_0x37a7ad;if(typeof Reflect===_0x75bb5c(0xae)&&typeof Reflect[_0x75bb5c(0x10d)]===_0x75bb5c(0xb8))return Reflect[_0x75bb5c(0x10d)](_0x42ee1f,_0x301238);},__param=this&&this[_0x37a7ad(0xb4)]||function(_0x5864e6,_0x279f41){return function(_0x2cf601,_0xc30d1b){_0x279f41(_0x2cf601,_0xc30d1b,_0x5864e6);};};Object[_0x37a7ad(0xc8)](exports,_0x37a7ad(0xa8),{'value':!![]}),exports[_0x37a7ad(0x10f)]=void 0x0;const common_1=require(_0x37a7ad(0xc1)),swagger_1=require('@nestjs/swagger'),jwtAuth_guard_1=require('../../common/auth/jwtAuth.guard'),official_service_1=require(_0x37a7ad(0xd3)),axios_1=require(_0x37a7ad(0x109)),getQrCode_dto_1=require(_0x37a7ad(0x105)),getQrSceneStr_dto_1=require(_0x37a7ad(0x104)),Login_vo_1=require(_0x37a7ad(0xed));let OfficialController=class OfficialController{constructor(_0xfeb5b6){const _0x2e81c5=_0x37a7ad;this[_0x2e81c5(0xf5)]=_0xfeb5b6;}async[_0x37a7ad(0xb6)](_0x52f7b2,_0xb3a78f,_0x190c96){const _0x4ec194=_0x37a7ad;console[_0x4ec194(0xaf)](_0x4ec194(0xd7),_0xb3a78f,_0x190c96);const _0x33867a=await this['officialService']['verify'](_0xb3a78f[_0x4ec194(0xc7)],_0xb3a78f['nonce'],_0xb3a78f[_0x4ec194(0xb0)]);return _0x33867a?_0xb3a78f[_0x4ec194(0xa6)]:'';}async['notifyPost'](_0x3b9bcb,_0x5eee0e,_0x24e09e,_0x193d1e){const _0x46d787=_0x37a7ad,{xml:_0x3b5b7e}=_0x24e09e;console['log'](_0x46d787(0x102),_0x3b5b7e);const _0x5c1733=process[_0x46d787(0x10c)][_0x46d787(0xec)];_0x5c1733===_0x46d787(0xbd)&&((0x0,axios_1[_0x46d787(0xca)])({'url':_0x46d787(0xd5),'data':_0x24e09e,'method':'POST','headers':{'Content-Type':_0x46d787(0xa7)}})[_0x46d787(0xc2)](_0x57c7ab=>{console['error']('kaifa.qumao518.vip：广播扫码事件失败');}),(0x0,axios_1[_0x46d787(0xca)])({'url':_0x46d787(0xd6),'data':_0x24e09e,'method':_0x46d787(0xac),'headers':{'Content-Type':_0x46d787(0xa7)}})[_0x46d787(0xc2)](_0x56c7a0=>{const _0x552716=_0x46d787;console[_0x552716(0xe4)](_0x552716(0xdc));}),(0x0,axios_1[_0x46d787(0xca)])({'url':_0x46d787(0xa4),'data':_0x24e09e,'method':_0x46d787(0xac),'headers':{'Content-Type':_0x46d787(0xa7)}})[_0x46d787(0xc2)](_0x2e6a9e=>{const _0x33e574=_0x46d787;console[_0x33e574(0xe4)](_0x33e574(0xbc));}));if(_0x3b5b7e[_0x46d787(0x103)][0x0]=='event'){if(_0x3b5b7e[_0x46d787(0xee)][0x0]==_0x46d787(0xe5)||_0x3b5b7e[_0x46d787(0xee)][0x0]=='CLICK')return _0x193d1e[_0x46d787(0xdf)](0xc8)[_0x46d787(0xcd)]('');if(_0x3b5b7e[_0x46d787(0xee)][0x0]==_0x46d787(0xe0)){console[_0x46d787(0xaf)]('扫码');const _0x24ce4f=_0x3b5b7e[_0x46d787(0xb5)][0x0];if(_0x24ce4f[_0x46d787(0xd8)]('/')){this['officialService'][_0x46d787(0x106)](_0x3b5b7e[_0x46d787(0x108)][0x0],_0x24ce4f);const _0x4fb14e=await this[_0x46d787(0xf5)][_0x46d787(0xe3)](_0x3b5b7e,_0x46d787(0xce));return _0x193d1e[_0x46d787(0xdf)](0xc8)[_0x46d787(0xcd)](_0x4fb14e);}this[_0x46d787(0xf5)][_0x46d787(0xc0)](_0x3b5b7e[_0x46d787(0x108)][0x0],_0x24ce4f);const _0x515093=await this[_0x46d787(0xf5)][_0x46d787(0xe3)](_0x3b5b7e,_0x46d787(0xf4));return _0x193d1e[_0x46d787(0xdf)](0xc8)[_0x46d787(0xcd)](_0x515093);}if(_0x3b5b7e[_0x46d787(0xee)][0x0]==_0x46d787(0xd2)){console['log']('订阅',_0x3b5b7e[_0x46d787(0xb5)][0x0]);const _0x4232d0=_0x3b5b7e[_0x46d787(0xb5)][0x0]['split']('qrscene_')[0x1];console['log'](_0x46d787(0xf2),_0x4232d0);if(!_0x4232d0){const _0x18e06f=await this[_0x46d787(0xf5)]['genXmlMsgByConfig'](_0x3b5b7e,_0x46d787(0xd1));return _0x193d1e[_0x46d787(0xdf)](0xc8)[_0x46d787(0xcd)](_0x18e06f);}if(_0x4232d0[_0x46d787(0xd8)]('/')){this[_0x46d787(0xf5)][_0x46d787(0x106)](_0x3b5b7e[_0x46d787(0x108)][0x0],_0x4232d0);const _0xf0181e=await this['officialService'][_0x46d787(0xe3)](_0x3b5b7e,'officialBindAccountText');return _0x193d1e['status'](0xc8)[_0x46d787(0xcd)](_0xf0181e);}this[_0x46d787(0xf5)][_0x46d787(0xc0)](_0x3b5b7e['fromusername'][0x0],_0x4232d0);const _0x59a311=await this['officialService'][_0x46d787(0xe3)](_0x3b5b7e,_0x46d787(0xd1));return _0x193d1e['status'](0xc8)[_0x46d787(0xcd)](_0x59a311);}if(_0x3b5b7e[_0x46d787(0xee)][0x0]==_0x46d787(0xba))return _0x193d1e[_0x46d787(0xdf)](0xc8)['send']('');}if(_0x3b5b7e[_0x46d787(0x103)][0x0]==_0x46d787(0xef)){console[_0x46d787(0xaf)](_0x46d787(0xa5));const _0x3b09a5=await this['officialService']['aotoPlay'](_0x3b5b7e[_0x46d787(0xe6)][0x0]),_0x522b0e=await this[_0x46d787(0xf5)][_0x46d787(0xd4)](_0x3b5b7e,_0x3b09a5);return _0x193d1e[_0x46d787(0xdf)](0xc8)['send'](_0x522b0e);}return _0x46d787(0xf0);}async['getQRSceneStr'](_0x17b82b){const _0x2d6704=_0x37a7ad;return this[_0x2d6704(0xf5)][_0x2d6704(0xfa)](_0x17b82b);}async[_0x37a7ad(0xf3)](_0x240e89){const _0x50e15c=_0x37a7ad;return this[_0x50e15c(0xf5)][_0x50e15c(0xf3)](_0x240e89);}async[_0x37a7ad(0xcc)](_0x5194f8){const _0x199cea=_0x37a7ad,_0x354e16=await this[_0x199cea(0xf5)][_0x199cea(0xea)](_0x5194f8['sceneStr']);return common_1[_0x199cea(0xf8)][_0x199cea(0xaf)](_0x354e16,_0x199cea(0xbe)),_0x199cea(0xf9)+encodeURIComponent(_0x354e16);}async[_0x37a7ad(0xfd)](_0xde7ce0,_0x5a70f6){const _0x3fa350=_0x37a7ad;return this['officialService'][_0x3fa350(0xfd)](_0xde7ce0,_0x5a70f6[_0x3fa350(0xc6)]);}async[_0x37a7ad(0xe8)](_0x5d937e,_0x199e32){const _0x1b1bba=_0x37a7ad;return this[_0x1b1bba(0xf5)][_0x1b1bba(0xe8)](_0x5d937e,_0x199e32[_0x1b1bba(0xc6)]);}async['getRedirectUrl'](_0xa37429){const _0x21511e=_0x37a7ad;return this[_0x21511e(0xf5)]['getRedirectUrl'](_0xa37429['url']);}async[_0x37a7ad(0x10b)](_0x44d0a3){const _0x179f05=_0x37a7ad;return this[_0x179f05(0xf5)][_0x179f05(0x10b)](_0x44d0a3[_0x179f05(0xc9)]);}async[_0x37a7ad(0xff)](_0x222634,_0x59e09e){const _0x402096=_0x37a7ad;return this['officialService'][_0x402096(0xff)](_0x222634,_0x59e09e['code']);}async[_0x37a7ad(0xfe)](_0x2ab890,_0x1abfbe){const _0x2a6402=_0x37a7ad;return this['officialService'][_0x2a6402(0xfe)](_0x2ab890,_0x1abfbe);}};__decorate([(0x0,common_1[_0x37a7ad(0xb3)])(_0x37a7ad(0xb6)),(0x0,swagger_1[_0x37a7ad(0x111)])({'summary':_0x37a7ad(0xe9)}),__param(0x0,(0x0,common_1[_0x37a7ad(0x10a)])()),__param(0x1,(0x0,common_1[_0x37a7ad(0xf1)])()),__param(0x2,(0x0,common_1[_0x37a7ad(0xdb)])()),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object,Object,Object]),__metadata('design:returntype',Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xb6),null),__decorate([(0x0,common_1[_0x37a7ad(0xe2)])('notify'),(0x0,swagger_1[_0x37a7ad(0x111)])({'summary':_0x37a7ad(0xb2)}),__param(0x0,(0x0,common_1[_0x37a7ad(0x10a)])()),__param(0x1,(0x0,common_1[_0x37a7ad(0xf1)])()),__param(0x2,(0x0,common_1[_0x37a7ad(0xdb)])()),__param(0x3,(0x0,common_1[_0x37a7ad(0xeb)])()),__metadata('design:type',Function),__metadata(_0x37a7ad(0xd9),[Object,Object,Object,Object]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xe1),null),__decorate([(0x0,common_1[_0x37a7ad(0xe2)])(_0x37a7ad(0xfa)),(0x0,swagger_1['ApiOperation'])({'summary':_0x37a7ad(0xbf)}),__param(0x0,(0x0,common_1[_0x37a7ad(0xdb)])()),__metadata('design:type',Function),__metadata('design:paramtypes',[getQrSceneStr_dto_1[_0x37a7ad(0x107)]]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xfa),null),__decorate([(0x0,common_1[_0x37a7ad(0xe2)])(_0x37a7ad(0xf3)),(0x0,swagger_1[_0x37a7ad(0x111)])({'summary':_0x37a7ad(0xb7)}),(0x0,common_1[_0x37a7ad(0xa9)])(jwtAuth_guard_1[_0x37a7ad(0xcb)]),__param(0x0,(0x0,common_1['Req'])()),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xf3),null),__decorate([(0x0,common_1[_0x37a7ad(0xb3)])(_0x37a7ad(0xcc)),(0x0,swagger_1['ApiOperation'])({'summary':_0x37a7ad(0xd0)}),__param(0x0,(0x0,common_1[_0x37a7ad(0xf1)])()),__metadata(_0x37a7ad(0xf6),Function),__metadata('design:paramtypes',[getQrCode_dto_1[_0x37a7ad(0x101)]]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController['prototype'],_0x37a7ad(0xcc),null),__decorate([(0x0,common_1['Post'])('loginBySceneStr'),(0x0,swagger_1[_0x37a7ad(0x111)])({'summary':_0x37a7ad(0xfb)}),__param(0x0,(0x0,common_1[_0x37a7ad(0x10a)])()),__param(0x1,(0x0,common_1[_0x37a7ad(0xdb)])()),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object,getQrCode_dto_1[_0x37a7ad(0x101)]]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xfd),null),__decorate([(0x0,common_1[_0x37a7ad(0xe2)])(_0x37a7ad(0xe8)),(0x0,swagger_1[_0x37a7ad(0x111)])({'summary':_0x37a7ad(0x10e)}),(0x0,common_1[_0x37a7ad(0xa9)])(jwtAuth_guard_1[_0x37a7ad(0xcb)]),__param(0x0,(0x0,common_1[_0x37a7ad(0x10a)])()),__param(0x1,(0x0,common_1[_0x37a7ad(0xdb)])()),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object,getQrCode_dto_1[_0x37a7ad(0x101)]]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xe8),null),__decorate([(0x0,common_1[_0x37a7ad(0xe2)])('getRedirectUrl'),(0x0,swagger_1[_0x37a7ad(0x111)])({'summary':_0x37a7ad(0xb9)}),__param(0x0,(0x0,common_1[_0x37a7ad(0xdb)])()),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],'getRedirectUrl',null),__decorate([(0x0,common_1[_0x37a7ad(0xe2)])(_0x37a7ad(0x10b)),(0x0,swagger_1[_0x37a7ad(0x111)])({'summary':_0x37a7ad(0xab)}),__param(0x0,(0x0,common_1[_0x37a7ad(0xdb)])()),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0x10b),null),__decorate([(0x0,common_1[_0x37a7ad(0xe2)])(_0x37a7ad(0xff)),(0x0,swagger_1['ApiOperation'])({'summary':_0x37a7ad(0xc4)}),(0x0,swagger_1[_0x37a7ad(0xad)])({'type':Login_vo_1[_0x37a7ad(0xf7)]}),__param(0x0,(0x0,common_1['Req'])()),__param(0x1,(0x0,common_1['Body'])()),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object,Object]),__metadata(_0x37a7ad(0xaa),Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xff),null),__decorate([(0x0,common_1[_0x37a7ad(0xb3)])('getAccessToken'),__param(0x0,(0x0,common_1[_0x37a7ad(0x10a)])()),__param(0x1,(0x0,common_1[_0x37a7ad(0xf1)])('type')),__metadata(_0x37a7ad(0xf6),Function),__metadata(_0x37a7ad(0xd9),[Object,String]),__metadata('design:returntype',Promise)],OfficialController[_0x37a7ad(0xc5)],_0x37a7ad(0xfe),null),OfficialController=__decorate([(0x0,swagger_1[_0x37a7ad(0xc3)])(_0x37a7ad(0xbb)),(0x0,common_1['Controller'])('official'),__metadata('design:paramtypes',[official_service_1[_0x37a7ad(0xda)]])],OfficialController),exports['OfficialController']=OfficialController;