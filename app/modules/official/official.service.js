'use strict';const _0x150ea4=_0x45b7;(function(_0x23ead1,_0x314a6b){const _0x2b1cfc=_0x45b7,_0x9ef282=_0x23ead1();while(!![]){try{const _0x3e5173=-parseInt(_0x2b1cfc(0xd0))/0x1*(parseInt(_0x2b1cfc(0xd5))/0x2)+-parseInt(_0x2b1cfc(0xd1))/0x3*(-parseInt(_0x2b1cfc(0xcc))/0x4)+-parseInt(_0x2b1cfc(0xb3))/0x5+-parseInt(_0x2b1cfc(0xd8))/0x6*(-parseInt(_0x2b1cfc(0x96))/0x7)+parseInt(_0x2b1cfc(0xd2))/0x8*(parseInt(_0x2b1cfc(0xe3))/0x9)+-parseInt(_0x2b1cfc(0x93))/0xa*(parseInt(_0x2b1cfc(0xec))/0xb)+parseInt(_0x2b1cfc(0xc5))/0xc*(parseInt(_0x2b1cfc(0xf6))/0xd);if(_0x3e5173===_0x314a6b)break;else _0x9ef282['push'](_0x9ef282['shift']());}catch(_0x282eaa){_0x9ef282['push'](_0x9ef282['shift']());}}}(_0x5ebd,0x96844));function _0x45b7(_0x5d8a7c,_0x287820){const _0x5ebd7a=_0x5ebd();return _0x45b7=function(_0x45b790,_0x610c12){_0x45b790=_0x45b790-0x8e;let _0x57376d=_0x5ebd7a[_0x45b790];return _0x57376d;},_0x45b7(_0x5d8a7c,_0x287820);}var __decorate=this&&this[_0x150ea4(0xa8)]||function(_0x4b7655,_0x2060d4,_0xa643be,_0x102606){const _0x5bcf8d=_0x150ea4;var _0x19c48e=arguments['length'],_0x32ea0f=_0x19c48e<0x3?_0x2060d4:_0x102606===null?_0x102606=Object['getOwnPropertyDescriptor'](_0x2060d4,_0xa643be):_0x102606,_0x17e61c;if(typeof Reflect===_0x5bcf8d(0xe7)&&typeof Reflect[_0x5bcf8d(0x8f)]===_0x5bcf8d(0xa2))_0x32ea0f=Reflect['decorate'](_0x4b7655,_0x2060d4,_0xa643be,_0x102606);else{for(var _0x513ac8=_0x4b7655['length']-0x1;_0x513ac8>=0x0;_0x513ac8--)if(_0x17e61c=_0x4b7655[_0x513ac8])_0x32ea0f=(_0x19c48e<0x3?_0x17e61c(_0x32ea0f):_0x19c48e>0x3?_0x17e61c(_0x2060d4,_0xa643be,_0x32ea0f):_0x17e61c(_0x2060d4,_0xa643be))||_0x32ea0f;}return _0x19c48e>0x3&&_0x32ea0f&&Object[_0x5bcf8d(0xfd)](_0x2060d4,_0xa643be,_0x32ea0f),_0x32ea0f;},__metadata=this&&this[_0x150ea4(0xca)]||function(_0xcba98b,_0x4759f3){const _0x4a9faa=_0x150ea4;if(typeof Reflect===_0x4a9faa(0xe7)&&typeof Reflect[_0x4a9faa(0xee)]==='function')return Reflect[_0x4a9faa(0xee)](_0xcba98b,_0x4759f3);};function _0x5ebd(){const _0xca4fa7=['HttpStatus','mini',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','&secret=','join','BAD_REQUEST','&url=',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','default','tousername','156YOdsUB','HttpException','design:paramtypes','autoreplyService','AutoreplyService','__metadata','sceneStrMap','1524128wFHxkR','userService','log','createRandomNonceStr','11017IKnaXD','3sGHbze','1049304CSSvTA','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','非法参数','218sYcmKG','authToken','wechatAccessToken','6vCTeur','str:\x20','post','bindWxBySceneStr','globalConfigService','getAccessToken','&code=','./../autoreply/autoreply.service','officialAutoReplyText','../../common/utils/date','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','81znBbDJ','bindWx','./vo/Login.vo','hex','object','aotoPlay','split','wechatJsapiTicket','&openid=','187MhCXWl','getUserOpenId','metadata','./../auth/auth.service','getConfigByKeys','OfficialLoginVO','wechatOfficialAppSecret','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','../../common/constants/redisKey.constant','&noncestr=','985881QyONmF','OfficialService','update','get','@nestjs/common','user','genXmlMsg','defineProperty','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','decorate','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','getRedirectUrl','getQRSceneStrByBind','553720fNkUVn','GlobalConfigService','sort','1612394cbrOkA','wechatOfficialToken','valueOf','loginByCode','&lang=zh_CN','&grant_type=authorization_code','getJwtToken','createHash','authService','fromusername','Injectable','verify','function','openId','fetchQRCodeTicket','&timestamp=','sha1','&redirect_uri=','__decorate','checkAutoReply','../../common/utils','scanBindWx','scan','errmsg','wechatOfficialAppId','WE_MINI_ACCESS_KEY','UserService','jiangly','appId:\x20','95145cLxTRz','回跳跳转地址:\x20','digest','error','redisCacheService','genXmlMsgByConfig','jsapi_ticket=','scanedSceneStrMap'];_0x5ebd=function(){return _0xca4fa7;};return _0x5ebd();}Object[_0x150ea4(0xfd)](exports,'__esModule',{'value':!![]}),exports[_0x150ea4(0xf7)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),auth_service_1=require(_0x150ea4(0xef)),user_service_1=require('./../user/user.service'),autoreply_service_1=require(_0x150ea4(0xdf)),common_1=require(_0x150ea4(0xfa)),crypto=require('crypto'),axios_1=require('axios'),utils_1=require(_0x150ea4(0xaa)),Login_vo_1=require(_0x150ea4(0xe5)),redisKey_constant_1=require(_0x150ea4(0xf4)),redisCache_service_1=require('../redisCache/redisCache.service'),date_1=require(_0x150ea4(0xe1));let OfficialService=class OfficialService{constructor(_0x51bde9,_0x3d3594,_0x52d717,_0x2c6450,_0x2b7943){const _0x2eede8=_0x150ea4;this[_0x2eede8(0xc8)]=_0x51bde9,this[_0x2eede8(0xcd)]=_0x3d3594,this['authService']=_0x52d717,this[_0x2eede8(0xdc)]=_0x2c6450,this[_0x2eede8(0xb7)]=_0x2b7943,this[_0x2eede8(0xcb)]={},this[_0x2eede8(0xba)]={};}async['getQRSceneStr'](_0x3636dd){const _0x1bcec5=_0x150ea4,{invitedBy:_0x3f63dc}=_0x3636dd;let _0x226e69=(0x0,utils_1[_0x1bcec5(0xcf)])(0x20);return _0x3f63dc&&(_0x226e69+=':'+_0x3f63dc),this[_0x1bcec5(0xcb)][_0x226e69]=!![],_0x226e69;}async[_0x150ea4(0x92)](_0x3f7079){const _0x5cde45=_0x150ea4,{id:_0x1f0eef}=_0x3f7079[_0x5cde45(0xfb)],_0x5657a4=(0x0,utils_1[_0x5cde45(0xcf)])(0x20)+'/'+_0x1f0eef;return this[_0x5cde45(0xcb)][_0x5657a4]=!![],_0x5657a4;}async['getQRCodeTicket'](_0x3495f5){const _0xdd2fab=_0x150ea4;return this[_0xdd2fab(0xa4)](_0x3495f5);}async[_0x150ea4(0x91)](_0x252cdf){const _0x213c7e=_0x150ea4,_0x504156=await this[_0x213c7e(0xdc)][_0x213c7e(0xf0)](['wechatOfficialAppId']),_0x1bcbf2=_0x213c7e(0x8e)+_0x504156+_0x213c7e(0xa7)+encodeURIComponent(_0x252cdf)+_0x213c7e(0xf3);return console[_0x213c7e(0xce)](_0x213c7e(0xb4),_0x1bcbf2),_0x1bcbf2;}async['getJsapiTicket'](_0x14db1f){const _0xb73b24=_0x150ea4,_0x56b500=(0x0,utils_1['createRandomNonceStr'])(0x20),_0x4b401d=(Date['now']()/0x3e8)['toFixed'](0x0),_0x182ada=await this['globalConfigService']['getConfigByKeys']([_0xb73b24(0xea),_0xb73b24(0xae)]),{wechatJsapiTicket:_0x3b53c8,wechatOfficialAppId:_0x1f3269}=_0x182ada;console[_0xb73b24(0xce)]('jsapiTicket:\x20',_0x3b53c8),console[_0xb73b24(0xce)](_0xb73b24(0xb2),_0x1f3269);const _0x130791=_0xb73b24(0xb9)+_0x3b53c8+_0xb73b24(0xf5)+_0x56b500+_0xb73b24(0xa5)+_0x4b401d+_0xb73b24(0xc1)+_0x14db1f;console[_0xb73b24(0xce)](_0xb73b24(0xd9),_0x130791);const _0x1675f2=this['sha1'](_0x130791);return{'appId':_0x1f3269,'nonceStr':_0x56b500,'timestamp':_0x4b401d,'signature':_0x1675f2};}async[_0x150ea4(0xa4)](_0x5edbc8){const _0x1e56d7=_0x150ea4,_0x26898c=await this['globalConfigService'][_0x1e56d7(0xf0)](['wechatAccessToken']),_0x5ec2d1={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x5edbc8}}},_0x125215=await axios_1[_0x1e56d7(0xc3)][_0x1e56d7(0xda)](_0x1e56d7(0xd3)+_0x26898c,_0x5ec2d1),{data:{errmsg:_0xee5456,ticket:_0xc248eb}}=_0x125215;if(_0xee5456)throw new common_1[(_0x1e56d7(0xc6))](_0xee5456,common_1[_0x1e56d7(0xbb)][_0x1e56d7(0xc0)]);return _0xc248eb;}async[_0x150ea4(0x99)](_0x283b43,_0x56f2ae){const _0x3f9011=_0x150ea4,_0x30af50=await this['globalConfigService'][_0x3f9011(0xf0)](['wechatOfficialAppId',_0x3f9011(0xf2)]),{wechatOfficialAppId:_0x1f5085,wechatOfficialAppSecret:_0x2b6709}=_0x30af50,_0x1cb684=await axios_1['default']['get'](_0x3f9011(0xe2)+_0x1f5085+_0x3f9011(0xbe)+_0x2b6709+_0x3f9011(0xde)+_0x56f2ae+_0x3f9011(0x9b)),{data:{errmsg:_0x23fe75,openid:_0x2e5312,access_token:_0x20e23c}}=_0x1cb684;if(_0x23fe75)throw new common_1['HttpException'](_0x23fe75,common_1[_0x3f9011(0xbb)][_0x3f9011(0xc0)]);let _0x1d1f2a=new Login_vo_1[(_0x3f9011(0xf1))]();_0x1d1f2a[_0x3f9011(0xa3)]=_0x2e5312;const _0x2e03b7=await this[_0x3f9011(0xcd)]['getUserOpenId'](_0x2e5312);if(_0x2e03b7)_0x1d1f2a[_0x3f9011(0xd6)]=await this[_0x3f9011(0x9e)][_0x3f9011(0x9c)](_0x2e03b7,_0x283b43);else{if(_0x20e23c){const {data:_0x3ef728}=await axios_1[_0x3f9011(0xc3)][_0x3f9011(0xf9)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20https://api.weixin.qq.com/sns/userinfo?access_token='+_0x20e23c+_0x3f9011(0xeb)+_0x2e5312+_0x3f9011(0x9a));!_0x3ef728[_0x3f9011(0xad)]&&console[_0x3f9011(0xb6)](_0x3ef728[_0x3f9011(0xad)]),_0x1d1f2a['wechatUser']=_0x3ef728;}}return _0x1d1f2a;}async[_0x150ea4(0xac)](_0x5da658,_0x4f1673){const _0x38f2fd=_0x150ea4;if(!this[_0x38f2fd(0xcb)][_0x4f1673])throw new common_1[(_0x38f2fd(0xc6))](_0x38f2fd(0xd4),common_1[_0x38f2fd(0xbb)]['BAD_REQUEST']);this[_0x38f2fd(0xba)][_0x4f1673]=_0x5da658;}async['loginBySceneStr'](_0x2707fa,_0x3dc3f3){const _0x2af5a3=_0x150ea4;if(!this['sceneStrMap'][_0x3dc3f3])return;const _0x5dd374=this[_0x2af5a3(0xba)][_0x3dc3f3];if(!_0x5dd374)return new Login_vo_1[(_0x2af5a3(0xf1))]();let _0x14d570=new Login_vo_1[(_0x2af5a3(0xf1))]();_0x14d570[_0x2af5a3(0xa3)]=_0x5dd374;const _0x59b4fe=await this[_0x2af5a3(0xcd)][_0x2af5a3(0xed)](_0x5dd374);return _0x59b4fe&&(_0x14d570[_0x2af5a3(0xd6)]=await this[_0x2af5a3(0x9e)][_0x2af5a3(0x9c)](_0x59b4fe,_0x2707fa)),delete this['scanedSceneStrMap'][_0x3dc3f3],_0x14d570;}async[_0x150ea4(0xab)](_0x4bd528,_0x29f287){const _0x263320=_0x150ea4;if(!this[_0x263320(0xcb)][_0x29f287])throw new common_1[(_0x263320(0xc6))](_0x263320(0xd4),common_1[_0x263320(0xbb)][_0x263320(0xc0)]);const _0x58a35f=_0x29f287[_0x263320(0xe9)]('/')[0x1],_0x5dfe72=await this[_0x263320(0xcd)][_0x263320(0xe4)](_0x4bd528,_0x58a35f);this['scanedSceneStrMap'][_0x29f287]=_0x5dfe72;}async[_0x150ea4(0xdb)](_0xab019,_0x1035d7){const _0x2607ba=_0x150ea4;if(!this[_0x2607ba(0xcb)][_0x1035d7])throw new common_1[(_0x2607ba(0xc6))](_0x2607ba(0xd4),common_1[_0x2607ba(0xbb)][_0x2607ba(0xc0)]);const {id:_0x3d3430}=_0xab019[_0x2607ba(0xfb)],_0x2b218b=this['scanedSceneStrMap'][_0x1035d7];if(!_0x2b218b)return'';return delete this['scanedSceneStrMap'][_0x1035d7],_0x2b218b;}async[_0x150ea4(0xa1)](_0x3aaf33,_0x1634ac,_0x40eae8){const _0x287748=_0x150ea4,_0x25258f=await this['globalConfigService'][_0x287748(0xf0)]([_0x287748(0x97)]),_0x325154=_0x25258f||_0x287748(0xb1);return await this[_0x287748(0xa6)]([_0x325154,_0x1634ac,_0x40eae8][_0x287748(0x95)]()[_0x287748(0xbf)](''))==_0x3aaf33;}['sha1'](_0x2ae859){const _0x64b43=_0x150ea4;return crypto[_0x64b43(0x9d)]('sha1')[_0x64b43(0xf8)](_0x2ae859)[_0x64b43(0xb5)](_0x64b43(0xe6));}async[_0x150ea4(0xb8)](_0x213ade,_0x9f6ed6){const _0x2587f6=_0x150ea4,_0x21fe9f=await this['globalConfigService'][_0x2587f6(0xf0)]([_0x9f6ed6]);return this[_0x2587f6(0xfc)](_0x213ade,_0x21fe9f);}async[_0x150ea4(0xfc)](_0x5e88c7,_0x218248){const _0x3159fb=_0x150ea4;return _0x3159fb(0x90)+_0x5e88c7[_0x3159fb(0x9f)][0x0]+_0x3159fb(0xc2)+_0x5e88c7[_0x3159fb(0xc4)][0x0]+_0x3159fb(0xbd)+(0x0,date_1[_0x3159fb(0xc3)])()[_0x3159fb(0x98)]()+'</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA['+_0x218248+']]></Content>\x0a\x20\x20\x20\x20</xml>';}async[_0x150ea4(0xe8)](_0x3a8e27){const _0x5cf910=_0x150ea4;let _0x268547=await this[_0x5cf910(0xc8)][_0x5cf910(0xa9)](_0x3a8e27);if(!_0x268547){const _0x4f0e7d=await this[_0x5cf910(0xdc)][_0x5cf910(0xf0)]([_0x5cf910(0xe0)]);_0x268547=_0x4f0e7d;}return _0x268547;}async[_0x150ea4(0xdd)](_0x1d299d,_0x1a2a85){const _0x2d1b28=_0x150ea4;console['log'](_0x1d299d['ip']);if(_0x1a2a85==='official'){const _0x2acb2a=await this['globalConfigService'][_0x2d1b28(0xf0)]([_0x2d1b28(0xd7)]);return _0x2acb2a;}else{if(_0x1a2a85===_0x2d1b28(0xbc)){const _0x349410=await this[_0x2d1b28(0xb7)]['get']({'key':redisKey_constant_1[_0x2d1b28(0xaf)]});return _0x349410;}else throw new common_1[(_0x2d1b28(0xc6))](null,common_1[_0x2d1b28(0xbb)][_0x2d1b28(0xc0)]);}}};OfficialService=__decorate([(0x0,common_1[_0x150ea4(0xa0)])(),__metadata(_0x150ea4(0xc7),[autoreply_service_1[_0x150ea4(0xc9)],user_service_1[_0x150ea4(0xb0)],auth_service_1['AuthService'],globalConfig_service_1[_0x150ea4(0x94)],redisCache_service_1['RedisCacheService']])],OfficialService),exports[_0x150ea4(0xf7)]=OfficialService;