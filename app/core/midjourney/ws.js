'use strict';const _0x41b966=_0x49a4;(function(_0x354321,_0x44e27d){const _0xe17606=_0x49a4,_0x11ce9a=_0x354321();while(!![]){try{const _0x393749=-parseInt(_0xe17606(0x143))/0x1*(-parseInt(_0xe17606(0x151))/0x2)+parseInt(_0xe17606(0x10d))/0x3+parseInt(_0xe17606(0x13a))/0x4*(parseInt(_0xe17606(0x134))/0x5)+parseInt(_0xe17606(0x13c))/0x6*(parseInt(_0xe17606(0x10a))/0x7)+parseInt(_0xe17606(0xe9))/0x8*(parseInt(_0xe17606(0x100))/0x9)+parseInt(_0xe17606(0xf9))/0xa*(-parseInt(_0xe17606(0x11a))/0xb)+parseInt(_0xe17606(0xf0))/0xc*(-parseInt(_0xe17606(0x127))/0xd);if(_0x393749===_0x44e27d)break;else _0x11ce9a['push'](_0x11ce9a['shift']());}catch(_0x16117e){_0x11ce9a['push'](_0x11ce9a['shift']());}}}(_0x4e2a,0x64be2));function _0x4e2a(){const _0x17f6a8=['get','handleMessageDelete','discord\x20wsClient\x20reconnect...','defineProperty','156zavfSi','once','call','readyState','from',',\x20error\x20reason:\x20','handleMessageUpdate','./utils','toString','wsBaseUrl','formatComponents','describe','/inpaint','3125pEuSmM','parseInt','parse','__esModule','https://cdn.discordapp.com','channel_id','1300ASdWzN','opts','2394222IRwbTX','send','connect','wsClient','url','msgMap','OPEN','1ogdzns','EventEmitter','discord\x20wsClient\x20was\x20close,\x20error\x20code:\x20','arrayBuffer','MESSAGE_CREATE','addEventListener','emitNonce','emitEmbed','imgBaseUrl','eventemitter3','MESSAGE_DELETE','off','Mac\x20OS\x20X','isomorphic-ws','231802olvZYu','open','processingImage','72uRHHJT','nonce','embed','matchRegionNonce','READY','waitReady','error','620844uGDBGt','getMsgByContent','emit','message','./msgMap','number','user','replace','session_id','1929610HKlkop','getMsgById','discord\x20heartbeat\x20ack!','updateMsgByNonce','heartbeatTask','discordsaysUrl','heartbeat','24903KLRZfx','waitMessage','lastSequence','heartbeat_interval','then','wsBaseUrl\x20can\x27t\x20be\x20empty','handleMessageCreate','prompt','image_url','/inpaint/api/get-image-info/0/0/','14pSyhGL','image','MidjourneyWs','253332kYBZFI','ws创建失败','reconnectionTask','bind','json','INTERACTION_IFRAME_MODAL_CREATE','assign','WS_ERROR','split','stringify','wsClient\x20is\x20open!','info','auth','11HkYBnU','INTERACTION_MODAL_CREATE','getMsgByOriginId','close','timestamp','debug','skipHeartbeat','length','MESSAGE_UPDATE'];_0x4e2a=function(){return _0x17f6a8;};return _0x4e2a();}Object[_0x41b966(0x126)](exports,_0x41b966(0x137),{'value':!![]}),exports[_0x41b966(0x10c)]=void 0x0;const eventemitter3_1=require(_0x41b966(0x14c)),{WebSocket}=require(_0x41b966(0x150)),msgMap_1=require(_0x41b966(0xf4)),utils_1=require(_0x41b966(0x12e));function _0x49a4(_0x991140,_0x2e7b4f){const _0x4e2ae2=_0x4e2a();return _0x49a4=function(_0x49a444,_0x481c7e){_0x49a444=_0x49a444-0xe7;let _0x5e99d1=_0x4e2ae2[_0x49a444];return _0x5e99d1;},_0x49a4(_0x991140,_0x2e7b4f);}class MidjourneyWs extends eventemitter3_1[_0x41b966(0x144)]{constructor(_0x3be66e){const _0xa79add=_0x41b966;super(),this[_0xa79add(0x13b)]=_0x3be66e,this['lastSequence']=null,this[_0xa79add(0xfd)]=null,this[_0xa79add(0x10f)]=null,this[_0xa79add(0x141)]=new msgMap_1['MidjourneyMsgMap'](),this[_0xa79add(0x13f)]=this[_0xa79add(0x13e)]();}[_0x41b966(0x13e)](){const _0xd16f4e=_0x41b966;if(!this[_0xd16f4e(0x13b)][_0xd16f4e(0x130)])throw new Error(_0xd16f4e(0x105));let _0x52d6d0;!this[_0xd16f4e(0x13b)]['wsProxyUrl']&&this[_0xd16f4e(0x13b)][_0xd16f4e(0x130)]&&(_0x52d6d0=new WebSocket(this[_0xd16f4e(0x13b)][_0xd16f4e(0x130)]));if(!_0x52d6d0)throw _0xd16f4e(0x10e);return _0x52d6d0[_0xd16f4e(0x148)](_0xd16f4e(0xe7),()=>{const _0x382746=_0xd16f4e;this[_0x382746(0xf2)]('WS_OPEN'),this[_0x382746(0x13b)][_0x382746(0x11f)]?.('MidjourneyWs',_0x382746(0x13e))(_0x382746(0x117)),this['reconnectionTask']&&(clearTimeout(this[_0x382746(0x10f)]),this[_0x382746(0x10f)]=null);}),_0x52d6d0['addEventListener'](_0xd16f4e(0xf3),this['message'][_0xd16f4e(0x110)](this)),_0x52d6d0['addEventListener']('error',_0x2d28c5=>{const _0x93f6e4=_0xd16f4e;this[_0x93f6e4(0xf2)](_0x93f6e4(0x114),_0x2d28c5[_0x93f6e4(0xf3)]),this[_0x93f6e4(0x13b)]['debug']?.(_0x93f6e4(0x10c),_0x93f6e4(0x13e))('discord\x20wsClient\x20occurred\x20an\x20error:\x20'+_0x2d28c5['message']),this[_0x93f6e4(0x13f)][_0x93f6e4(0x11d)]();}),_0x52d6d0[_0xd16f4e(0x148)](_0xd16f4e(0x11d),({code:_0x4ffe12,reason:_0x4f72c4})=>{const _0x3a0933=_0xd16f4e;this[_0x3a0933(0xf2)]('WS_CLOSE'),this[_0x3a0933(0x13b)]['debug']?.('MidjourneyWs','connect')(_0x3a0933(0x145)+_0x4ffe12+_0x3a0933(0x12c)+_0x4f72c4),_0x4ffe12===0xfa4?this[_0x3a0933(0xf2)](_0x3a0933(0xed),new Error(_0x4f72c4)):this[_0x3a0933(0x10f)]=setTimeout(()=>{const _0x10c090=_0x3a0933;this[_0x10c090(0x13b)][_0x10c090(0x11f)]?.(_0x10c090(0x10c),_0x10c090(0x13e))(_0x10c090(0x125)),this['heartbeatTask']&&typeof this[_0x10c090(0xfd)]===_0x10c090(0xf5)&&(clearInterval(this[_0x10c090(0xfd)]),this[_0x10c090(0xfd)]=null),this[_0x10c090(0x13f)]=this[_0x10c090(0x13e)][_0x10c090(0x129)](this);},0xfa0);}),_0x52d6d0;}[_0x41b966(0x119)](){const _0x40e116=_0x41b966;this[_0x40e116(0x13f)][_0x40e116(0x13d)](JSON['stringify']({'op':0x2,'d':{'token':this['opts']['token'],'capabilities':0x3ffd,'properties':{'os':_0x40e116(0x14f),'browser':'Chrome','device':''},'compress':![]}}));}[_0x41b966(0xff)](_0x28dd05){const _0x3565ab=_0x41b966,_0x316be8=_0x28dd05*Math['random']();this[_0x3565ab(0xfd)]=setTimeout(()=>{const _0x2c6a0c=_0x3565ab;this[_0x2c6a0c(0x13f)][_0x2c6a0c(0x12a)]===WebSocket[_0x2c6a0c(0x142)]&&(this[_0x2c6a0c(0x13f)][_0x2c6a0c(0x13d)](JSON['stringify']({'op':0x1,'d':this[_0x2c6a0c(0x102)]})),this[_0x2c6a0c(0xff)](_0x28dd05));},_0x316be8);}[_0x41b966(0xf3)](_0x2544aa){const _0x4e2a7d=_0x41b966,_0x2fa424=JSON[_0x4e2a7d(0x136)](_0x2544aa['data']),_0x5b7ad4=_0x2fa424['d'],_0x17f9df=_0x2fa424['t'],_0x19ed5f=_0x2fa424['s'],_0x57d47f=_0x2fa424['op'];_0x19ed5f&&(this[_0x4e2a7d(0x102)]=_0x19ed5f);_0x57d47f===0xa&&(this['heartbeat'](_0x5b7ad4[_0x4e2a7d(0x103)]),this[_0x4e2a7d(0x119)]());_0x17f9df===_0x4e2a7d(0xed)&&(this['opts'][_0x4e2a7d(0xf8)]=_0x5b7ad4[_0x4e2a7d(0xf8)],this[_0x4e2a7d(0x13b)]['user']=_0x5b7ad4[_0x4e2a7d(0xf6)],this[_0x4e2a7d(0x13b)][_0x4e2a7d(0x11f)]?.(_0x4e2a7d(0x10c),_0x4e2a7d(0xf3))('wsClient\x20connect\x20successfully!'),this['emit']('READY',_0x5b7ad4['user']));if(_0x17f9df===_0x4e2a7d(0x147)||_0x17f9df==='MESSAGE_UPDATE'||_0x17f9df===_0x4e2a7d(0x14d)||_0x17f9df==='INTERACTION_IFRAME_MODAL_CREATE'||_0x17f9df===_0x4e2a7d(0x11b))this['handleMessage'](_0x17f9df,_0x5b7ad4);_0x57d47f===0xb&&(!this[_0x4e2a7d(0x13b)][_0x4e2a7d(0x120)]&&this[_0x4e2a7d(0x13b)][_0x4e2a7d(0x11f)]?.(_0x4e2a7d(0x10c),_0x4e2a7d(0xf3))(_0x4e2a7d(0xfb)));}['handleMessage'](_0x311405,_0x5aa5f2){const _0x1e008f=_0x41b966;if(_0x5aa5f2[_0x1e008f(0x139)]!==this[_0x1e008f(0x13b)]['channel_id'])return;if(_0x311405===_0x1e008f(0x147)||_0x311405===_0x1e008f(0x112)||_0x311405===_0x1e008f(0x11b))this['handleMessageCreate'](_0x311405,_0x5aa5f2);else{if(_0x311405===_0x1e008f(0x122))this[_0x1e008f(0x12d)](_0x1e008f(0x122),_0x5aa5f2);else this['handleMessageDelete'](_0x5aa5f2);}}[_0x41b966(0x106)](_0x426545,_0x1b22b7){const _0x2f9ab8=_0x41b966;let {nonce:_0x4644ee,id:_0x54887e,embeds:embeds=[],custom_id:_0x40f931,content:_0x191b4b,attachments:attachments=[],components:_0x22c7d2}=_0x1b22b7;_0x4644ee=_0x4644ee||(0x0,utils_1[_0x2f9ab8(0xec)])(_0x191b4b);if(_0x4644ee&&!attachments['length']){this[_0x2f9ab8(0x141)][_0x2f9ab8(0xfc)](_0x54887e,_0x4644ee);if(embeds[0x0]){const {color:_0x15d14a}=embeds[0x0];switch(_0x15d14a){case 0xff0000:this[_0x2f9ab8(0x14a)](_0x54887e,_0x2f9ab8(0x147),embeds[0x0]);break;default:break;}}if(_0x426545===_0x2f9ab8(0x112)&&_0x40f931){_0x40f931=_0x40f931[_0x2f9ab8(0x115)]('::')[0x2];let _0x5cddfb='';return fetch(this[_0x2f9ab8(0x13b)][_0x2f9ab8(0xfe)]+_0x2f9ab8(0x109)+_0x40f931)[_0x2f9ab8(0x104)](async _0x11fdfa=>{const _0x494403=_0x2f9ab8;if(_0x11fdfa['ok']){const _0x1b1845=await _0x11fdfa[_0x494403(0x111)]();_0x5cddfb=_0x1b1845[_0x494403(0x107)];const _0x53c5ca=await fetch(this['opts'][_0x494403(0xfe)]+_0x494403(0x133)+_0x1b1845[_0x494403(0x108)]?.[_0x494403(0xf7)](/^\./,''))['then'](_0x331b8b=>_0x331b8b[_0x494403(0x146)]())[_0x494403(0x104)](_0xc9fcf0=>Buffer[_0x494403(0x12b)](_0xc9fcf0)[_0x494403(0x12f)]('base64'));this[_0x494403(0x149)](_0x4644ee,_0x426545,{'custom_id':_0x40f931,'varyRegionPrompt':_0x5cddfb,'varyRegionImgBase64':_0x53c5ca});}});}_0x426545===_0x2f9ab8(0x11b)&&_0x40f931&&_0x22c7d2['length']&&this['emitNonce'](_0x4644ee,_0x426545,{'id':_0x54887e,'custom_id':_0x40f931,'components':_0x22c7d2});}this[_0x2f9ab8(0x12d)](_0x2f9ab8(0x147),_0x1b22b7);}[_0x41b966(0x12d)](_0x554a59,_0x3bc254){const _0x417071=_0x41b966,{content:_0x45a274,interaction:interaction={},nonce:_0x5663d7,flags:_0x32afff,attachments:_0x16a7ea,components:components=[],embeds:embeds=[],id:_0x237703}=_0x3bc254;if(!_0x5663d7){const {name:_0x2ad14a}=interaction,_0x180f7c=this[_0x417071(0x141)][_0x417071(0xfa)](_0x237703);if(_0x180f7c&&_0x180f7c[_0x417071(0xea)])switch(_0x2ad14a){case'settings':this[_0x417071(0x149)](_0x180f7c[_0x417071(0xea)],_0x554a59,{'id':_0x237703,'flags':_0x32afff,'components':(0x0,utils_1['formatComponents'])(components),'progress':0x64});return;case _0x417071(0x118):embeds['at'](0x0)&&this['emitNonce'](_0x180f7c[_0x417071(0xea)],_0x554a59,{'id':_0x237703,'embed':embeds[0x0],'progress':0x64});return;case _0x417071(0x132):embeds['at'](0x0)&&this[_0x417071(0x149)](_0x180f7c[_0x417071(0xea)],_0x554a59,{'flags':_0x32afff,'url':embeds[0x0][_0x417071(0x10b)][_0x417071(0x140)],'timestamp':_0x3bc254[_0x417071(0x11e)],'components':(0x0,utils_1[_0x417071(0x131)])(components),'id':_0x237703,'embed':embeds[0x0],'progress':0x64});return;}}_0x45a274&&this['processingImage'](_0x554a59,_0x3bc254);}[_0x41b966(0x124)]({id:_0x2bc24e}){const _0x38cc0e=_0x41b966;this[_0x38cc0e(0x149)](_0x2bc24e,'MESSAGE_DELETE',{'id':_0x2bc24e},!![]);}[_0x41b966(0xe8)](_0xf2cb9d,_0x45491f){const _0x372a84=_0x41b966,{content:_0x196454,id:_0x1f74b9,attachments:attachments=[],flags:_0x5a7263,components:components=[],nonce:_0x4e0980,timestamp:_0x2ac0e0,message_reference:message_reference={}}=_0x45491f,{message_id:_0x7a31f3}=message_reference,_0x15e946=this['msgMap'][_0x372a84(0xfa)](_0x1f74b9)||this[_0x372a84(0x141)]['getMsgByparentId'](_0x7a31f3)||this[_0x372a84(0x141)][_0x372a84(0xf1)](_0x196454);if(!_0x15e946?.['nonce']){console['error']('nonce\x20is\x20none');return;}let _0x45d406=attachments['at'](0x0)?.[_0x372a84(0x140)];if(_0x45d406&&this[_0x372a84(0x13b)][_0x372a84(0x14b)])_0x45d406=_0x45d406[_0x372a84(0xf7)](_0x372a84(0x138),this[_0x372a84(0x13b)]['imgBaseUrl']);const _0xf539f=_0x196454?.['match'](/\((\d+?)%\)\s\(\w+?\)/)?.[0x1],_0x5acdf9=!_0x4e0980&&attachments[_0x372a84(0x121)]&&components['length']&&_0xf2cb9d===_0x372a84(0x147),_0x4f5ba0=_0x5acdf9?0x64:_0xf539f?Number[_0x372a84(0x135)](_0xf539f):0x0,_0x4f3de7=_0x15e946?.['id']!==_0x1f74b9?_0x15e946?.['id']:undefined,_0x3bfe87=JSON[_0x372a84(0x136)](JSON[_0x372a84(0x116)]({'id':_0x1f74b9,'url':_0x45d406,'originId':_0x4f3de7,'attachments':attachments,'content':_0x196454['replace'](/^\*\*regionNonce:\s\d+?,\s/,'**'),'parentId':_0x7a31f3,'flags':_0x5a7263,'components':(0x0,utils_1[_0x372a84(0x131)])(components),'progress':_0x4f5ba0,'timestamp':_0x2ac0e0}));this['emitNonce'](_0x15e946[_0x372a84(0xea)],_0xf2cb9d,_0x3bfe87);}[_0x41b966(0x149)](_0x35575e,_0x5ae514,_0x62e389,_0x59403f=![]){const _0x436fbc=_0x41b966,_0x267dd1=this['msgMap'][_0x436fbc(0x123)](_0x35575e)||this['msgMap'][_0x436fbc(0xfa)](_0x35575e)||this[_0x436fbc(0x141)][_0x436fbc(0x11c)](_0x35575e);_0x267dd1&&_0x267dd1[_0x436fbc(0xea)]&&this[_0x436fbc(0xf2)](_0x267dd1[_0x436fbc(0xea)],_0x5ae514,_0x59403f?_0x62e389:Object[_0x436fbc(0x113)]({},_0x267dd1,_0x62e389));}[_0x41b966(0x14a)](_0x236b9e,_0x124e60,_0x1cb09d){const _0x1315a6=_0x41b966,_0x4cb655=this['msgMap']['getMsgById'](_0x236b9e);if(!_0x4cb655||!_0x4cb655[_0x1315a6(0xea)])return;_0x4cb655[_0x1315a6(0xeb)]=_0x1cb09d,this['emitNonce'](_0x4cb655['nonce'],_0x124e60,_0x4cb655);}[_0x41b966(0xee)](){return new Promise((_0x2ddf2e,_0x2279ee)=>{const _0x2ae9bf=_0x49a4;this[_0x2ae9bf(0x128)]('READY',_0x4c8b92=>_0x4c8b92 instanceof Error?_0x2279ee(_0x4c8b92):_0x2ddf2e(_0x4c8b92));});}[_0x41b966(0x101)]({nonce:_0x49d221,parentId:_0x26a5de,cb:_0x12e4f5}){const _0x49a3b3=_0x41b966;this[_0x49a3b3(0x141)]['set'](_0x49d221,{'id':'','nonce':_0x49d221});const _0x266993=_0x26a5de&&this[_0x49a3b3(0x141)][_0x49a3b3(0xfa)](_0x26a5de);return new Promise((_0x38197d,_0x260114)=>{const _0x43d7f3=_0x49a3b3;_0x266993&&_0x266993['nonce']&&this[_0x43d7f3(0x128)](_0x266993[_0x43d7f3(0xea)],(_0x1010a3,_0x30ca95)=>{const _0xfae80a=_0x43d7f3;_0x12e4f5?.(_0x1010a3,_0x30ca95),this[_0xfae80a(0x14e)](_0x266993['nonce']);}),this['on'](_0x49d221,(_0x388f70,_0x42f94a)=>{const _0x15f8ed=_0x43d7f3;_0x12e4f5?.(_0x388f70,_0x42f94a);if(_0x388f70===_0x15f8ed(0x14d)&&_0x42f94a['id']){const _0x52f1a1=this[_0x15f8ed(0x141)][_0x15f8ed(0x11c)](_0x42f94a['id']);_0x52f1a1&&this[_0x15f8ed(0x14e)](_0x49d221)&&_0x38197d(_0x52f1a1);return;}if(_0x388f70===_0x15f8ed(0x112)||_0x388f70==='INTERACTION_MODAL_CREATE'){this[_0x15f8ed(0x14e)](_0x49d221);return;}this[_0x15f8ed(0x141)]['set'](_0x49d221,_0x42f94a),_0x42f94a[_0x15f8ed(0xef)]&&(this[_0x15f8ed(0x14e)](_0x49d221),_0x260114(_0x42f94a[_0x15f8ed(0xef)]));});});}}exports[_0x41b966(0x10c)]=MidjourneyWs;